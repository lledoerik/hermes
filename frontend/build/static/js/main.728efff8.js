/*! For license information please see main.728efff8.js.LICENSE.txt */
(()=>{"use strict";var e={43:(e,t,s)=>{e.exports=s(202)},153:(e,t,s)=>{var n=s(43),r=Symbol.for("react.element"),i=Symbol.for("react.fragment"),a=Object.prototype.hasOwnProperty,o=n.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,l={key:!0,ref:!0,__self:!0,__source:!0};function c(e,t,s){var n,i={},c=null,d=null;for(n in void 0!==s&&(c=""+s),void 0!==t.key&&(c=""+t.key),void 0!==t.ref&&(d=t.ref),t)a.call(t,n)&&!l.hasOwnProperty(n)&&(i[n]=t[n]);if(e&&e.defaultProps)for(n in t=e.defaultProps)void 0===i[n]&&(i[n]=t[n]);return{$$typeof:r,type:e,key:c,ref:d,props:i,_owner:o.current}}t.Fragment=i,t.jsx=c,t.jsxs=c},202:(e,t)=>{var s=Symbol.for("react.element"),n=Symbol.for("react.portal"),r=Symbol.for("react.fragment"),i=Symbol.for("react.strict_mode"),a=Symbol.for("react.profiler"),o=Symbol.for("react.provider"),l=Symbol.for("react.context"),c=Symbol.for("react.forward_ref"),d=Symbol.for("react.suspense"),u=Symbol.for("react.memo"),h=Symbol.for("react.lazy"),f=Symbol.iterator;var m={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},p=Object.assign,g={};function v(e,t,s){this.props=e,this.context=t,this.refs=g,this.updater=s||m}function y(){}function b(e,t,s){this.props=e,this.context=t,this.refs=g,this.updater=s||m}v.prototype.isReactComponent={},v.prototype.setState=function(e,t){if("object"!==typeof e&&"function"!==typeof e&&null!=e)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,t,"setState")},v.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")},y.prototype=v.prototype;var x=b.prototype=new y;x.constructor=b,p(x,v.prototype),x.isPureReactComponent=!0;var E=Array.isArray,S=Object.prototype.hasOwnProperty,T={current:null},k={key:!0,ref:!0,__self:!0,__source:!0};function w(e,t,n){var r,i={},a=null,o=null;if(null!=t)for(r in void 0!==t.ref&&(o=t.ref),void 0!==t.key&&(a=""+t.key),t)S.call(t,r)&&!k.hasOwnProperty(r)&&(i[r]=t[r]);var l=arguments.length-2;if(1===l)i.children=n;else if(1<l){for(var c=Array(l),d=0;d<l;d++)c[d]=arguments[d+2];i.children=c}if(e&&e.defaultProps)for(r in l=e.defaultProps)void 0===i[r]&&(i[r]=l[r]);return{$$typeof:s,type:e,key:a,ref:o,props:i,_owner:T.current}}function L(e){return"object"===typeof e&&null!==e&&e.$$typeof===s}var C=/\/+/g;function A(e,t){return"object"===typeof e&&null!==e&&null!=e.key?function(e){var t={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,function(e){return t[e]})}(""+e.key):t.toString(36)}function R(e,t,r,i,a){var o=typeof e;"undefined"!==o&&"boolean"!==o||(e=null);var l=!1;if(null===e)l=!0;else switch(o){case"string":case"number":l=!0;break;case"object":switch(e.$$typeof){case s:case n:l=!0}}if(l)return a=a(l=e),e=""===i?"."+A(l,0):i,E(a)?(r="",null!=e&&(r=e.replace(C,"$&/")+"/"),R(a,t,r,"",function(e){return e})):null!=a&&(L(a)&&(a=function(e,t){return{$$typeof:s,type:e.type,key:t,ref:e.ref,props:e.props,_owner:e._owner}}(a,r+(!a.key||l&&l.key===a.key?"":(""+a.key).replace(C,"$&/")+"/")+e)),t.push(a)),1;if(l=0,i=""===i?".":i+":",E(e))for(var c=0;c<e.length;c++){var d=i+A(o=e[c],c);l+=R(o,t,r,d,a)}else if(d=function(e){return null===e||"object"!==typeof e?null:"function"===typeof(e=f&&e[f]||e["@@iterator"])?e:null}(e),"function"===typeof d)for(e=d.call(e),c=0;!(o=e.next()).done;)l+=R(o=o.value,t,r,d=i+A(o,c++),a);else if("object"===o)throw t=String(e),Error("Objects are not valid as a React child (found: "+("[object Object]"===t?"object with keys {"+Object.keys(e).join(", ")+"}":t)+"). If you meant to render a collection of children, use an array instead.");return l}function _(e,t,s){if(null==e)return e;var n=[],r=0;return R(e,n,"","",function(e){return t.call(s,e,r++)}),n}function N(e){if(-1===e._status){var t=e._result;(t=t()).then(function(t){0!==e._status&&-1!==e._status||(e._status=1,e._result=t)},function(t){0!==e._status&&-1!==e._status||(e._status=2,e._result=t)}),-1===e._status&&(e._status=0,e._result=t)}if(1===e._status)return e._result.default;throw e._result}var I={current:null},j={transition:null},P={ReactCurrentDispatcher:I,ReactCurrentBatchConfig:j,ReactCurrentOwner:T};function D(){throw Error("act(...) is not supported in production builds of React.")}t.Children={map:_,forEach:function(e,t,s){_(e,function(){t.apply(this,arguments)},s)},count:function(e){var t=0;return _(e,function(){t++}),t},toArray:function(e){return _(e,function(e){return e})||[]},only:function(e){if(!L(e))throw Error("React.Children.only expected to receive a single React element child.");return e}},t.Component=v,t.Fragment=r,t.Profiler=a,t.PureComponent=b,t.StrictMode=i,t.Suspense=d,t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=P,t.act=D,t.cloneElement=function(e,t,n){if(null===e||void 0===e)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+e+".");var r=p({},e.props),i=e.key,a=e.ref,o=e._owner;if(null!=t){if(void 0!==t.ref&&(a=t.ref,o=T.current),void 0!==t.key&&(i=""+t.key),e.type&&e.type.defaultProps)var l=e.type.defaultProps;for(c in t)S.call(t,c)&&!k.hasOwnProperty(c)&&(r[c]=void 0===t[c]&&void 0!==l?l[c]:t[c])}var c=arguments.length-2;if(1===c)r.children=n;else if(1<c){l=Array(c);for(var d=0;d<c;d++)l[d]=arguments[d+2];r.children=l}return{$$typeof:s,type:e.type,key:i,ref:a,props:r,_owner:o}},t.createContext=function(e){return(e={$$typeof:l,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null}).Provider={$$typeof:o,_context:e},e.Consumer=e},t.createElement=w,t.createFactory=function(e){var t=w.bind(null,e);return t.type=e,t},t.createRef=function(){return{current:null}},t.forwardRef=function(e){return{$$typeof:c,render:e}},t.isValidElement=L,t.lazy=function(e){return{$$typeof:h,_payload:{_status:-1,_result:e},_init:N}},t.memo=function(e,t){return{$$typeof:u,type:e,compare:void 0===t?null:t}},t.startTransition=function(e){var t=j.transition;j.transition={};try{e()}finally{j.transition=t}},t.unstable_act=D,t.useCallback=function(e,t){return I.current.useCallback(e,t)},t.useContext=function(e){return I.current.useContext(e)},t.useDebugValue=function(){},t.useDeferredValue=function(e){return I.current.useDeferredValue(e)},t.useEffect=function(e,t){return I.current.useEffect(e,t)},t.useId=function(){return I.current.useId()},t.useImperativeHandle=function(e,t,s){return I.current.useImperativeHandle(e,t,s)},t.useInsertionEffect=function(e,t){return I.current.useInsertionEffect(e,t)},t.useLayoutEffect=function(e,t){return I.current.useLayoutEffect(e,t)},t.useMemo=function(e,t){return I.current.useMemo(e,t)},t.useReducer=function(e,t,s){return I.current.useReducer(e,t,s)},t.useRef=function(e){return I.current.useRef(e)},t.useState=function(e){return I.current.useState(e)},t.useSyncExternalStore=function(e,t,s){return I.current.useSyncExternalStore(e,t,s)},t.useTransition=function(){return I.current.useTransition()},t.version="18.3.1"},234:(e,t)=>{function s(e,t){var s=e.length;e.push(t);e:for(;0<s;){var n=s-1>>>1,r=e[n];if(!(0<i(r,t)))break e;e[n]=t,e[s]=r,s=n}}function n(e){return 0===e.length?null:e[0]}function r(e){if(0===e.length)return null;var t=e[0],s=e.pop();if(s!==t){e[0]=s;e:for(var n=0,r=e.length,a=r>>>1;n<a;){var o=2*(n+1)-1,l=e[o],c=o+1,d=e[c];if(0>i(l,s))c<r&&0>i(d,l)?(e[n]=d,e[c]=s,n=c):(e[n]=l,e[o]=s,n=o);else{if(!(c<r&&0>i(d,s)))break e;e[n]=d,e[c]=s,n=c}}}return t}function i(e,t){var s=e.sortIndex-t.sortIndex;return 0!==s?s:e.id-t.id}if("object"===typeof performance&&"function"===typeof performance.now){var a=performance;t.unstable_now=function(){return a.now()}}else{var o=Date,l=o.now();t.unstable_now=function(){return o.now()-l}}var c=[],d=[],u=1,h=null,f=3,m=!1,p=!1,g=!1,v="function"===typeof setTimeout?setTimeout:null,y="function"===typeof clearTimeout?clearTimeout:null,b="undefined"!==typeof setImmediate?setImmediate:null;function x(e){for(var t=n(d);null!==t;){if(null===t.callback)r(d);else{if(!(t.startTime<=e))break;r(d),t.sortIndex=t.expirationTime,s(c,t)}t=n(d)}}function E(e){if(g=!1,x(e),!p)if(null!==n(c))p=!0,j(S);else{var t=n(d);null!==t&&P(E,t.startTime-e)}}function S(e,s){p=!1,g&&(g=!1,y(L),L=-1),m=!0;var i=f;try{for(x(s),h=n(c);null!==h&&(!(h.expirationTime>s)||e&&!R());){var a=h.callback;if("function"===typeof a){h.callback=null,f=h.priorityLevel;var o=a(h.expirationTime<=s);s=t.unstable_now(),"function"===typeof o?h.callback=o:h===n(c)&&r(c),x(s)}else r(c);h=n(c)}if(null!==h)var l=!0;else{var u=n(d);null!==u&&P(E,u.startTime-s),l=!1}return l}finally{h=null,f=i,m=!1}}"undefined"!==typeof navigator&&void 0!==navigator.scheduling&&void 0!==navigator.scheduling.isInputPending&&navigator.scheduling.isInputPending.bind(navigator.scheduling);var T,k=!1,w=null,L=-1,C=5,A=-1;function R(){return!(t.unstable_now()-A<C)}function _(){if(null!==w){var e=t.unstable_now();A=e;var s=!0;try{s=w(!0,e)}finally{s?T():(k=!1,w=null)}}else k=!1}if("function"===typeof b)T=function(){b(_)};else if("undefined"!==typeof MessageChannel){var N=new MessageChannel,I=N.port2;N.port1.onmessage=_,T=function(){I.postMessage(null)}}else T=function(){v(_,0)};function j(e){w=e,k||(k=!0,T())}function P(e,s){L=v(function(){e(t.unstable_now())},s)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(e){e.callback=null},t.unstable_continueExecution=function(){p||m||(p=!0,j(S))},t.unstable_forceFrameRate=function(e){0>e||125<e?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):C=0<e?Math.floor(1e3/e):5},t.unstable_getCurrentPriorityLevel=function(){return f},t.unstable_getFirstCallbackNode=function(){return n(c)},t.unstable_next=function(e){switch(f){case 1:case 2:case 3:var t=3;break;default:t=f}var s=f;f=t;try{return e()}finally{f=s}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(e,t){switch(e){case 1:case 2:case 3:case 4:case 5:break;default:e=3}var s=f;f=e;try{return t()}finally{f=s}},t.unstable_scheduleCallback=function(e,r,i){var a=t.unstable_now();switch("object"===typeof i&&null!==i?i="number"===typeof(i=i.delay)&&0<i?a+i:a:i=a,e){case 1:var o=-1;break;case 2:o=250;break;case 5:o=1073741823;break;case 4:o=1e4;break;default:o=5e3}return e={id:u++,callback:r,priorityLevel:e,startTime:i,expirationTime:o=i+o,sortIndex:-1},i>a?(e.sortIndex=i,s(d,e),null===n(c)&&e===n(d)&&(g?(y(L),L=-1):g=!0,P(E,i-a))):(e.sortIndex=o,s(c,e),p||m||(p=!0,j(S))),e},t.unstable_shouldYield=R,t.unstable_wrapCallback=function(e){var t=f;return function(){var s=f;f=t;try{return e.apply(this,arguments)}finally{f=s}}}},391:(e,t,s)=>{var n=s(950);t.createRoot=n.createRoot,t.hydrateRoot=n.hydrateRoot},579:(e,t,s)=>{e.exports=s(153)},730:(e,t,s)=>{var n=s(43),r=s(853);function i(e){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+e,s=1;s<arguments.length;s++)t+="&args[]="+encodeURIComponent(arguments[s]);return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var a=new Set,o={};function l(e,t){c(e,t),c(e+"Capture",t)}function c(e,t){for(o[e]=t,e=0;e<t.length;e++)a.add(t[e])}var d=!("undefined"===typeof window||"undefined"===typeof window.document||"undefined"===typeof window.document.createElement),u=Object.prototype.hasOwnProperty,h=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,f={},m={};function p(e,t,s,n,r,i,a){this.acceptsBooleans=2===t||3===t||4===t,this.attributeName=n,this.attributeNamespace=r,this.mustUseProperty=s,this.propertyName=e,this.type=t,this.sanitizeURL=i,this.removeEmptyString=a}var g={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(e){g[e]=new p(e,0,!1,e,null,!1,!1)}),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(e){var t=e[0];g[t]=new p(t,1,!1,e[1],null,!1,!1)}),["contentEditable","draggable","spellCheck","value"].forEach(function(e){g[e]=new p(e,2,!1,e.toLowerCase(),null,!1,!1)}),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(e){g[e]=new p(e,2,!1,e,null,!1,!1)}),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(e){g[e]=new p(e,3,!1,e.toLowerCase(),null,!1,!1)}),["checked","multiple","muted","selected"].forEach(function(e){g[e]=new p(e,3,!0,e,null,!1,!1)}),["capture","download"].forEach(function(e){g[e]=new p(e,4,!1,e,null,!1,!1)}),["cols","rows","size","span"].forEach(function(e){g[e]=new p(e,6,!1,e,null,!1,!1)}),["rowSpan","start"].forEach(function(e){g[e]=new p(e,5,!1,e.toLowerCase(),null,!1,!1)});var v=/[\-:]([a-z])/g;function y(e){return e[1].toUpperCase()}function b(e,t,s,n){var r=g.hasOwnProperty(t)?g[t]:null;(null!==r?0!==r.type:n||!(2<t.length)||"o"!==t[0]&&"O"!==t[0]||"n"!==t[1]&&"N"!==t[1])&&(function(e,t,s,n){if(null===t||"undefined"===typeof t||function(e,t,s,n){if(null!==s&&0===s.type)return!1;switch(typeof t){case"function":case"symbol":return!0;case"boolean":return!n&&(null!==s?!s.acceptsBooleans:"data-"!==(e=e.toLowerCase().slice(0,5))&&"aria-"!==e);default:return!1}}(e,t,s,n))return!0;if(n)return!1;if(null!==s)switch(s.type){case 3:return!t;case 4:return!1===t;case 5:return isNaN(t);case 6:return isNaN(t)||1>t}return!1}(t,s,r,n)&&(s=null),n||null===r?function(e){return!!u.call(m,e)||!u.call(f,e)&&(h.test(e)?m[e]=!0:(f[e]=!0,!1))}(t)&&(null===s?e.removeAttribute(t):e.setAttribute(t,""+s)):r.mustUseProperty?e[r.propertyName]=null===s?3!==r.type&&"":s:(t=r.attributeName,n=r.attributeNamespace,null===s?e.removeAttribute(t):(s=3===(r=r.type)||4===r&&!0===s?"":""+s,n?e.setAttributeNS(n,t,s):e.setAttribute(t,s))))}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(e){var t=e.replace(v,y);g[t]=new p(t,1,!1,e,null,!1,!1)}),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(e){var t=e.replace(v,y);g[t]=new p(t,1,!1,e,"http://www.w3.org/1999/xlink",!1,!1)}),["xml:base","xml:lang","xml:space"].forEach(function(e){var t=e.replace(v,y);g[t]=new p(t,1,!1,e,"http://www.w3.org/XML/1998/namespace",!1,!1)}),["tabIndex","crossOrigin"].forEach(function(e){g[e]=new p(e,1,!1,e.toLowerCase(),null,!1,!1)}),g.xlinkHref=new p("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach(function(e){g[e]=new p(e,1,!1,e.toLowerCase(),null,!0,!0)});var x=n.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,E=Symbol.for("react.element"),S=Symbol.for("react.portal"),T=Symbol.for("react.fragment"),k=Symbol.for("react.strict_mode"),w=Symbol.for("react.profiler"),L=Symbol.for("react.provider"),C=Symbol.for("react.context"),A=Symbol.for("react.forward_ref"),R=Symbol.for("react.suspense"),_=Symbol.for("react.suspense_list"),N=Symbol.for("react.memo"),I=Symbol.for("react.lazy");Symbol.for("react.scope"),Symbol.for("react.debug_trace_mode");var j=Symbol.for("react.offscreen");Symbol.for("react.legacy_hidden"),Symbol.for("react.cache"),Symbol.for("react.tracing_marker");var P=Symbol.iterator;function D(e){return null===e||"object"!==typeof e?null:"function"===typeof(e=P&&e[P]||e["@@iterator"])?e:null}var M,O=Object.assign;function F(e){if(void 0===M)try{throw Error()}catch(s){var t=s.stack.trim().match(/\n( *(at )?)/);M=t&&t[1]||""}return"\n"+M+e}var U=!1;function B(e,t){if(!e||U)return"";U=!0;var s=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(t)if(t=function(){throw Error()},Object.defineProperty(t.prototype,"props",{set:function(){throw Error()}}),"object"===typeof Reflect&&Reflect.construct){try{Reflect.construct(t,[])}catch(c){var n=c}Reflect.construct(e,[],t)}else{try{t.call()}catch(c){n=c}e.call(t.prototype)}else{try{throw Error()}catch(c){n=c}e()}}catch(c){if(c&&n&&"string"===typeof c.stack){for(var r=c.stack.split("\n"),i=n.stack.split("\n"),a=r.length-1,o=i.length-1;1<=a&&0<=o&&r[a]!==i[o];)o--;for(;1<=a&&0<=o;a--,o--)if(r[a]!==i[o]){if(1!==a||1!==o)do{if(a--,0>--o||r[a]!==i[o]){var l="\n"+r[a].replace(" at new "," at ");return e.displayName&&l.includes("<anonymous>")&&(l=l.replace("<anonymous>",e.displayName)),l}}while(1<=a&&0<=o);break}}}finally{U=!1,Error.prepareStackTrace=s}return(e=e?e.displayName||e.name:"")?F(e):""}function G(e){switch(e.tag){case 5:return F(e.type);case 16:return F("Lazy");case 13:return F("Suspense");case 19:return F("SuspenseList");case 0:case 2:case 15:return e=B(e.type,!1);case 11:return e=B(e.type.render,!1);case 1:return e=B(e.type,!0);default:return""}}function V(e){if(null==e)return null;if("function"===typeof e)return e.displayName||e.name||null;if("string"===typeof e)return e;switch(e){case T:return"Fragment";case S:return"Portal";case w:return"Profiler";case k:return"StrictMode";case R:return"Suspense";case _:return"SuspenseList"}if("object"===typeof e)switch(e.$$typeof){case C:return(e.displayName||"Context")+".Consumer";case L:return(e._context.displayName||"Context")+".Provider";case A:var t=e.render;return(e=e.displayName)||(e=""!==(e=t.displayName||t.name||"")?"ForwardRef("+e+")":"ForwardRef"),e;case N:return null!==(t=e.displayName||null)?t:V(e.type)||"Memo";case I:t=e._payload,e=e._init;try{return V(e(t))}catch(s){}}return null}function z(e){var t=e.type;switch(e.tag){case 24:return"Cache";case 9:return(t.displayName||"Context")+".Consumer";case 10:return(t._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return e=(e=t.render).displayName||e.name||"",t.displayName||(""!==e?"ForwardRef("+e+")":"ForwardRef");case 7:return"Fragment";case 5:return t;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return V(t);case 8:return t===k?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if("function"===typeof t)return t.displayName||t.name||null;if("string"===typeof t)return t}return null}function H(e){switch(typeof e){case"boolean":case"number":case"string":case"undefined":case"object":return e;default:return""}}function K(e){var t=e.type;return(e=e.nodeName)&&"input"===e.toLowerCase()&&("checkbox"===t||"radio"===t)}function W(e){e._valueTracker||(e._valueTracker=function(e){var t=K(e)?"checked":"value",s=Object.getOwnPropertyDescriptor(e.constructor.prototype,t),n=""+e[t];if(!e.hasOwnProperty(t)&&"undefined"!==typeof s&&"function"===typeof s.get&&"function"===typeof s.set){var r=s.get,i=s.set;return Object.defineProperty(e,t,{configurable:!0,get:function(){return r.call(this)},set:function(e){n=""+e,i.call(this,e)}}),Object.defineProperty(e,t,{enumerable:s.enumerable}),{getValue:function(){return n},setValue:function(e){n=""+e},stopTracking:function(){e._valueTracker=null,delete e[t]}}}}(e))}function q(e){if(!e)return!1;var t=e._valueTracker;if(!t)return!0;var s=t.getValue(),n="";return e&&(n=K(e)?e.checked?"true":"false":e.value),(e=n)!==s&&(t.setValue(e),!0)}function Y(e){if("undefined"===typeof(e=e||("undefined"!==typeof document?document:void 0)))return null;try{return e.activeElement||e.body}catch(t){return e.body}}function X(e,t){var s=t.checked;return O({},t,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:null!=s?s:e._wrapperState.initialChecked})}function Q(e,t){var s=null==t.defaultValue?"":t.defaultValue,n=null!=t.checked?t.checked:t.defaultChecked;s=H(null!=t.value?t.value:s),e._wrapperState={initialChecked:n,initialValue:s,controlled:"checkbox"===t.type||"radio"===t.type?null!=t.checked:null!=t.value}}function $(e,t){null!=(t=t.checked)&&b(e,"checked",t,!1)}function J(e,t){$(e,t);var s=H(t.value),n=t.type;if(null!=s)"number"===n?(0===s&&""===e.value||e.value!=s)&&(e.value=""+s):e.value!==""+s&&(e.value=""+s);else if("submit"===n||"reset"===n)return void e.removeAttribute("value");t.hasOwnProperty("value")?ee(e,t.type,s):t.hasOwnProperty("defaultValue")&&ee(e,t.type,H(t.defaultValue)),null==t.checked&&null!=t.defaultChecked&&(e.defaultChecked=!!t.defaultChecked)}function Z(e,t,s){if(t.hasOwnProperty("value")||t.hasOwnProperty("defaultValue")){var n=t.type;if(!("submit"!==n&&"reset"!==n||void 0!==t.value&&null!==t.value))return;t=""+e._wrapperState.initialValue,s||t===e.value||(e.value=t),e.defaultValue=t}""!==(s=e.name)&&(e.name=""),e.defaultChecked=!!e._wrapperState.initialChecked,""!==s&&(e.name=s)}function ee(e,t,s){"number"===t&&Y(e.ownerDocument)===e||(null==s?e.defaultValue=""+e._wrapperState.initialValue:e.defaultValue!==""+s&&(e.defaultValue=""+s))}var te=Array.isArray;function se(e,t,s,n){if(e=e.options,t){t={};for(var r=0;r<s.length;r++)t["$"+s[r]]=!0;for(s=0;s<e.length;s++)r=t.hasOwnProperty("$"+e[s].value),e[s].selected!==r&&(e[s].selected=r),r&&n&&(e[s].defaultSelected=!0)}else{for(s=""+H(s),t=null,r=0;r<e.length;r++){if(e[r].value===s)return e[r].selected=!0,void(n&&(e[r].defaultSelected=!0));null!==t||e[r].disabled||(t=e[r])}null!==t&&(t.selected=!0)}}function ne(e,t){if(null!=t.dangerouslySetInnerHTML)throw Error(i(91));return O({},t,{value:void 0,defaultValue:void 0,children:""+e._wrapperState.initialValue})}function re(e,t){var s=t.value;if(null==s){if(s=t.children,t=t.defaultValue,null!=s){if(null!=t)throw Error(i(92));if(te(s)){if(1<s.length)throw Error(i(93));s=s[0]}t=s}null==t&&(t=""),s=t}e._wrapperState={initialValue:H(s)}}function ie(e,t){var s=H(t.value),n=H(t.defaultValue);null!=s&&((s=""+s)!==e.value&&(e.value=s),null==t.defaultValue&&e.defaultValue!==s&&(e.defaultValue=s)),null!=n&&(e.defaultValue=""+n)}function ae(e){var t=e.textContent;t===e._wrapperState.initialValue&&""!==t&&null!==t&&(e.value=t)}function oe(e){switch(e){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function le(e,t){return null==e||"http://www.w3.org/1999/xhtml"===e?oe(t):"http://www.w3.org/2000/svg"===e&&"foreignObject"===t?"http://www.w3.org/1999/xhtml":e}var ce,de,ue=(de=function(e,t){if("http://www.w3.org/2000/svg"!==e.namespaceURI||"innerHTML"in e)e.innerHTML=t;else{for((ce=ce||document.createElement("div")).innerHTML="<svg>"+t.valueOf().toString()+"</svg>",t=ce.firstChild;e.firstChild;)e.removeChild(e.firstChild);for(;t.firstChild;)e.appendChild(t.firstChild)}},"undefined"!==typeof MSApp&&MSApp.execUnsafeLocalFunction?function(e,t,s,n){MSApp.execUnsafeLocalFunction(function(){return de(e,t)})}:de);function he(e,t){if(t){var s=e.firstChild;if(s&&s===e.lastChild&&3===s.nodeType)return void(s.nodeValue=t)}e.textContent=t}var fe={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},me=["Webkit","ms","Moz","O"];function pe(e,t,s){return null==t||"boolean"===typeof t||""===t?"":s||"number"!==typeof t||0===t||fe.hasOwnProperty(e)&&fe[e]?(""+t).trim():t+"px"}function ge(e,t){for(var s in e=e.style,t)if(t.hasOwnProperty(s)){var n=0===s.indexOf("--"),r=pe(s,t[s],n);"float"===s&&(s="cssFloat"),n?e.setProperty(s,r):e[s]=r}}Object.keys(fe).forEach(function(e){me.forEach(function(t){t=t+e.charAt(0).toUpperCase()+e.substring(1),fe[t]=fe[e]})});var ve=O({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function ye(e,t){if(t){if(ve[e]&&(null!=t.children||null!=t.dangerouslySetInnerHTML))throw Error(i(137,e));if(null!=t.dangerouslySetInnerHTML){if(null!=t.children)throw Error(i(60));if("object"!==typeof t.dangerouslySetInnerHTML||!("__html"in t.dangerouslySetInnerHTML))throw Error(i(61))}if(null!=t.style&&"object"!==typeof t.style)throw Error(i(62))}}function be(e,t){if(-1===e.indexOf("-"))return"string"===typeof t.is;switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var xe=null;function Ee(e){return(e=e.target||e.srcElement||window).correspondingUseElement&&(e=e.correspondingUseElement),3===e.nodeType?e.parentNode:e}var Se=null,Te=null,ke=null;function we(e){if(e=br(e)){if("function"!==typeof Se)throw Error(i(280));var t=e.stateNode;t&&(t=Er(t),Se(e.stateNode,e.type,t))}}function Le(e){Te?ke?ke.push(e):ke=[e]:Te=e}function Ce(){if(Te){var e=Te,t=ke;if(ke=Te=null,we(e),t)for(e=0;e<t.length;e++)we(t[e])}}function Ae(e,t){return e(t)}function Re(){}var _e=!1;function Ne(e,t,s){if(_e)return e(t,s);_e=!0;try{return Ae(e,t,s)}finally{_e=!1,(null!==Te||null!==ke)&&(Re(),Ce())}}function Ie(e,t){var s=e.stateNode;if(null===s)return null;var n=Er(s);if(null===n)return null;s=n[t];e:switch(t){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(n=!n.disabled)||(n=!("button"===(e=e.type)||"input"===e||"select"===e||"textarea"===e)),e=!n;break e;default:e=!1}if(e)return null;if(s&&"function"!==typeof s)throw Error(i(231,t,typeof s));return s}var je=!1;if(d)try{var Pe={};Object.defineProperty(Pe,"passive",{get:function(){je=!0}}),window.addEventListener("test",Pe,Pe),window.removeEventListener("test",Pe,Pe)}catch(de){je=!1}function De(e,t,s,n,r,i,a,o,l){var c=Array.prototype.slice.call(arguments,3);try{t.apply(s,c)}catch(d){this.onError(d)}}var Me=!1,Oe=null,Fe=!1,Ue=null,Be={onError:function(e){Me=!0,Oe=e}};function Ge(e,t,s,n,r,i,a,o,l){Me=!1,Oe=null,De.apply(Be,arguments)}function Ve(e){var t=e,s=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do{0!==(4098&(t=e).flags)&&(s=t.return),e=t.return}while(e)}return 3===t.tag?s:null}function ze(e){if(13===e.tag){var t=e.memoizedState;if(null===t&&(null!==(e=e.alternate)&&(t=e.memoizedState)),null!==t)return t.dehydrated}return null}function He(e){if(Ve(e)!==e)throw Error(i(188))}function Ke(e){return null!==(e=function(e){var t=e.alternate;if(!t){if(null===(t=Ve(e)))throw Error(i(188));return t!==e?null:e}for(var s=e,n=t;;){var r=s.return;if(null===r)break;var a=r.alternate;if(null===a){if(null!==(n=r.return)){s=n;continue}break}if(r.child===a.child){for(a=r.child;a;){if(a===s)return He(r),e;if(a===n)return He(r),t;a=a.sibling}throw Error(i(188))}if(s.return!==n.return)s=r,n=a;else{for(var o=!1,l=r.child;l;){if(l===s){o=!0,s=r,n=a;break}if(l===n){o=!0,n=r,s=a;break}l=l.sibling}if(!o){for(l=a.child;l;){if(l===s){o=!0,s=a,n=r;break}if(l===n){o=!0,n=a,s=r;break}l=l.sibling}if(!o)throw Error(i(189))}}if(s.alternate!==n)throw Error(i(190))}if(3!==s.tag)throw Error(i(188));return s.stateNode.current===s?e:t}(e))?We(e):null}function We(e){if(5===e.tag||6===e.tag)return e;for(e=e.child;null!==e;){var t=We(e);if(null!==t)return t;e=e.sibling}return null}var qe=r.unstable_scheduleCallback,Ye=r.unstable_cancelCallback,Xe=r.unstable_shouldYield,Qe=r.unstable_requestPaint,$e=r.unstable_now,Je=r.unstable_getCurrentPriorityLevel,Ze=r.unstable_ImmediatePriority,et=r.unstable_UserBlockingPriority,tt=r.unstable_NormalPriority,st=r.unstable_LowPriority,nt=r.unstable_IdlePriority,rt=null,it=null;var at=Math.clz32?Math.clz32:function(e){return e>>>=0,0===e?32:31-(ot(e)/lt|0)|0},ot=Math.log,lt=Math.LN2;var ct=64,dt=4194304;function ut(e){switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return 4194240&e;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return 130023424&e;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return e}}function ht(e,t){var s=e.pendingLanes;if(0===s)return 0;var n=0,r=e.suspendedLanes,i=e.pingedLanes,a=268435455&s;if(0!==a){var o=a&~r;0!==o?n=ut(o):0!==(i&=a)&&(n=ut(i))}else 0!==(a=s&~r)?n=ut(a):0!==i&&(n=ut(i));if(0===n)return 0;if(0!==t&&t!==n&&0===(t&r)&&((r=n&-n)>=(i=t&-t)||16===r&&0!==(4194240&i)))return t;if(0!==(4&n)&&(n|=16&s),0!==(t=e.entangledLanes))for(e=e.entanglements,t&=n;0<t;)r=1<<(s=31-at(t)),n|=e[s],t&=~r;return n}function ft(e,t){switch(e){case 1:case 2:case 4:return t+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t+5e3;default:return-1}}function mt(e){return 0!==(e=-1073741825&e.pendingLanes)?e:1073741824&e?1073741824:0}function pt(){var e=ct;return 0===(4194240&(ct<<=1))&&(ct=64),e}function gt(e){for(var t=[],s=0;31>s;s++)t.push(e);return t}function vt(e,t,s){e.pendingLanes|=t,536870912!==t&&(e.suspendedLanes=0,e.pingedLanes=0),(e=e.eventTimes)[t=31-at(t)]=s}function yt(e,t){var s=e.entangledLanes|=t;for(e=e.entanglements;s;){var n=31-at(s),r=1<<n;r&t|e[n]&t&&(e[n]|=t),s&=~r}}var bt=0;function xt(e){return 1<(e&=-e)?4<e?0!==(268435455&e)?16:536870912:4:1}var Et,St,Tt,kt,wt,Lt=!1,Ct=[],At=null,Rt=null,_t=null,Nt=new Map,It=new Map,jt=[],Pt="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Dt(e,t){switch(e){case"focusin":case"focusout":At=null;break;case"dragenter":case"dragleave":Rt=null;break;case"mouseover":case"mouseout":_t=null;break;case"pointerover":case"pointerout":Nt.delete(t.pointerId);break;case"gotpointercapture":case"lostpointercapture":It.delete(t.pointerId)}}function Mt(e,t,s,n,r,i){return null===e||e.nativeEvent!==i?(e={blockedOn:t,domEventName:s,eventSystemFlags:n,nativeEvent:i,targetContainers:[r]},null!==t&&(null!==(t=br(t))&&St(t)),e):(e.eventSystemFlags|=n,t=e.targetContainers,null!==r&&-1===t.indexOf(r)&&t.push(r),e)}function Ot(e){var t=yr(e.target);if(null!==t){var s=Ve(t);if(null!==s)if(13===(t=s.tag)){if(null!==(t=ze(s)))return e.blockedOn=t,void wt(e.priority,function(){Tt(s)})}else if(3===t&&s.stateNode.current.memoizedState.isDehydrated)return void(e.blockedOn=3===s.tag?s.stateNode.containerInfo:null)}e.blockedOn=null}function Ft(e){if(null!==e.blockedOn)return!1;for(var t=e.targetContainers;0<t.length;){var s=Xt(e.domEventName,e.eventSystemFlags,t[0],e.nativeEvent);if(null!==s)return null!==(t=br(s))&&St(t),e.blockedOn=s,!1;var n=new(s=e.nativeEvent).constructor(s.type,s);xe=n,s.target.dispatchEvent(n),xe=null,t.shift()}return!0}function Ut(e,t,s){Ft(e)&&s.delete(t)}function Bt(){Lt=!1,null!==At&&Ft(At)&&(At=null),null!==Rt&&Ft(Rt)&&(Rt=null),null!==_t&&Ft(_t)&&(_t=null),Nt.forEach(Ut),It.forEach(Ut)}function Gt(e,t){e.blockedOn===t&&(e.blockedOn=null,Lt||(Lt=!0,r.unstable_scheduleCallback(r.unstable_NormalPriority,Bt)))}function Vt(e){function t(t){return Gt(t,e)}if(0<Ct.length){Gt(Ct[0],e);for(var s=1;s<Ct.length;s++){var n=Ct[s];n.blockedOn===e&&(n.blockedOn=null)}}for(null!==At&&Gt(At,e),null!==Rt&&Gt(Rt,e),null!==_t&&Gt(_t,e),Nt.forEach(t),It.forEach(t),s=0;s<jt.length;s++)(n=jt[s]).blockedOn===e&&(n.blockedOn=null);for(;0<jt.length&&null===(s=jt[0]).blockedOn;)Ot(s),null===s.blockedOn&&jt.shift()}var zt=x.ReactCurrentBatchConfig,Ht=!0;function Kt(e,t,s,n){var r=bt,i=zt.transition;zt.transition=null;try{bt=1,qt(e,t,s,n)}finally{bt=r,zt.transition=i}}function Wt(e,t,s,n){var r=bt,i=zt.transition;zt.transition=null;try{bt=4,qt(e,t,s,n)}finally{bt=r,zt.transition=i}}function qt(e,t,s,n){if(Ht){var r=Xt(e,t,s,n);if(null===r)Hn(e,t,n,Yt,s),Dt(e,n);else if(function(e,t,s,n,r){switch(t){case"focusin":return At=Mt(At,e,t,s,n,r),!0;case"dragenter":return Rt=Mt(Rt,e,t,s,n,r),!0;case"mouseover":return _t=Mt(_t,e,t,s,n,r),!0;case"pointerover":var i=r.pointerId;return Nt.set(i,Mt(Nt.get(i)||null,e,t,s,n,r)),!0;case"gotpointercapture":return i=r.pointerId,It.set(i,Mt(It.get(i)||null,e,t,s,n,r)),!0}return!1}(r,e,t,s,n))n.stopPropagation();else if(Dt(e,n),4&t&&-1<Pt.indexOf(e)){for(;null!==r;){var i=br(r);if(null!==i&&Et(i),null===(i=Xt(e,t,s,n))&&Hn(e,t,n,Yt,s),i===r)break;r=i}null!==r&&n.stopPropagation()}else Hn(e,t,n,null,s)}}var Yt=null;function Xt(e,t,s,n){if(Yt=null,null!==(e=yr(e=Ee(n))))if(null===(t=Ve(e)))e=null;else if(13===(s=t.tag)){if(null!==(e=ze(t)))return e;e=null}else if(3===s){if(t.stateNode.current.memoizedState.isDehydrated)return 3===t.tag?t.stateNode.containerInfo:null;e=null}else t!==e&&(e=null);return Yt=e,null}function Qt(e){switch(e){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(Je()){case Ze:return 1;case et:return 4;case tt:case st:return 16;case nt:return 536870912;default:return 16}default:return 16}}var $t=null,Jt=null,Zt=null;function es(){if(Zt)return Zt;var e,t,s=Jt,n=s.length,r="value"in $t?$t.value:$t.textContent,i=r.length;for(e=0;e<n&&s[e]===r[e];e++);var a=n-e;for(t=1;t<=a&&s[n-t]===r[i-t];t++);return Zt=r.slice(e,1<t?1-t:void 0)}function ts(e){var t=e.keyCode;return"charCode"in e?0===(e=e.charCode)&&13===t&&(e=13):e=t,10===e&&(e=13),32<=e||13===e?e:0}function ss(){return!0}function ns(){return!1}function rs(e){function t(t,s,n,r,i){for(var a in this._reactName=t,this._targetInst=n,this.type=s,this.nativeEvent=r,this.target=i,this.currentTarget=null,e)e.hasOwnProperty(a)&&(t=e[a],this[a]=t?t(r):r[a]);return this.isDefaultPrevented=(null!=r.defaultPrevented?r.defaultPrevented:!1===r.returnValue)?ss:ns,this.isPropagationStopped=ns,this}return O(t.prototype,{preventDefault:function(){this.defaultPrevented=!0;var e=this.nativeEvent;e&&(e.preventDefault?e.preventDefault():"unknown"!==typeof e.returnValue&&(e.returnValue=!1),this.isDefaultPrevented=ss)},stopPropagation:function(){var e=this.nativeEvent;e&&(e.stopPropagation?e.stopPropagation():"unknown"!==typeof e.cancelBubble&&(e.cancelBubble=!0),this.isPropagationStopped=ss)},persist:function(){},isPersistent:ss}),t}var is,as,os,ls={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},cs=rs(ls),ds=O({},ls,{view:0,detail:0}),us=rs(ds),hs=O({},ds,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:ks,button:0,buttons:0,relatedTarget:function(e){return void 0===e.relatedTarget?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==os&&(os&&"mousemove"===e.type?(is=e.screenX-os.screenX,as=e.screenY-os.screenY):as=is=0,os=e),is)},movementY:function(e){return"movementY"in e?e.movementY:as}}),fs=rs(hs),ms=rs(O({},hs,{dataTransfer:0})),ps=rs(O({},ds,{relatedTarget:0})),gs=rs(O({},ls,{animationName:0,elapsedTime:0,pseudoElement:0})),vs=O({},ls,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}}),ys=rs(vs),bs=rs(O({},ls,{data:0})),xs={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Es={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Ss={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Ts(e){var t=this.nativeEvent;return t.getModifierState?t.getModifierState(e):!!(e=Ss[e])&&!!t[e]}function ks(){return Ts}var ws=O({},ds,{key:function(e){if(e.key){var t=xs[e.key]||e.key;if("Unidentified"!==t)return t}return"keypress"===e.type?13===(e=ts(e))?"Enter":String.fromCharCode(e):"keydown"===e.type||"keyup"===e.type?Es[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:ks,charCode:function(e){return"keypress"===e.type?ts(e):0},keyCode:function(e){return"keydown"===e.type||"keyup"===e.type?e.keyCode:0},which:function(e){return"keypress"===e.type?ts(e):"keydown"===e.type||"keyup"===e.type?e.keyCode:0}}),Ls=rs(ws),Cs=rs(O({},hs,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0})),As=rs(O({},ds,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:ks})),Rs=rs(O({},ls,{propertyName:0,elapsedTime:0,pseudoElement:0})),_s=O({},hs,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0}),Ns=rs(_s),Is=[9,13,27,32],js=d&&"CompositionEvent"in window,Ps=null;d&&"documentMode"in document&&(Ps=document.documentMode);var Ds=d&&"TextEvent"in window&&!Ps,Ms=d&&(!js||Ps&&8<Ps&&11>=Ps),Os=String.fromCharCode(32),Fs=!1;function Us(e,t){switch(e){case"keyup":return-1!==Is.indexOf(t.keyCode);case"keydown":return 229!==t.keyCode;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Bs(e){return"object"===typeof(e=e.detail)&&"data"in e?e.data:null}var Gs=!1;var Vs={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function zs(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return"input"===t?!!Vs[e.type]:"textarea"===t}function Hs(e,t,s,n){Le(n),0<(t=Wn(t,"onChange")).length&&(s=new cs("onChange","change",null,s,n),e.push({event:s,listeners:t}))}var Ks=null,Ws=null;function qs(e){Fn(e,0)}function Ys(e){if(q(xr(e)))return e}function Xs(e,t){if("change"===e)return t}var Qs=!1;if(d){var $s;if(d){var Js="oninput"in document;if(!Js){var Zs=document.createElement("div");Zs.setAttribute("oninput","return;"),Js="function"===typeof Zs.oninput}$s=Js}else $s=!1;Qs=$s&&(!document.documentMode||9<document.documentMode)}function en(){Ks&&(Ks.detachEvent("onpropertychange",tn),Ws=Ks=null)}function tn(e){if("value"===e.propertyName&&Ys(Ws)){var t=[];Hs(t,Ws,e,Ee(e)),Ne(qs,t)}}function sn(e,t,s){"focusin"===e?(en(),Ws=s,(Ks=t).attachEvent("onpropertychange",tn)):"focusout"===e&&en()}function nn(e){if("selectionchange"===e||"keyup"===e||"keydown"===e)return Ys(Ws)}function rn(e,t){if("click"===e)return Ys(t)}function an(e,t){if("input"===e||"change"===e)return Ys(t)}var on="function"===typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e===1/t)||e!==e&&t!==t};function ln(e,t){if(on(e,t))return!0;if("object"!==typeof e||null===e||"object"!==typeof t||null===t)return!1;var s=Object.keys(e),n=Object.keys(t);if(s.length!==n.length)return!1;for(n=0;n<s.length;n++){var r=s[n];if(!u.call(t,r)||!on(e[r],t[r]))return!1}return!0}function cn(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function dn(e,t){var s,n=cn(e);for(e=0;n;){if(3===n.nodeType){if(s=e+n.textContent.length,e<=t&&s>=t)return{node:n,offset:t-e};e=s}e:{for(;n;){if(n.nextSibling){n=n.nextSibling;break e}n=n.parentNode}n=void 0}n=cn(n)}}function un(e,t){return!(!e||!t)&&(e===t||(!e||3!==e.nodeType)&&(t&&3===t.nodeType?un(e,t.parentNode):"contains"in e?e.contains(t):!!e.compareDocumentPosition&&!!(16&e.compareDocumentPosition(t))))}function hn(){for(var e=window,t=Y();t instanceof e.HTMLIFrameElement;){try{var s="string"===typeof t.contentWindow.location.href}catch(n){s=!1}if(!s)break;t=Y((e=t.contentWindow).document)}return t}function fn(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&("input"===t&&("text"===e.type||"search"===e.type||"tel"===e.type||"url"===e.type||"password"===e.type)||"textarea"===t||"true"===e.contentEditable)}function mn(e){var t=hn(),s=e.focusedElem,n=e.selectionRange;if(t!==s&&s&&s.ownerDocument&&un(s.ownerDocument.documentElement,s)){if(null!==n&&fn(s))if(t=n.start,void 0===(e=n.end)&&(e=t),"selectionStart"in s)s.selectionStart=t,s.selectionEnd=Math.min(e,s.value.length);else if((e=(t=s.ownerDocument||document)&&t.defaultView||window).getSelection){e=e.getSelection();var r=s.textContent.length,i=Math.min(n.start,r);n=void 0===n.end?i:Math.min(n.end,r),!e.extend&&i>n&&(r=n,n=i,i=r),r=dn(s,i);var a=dn(s,n);r&&a&&(1!==e.rangeCount||e.anchorNode!==r.node||e.anchorOffset!==r.offset||e.focusNode!==a.node||e.focusOffset!==a.offset)&&((t=t.createRange()).setStart(r.node,r.offset),e.removeAllRanges(),i>n?(e.addRange(t),e.extend(a.node,a.offset)):(t.setEnd(a.node,a.offset),e.addRange(t)))}for(t=[],e=s;e=e.parentNode;)1===e.nodeType&&t.push({element:e,left:e.scrollLeft,top:e.scrollTop});for("function"===typeof s.focus&&s.focus(),s=0;s<t.length;s++)(e=t[s]).element.scrollLeft=e.left,e.element.scrollTop=e.top}}var pn=d&&"documentMode"in document&&11>=document.documentMode,gn=null,vn=null,yn=null,bn=!1;function xn(e,t,s){var n=s.window===s?s.document:9===s.nodeType?s:s.ownerDocument;bn||null==gn||gn!==Y(n)||("selectionStart"in(n=gn)&&fn(n)?n={start:n.selectionStart,end:n.selectionEnd}:n={anchorNode:(n=(n.ownerDocument&&n.ownerDocument.defaultView||window).getSelection()).anchorNode,anchorOffset:n.anchorOffset,focusNode:n.focusNode,focusOffset:n.focusOffset},yn&&ln(yn,n)||(yn=n,0<(n=Wn(vn,"onSelect")).length&&(t=new cs("onSelect","select",null,t,s),e.push({event:t,listeners:n}),t.target=gn)))}function En(e,t){var s={};return s[e.toLowerCase()]=t.toLowerCase(),s["Webkit"+e]="webkit"+t,s["Moz"+e]="moz"+t,s}var Sn={animationend:En("Animation","AnimationEnd"),animationiteration:En("Animation","AnimationIteration"),animationstart:En("Animation","AnimationStart"),transitionend:En("Transition","TransitionEnd")},Tn={},kn={};function wn(e){if(Tn[e])return Tn[e];if(!Sn[e])return e;var t,s=Sn[e];for(t in s)if(s.hasOwnProperty(t)&&t in kn)return Tn[e]=s[t];return e}d&&(kn=document.createElement("div").style,"AnimationEvent"in window||(delete Sn.animationend.animation,delete Sn.animationiteration.animation,delete Sn.animationstart.animation),"TransitionEvent"in window||delete Sn.transitionend.transition);var Ln=wn("animationend"),Cn=wn("animationiteration"),An=wn("animationstart"),Rn=wn("transitionend"),_n=new Map,Nn="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function In(e,t){_n.set(e,t),l(t,[e])}for(var jn=0;jn<Nn.length;jn++){var Pn=Nn[jn];In(Pn.toLowerCase(),"on"+(Pn[0].toUpperCase()+Pn.slice(1)))}In(Ln,"onAnimationEnd"),In(Cn,"onAnimationIteration"),In(An,"onAnimationStart"),In("dblclick","onDoubleClick"),In("focusin","onFocus"),In("focusout","onBlur"),In(Rn,"onTransitionEnd"),c("onMouseEnter",["mouseout","mouseover"]),c("onMouseLeave",["mouseout","mouseover"]),c("onPointerEnter",["pointerout","pointerover"]),c("onPointerLeave",["pointerout","pointerover"]),l("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),l("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),l("onBeforeInput",["compositionend","keypress","textInput","paste"]),l("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),l("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),l("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Dn="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Mn=new Set("cancel close invalid load scroll toggle".split(" ").concat(Dn));function On(e,t,s){var n=e.type||"unknown-event";e.currentTarget=s,function(e,t,s,n,r,a,o,l,c){if(Ge.apply(this,arguments),Me){if(!Me)throw Error(i(198));var d=Oe;Me=!1,Oe=null,Fe||(Fe=!0,Ue=d)}}(n,t,void 0,e),e.currentTarget=null}function Fn(e,t){t=0!==(4&t);for(var s=0;s<e.length;s++){var n=e[s],r=n.event;n=n.listeners;e:{var i=void 0;if(t)for(var a=n.length-1;0<=a;a--){var o=n[a],l=o.instance,c=o.currentTarget;if(o=o.listener,l!==i&&r.isPropagationStopped())break e;On(r,o,c),i=l}else for(a=0;a<n.length;a++){if(l=(o=n[a]).instance,c=o.currentTarget,o=o.listener,l!==i&&r.isPropagationStopped())break e;On(r,o,c),i=l}}}if(Fe)throw e=Ue,Fe=!1,Ue=null,e}function Un(e,t){var s=t[pr];void 0===s&&(s=t[pr]=new Set);var n=e+"__bubble";s.has(n)||(zn(t,e,2,!1),s.add(n))}function Bn(e,t,s){var n=0;t&&(n|=4),zn(s,e,n,t)}var Gn="_reactListening"+Math.random().toString(36).slice(2);function Vn(e){if(!e[Gn]){e[Gn]=!0,a.forEach(function(t){"selectionchange"!==t&&(Mn.has(t)||Bn(t,!1,e),Bn(t,!0,e))});var t=9===e.nodeType?e:e.ownerDocument;null===t||t[Gn]||(t[Gn]=!0,Bn("selectionchange",!1,t))}}function zn(e,t,s,n){switch(Qt(t)){case 1:var r=Kt;break;case 4:r=Wt;break;default:r=qt}s=r.bind(null,t,s,e),r=void 0,!je||"touchstart"!==t&&"touchmove"!==t&&"wheel"!==t||(r=!0),n?void 0!==r?e.addEventListener(t,s,{capture:!0,passive:r}):e.addEventListener(t,s,!0):void 0!==r?e.addEventListener(t,s,{passive:r}):e.addEventListener(t,s,!1)}function Hn(e,t,s,n,r){var i=n;if(0===(1&t)&&0===(2&t)&&null!==n)e:for(;;){if(null===n)return;var a=n.tag;if(3===a||4===a){var o=n.stateNode.containerInfo;if(o===r||8===o.nodeType&&o.parentNode===r)break;if(4===a)for(a=n.return;null!==a;){var l=a.tag;if((3===l||4===l)&&((l=a.stateNode.containerInfo)===r||8===l.nodeType&&l.parentNode===r))return;a=a.return}for(;null!==o;){if(null===(a=yr(o)))return;if(5===(l=a.tag)||6===l){n=i=a;continue e}o=o.parentNode}}n=n.return}Ne(function(){var n=i,r=Ee(s),a=[];e:{var o=_n.get(e);if(void 0!==o){var l=cs,c=e;switch(e){case"keypress":if(0===ts(s))break e;case"keydown":case"keyup":l=Ls;break;case"focusin":c="focus",l=ps;break;case"focusout":c="blur",l=ps;break;case"beforeblur":case"afterblur":l=ps;break;case"click":if(2===s.button)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":l=fs;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":l=ms;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":l=As;break;case Ln:case Cn:case An:l=gs;break;case Rn:l=Rs;break;case"scroll":l=us;break;case"wheel":l=Ns;break;case"copy":case"cut":case"paste":l=ys;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":l=Cs}var d=0!==(4&t),u=!d&&"scroll"===e,h=d?null!==o?o+"Capture":null:o;d=[];for(var f,m=n;null!==m;){var p=(f=m).stateNode;if(5===f.tag&&null!==p&&(f=p,null!==h&&(null!=(p=Ie(m,h))&&d.push(Kn(m,p,f)))),u)break;m=m.return}0<d.length&&(o=new l(o,c,null,s,r),a.push({event:o,listeners:d}))}}if(0===(7&t)){if(l="mouseout"===e||"pointerout"===e,(!(o="mouseover"===e||"pointerover"===e)||s===xe||!(c=s.relatedTarget||s.fromElement)||!yr(c)&&!c[mr])&&(l||o)&&(o=r.window===r?r:(o=r.ownerDocument)?o.defaultView||o.parentWindow:window,l?(l=n,null!==(c=(c=s.relatedTarget||s.toElement)?yr(c):null)&&(c!==(u=Ve(c))||5!==c.tag&&6!==c.tag)&&(c=null)):(l=null,c=n),l!==c)){if(d=fs,p="onMouseLeave",h="onMouseEnter",m="mouse","pointerout"!==e&&"pointerover"!==e||(d=Cs,p="onPointerLeave",h="onPointerEnter",m="pointer"),u=null==l?o:xr(l),f=null==c?o:xr(c),(o=new d(p,m+"leave",l,s,r)).target=u,o.relatedTarget=f,p=null,yr(r)===n&&((d=new d(h,m+"enter",c,s,r)).target=f,d.relatedTarget=u,p=d),u=p,l&&c)e:{for(h=c,m=0,f=d=l;f;f=qn(f))m++;for(f=0,p=h;p;p=qn(p))f++;for(;0<m-f;)d=qn(d),m--;for(;0<f-m;)h=qn(h),f--;for(;m--;){if(d===h||null!==h&&d===h.alternate)break e;d=qn(d),h=qn(h)}d=null}else d=null;null!==l&&Yn(a,o,l,d,!1),null!==c&&null!==u&&Yn(a,u,c,d,!0)}if("select"===(l=(o=n?xr(n):window).nodeName&&o.nodeName.toLowerCase())||"input"===l&&"file"===o.type)var g=Xs;else if(zs(o))if(Qs)g=an;else{g=nn;var v=sn}else(l=o.nodeName)&&"input"===l.toLowerCase()&&("checkbox"===o.type||"radio"===o.type)&&(g=rn);switch(g&&(g=g(e,n))?Hs(a,g,s,r):(v&&v(e,o,n),"focusout"===e&&(v=o._wrapperState)&&v.controlled&&"number"===o.type&&ee(o,"number",o.value)),v=n?xr(n):window,e){case"focusin":(zs(v)||"true"===v.contentEditable)&&(gn=v,vn=n,yn=null);break;case"focusout":yn=vn=gn=null;break;case"mousedown":bn=!0;break;case"contextmenu":case"mouseup":case"dragend":bn=!1,xn(a,s,r);break;case"selectionchange":if(pn)break;case"keydown":case"keyup":xn(a,s,r)}var y;if(js)e:{switch(e){case"compositionstart":var b="onCompositionStart";break e;case"compositionend":b="onCompositionEnd";break e;case"compositionupdate":b="onCompositionUpdate";break e}b=void 0}else Gs?Us(e,s)&&(b="onCompositionEnd"):"keydown"===e&&229===s.keyCode&&(b="onCompositionStart");b&&(Ms&&"ko"!==s.locale&&(Gs||"onCompositionStart"!==b?"onCompositionEnd"===b&&Gs&&(y=es()):(Jt="value"in($t=r)?$t.value:$t.textContent,Gs=!0)),0<(v=Wn(n,b)).length&&(b=new bs(b,e,null,s,r),a.push({event:b,listeners:v}),y?b.data=y:null!==(y=Bs(s))&&(b.data=y))),(y=Ds?function(e,t){switch(e){case"compositionend":return Bs(t);case"keypress":return 32!==t.which?null:(Fs=!0,Os);case"textInput":return(e=t.data)===Os&&Fs?null:e;default:return null}}(e,s):function(e,t){if(Gs)return"compositionend"===e||!js&&Us(e,t)?(e=es(),Zt=Jt=$t=null,Gs=!1,e):null;switch(e){case"paste":default:return null;case"keypress":if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case"compositionend":return Ms&&"ko"!==t.locale?null:t.data}}(e,s))&&(0<(n=Wn(n,"onBeforeInput")).length&&(r=new bs("onBeforeInput","beforeinput",null,s,r),a.push({event:r,listeners:n}),r.data=y))}Fn(a,t)})}function Kn(e,t,s){return{instance:e,listener:t,currentTarget:s}}function Wn(e,t){for(var s=t+"Capture",n=[];null!==e;){var r=e,i=r.stateNode;5===r.tag&&null!==i&&(r=i,null!=(i=Ie(e,s))&&n.unshift(Kn(e,i,r)),null!=(i=Ie(e,t))&&n.push(Kn(e,i,r))),e=e.return}return n}function qn(e){if(null===e)return null;do{e=e.return}while(e&&5!==e.tag);return e||null}function Yn(e,t,s,n,r){for(var i=t._reactName,a=[];null!==s&&s!==n;){var o=s,l=o.alternate,c=o.stateNode;if(null!==l&&l===n)break;5===o.tag&&null!==c&&(o=c,r?null!=(l=Ie(s,i))&&a.unshift(Kn(s,l,o)):r||null!=(l=Ie(s,i))&&a.push(Kn(s,l,o))),s=s.return}0!==a.length&&e.push({event:t,listeners:a})}var Xn=/\r\n?/g,Qn=/\u0000|\uFFFD/g;function $n(e){return("string"===typeof e?e:""+e).replace(Xn,"\n").replace(Qn,"")}function Jn(e,t,s){if(t=$n(t),$n(e)!==t&&s)throw Error(i(425))}function Zn(){}var er=null,tr=null;function sr(e,t){return"textarea"===e||"noscript"===e||"string"===typeof t.children||"number"===typeof t.children||"object"===typeof t.dangerouslySetInnerHTML&&null!==t.dangerouslySetInnerHTML&&null!=t.dangerouslySetInnerHTML.__html}var nr="function"===typeof setTimeout?setTimeout:void 0,rr="function"===typeof clearTimeout?clearTimeout:void 0,ir="function"===typeof Promise?Promise:void 0,ar="function"===typeof queueMicrotask?queueMicrotask:"undefined"!==typeof ir?function(e){return ir.resolve(null).then(e).catch(or)}:nr;function or(e){setTimeout(function(){throw e})}function lr(e,t){var s=t,n=0;do{var r=s.nextSibling;if(e.removeChild(s),r&&8===r.nodeType)if("/$"===(s=r.data)){if(0===n)return e.removeChild(r),void Vt(t);n--}else"$"!==s&&"$?"!==s&&"$!"!==s||n++;s=r}while(s);Vt(t)}function cr(e){for(;null!=e;e=e.nextSibling){var t=e.nodeType;if(1===t||3===t)break;if(8===t){if("$"===(t=e.data)||"$!"===t||"$?"===t)break;if("/$"===t)return null}}return e}function dr(e){e=e.previousSibling;for(var t=0;e;){if(8===e.nodeType){var s=e.data;if("$"===s||"$!"===s||"$?"===s){if(0===t)return e;t--}else"/$"===s&&t++}e=e.previousSibling}return null}var ur=Math.random().toString(36).slice(2),hr="__reactFiber$"+ur,fr="__reactProps$"+ur,mr="__reactContainer$"+ur,pr="__reactEvents$"+ur,gr="__reactListeners$"+ur,vr="__reactHandles$"+ur;function yr(e){var t=e[hr];if(t)return t;for(var s=e.parentNode;s;){if(t=s[mr]||s[hr]){if(s=t.alternate,null!==t.child||null!==s&&null!==s.child)for(e=dr(e);null!==e;){if(s=e[hr])return s;e=dr(e)}return t}s=(e=s).parentNode}return null}function br(e){return!(e=e[hr]||e[mr])||5!==e.tag&&6!==e.tag&&13!==e.tag&&3!==e.tag?null:e}function xr(e){if(5===e.tag||6===e.tag)return e.stateNode;throw Error(i(33))}function Er(e){return e[fr]||null}var Sr=[],Tr=-1;function kr(e){return{current:e}}function wr(e){0>Tr||(e.current=Sr[Tr],Sr[Tr]=null,Tr--)}function Lr(e,t){Tr++,Sr[Tr]=e.current,e.current=t}var Cr={},Ar=kr(Cr),Rr=kr(!1),_r=Cr;function Nr(e,t){var s=e.type.contextTypes;if(!s)return Cr;var n=e.stateNode;if(n&&n.__reactInternalMemoizedUnmaskedChildContext===t)return n.__reactInternalMemoizedMaskedChildContext;var r,i={};for(r in s)i[r]=t[r];return n&&((e=e.stateNode).__reactInternalMemoizedUnmaskedChildContext=t,e.__reactInternalMemoizedMaskedChildContext=i),i}function Ir(e){return null!==(e=e.childContextTypes)&&void 0!==e}function jr(){wr(Rr),wr(Ar)}function Pr(e,t,s){if(Ar.current!==Cr)throw Error(i(168));Lr(Ar,t),Lr(Rr,s)}function Dr(e,t,s){var n=e.stateNode;if(t=t.childContextTypes,"function"!==typeof n.getChildContext)return s;for(var r in n=n.getChildContext())if(!(r in t))throw Error(i(108,z(e)||"Unknown",r));return O({},s,n)}function Mr(e){return e=(e=e.stateNode)&&e.__reactInternalMemoizedMergedChildContext||Cr,_r=Ar.current,Lr(Ar,e),Lr(Rr,Rr.current),!0}function Or(e,t,s){var n=e.stateNode;if(!n)throw Error(i(169));s?(e=Dr(e,t,_r),n.__reactInternalMemoizedMergedChildContext=e,wr(Rr),wr(Ar),Lr(Ar,e)):wr(Rr),Lr(Rr,s)}var Fr=null,Ur=!1,Br=!1;function Gr(e){null===Fr?Fr=[e]:Fr.push(e)}function Vr(){if(!Br&&null!==Fr){Br=!0;var e=0,t=bt;try{var s=Fr;for(bt=1;e<s.length;e++){var n=s[e];do{n=n(!0)}while(null!==n)}Fr=null,Ur=!1}catch(r){throw null!==Fr&&(Fr=Fr.slice(e+1)),qe(Ze,Vr),r}finally{bt=t,Br=!1}}return null}var zr=[],Hr=0,Kr=null,Wr=0,qr=[],Yr=0,Xr=null,Qr=1,$r="";function Jr(e,t){zr[Hr++]=Wr,zr[Hr++]=Kr,Kr=e,Wr=t}function Zr(e,t,s){qr[Yr++]=Qr,qr[Yr++]=$r,qr[Yr++]=Xr,Xr=e;var n=Qr;e=$r;var r=32-at(n)-1;n&=~(1<<r),s+=1;var i=32-at(t)+r;if(30<i){var a=r-r%5;i=(n&(1<<a)-1).toString(32),n>>=a,r-=a,Qr=1<<32-at(t)+r|s<<r|n,$r=i+e}else Qr=1<<i|s<<r|n,$r=e}function ei(e){null!==e.return&&(Jr(e,1),Zr(e,1,0))}function ti(e){for(;e===Kr;)Kr=zr[--Hr],zr[Hr]=null,Wr=zr[--Hr],zr[Hr]=null;for(;e===Xr;)Xr=qr[--Yr],qr[Yr]=null,$r=qr[--Yr],qr[Yr]=null,Qr=qr[--Yr],qr[Yr]=null}var si=null,ni=null,ri=!1,ii=null;function ai(e,t){var s=Nc(5,null,null,0);s.elementType="DELETED",s.stateNode=t,s.return=e,null===(t=e.deletions)?(e.deletions=[s],e.flags|=16):t.push(s)}function oi(e,t){switch(e.tag){case 5:var s=e.type;return null!==(t=1!==t.nodeType||s.toLowerCase()!==t.nodeName.toLowerCase()?null:t)&&(e.stateNode=t,si=e,ni=cr(t.firstChild),!0);case 6:return null!==(t=""===e.pendingProps||3!==t.nodeType?null:t)&&(e.stateNode=t,si=e,ni=null,!0);case 13:return null!==(t=8!==t.nodeType?null:t)&&(s=null!==Xr?{id:Qr,overflow:$r}:null,e.memoizedState={dehydrated:t,treeContext:s,retryLane:1073741824},(s=Nc(18,null,null,0)).stateNode=t,s.return=e,e.child=s,si=e,ni=null,!0);default:return!1}}function li(e){return 0!==(1&e.mode)&&0===(128&e.flags)}function ci(e){if(ri){var t=ni;if(t){var s=t;if(!oi(e,t)){if(li(e))throw Error(i(418));t=cr(s.nextSibling);var n=si;t&&oi(e,t)?ai(n,s):(e.flags=-4097&e.flags|2,ri=!1,si=e)}}else{if(li(e))throw Error(i(418));e.flags=-4097&e.flags|2,ri=!1,si=e}}}function di(e){for(e=e.return;null!==e&&5!==e.tag&&3!==e.tag&&13!==e.tag;)e=e.return;si=e}function ui(e){if(e!==si)return!1;if(!ri)return di(e),ri=!0,!1;var t;if((t=3!==e.tag)&&!(t=5!==e.tag)&&(t="head"!==(t=e.type)&&"body"!==t&&!sr(e.type,e.memoizedProps)),t&&(t=ni)){if(li(e))throw hi(),Error(i(418));for(;t;)ai(e,t),t=cr(t.nextSibling)}if(di(e),13===e.tag){if(!(e=null!==(e=e.memoizedState)?e.dehydrated:null))throw Error(i(317));e:{for(e=e.nextSibling,t=0;e;){if(8===e.nodeType){var s=e.data;if("/$"===s){if(0===t){ni=cr(e.nextSibling);break e}t--}else"$"!==s&&"$!"!==s&&"$?"!==s||t++}e=e.nextSibling}ni=null}}else ni=si?cr(e.stateNode.nextSibling):null;return!0}function hi(){for(var e=ni;e;)e=cr(e.nextSibling)}function fi(){ni=si=null,ri=!1}function mi(e){null===ii?ii=[e]:ii.push(e)}var pi=x.ReactCurrentBatchConfig;function gi(e,t,s){if(null!==(e=s.ref)&&"function"!==typeof e&&"object"!==typeof e){if(s._owner){if(s=s._owner){if(1!==s.tag)throw Error(i(309));var n=s.stateNode}if(!n)throw Error(i(147,e));var r=n,a=""+e;return null!==t&&null!==t.ref&&"function"===typeof t.ref&&t.ref._stringRef===a?t.ref:(t=function(e){var t=r.refs;null===e?delete t[a]:t[a]=e},t._stringRef=a,t)}if("string"!==typeof e)throw Error(i(284));if(!s._owner)throw Error(i(290,e))}return e}function vi(e,t){throw e=Object.prototype.toString.call(t),Error(i(31,"[object Object]"===e?"object with keys {"+Object.keys(t).join(", ")+"}":e))}function yi(e){return(0,e._init)(e._payload)}function bi(e){function t(t,s){if(e){var n=t.deletions;null===n?(t.deletions=[s],t.flags|=16):n.push(s)}}function s(s,n){if(!e)return null;for(;null!==n;)t(s,n),n=n.sibling;return null}function n(e,t){for(e=new Map;null!==t;)null!==t.key?e.set(t.key,t):e.set(t.index,t),t=t.sibling;return e}function r(e,t){return(e=jc(e,t)).index=0,e.sibling=null,e}function a(t,s,n){return t.index=n,e?null!==(n=t.alternate)?(n=n.index)<s?(t.flags|=2,s):n:(t.flags|=2,s):(t.flags|=1048576,s)}function o(t){return e&&null===t.alternate&&(t.flags|=2),t}function l(e,t,s,n){return null===t||6!==t.tag?((t=Oc(s,e.mode,n)).return=e,t):((t=r(t,s)).return=e,t)}function c(e,t,s,n){var i=s.type;return i===T?u(e,t,s.props.children,n,s.key):null!==t&&(t.elementType===i||"object"===typeof i&&null!==i&&i.$$typeof===I&&yi(i)===t.type)?((n=r(t,s.props)).ref=gi(e,t,s),n.return=e,n):((n=Pc(s.type,s.key,s.props,null,e.mode,n)).ref=gi(e,t,s),n.return=e,n)}function d(e,t,s,n){return null===t||4!==t.tag||t.stateNode.containerInfo!==s.containerInfo||t.stateNode.implementation!==s.implementation?((t=Fc(s,e.mode,n)).return=e,t):((t=r(t,s.children||[])).return=e,t)}function u(e,t,s,n,i){return null===t||7!==t.tag?((t=Dc(s,e.mode,n,i)).return=e,t):((t=r(t,s)).return=e,t)}function h(e,t,s){if("string"===typeof t&&""!==t||"number"===typeof t)return(t=Oc(""+t,e.mode,s)).return=e,t;if("object"===typeof t&&null!==t){switch(t.$$typeof){case E:return(s=Pc(t.type,t.key,t.props,null,e.mode,s)).ref=gi(e,null,t),s.return=e,s;case S:return(t=Fc(t,e.mode,s)).return=e,t;case I:return h(e,(0,t._init)(t._payload),s)}if(te(t)||D(t))return(t=Dc(t,e.mode,s,null)).return=e,t;vi(e,t)}return null}function f(e,t,s,n){var r=null!==t?t.key:null;if("string"===typeof s&&""!==s||"number"===typeof s)return null!==r?null:l(e,t,""+s,n);if("object"===typeof s&&null!==s){switch(s.$$typeof){case E:return s.key===r?c(e,t,s,n):null;case S:return s.key===r?d(e,t,s,n):null;case I:return f(e,t,(r=s._init)(s._payload),n)}if(te(s)||D(s))return null!==r?null:u(e,t,s,n,null);vi(e,s)}return null}function m(e,t,s,n,r){if("string"===typeof n&&""!==n||"number"===typeof n)return l(t,e=e.get(s)||null,""+n,r);if("object"===typeof n&&null!==n){switch(n.$$typeof){case E:return c(t,e=e.get(null===n.key?s:n.key)||null,n,r);case S:return d(t,e=e.get(null===n.key?s:n.key)||null,n,r);case I:return m(e,t,s,(0,n._init)(n._payload),r)}if(te(n)||D(n))return u(t,e=e.get(s)||null,n,r,null);vi(t,n)}return null}function p(r,i,o,l){for(var c=null,d=null,u=i,p=i=0,g=null;null!==u&&p<o.length;p++){u.index>p?(g=u,u=null):g=u.sibling;var v=f(r,u,o[p],l);if(null===v){null===u&&(u=g);break}e&&u&&null===v.alternate&&t(r,u),i=a(v,i,p),null===d?c=v:d.sibling=v,d=v,u=g}if(p===o.length)return s(r,u),ri&&Jr(r,p),c;if(null===u){for(;p<o.length;p++)null!==(u=h(r,o[p],l))&&(i=a(u,i,p),null===d?c=u:d.sibling=u,d=u);return ri&&Jr(r,p),c}for(u=n(r,u);p<o.length;p++)null!==(g=m(u,r,p,o[p],l))&&(e&&null!==g.alternate&&u.delete(null===g.key?p:g.key),i=a(g,i,p),null===d?c=g:d.sibling=g,d=g);return e&&u.forEach(function(e){return t(r,e)}),ri&&Jr(r,p),c}function g(r,o,l,c){var d=D(l);if("function"!==typeof d)throw Error(i(150));if(null==(l=d.call(l)))throw Error(i(151));for(var u=d=null,p=o,g=o=0,v=null,y=l.next();null!==p&&!y.done;g++,y=l.next()){p.index>g?(v=p,p=null):v=p.sibling;var b=f(r,p,y.value,c);if(null===b){null===p&&(p=v);break}e&&p&&null===b.alternate&&t(r,p),o=a(b,o,g),null===u?d=b:u.sibling=b,u=b,p=v}if(y.done)return s(r,p),ri&&Jr(r,g),d;if(null===p){for(;!y.done;g++,y=l.next())null!==(y=h(r,y.value,c))&&(o=a(y,o,g),null===u?d=y:u.sibling=y,u=y);return ri&&Jr(r,g),d}for(p=n(r,p);!y.done;g++,y=l.next())null!==(y=m(p,r,g,y.value,c))&&(e&&null!==y.alternate&&p.delete(null===y.key?g:y.key),o=a(y,o,g),null===u?d=y:u.sibling=y,u=y);return e&&p.forEach(function(e){return t(r,e)}),ri&&Jr(r,g),d}return function e(n,i,a,l){if("object"===typeof a&&null!==a&&a.type===T&&null===a.key&&(a=a.props.children),"object"===typeof a&&null!==a){switch(a.$$typeof){case E:e:{for(var c=a.key,d=i;null!==d;){if(d.key===c){if((c=a.type)===T){if(7===d.tag){s(n,d.sibling),(i=r(d,a.props.children)).return=n,n=i;break e}}else if(d.elementType===c||"object"===typeof c&&null!==c&&c.$$typeof===I&&yi(c)===d.type){s(n,d.sibling),(i=r(d,a.props)).ref=gi(n,d,a),i.return=n,n=i;break e}s(n,d);break}t(n,d),d=d.sibling}a.type===T?((i=Dc(a.props.children,n.mode,l,a.key)).return=n,n=i):((l=Pc(a.type,a.key,a.props,null,n.mode,l)).ref=gi(n,i,a),l.return=n,n=l)}return o(n);case S:e:{for(d=a.key;null!==i;){if(i.key===d){if(4===i.tag&&i.stateNode.containerInfo===a.containerInfo&&i.stateNode.implementation===a.implementation){s(n,i.sibling),(i=r(i,a.children||[])).return=n,n=i;break e}s(n,i);break}t(n,i),i=i.sibling}(i=Fc(a,n.mode,l)).return=n,n=i}return o(n);case I:return e(n,i,(d=a._init)(a._payload),l)}if(te(a))return p(n,i,a,l);if(D(a))return g(n,i,a,l);vi(n,a)}return"string"===typeof a&&""!==a||"number"===typeof a?(a=""+a,null!==i&&6===i.tag?(s(n,i.sibling),(i=r(i,a)).return=n,n=i):(s(n,i),(i=Oc(a,n.mode,l)).return=n,n=i),o(n)):s(n,i)}}var xi=bi(!0),Ei=bi(!1),Si=kr(null),Ti=null,ki=null,wi=null;function Li(){wi=ki=Ti=null}function Ci(e){var t=Si.current;wr(Si),e._currentValue=t}function Ai(e,t,s){for(;null!==e;){var n=e.alternate;if((e.childLanes&t)!==t?(e.childLanes|=t,null!==n&&(n.childLanes|=t)):null!==n&&(n.childLanes&t)!==t&&(n.childLanes|=t),e===s)break;e=e.return}}function Ri(e,t){Ti=e,wi=ki=null,null!==(e=e.dependencies)&&null!==e.firstContext&&(0!==(e.lanes&t)&&(bo=!0),e.firstContext=null)}function _i(e){var t=e._currentValue;if(wi!==e)if(e={context:e,memoizedValue:t,next:null},null===ki){if(null===Ti)throw Error(i(308));ki=e,Ti.dependencies={lanes:0,firstContext:e}}else ki=ki.next=e;return t}var Ni=null;function Ii(e){null===Ni?Ni=[e]:Ni.push(e)}function ji(e,t,s,n){var r=t.interleaved;return null===r?(s.next=s,Ii(t)):(s.next=r.next,r.next=s),t.interleaved=s,Pi(e,n)}function Pi(e,t){e.lanes|=t;var s=e.alternate;for(null!==s&&(s.lanes|=t),s=e,e=e.return;null!==e;)e.childLanes|=t,null!==(s=e.alternate)&&(s.childLanes|=t),s=e,e=e.return;return 3===s.tag?s.stateNode:null}var Di=!1;function Mi(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function Oi(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,effects:e.effects})}function Fi(e,t){return{eventTime:e,lane:t,tag:0,payload:null,callback:null,next:null}}function Ui(e,t,s){var n=e.updateQueue;if(null===n)return null;if(n=n.shared,0!==(2&Al)){var r=n.pending;return null===r?t.next=t:(t.next=r.next,r.next=t),n.pending=t,Pi(e,s)}return null===(r=n.interleaved)?(t.next=t,Ii(n)):(t.next=r.next,r.next=t),n.interleaved=t,Pi(e,s)}function Bi(e,t,s){if(null!==(t=t.updateQueue)&&(t=t.shared,0!==(4194240&s))){var n=t.lanes;s|=n&=e.pendingLanes,t.lanes=s,yt(e,s)}}function Gi(e,t){var s=e.updateQueue,n=e.alternate;if(null!==n&&s===(n=n.updateQueue)){var r=null,i=null;if(null!==(s=s.firstBaseUpdate)){do{var a={eventTime:s.eventTime,lane:s.lane,tag:s.tag,payload:s.payload,callback:s.callback,next:null};null===i?r=i=a:i=i.next=a,s=s.next}while(null!==s);null===i?r=i=t:i=i.next=t}else r=i=t;return s={baseState:n.baseState,firstBaseUpdate:r,lastBaseUpdate:i,shared:n.shared,effects:n.effects},void(e.updateQueue=s)}null===(e=s.lastBaseUpdate)?s.firstBaseUpdate=t:e.next=t,s.lastBaseUpdate=t}function Vi(e,t,s,n){var r=e.updateQueue;Di=!1;var i=r.firstBaseUpdate,a=r.lastBaseUpdate,o=r.shared.pending;if(null!==o){r.shared.pending=null;var l=o,c=l.next;l.next=null,null===a?i=c:a.next=c,a=l;var d=e.alternate;null!==d&&((o=(d=d.updateQueue).lastBaseUpdate)!==a&&(null===o?d.firstBaseUpdate=c:o.next=c,d.lastBaseUpdate=l))}if(null!==i){var u=r.baseState;for(a=0,d=c=l=null,o=i;;){var h=o.lane,f=o.eventTime;if((n&h)===h){null!==d&&(d=d.next={eventTime:f,lane:0,tag:o.tag,payload:o.payload,callback:o.callback,next:null});e:{var m=e,p=o;switch(h=t,f=s,p.tag){case 1:if("function"===typeof(m=p.payload)){u=m.call(f,u,h);break e}u=m;break e;case 3:m.flags=-65537&m.flags|128;case 0:if(null===(h="function"===typeof(m=p.payload)?m.call(f,u,h):m)||void 0===h)break e;u=O({},u,h);break e;case 2:Di=!0}}null!==o.callback&&0!==o.lane&&(e.flags|=64,null===(h=r.effects)?r.effects=[o]:h.push(o))}else f={eventTime:f,lane:h,tag:o.tag,payload:o.payload,callback:o.callback,next:null},null===d?(c=d=f,l=u):d=d.next=f,a|=h;if(null===(o=o.next)){if(null===(o=r.shared.pending))break;o=(h=o).next,h.next=null,r.lastBaseUpdate=h,r.shared.pending=null}}if(null===d&&(l=u),r.baseState=l,r.firstBaseUpdate=c,r.lastBaseUpdate=d,null!==(t=r.shared.interleaved)){r=t;do{a|=r.lane,r=r.next}while(r!==t)}else null===i&&(r.shared.lanes=0);Ml|=a,e.lanes=a,e.memoizedState=u}}function zi(e,t,s){if(e=t.effects,t.effects=null,null!==e)for(t=0;t<e.length;t++){var n=e[t],r=n.callback;if(null!==r){if(n.callback=null,n=s,"function"!==typeof r)throw Error(i(191,r));r.call(n)}}}var Hi={},Ki=kr(Hi),Wi=kr(Hi),qi=kr(Hi);function Yi(e){if(e===Hi)throw Error(i(174));return e}function Xi(e,t){switch(Lr(qi,t),Lr(Wi,e),Lr(Ki,Hi),e=t.nodeType){case 9:case 11:t=(t=t.documentElement)?t.namespaceURI:le(null,"");break;default:t=le(t=(e=8===e?t.parentNode:t).namespaceURI||null,e=e.tagName)}wr(Ki),Lr(Ki,t)}function Qi(){wr(Ki),wr(Wi),wr(qi)}function $i(e){Yi(qi.current);var t=Yi(Ki.current),s=le(t,e.type);t!==s&&(Lr(Wi,e),Lr(Ki,s))}function Ji(e){Wi.current===e&&(wr(Ki),wr(Wi))}var Zi=kr(0);function ea(e){for(var t=e;null!==t;){if(13===t.tag){var s=t.memoizedState;if(null!==s&&(null===(s=s.dehydrated)||"$?"===s.data||"$!"===s.data))return t}else if(19===t.tag&&void 0!==t.memoizedProps.revealOrder){if(0!==(128&t.flags))return t}else if(null!==t.child){t.child.return=t,t=t.child;continue}if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}var ta=[];function sa(){for(var e=0;e<ta.length;e++)ta[e]._workInProgressVersionPrimary=null;ta.length=0}var na=x.ReactCurrentDispatcher,ra=x.ReactCurrentBatchConfig,ia=0,aa=null,oa=null,la=null,ca=!1,da=!1,ua=0,ha=0;function fa(){throw Error(i(321))}function ma(e,t){if(null===t)return!1;for(var s=0;s<t.length&&s<e.length;s++)if(!on(e[s],t[s]))return!1;return!0}function pa(e,t,s,n,r,a){if(ia=a,aa=t,t.memoizedState=null,t.updateQueue=null,t.lanes=0,na.current=null===e||null===e.memoizedState?Ja:Za,e=s(n,r),da){a=0;do{if(da=!1,ua=0,25<=a)throw Error(i(301));a+=1,la=oa=null,t.updateQueue=null,na.current=eo,e=s(n,r)}while(da)}if(na.current=$a,t=null!==oa&&null!==oa.next,ia=0,la=oa=aa=null,ca=!1,t)throw Error(i(300));return e}function ga(){var e=0!==ua;return ua=0,e}function va(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return null===la?aa.memoizedState=la=e:la=la.next=e,la}function ya(){if(null===oa){var e=aa.alternate;e=null!==e?e.memoizedState:null}else e=oa.next;var t=null===la?aa.memoizedState:la.next;if(null!==t)la=t,oa=e;else{if(null===e)throw Error(i(310));e={memoizedState:(oa=e).memoizedState,baseState:oa.baseState,baseQueue:oa.baseQueue,queue:oa.queue,next:null},null===la?aa.memoizedState=la=e:la=la.next=e}return la}function ba(e,t){return"function"===typeof t?t(e):t}function xa(e){var t=ya(),s=t.queue;if(null===s)throw Error(i(311));s.lastRenderedReducer=e;var n=oa,r=n.baseQueue,a=s.pending;if(null!==a){if(null!==r){var o=r.next;r.next=a.next,a.next=o}n.baseQueue=r=a,s.pending=null}if(null!==r){a=r.next,n=n.baseState;var l=o=null,c=null,d=a;do{var u=d.lane;if((ia&u)===u)null!==c&&(c=c.next={lane:0,action:d.action,hasEagerState:d.hasEagerState,eagerState:d.eagerState,next:null}),n=d.hasEagerState?d.eagerState:e(n,d.action);else{var h={lane:u,action:d.action,hasEagerState:d.hasEagerState,eagerState:d.eagerState,next:null};null===c?(l=c=h,o=n):c=c.next=h,aa.lanes|=u,Ml|=u}d=d.next}while(null!==d&&d!==a);null===c?o=n:c.next=l,on(n,t.memoizedState)||(bo=!0),t.memoizedState=n,t.baseState=o,t.baseQueue=c,s.lastRenderedState=n}if(null!==(e=s.interleaved)){r=e;do{a=r.lane,aa.lanes|=a,Ml|=a,r=r.next}while(r!==e)}else null===r&&(s.lanes=0);return[t.memoizedState,s.dispatch]}function Ea(e){var t=ya(),s=t.queue;if(null===s)throw Error(i(311));s.lastRenderedReducer=e;var n=s.dispatch,r=s.pending,a=t.memoizedState;if(null!==r){s.pending=null;var o=r=r.next;do{a=e(a,o.action),o=o.next}while(o!==r);on(a,t.memoizedState)||(bo=!0),t.memoizedState=a,null===t.baseQueue&&(t.baseState=a),s.lastRenderedState=a}return[a,n]}function Sa(){}function Ta(e,t){var s=aa,n=ya(),r=t(),a=!on(n.memoizedState,r);if(a&&(n.memoizedState=r,bo=!0),n=n.queue,Da(La.bind(null,s,n,e),[e]),n.getSnapshot!==t||a||null!==la&&1&la.memoizedState.tag){if(s.flags|=2048,_a(9,wa.bind(null,s,n,r,t),void 0,null),null===Rl)throw Error(i(349));0!==(30&ia)||ka(s,t,r)}return r}function ka(e,t,s){e.flags|=16384,e={getSnapshot:t,value:s},null===(t=aa.updateQueue)?(t={lastEffect:null,stores:null},aa.updateQueue=t,t.stores=[e]):null===(s=t.stores)?t.stores=[e]:s.push(e)}function wa(e,t,s,n){t.value=s,t.getSnapshot=n,Ca(t)&&Aa(e)}function La(e,t,s){return s(function(){Ca(t)&&Aa(e)})}function Ca(e){var t=e.getSnapshot;e=e.value;try{var s=t();return!on(e,s)}catch(n){return!0}}function Aa(e){var t=Pi(e,1);null!==t&&sc(t,e,1,-1)}function Ra(e){var t=va();return"function"===typeof e&&(e=e()),t.memoizedState=t.baseState=e,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:ba,lastRenderedState:e},t.queue=e,e=e.dispatch=qa.bind(null,aa,e),[t.memoizedState,e]}function _a(e,t,s,n){return e={tag:e,create:t,destroy:s,deps:n,next:null},null===(t=aa.updateQueue)?(t={lastEffect:null,stores:null},aa.updateQueue=t,t.lastEffect=e.next=e):null===(s=t.lastEffect)?t.lastEffect=e.next=e:(n=s.next,s.next=e,e.next=n,t.lastEffect=e),e}function Na(){return ya().memoizedState}function Ia(e,t,s,n){var r=va();aa.flags|=e,r.memoizedState=_a(1|t,s,void 0,void 0===n?null:n)}function ja(e,t,s,n){var r=ya();n=void 0===n?null:n;var i=void 0;if(null!==oa){var a=oa.memoizedState;if(i=a.destroy,null!==n&&ma(n,a.deps))return void(r.memoizedState=_a(t,s,i,n))}aa.flags|=e,r.memoizedState=_a(1|t,s,i,n)}function Pa(e,t){return Ia(8390656,8,e,t)}function Da(e,t){return ja(2048,8,e,t)}function Ma(e,t){return ja(4,2,e,t)}function Oa(e,t){return ja(4,4,e,t)}function Fa(e,t){return"function"===typeof t?(e=e(),t(e),function(){t(null)}):null!==t&&void 0!==t?(e=e(),t.current=e,function(){t.current=null}):void 0}function Ua(e,t,s){return s=null!==s&&void 0!==s?s.concat([e]):null,ja(4,4,Fa.bind(null,t,e),s)}function Ba(){}function Ga(e,t){var s=ya();t=void 0===t?null:t;var n=s.memoizedState;return null!==n&&null!==t&&ma(t,n[1])?n[0]:(s.memoizedState=[e,t],e)}function Va(e,t){var s=ya();t=void 0===t?null:t;var n=s.memoizedState;return null!==n&&null!==t&&ma(t,n[1])?n[0]:(e=e(),s.memoizedState=[e,t],e)}function za(e,t,s){return 0===(21&ia)?(e.baseState&&(e.baseState=!1,bo=!0),e.memoizedState=s):(on(s,t)||(s=pt(),aa.lanes|=s,Ml|=s,e.baseState=!0),t)}function Ha(e,t){var s=bt;bt=0!==s&&4>s?s:4,e(!0);var n=ra.transition;ra.transition={};try{e(!1),t()}finally{bt=s,ra.transition=n}}function Ka(){return ya().memoizedState}function Wa(e,t,s){var n=tc(e);if(s={lane:n,action:s,hasEagerState:!1,eagerState:null,next:null},Ya(e))Xa(t,s);else if(null!==(s=ji(e,t,s,n))){sc(s,e,n,ec()),Qa(s,t,n)}}function qa(e,t,s){var n=tc(e),r={lane:n,action:s,hasEagerState:!1,eagerState:null,next:null};if(Ya(e))Xa(t,r);else{var i=e.alternate;if(0===e.lanes&&(null===i||0===i.lanes)&&null!==(i=t.lastRenderedReducer))try{var a=t.lastRenderedState,o=i(a,s);if(r.hasEagerState=!0,r.eagerState=o,on(o,a)){var l=t.interleaved;return null===l?(r.next=r,Ii(t)):(r.next=l.next,l.next=r),void(t.interleaved=r)}}catch(c){}null!==(s=ji(e,t,r,n))&&(sc(s,e,n,r=ec()),Qa(s,t,n))}}function Ya(e){var t=e.alternate;return e===aa||null!==t&&t===aa}function Xa(e,t){da=ca=!0;var s=e.pending;null===s?t.next=t:(t.next=s.next,s.next=t),e.pending=t}function Qa(e,t,s){if(0!==(4194240&s)){var n=t.lanes;s|=n&=e.pendingLanes,t.lanes=s,yt(e,s)}}var $a={readContext:_i,useCallback:fa,useContext:fa,useEffect:fa,useImperativeHandle:fa,useInsertionEffect:fa,useLayoutEffect:fa,useMemo:fa,useReducer:fa,useRef:fa,useState:fa,useDebugValue:fa,useDeferredValue:fa,useTransition:fa,useMutableSource:fa,useSyncExternalStore:fa,useId:fa,unstable_isNewReconciler:!1},Ja={readContext:_i,useCallback:function(e,t){return va().memoizedState=[e,void 0===t?null:t],e},useContext:_i,useEffect:Pa,useImperativeHandle:function(e,t,s){return s=null!==s&&void 0!==s?s.concat([e]):null,Ia(4194308,4,Fa.bind(null,t,e),s)},useLayoutEffect:function(e,t){return Ia(4194308,4,e,t)},useInsertionEffect:function(e,t){return Ia(4,2,e,t)},useMemo:function(e,t){var s=va();return t=void 0===t?null:t,e=e(),s.memoizedState=[e,t],e},useReducer:function(e,t,s){var n=va();return t=void 0!==s?s(t):t,n.memoizedState=n.baseState=t,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:t},n.queue=e,e=e.dispatch=Wa.bind(null,aa,e),[n.memoizedState,e]},useRef:function(e){return e={current:e},va().memoizedState=e},useState:Ra,useDebugValue:Ba,useDeferredValue:function(e){return va().memoizedState=e},useTransition:function(){var e=Ra(!1),t=e[0];return e=Ha.bind(null,e[1]),va().memoizedState=e,[t,e]},useMutableSource:function(){},useSyncExternalStore:function(e,t,s){var n=aa,r=va();if(ri){if(void 0===s)throw Error(i(407));s=s()}else{if(s=t(),null===Rl)throw Error(i(349));0!==(30&ia)||ka(n,t,s)}r.memoizedState=s;var a={value:s,getSnapshot:t};return r.queue=a,Pa(La.bind(null,n,a,e),[e]),n.flags|=2048,_a(9,wa.bind(null,n,a,s,t),void 0,null),s},useId:function(){var e=va(),t=Rl.identifierPrefix;if(ri){var s=$r;t=":"+t+"R"+(s=(Qr&~(1<<32-at(Qr)-1)).toString(32)+s),0<(s=ua++)&&(t+="H"+s.toString(32)),t+=":"}else t=":"+t+"r"+(s=ha++).toString(32)+":";return e.memoizedState=t},unstable_isNewReconciler:!1},Za={readContext:_i,useCallback:Ga,useContext:_i,useEffect:Da,useImperativeHandle:Ua,useInsertionEffect:Ma,useLayoutEffect:Oa,useMemo:Va,useReducer:xa,useRef:Na,useState:function(){return xa(ba)},useDebugValue:Ba,useDeferredValue:function(e){return za(ya(),oa.memoizedState,e)},useTransition:function(){return[xa(ba)[0],ya().memoizedState]},useMutableSource:Sa,useSyncExternalStore:Ta,useId:Ka,unstable_isNewReconciler:!1},eo={readContext:_i,useCallback:Ga,useContext:_i,useEffect:Da,useImperativeHandle:Ua,useInsertionEffect:Ma,useLayoutEffect:Oa,useMemo:Va,useReducer:Ea,useRef:Na,useState:function(){return Ea(ba)},useDebugValue:Ba,useDeferredValue:function(e){var t=ya();return null===oa?t.memoizedState=e:za(t,oa.memoizedState,e)},useTransition:function(){return[Ea(ba)[0],ya().memoizedState]},useMutableSource:Sa,useSyncExternalStore:Ta,useId:Ka,unstable_isNewReconciler:!1};function to(e,t){if(e&&e.defaultProps){for(var s in t=O({},t),e=e.defaultProps)void 0===t[s]&&(t[s]=e[s]);return t}return t}function so(e,t,s,n){s=null===(s=s(n,t=e.memoizedState))||void 0===s?t:O({},t,s),e.memoizedState=s,0===e.lanes&&(e.updateQueue.baseState=s)}var no={isMounted:function(e){return!!(e=e._reactInternals)&&Ve(e)===e},enqueueSetState:function(e,t,s){e=e._reactInternals;var n=ec(),r=tc(e),i=Fi(n,r);i.payload=t,void 0!==s&&null!==s&&(i.callback=s),null!==(t=Ui(e,i,r))&&(sc(t,e,r,n),Bi(t,e,r))},enqueueReplaceState:function(e,t,s){e=e._reactInternals;var n=ec(),r=tc(e),i=Fi(n,r);i.tag=1,i.payload=t,void 0!==s&&null!==s&&(i.callback=s),null!==(t=Ui(e,i,r))&&(sc(t,e,r,n),Bi(t,e,r))},enqueueForceUpdate:function(e,t){e=e._reactInternals;var s=ec(),n=tc(e),r=Fi(s,n);r.tag=2,void 0!==t&&null!==t&&(r.callback=t),null!==(t=Ui(e,r,n))&&(sc(t,e,n,s),Bi(t,e,n))}};function ro(e,t,s,n,r,i,a){return"function"===typeof(e=e.stateNode).shouldComponentUpdate?e.shouldComponentUpdate(n,i,a):!t.prototype||!t.prototype.isPureReactComponent||(!ln(s,n)||!ln(r,i))}function io(e,t,s){var n=!1,r=Cr,i=t.contextType;return"object"===typeof i&&null!==i?i=_i(i):(r=Ir(t)?_r:Ar.current,i=(n=null!==(n=t.contextTypes)&&void 0!==n)?Nr(e,r):Cr),t=new t(s,i),e.memoizedState=null!==t.state&&void 0!==t.state?t.state:null,t.updater=no,e.stateNode=t,t._reactInternals=e,n&&((e=e.stateNode).__reactInternalMemoizedUnmaskedChildContext=r,e.__reactInternalMemoizedMaskedChildContext=i),t}function ao(e,t,s,n){e=t.state,"function"===typeof t.componentWillReceiveProps&&t.componentWillReceiveProps(s,n),"function"===typeof t.UNSAFE_componentWillReceiveProps&&t.UNSAFE_componentWillReceiveProps(s,n),t.state!==e&&no.enqueueReplaceState(t,t.state,null)}function oo(e,t,s,n){var r=e.stateNode;r.props=s,r.state=e.memoizedState,r.refs={},Mi(e);var i=t.contextType;"object"===typeof i&&null!==i?r.context=_i(i):(i=Ir(t)?_r:Ar.current,r.context=Nr(e,i)),r.state=e.memoizedState,"function"===typeof(i=t.getDerivedStateFromProps)&&(so(e,t,i,s),r.state=e.memoizedState),"function"===typeof t.getDerivedStateFromProps||"function"===typeof r.getSnapshotBeforeUpdate||"function"!==typeof r.UNSAFE_componentWillMount&&"function"!==typeof r.componentWillMount||(t=r.state,"function"===typeof r.componentWillMount&&r.componentWillMount(),"function"===typeof r.UNSAFE_componentWillMount&&r.UNSAFE_componentWillMount(),t!==r.state&&no.enqueueReplaceState(r,r.state,null),Vi(e,s,r,n),r.state=e.memoizedState),"function"===typeof r.componentDidMount&&(e.flags|=4194308)}function lo(e,t){try{var s="",n=t;do{s+=G(n),n=n.return}while(n);var r=s}catch(i){r="\nError generating stack: "+i.message+"\n"+i.stack}return{value:e,source:t,stack:r,digest:null}}function co(e,t,s){return{value:e,source:null,stack:null!=s?s:null,digest:null!=t?t:null}}function uo(e,t){try{console.error(t.value)}catch(s){setTimeout(function(){throw s})}}var ho="function"===typeof WeakMap?WeakMap:Map;function fo(e,t,s){(s=Fi(-1,s)).tag=3,s.payload={element:null};var n=t.value;return s.callback=function(){Hl||(Hl=!0,Kl=n),uo(0,t)},s}function mo(e,t,s){(s=Fi(-1,s)).tag=3;var n=e.type.getDerivedStateFromError;if("function"===typeof n){var r=t.value;s.payload=function(){return n(r)},s.callback=function(){uo(0,t)}}var i=e.stateNode;return null!==i&&"function"===typeof i.componentDidCatch&&(s.callback=function(){uo(0,t),"function"!==typeof n&&(null===Wl?Wl=new Set([this]):Wl.add(this));var e=t.stack;this.componentDidCatch(t.value,{componentStack:null!==e?e:""})}),s}function po(e,t,s){var n=e.pingCache;if(null===n){n=e.pingCache=new ho;var r=new Set;n.set(t,r)}else void 0===(r=n.get(t))&&(r=new Set,n.set(t,r));r.has(s)||(r.add(s),e=wc.bind(null,e,t,s),t.then(e,e))}function go(e){do{var t;if((t=13===e.tag)&&(t=null===(t=e.memoizedState)||null!==t.dehydrated),t)return e;e=e.return}while(null!==e);return null}function vo(e,t,s,n,r){return 0===(1&e.mode)?(e===t?e.flags|=65536:(e.flags|=128,s.flags|=131072,s.flags&=-52805,1===s.tag&&(null===s.alternate?s.tag=17:((t=Fi(-1,1)).tag=2,Ui(s,t,1))),s.lanes|=1),e):(e.flags|=65536,e.lanes=r,e)}var yo=x.ReactCurrentOwner,bo=!1;function xo(e,t,s,n){t.child=null===e?Ei(t,null,s,n):xi(t,e.child,s,n)}function Eo(e,t,s,n,r){s=s.render;var i=t.ref;return Ri(t,r),n=pa(e,t,s,n,i,r),s=ga(),null===e||bo?(ri&&s&&ei(t),t.flags|=1,xo(e,t,n,r),t.child):(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~r,Ho(e,t,r))}function So(e,t,s,n,r){if(null===e){var i=s.type;return"function"!==typeof i||Ic(i)||void 0!==i.defaultProps||null!==s.compare||void 0!==s.defaultProps?((e=Pc(s.type,null,n,t,t.mode,r)).ref=t.ref,e.return=t,t.child=e):(t.tag=15,t.type=i,To(e,t,i,n,r))}if(i=e.child,0===(e.lanes&r)){var a=i.memoizedProps;if((s=null!==(s=s.compare)?s:ln)(a,n)&&e.ref===t.ref)return Ho(e,t,r)}return t.flags|=1,(e=jc(i,n)).ref=t.ref,e.return=t,t.child=e}function To(e,t,s,n,r){if(null!==e){var i=e.memoizedProps;if(ln(i,n)&&e.ref===t.ref){if(bo=!1,t.pendingProps=n=i,0===(e.lanes&r))return t.lanes=e.lanes,Ho(e,t,r);0!==(131072&e.flags)&&(bo=!0)}}return Lo(e,t,s,n,r)}function ko(e,t,s){var n=t.pendingProps,r=n.children,i=null!==e?e.memoizedState:null;if("hidden"===n.mode)if(0===(1&t.mode))t.memoizedState={baseLanes:0,cachePool:null,transitions:null},Lr(jl,Il),Il|=s;else{if(0===(1073741824&s))return e=null!==i?i.baseLanes|s:s,t.lanes=t.childLanes=1073741824,t.memoizedState={baseLanes:e,cachePool:null,transitions:null},t.updateQueue=null,Lr(jl,Il),Il|=e,null;t.memoizedState={baseLanes:0,cachePool:null,transitions:null},n=null!==i?i.baseLanes:s,Lr(jl,Il),Il|=n}else null!==i?(n=i.baseLanes|s,t.memoizedState=null):n=s,Lr(jl,Il),Il|=n;return xo(e,t,r,s),t.child}function wo(e,t){var s=t.ref;(null===e&&null!==s||null!==e&&e.ref!==s)&&(t.flags|=512,t.flags|=2097152)}function Lo(e,t,s,n,r){var i=Ir(s)?_r:Ar.current;return i=Nr(t,i),Ri(t,r),s=pa(e,t,s,n,i,r),n=ga(),null===e||bo?(ri&&n&&ei(t),t.flags|=1,xo(e,t,s,r),t.child):(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~r,Ho(e,t,r))}function Co(e,t,s,n,r){if(Ir(s)){var i=!0;Mr(t)}else i=!1;if(Ri(t,r),null===t.stateNode)zo(e,t),io(t,s,n),oo(t,s,n,r),n=!0;else if(null===e){var a=t.stateNode,o=t.memoizedProps;a.props=o;var l=a.context,c=s.contextType;"object"===typeof c&&null!==c?c=_i(c):c=Nr(t,c=Ir(s)?_r:Ar.current);var d=s.getDerivedStateFromProps,u="function"===typeof d||"function"===typeof a.getSnapshotBeforeUpdate;u||"function"!==typeof a.UNSAFE_componentWillReceiveProps&&"function"!==typeof a.componentWillReceiveProps||(o!==n||l!==c)&&ao(t,a,n,c),Di=!1;var h=t.memoizedState;a.state=h,Vi(t,n,a,r),l=t.memoizedState,o!==n||h!==l||Rr.current||Di?("function"===typeof d&&(so(t,s,d,n),l=t.memoizedState),(o=Di||ro(t,s,o,n,h,l,c))?(u||"function"!==typeof a.UNSAFE_componentWillMount&&"function"!==typeof a.componentWillMount||("function"===typeof a.componentWillMount&&a.componentWillMount(),"function"===typeof a.UNSAFE_componentWillMount&&a.UNSAFE_componentWillMount()),"function"===typeof a.componentDidMount&&(t.flags|=4194308)):("function"===typeof a.componentDidMount&&(t.flags|=4194308),t.memoizedProps=n,t.memoizedState=l),a.props=n,a.state=l,a.context=c,n=o):("function"===typeof a.componentDidMount&&(t.flags|=4194308),n=!1)}else{a=t.stateNode,Oi(e,t),o=t.memoizedProps,c=t.type===t.elementType?o:to(t.type,o),a.props=c,u=t.pendingProps,h=a.context,"object"===typeof(l=s.contextType)&&null!==l?l=_i(l):l=Nr(t,l=Ir(s)?_r:Ar.current);var f=s.getDerivedStateFromProps;(d="function"===typeof f||"function"===typeof a.getSnapshotBeforeUpdate)||"function"!==typeof a.UNSAFE_componentWillReceiveProps&&"function"!==typeof a.componentWillReceiveProps||(o!==u||h!==l)&&ao(t,a,n,l),Di=!1,h=t.memoizedState,a.state=h,Vi(t,n,a,r);var m=t.memoizedState;o!==u||h!==m||Rr.current||Di?("function"===typeof f&&(so(t,s,f,n),m=t.memoizedState),(c=Di||ro(t,s,c,n,h,m,l)||!1)?(d||"function"!==typeof a.UNSAFE_componentWillUpdate&&"function"!==typeof a.componentWillUpdate||("function"===typeof a.componentWillUpdate&&a.componentWillUpdate(n,m,l),"function"===typeof a.UNSAFE_componentWillUpdate&&a.UNSAFE_componentWillUpdate(n,m,l)),"function"===typeof a.componentDidUpdate&&(t.flags|=4),"function"===typeof a.getSnapshotBeforeUpdate&&(t.flags|=1024)):("function"!==typeof a.componentDidUpdate||o===e.memoizedProps&&h===e.memoizedState||(t.flags|=4),"function"!==typeof a.getSnapshotBeforeUpdate||o===e.memoizedProps&&h===e.memoizedState||(t.flags|=1024),t.memoizedProps=n,t.memoizedState=m),a.props=n,a.state=m,a.context=l,n=c):("function"!==typeof a.componentDidUpdate||o===e.memoizedProps&&h===e.memoizedState||(t.flags|=4),"function"!==typeof a.getSnapshotBeforeUpdate||o===e.memoizedProps&&h===e.memoizedState||(t.flags|=1024),n=!1)}return Ao(e,t,s,n,i,r)}function Ao(e,t,s,n,r,i){wo(e,t);var a=0!==(128&t.flags);if(!n&&!a)return r&&Or(t,s,!1),Ho(e,t,i);n=t.stateNode,yo.current=t;var o=a&&"function"!==typeof s.getDerivedStateFromError?null:n.render();return t.flags|=1,null!==e&&a?(t.child=xi(t,e.child,null,i),t.child=xi(t,null,o,i)):xo(e,t,o,i),t.memoizedState=n.state,r&&Or(t,s,!0),t.child}function Ro(e){var t=e.stateNode;t.pendingContext?Pr(0,t.pendingContext,t.pendingContext!==t.context):t.context&&Pr(0,t.context,!1),Xi(e,t.containerInfo)}function _o(e,t,s,n,r){return fi(),mi(r),t.flags|=256,xo(e,t,s,n),t.child}var No,Io,jo,Po,Do={dehydrated:null,treeContext:null,retryLane:0};function Mo(e){return{baseLanes:e,cachePool:null,transitions:null}}function Oo(e,t,s){var n,r=t.pendingProps,a=Zi.current,o=!1,l=0!==(128&t.flags);if((n=l)||(n=(null===e||null!==e.memoizedState)&&0!==(2&a)),n?(o=!0,t.flags&=-129):null!==e&&null===e.memoizedState||(a|=1),Lr(Zi,1&a),null===e)return ci(t),null!==(e=t.memoizedState)&&null!==(e=e.dehydrated)?(0===(1&t.mode)?t.lanes=1:"$!"===e.data?t.lanes=8:t.lanes=1073741824,null):(l=r.children,e=r.fallback,o?(r=t.mode,o=t.child,l={mode:"hidden",children:l},0===(1&r)&&null!==o?(o.childLanes=0,o.pendingProps=l):o=Mc(l,r,0,null),e=Dc(e,r,s,null),o.return=t,e.return=t,o.sibling=e,t.child=o,t.child.memoizedState=Mo(s),t.memoizedState=Do,e):Fo(t,l));if(null!==(a=e.memoizedState)&&null!==(n=a.dehydrated))return function(e,t,s,n,r,a,o){if(s)return 256&t.flags?(t.flags&=-257,Uo(e,t,o,n=co(Error(i(422))))):null!==t.memoizedState?(t.child=e.child,t.flags|=128,null):(a=n.fallback,r=t.mode,n=Mc({mode:"visible",children:n.children},r,0,null),(a=Dc(a,r,o,null)).flags|=2,n.return=t,a.return=t,n.sibling=a,t.child=n,0!==(1&t.mode)&&xi(t,e.child,null,o),t.child.memoizedState=Mo(o),t.memoizedState=Do,a);if(0===(1&t.mode))return Uo(e,t,o,null);if("$!"===r.data){if(n=r.nextSibling&&r.nextSibling.dataset)var l=n.dgst;return n=l,Uo(e,t,o,n=co(a=Error(i(419)),n,void 0))}if(l=0!==(o&e.childLanes),bo||l){if(null!==(n=Rl)){switch(o&-o){case 4:r=2;break;case 16:r=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:r=32;break;case 536870912:r=268435456;break;default:r=0}0!==(r=0!==(r&(n.suspendedLanes|o))?0:r)&&r!==a.retryLane&&(a.retryLane=r,Pi(e,r),sc(n,e,r,-1))}return pc(),Uo(e,t,o,n=co(Error(i(421))))}return"$?"===r.data?(t.flags|=128,t.child=e.child,t=Cc.bind(null,e),r._reactRetry=t,null):(e=a.treeContext,ni=cr(r.nextSibling),si=t,ri=!0,ii=null,null!==e&&(qr[Yr++]=Qr,qr[Yr++]=$r,qr[Yr++]=Xr,Qr=e.id,$r=e.overflow,Xr=t),t=Fo(t,n.children),t.flags|=4096,t)}(e,t,l,r,n,a,s);if(o){o=r.fallback,l=t.mode,n=(a=e.child).sibling;var c={mode:"hidden",children:r.children};return 0===(1&l)&&t.child!==a?((r=t.child).childLanes=0,r.pendingProps=c,t.deletions=null):(r=jc(a,c)).subtreeFlags=14680064&a.subtreeFlags,null!==n?o=jc(n,o):(o=Dc(o,l,s,null)).flags|=2,o.return=t,r.return=t,r.sibling=o,t.child=r,r=o,o=t.child,l=null===(l=e.child.memoizedState)?Mo(s):{baseLanes:l.baseLanes|s,cachePool:null,transitions:l.transitions},o.memoizedState=l,o.childLanes=e.childLanes&~s,t.memoizedState=Do,r}return e=(o=e.child).sibling,r=jc(o,{mode:"visible",children:r.children}),0===(1&t.mode)&&(r.lanes=s),r.return=t,r.sibling=null,null!==e&&(null===(s=t.deletions)?(t.deletions=[e],t.flags|=16):s.push(e)),t.child=r,t.memoizedState=null,r}function Fo(e,t){return(t=Mc({mode:"visible",children:t},e.mode,0,null)).return=e,e.child=t}function Uo(e,t,s,n){return null!==n&&mi(n),xi(t,e.child,null,s),(e=Fo(t,t.pendingProps.children)).flags|=2,t.memoizedState=null,e}function Bo(e,t,s){e.lanes|=t;var n=e.alternate;null!==n&&(n.lanes|=t),Ai(e.return,t,s)}function Go(e,t,s,n,r){var i=e.memoizedState;null===i?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:n,tail:s,tailMode:r}:(i.isBackwards=t,i.rendering=null,i.renderingStartTime=0,i.last=n,i.tail=s,i.tailMode=r)}function Vo(e,t,s){var n=t.pendingProps,r=n.revealOrder,i=n.tail;if(xo(e,t,n.children,s),0!==(2&(n=Zi.current)))n=1&n|2,t.flags|=128;else{if(null!==e&&0!==(128&e.flags))e:for(e=t.child;null!==e;){if(13===e.tag)null!==e.memoizedState&&Bo(e,s,t);else if(19===e.tag)Bo(e,s,t);else if(null!==e.child){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;null===e.sibling;){if(null===e.return||e.return===t)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}n&=1}if(Lr(Zi,n),0===(1&t.mode))t.memoizedState=null;else switch(r){case"forwards":for(s=t.child,r=null;null!==s;)null!==(e=s.alternate)&&null===ea(e)&&(r=s),s=s.sibling;null===(s=r)?(r=t.child,t.child=null):(r=s.sibling,s.sibling=null),Go(t,!1,r,s,i);break;case"backwards":for(s=null,r=t.child,t.child=null;null!==r;){if(null!==(e=r.alternate)&&null===ea(e)){t.child=r;break}e=r.sibling,r.sibling=s,s=r,r=e}Go(t,!0,s,null,i);break;case"together":Go(t,!1,null,null,void 0);break;default:t.memoizedState=null}return t.child}function zo(e,t){0===(1&t.mode)&&null!==e&&(e.alternate=null,t.alternate=null,t.flags|=2)}function Ho(e,t,s){if(null!==e&&(t.dependencies=e.dependencies),Ml|=t.lanes,0===(s&t.childLanes))return null;if(null!==e&&t.child!==e.child)throw Error(i(153));if(null!==t.child){for(s=jc(e=t.child,e.pendingProps),t.child=s,s.return=t;null!==e.sibling;)e=e.sibling,(s=s.sibling=jc(e,e.pendingProps)).return=t;s.sibling=null}return t.child}function Ko(e,t){if(!ri)switch(e.tailMode){case"hidden":t=e.tail;for(var s=null;null!==t;)null!==t.alternate&&(s=t),t=t.sibling;null===s?e.tail=null:s.sibling=null;break;case"collapsed":s=e.tail;for(var n=null;null!==s;)null!==s.alternate&&(n=s),s=s.sibling;null===n?t||null===e.tail?e.tail=null:e.tail.sibling=null:n.sibling=null}}function Wo(e){var t=null!==e.alternate&&e.alternate.child===e.child,s=0,n=0;if(t)for(var r=e.child;null!==r;)s|=r.lanes|r.childLanes,n|=14680064&r.subtreeFlags,n|=14680064&r.flags,r.return=e,r=r.sibling;else for(r=e.child;null!==r;)s|=r.lanes|r.childLanes,n|=r.subtreeFlags,n|=r.flags,r.return=e,r=r.sibling;return e.subtreeFlags|=n,e.childLanes=s,t}function qo(e,t,s){var n=t.pendingProps;switch(ti(t),t.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Wo(t),null;case 1:case 17:return Ir(t.type)&&jr(),Wo(t),null;case 3:return n=t.stateNode,Qi(),wr(Rr),wr(Ar),sa(),n.pendingContext&&(n.context=n.pendingContext,n.pendingContext=null),null!==e&&null!==e.child||(ui(t)?t.flags|=4:null===e||e.memoizedState.isDehydrated&&0===(256&t.flags)||(t.flags|=1024,null!==ii&&(ac(ii),ii=null))),Io(e,t),Wo(t),null;case 5:Ji(t);var r=Yi(qi.current);if(s=t.type,null!==e&&null!=t.stateNode)jo(e,t,s,n,r),e.ref!==t.ref&&(t.flags|=512,t.flags|=2097152);else{if(!n){if(null===t.stateNode)throw Error(i(166));return Wo(t),null}if(e=Yi(Ki.current),ui(t)){n=t.stateNode,s=t.type;var a=t.memoizedProps;switch(n[hr]=t,n[fr]=a,e=0!==(1&t.mode),s){case"dialog":Un("cancel",n),Un("close",n);break;case"iframe":case"object":case"embed":Un("load",n);break;case"video":case"audio":for(r=0;r<Dn.length;r++)Un(Dn[r],n);break;case"source":Un("error",n);break;case"img":case"image":case"link":Un("error",n),Un("load",n);break;case"details":Un("toggle",n);break;case"input":Q(n,a),Un("invalid",n);break;case"select":n._wrapperState={wasMultiple:!!a.multiple},Un("invalid",n);break;case"textarea":re(n,a),Un("invalid",n)}for(var l in ye(s,a),r=null,a)if(a.hasOwnProperty(l)){var c=a[l];"children"===l?"string"===typeof c?n.textContent!==c&&(!0!==a.suppressHydrationWarning&&Jn(n.textContent,c,e),r=["children",c]):"number"===typeof c&&n.textContent!==""+c&&(!0!==a.suppressHydrationWarning&&Jn(n.textContent,c,e),r=["children",""+c]):o.hasOwnProperty(l)&&null!=c&&"onScroll"===l&&Un("scroll",n)}switch(s){case"input":W(n),Z(n,a,!0);break;case"textarea":W(n),ae(n);break;case"select":case"option":break;default:"function"===typeof a.onClick&&(n.onclick=Zn)}n=r,t.updateQueue=n,null!==n&&(t.flags|=4)}else{l=9===r.nodeType?r:r.ownerDocument,"http://www.w3.org/1999/xhtml"===e&&(e=oe(s)),"http://www.w3.org/1999/xhtml"===e?"script"===s?((e=l.createElement("div")).innerHTML="<script><\/script>",e=e.removeChild(e.firstChild)):"string"===typeof n.is?e=l.createElement(s,{is:n.is}):(e=l.createElement(s),"select"===s&&(l=e,n.multiple?l.multiple=!0:n.size&&(l.size=n.size))):e=l.createElementNS(e,s),e[hr]=t,e[fr]=n,No(e,t,!1,!1),t.stateNode=e;e:{switch(l=be(s,n),s){case"dialog":Un("cancel",e),Un("close",e),r=n;break;case"iframe":case"object":case"embed":Un("load",e),r=n;break;case"video":case"audio":for(r=0;r<Dn.length;r++)Un(Dn[r],e);r=n;break;case"source":Un("error",e),r=n;break;case"img":case"image":case"link":Un("error",e),Un("load",e),r=n;break;case"details":Un("toggle",e),r=n;break;case"input":Q(e,n),r=X(e,n),Un("invalid",e);break;case"option":default:r=n;break;case"select":e._wrapperState={wasMultiple:!!n.multiple},r=O({},n,{value:void 0}),Un("invalid",e);break;case"textarea":re(e,n),r=ne(e,n),Un("invalid",e)}for(a in ye(s,r),c=r)if(c.hasOwnProperty(a)){var d=c[a];"style"===a?ge(e,d):"dangerouslySetInnerHTML"===a?null!=(d=d?d.__html:void 0)&&ue(e,d):"children"===a?"string"===typeof d?("textarea"!==s||""!==d)&&he(e,d):"number"===typeof d&&he(e,""+d):"suppressContentEditableWarning"!==a&&"suppressHydrationWarning"!==a&&"autoFocus"!==a&&(o.hasOwnProperty(a)?null!=d&&"onScroll"===a&&Un("scroll",e):null!=d&&b(e,a,d,l))}switch(s){case"input":W(e),Z(e,n,!1);break;case"textarea":W(e),ae(e);break;case"option":null!=n.value&&e.setAttribute("value",""+H(n.value));break;case"select":e.multiple=!!n.multiple,null!=(a=n.value)?se(e,!!n.multiple,a,!1):null!=n.defaultValue&&se(e,!!n.multiple,n.defaultValue,!0);break;default:"function"===typeof r.onClick&&(e.onclick=Zn)}switch(s){case"button":case"input":case"select":case"textarea":n=!!n.autoFocus;break e;case"img":n=!0;break e;default:n=!1}}n&&(t.flags|=4)}null!==t.ref&&(t.flags|=512,t.flags|=2097152)}return Wo(t),null;case 6:if(e&&null!=t.stateNode)Po(e,t,e.memoizedProps,n);else{if("string"!==typeof n&&null===t.stateNode)throw Error(i(166));if(s=Yi(qi.current),Yi(Ki.current),ui(t)){if(n=t.stateNode,s=t.memoizedProps,n[hr]=t,(a=n.nodeValue!==s)&&null!==(e=si))switch(e.tag){case 3:Jn(n.nodeValue,s,0!==(1&e.mode));break;case 5:!0!==e.memoizedProps.suppressHydrationWarning&&Jn(n.nodeValue,s,0!==(1&e.mode))}a&&(t.flags|=4)}else(n=(9===s.nodeType?s:s.ownerDocument).createTextNode(n))[hr]=t,t.stateNode=n}return Wo(t),null;case 13:if(wr(Zi),n=t.memoizedState,null===e||null!==e.memoizedState&&null!==e.memoizedState.dehydrated){if(ri&&null!==ni&&0!==(1&t.mode)&&0===(128&t.flags))hi(),fi(),t.flags|=98560,a=!1;else if(a=ui(t),null!==n&&null!==n.dehydrated){if(null===e){if(!a)throw Error(i(318));if(!(a=null!==(a=t.memoizedState)?a.dehydrated:null))throw Error(i(317));a[hr]=t}else fi(),0===(128&t.flags)&&(t.memoizedState=null),t.flags|=4;Wo(t),a=!1}else null!==ii&&(ac(ii),ii=null),a=!0;if(!a)return 65536&t.flags?t:null}return 0!==(128&t.flags)?(t.lanes=s,t):((n=null!==n)!==(null!==e&&null!==e.memoizedState)&&n&&(t.child.flags|=8192,0!==(1&t.mode)&&(null===e||0!==(1&Zi.current)?0===Pl&&(Pl=3):pc())),null!==t.updateQueue&&(t.flags|=4),Wo(t),null);case 4:return Qi(),Io(e,t),null===e&&Vn(t.stateNode.containerInfo),Wo(t),null;case 10:return Ci(t.type._context),Wo(t),null;case 19:if(wr(Zi),null===(a=t.memoizedState))return Wo(t),null;if(n=0!==(128&t.flags),null===(l=a.rendering))if(n)Ko(a,!1);else{if(0!==Pl||null!==e&&0!==(128&e.flags))for(e=t.child;null!==e;){if(null!==(l=ea(e))){for(t.flags|=128,Ko(a,!1),null!==(n=l.updateQueue)&&(t.updateQueue=n,t.flags|=4),t.subtreeFlags=0,n=s,s=t.child;null!==s;)e=n,(a=s).flags&=14680066,null===(l=a.alternate)?(a.childLanes=0,a.lanes=e,a.child=null,a.subtreeFlags=0,a.memoizedProps=null,a.memoizedState=null,a.updateQueue=null,a.dependencies=null,a.stateNode=null):(a.childLanes=l.childLanes,a.lanes=l.lanes,a.child=l.child,a.subtreeFlags=0,a.deletions=null,a.memoizedProps=l.memoizedProps,a.memoizedState=l.memoizedState,a.updateQueue=l.updateQueue,a.type=l.type,e=l.dependencies,a.dependencies=null===e?null:{lanes:e.lanes,firstContext:e.firstContext}),s=s.sibling;return Lr(Zi,1&Zi.current|2),t.child}e=e.sibling}null!==a.tail&&$e()>Vl&&(t.flags|=128,n=!0,Ko(a,!1),t.lanes=4194304)}else{if(!n)if(null!==(e=ea(l))){if(t.flags|=128,n=!0,null!==(s=e.updateQueue)&&(t.updateQueue=s,t.flags|=4),Ko(a,!0),null===a.tail&&"hidden"===a.tailMode&&!l.alternate&&!ri)return Wo(t),null}else 2*$e()-a.renderingStartTime>Vl&&1073741824!==s&&(t.flags|=128,n=!0,Ko(a,!1),t.lanes=4194304);a.isBackwards?(l.sibling=t.child,t.child=l):(null!==(s=a.last)?s.sibling=l:t.child=l,a.last=l)}return null!==a.tail?(t=a.tail,a.rendering=t,a.tail=t.sibling,a.renderingStartTime=$e(),t.sibling=null,s=Zi.current,Lr(Zi,n?1&s|2:1&s),t):(Wo(t),null);case 22:case 23:return uc(),n=null!==t.memoizedState,null!==e&&null!==e.memoizedState!==n&&(t.flags|=8192),n&&0!==(1&t.mode)?0!==(1073741824&Il)&&(Wo(t),6&t.subtreeFlags&&(t.flags|=8192)):Wo(t),null;case 24:case 25:return null}throw Error(i(156,t.tag))}function Yo(e,t){switch(ti(t),t.tag){case 1:return Ir(t.type)&&jr(),65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 3:return Qi(),wr(Rr),wr(Ar),sa(),0!==(65536&(e=t.flags))&&0===(128&e)?(t.flags=-65537&e|128,t):null;case 5:return Ji(t),null;case 13:if(wr(Zi),null!==(e=t.memoizedState)&&null!==e.dehydrated){if(null===t.alternate)throw Error(i(340));fi()}return 65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 19:return wr(Zi),null;case 4:return Qi(),null;case 10:return Ci(t.type._context),null;case 22:case 23:return uc(),null;default:return null}}No=function(e,t){for(var s=t.child;null!==s;){if(5===s.tag||6===s.tag)e.appendChild(s.stateNode);else if(4!==s.tag&&null!==s.child){s.child.return=s,s=s.child;continue}if(s===t)break;for(;null===s.sibling;){if(null===s.return||s.return===t)return;s=s.return}s.sibling.return=s.return,s=s.sibling}},Io=function(){},jo=function(e,t,s,n){var r=e.memoizedProps;if(r!==n){e=t.stateNode,Yi(Ki.current);var i,a=null;switch(s){case"input":r=X(e,r),n=X(e,n),a=[];break;case"select":r=O({},r,{value:void 0}),n=O({},n,{value:void 0}),a=[];break;case"textarea":r=ne(e,r),n=ne(e,n),a=[];break;default:"function"!==typeof r.onClick&&"function"===typeof n.onClick&&(e.onclick=Zn)}for(d in ye(s,n),s=null,r)if(!n.hasOwnProperty(d)&&r.hasOwnProperty(d)&&null!=r[d])if("style"===d){var l=r[d];for(i in l)l.hasOwnProperty(i)&&(s||(s={}),s[i]="")}else"dangerouslySetInnerHTML"!==d&&"children"!==d&&"suppressContentEditableWarning"!==d&&"suppressHydrationWarning"!==d&&"autoFocus"!==d&&(o.hasOwnProperty(d)?a||(a=[]):(a=a||[]).push(d,null));for(d in n){var c=n[d];if(l=null!=r?r[d]:void 0,n.hasOwnProperty(d)&&c!==l&&(null!=c||null!=l))if("style"===d)if(l){for(i in l)!l.hasOwnProperty(i)||c&&c.hasOwnProperty(i)||(s||(s={}),s[i]="");for(i in c)c.hasOwnProperty(i)&&l[i]!==c[i]&&(s||(s={}),s[i]=c[i])}else s||(a||(a=[]),a.push(d,s)),s=c;else"dangerouslySetInnerHTML"===d?(c=c?c.__html:void 0,l=l?l.__html:void 0,null!=c&&l!==c&&(a=a||[]).push(d,c)):"children"===d?"string"!==typeof c&&"number"!==typeof c||(a=a||[]).push(d,""+c):"suppressContentEditableWarning"!==d&&"suppressHydrationWarning"!==d&&(o.hasOwnProperty(d)?(null!=c&&"onScroll"===d&&Un("scroll",e),a||l===c||(a=[])):(a=a||[]).push(d,c))}s&&(a=a||[]).push("style",s);var d=a;(t.updateQueue=d)&&(t.flags|=4)}},Po=function(e,t,s,n){s!==n&&(t.flags|=4)};var Xo=!1,Qo=!1,$o="function"===typeof WeakSet?WeakSet:Set,Jo=null;function Zo(e,t){var s=e.ref;if(null!==s)if("function"===typeof s)try{s(null)}catch(n){kc(e,t,n)}else s.current=null}function el(e,t,s){try{s()}catch(n){kc(e,t,n)}}var tl=!1;function sl(e,t,s){var n=t.updateQueue;if(null!==(n=null!==n?n.lastEffect:null)){var r=n=n.next;do{if((r.tag&e)===e){var i=r.destroy;r.destroy=void 0,void 0!==i&&el(t,s,i)}r=r.next}while(r!==n)}}function nl(e,t){if(null!==(t=null!==(t=t.updateQueue)?t.lastEffect:null)){var s=t=t.next;do{if((s.tag&e)===e){var n=s.create;s.destroy=n()}s=s.next}while(s!==t)}}function rl(e){var t=e.ref;if(null!==t){var s=e.stateNode;e.tag,e=s,"function"===typeof t?t(e):t.current=e}}function il(e){var t=e.alternate;null!==t&&(e.alternate=null,il(t)),e.child=null,e.deletions=null,e.sibling=null,5===e.tag&&(null!==(t=e.stateNode)&&(delete t[hr],delete t[fr],delete t[pr],delete t[gr],delete t[vr])),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}function al(e){return 5===e.tag||3===e.tag||4===e.tag}function ol(e){e:for(;;){for(;null===e.sibling;){if(null===e.return||al(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;5!==e.tag&&6!==e.tag&&18!==e.tag;){if(2&e.flags)continue e;if(null===e.child||4===e.tag)continue e;e.child.return=e,e=e.child}if(!(2&e.flags))return e.stateNode}}function ll(e,t,s){var n=e.tag;if(5===n||6===n)e=e.stateNode,t?8===s.nodeType?s.parentNode.insertBefore(e,t):s.insertBefore(e,t):(8===s.nodeType?(t=s.parentNode).insertBefore(e,s):(t=s).appendChild(e),null!==(s=s._reactRootContainer)&&void 0!==s||null!==t.onclick||(t.onclick=Zn));else if(4!==n&&null!==(e=e.child))for(ll(e,t,s),e=e.sibling;null!==e;)ll(e,t,s),e=e.sibling}function cl(e,t,s){var n=e.tag;if(5===n||6===n)e=e.stateNode,t?s.insertBefore(e,t):s.appendChild(e);else if(4!==n&&null!==(e=e.child))for(cl(e,t,s),e=e.sibling;null!==e;)cl(e,t,s),e=e.sibling}var dl=null,ul=!1;function hl(e,t,s){for(s=s.child;null!==s;)fl(e,t,s),s=s.sibling}function fl(e,t,s){if(it&&"function"===typeof it.onCommitFiberUnmount)try{it.onCommitFiberUnmount(rt,s)}catch(o){}switch(s.tag){case 5:Qo||Zo(s,t);case 6:var n=dl,r=ul;dl=null,hl(e,t,s),ul=r,null!==(dl=n)&&(ul?(e=dl,s=s.stateNode,8===e.nodeType?e.parentNode.removeChild(s):e.removeChild(s)):dl.removeChild(s.stateNode));break;case 18:null!==dl&&(ul?(e=dl,s=s.stateNode,8===e.nodeType?lr(e.parentNode,s):1===e.nodeType&&lr(e,s),Vt(e)):lr(dl,s.stateNode));break;case 4:n=dl,r=ul,dl=s.stateNode.containerInfo,ul=!0,hl(e,t,s),dl=n,ul=r;break;case 0:case 11:case 14:case 15:if(!Qo&&(null!==(n=s.updateQueue)&&null!==(n=n.lastEffect))){r=n=n.next;do{var i=r,a=i.destroy;i=i.tag,void 0!==a&&(0!==(2&i)||0!==(4&i))&&el(s,t,a),r=r.next}while(r!==n)}hl(e,t,s);break;case 1:if(!Qo&&(Zo(s,t),"function"===typeof(n=s.stateNode).componentWillUnmount))try{n.props=s.memoizedProps,n.state=s.memoizedState,n.componentWillUnmount()}catch(o){kc(s,t,o)}hl(e,t,s);break;case 21:hl(e,t,s);break;case 22:1&s.mode?(Qo=(n=Qo)||null!==s.memoizedState,hl(e,t,s),Qo=n):hl(e,t,s);break;default:hl(e,t,s)}}function ml(e){var t=e.updateQueue;if(null!==t){e.updateQueue=null;var s=e.stateNode;null===s&&(s=e.stateNode=new $o),t.forEach(function(t){var n=Ac.bind(null,e,t);s.has(t)||(s.add(t),t.then(n,n))})}}function pl(e,t){var s=t.deletions;if(null!==s)for(var n=0;n<s.length;n++){var r=s[n];try{var a=e,o=t,l=o;e:for(;null!==l;){switch(l.tag){case 5:dl=l.stateNode,ul=!1;break e;case 3:case 4:dl=l.stateNode.containerInfo,ul=!0;break e}l=l.return}if(null===dl)throw Error(i(160));fl(a,o,r),dl=null,ul=!1;var c=r.alternate;null!==c&&(c.return=null),r.return=null}catch(d){kc(r,t,d)}}if(12854&t.subtreeFlags)for(t=t.child;null!==t;)gl(t,e),t=t.sibling}function gl(e,t){var s=e.alternate,n=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:if(pl(t,e),vl(e),4&n){try{sl(3,e,e.return),nl(3,e)}catch(g){kc(e,e.return,g)}try{sl(5,e,e.return)}catch(g){kc(e,e.return,g)}}break;case 1:pl(t,e),vl(e),512&n&&null!==s&&Zo(s,s.return);break;case 5:if(pl(t,e),vl(e),512&n&&null!==s&&Zo(s,s.return),32&e.flags){var r=e.stateNode;try{he(r,"")}catch(g){kc(e,e.return,g)}}if(4&n&&null!=(r=e.stateNode)){var a=e.memoizedProps,o=null!==s?s.memoizedProps:a,l=e.type,c=e.updateQueue;if(e.updateQueue=null,null!==c)try{"input"===l&&"radio"===a.type&&null!=a.name&&$(r,a),be(l,o);var d=be(l,a);for(o=0;o<c.length;o+=2){var u=c[o],h=c[o+1];"style"===u?ge(r,h):"dangerouslySetInnerHTML"===u?ue(r,h):"children"===u?he(r,h):b(r,u,h,d)}switch(l){case"input":J(r,a);break;case"textarea":ie(r,a);break;case"select":var f=r._wrapperState.wasMultiple;r._wrapperState.wasMultiple=!!a.multiple;var m=a.value;null!=m?se(r,!!a.multiple,m,!1):f!==!!a.multiple&&(null!=a.defaultValue?se(r,!!a.multiple,a.defaultValue,!0):se(r,!!a.multiple,a.multiple?[]:"",!1))}r[fr]=a}catch(g){kc(e,e.return,g)}}break;case 6:if(pl(t,e),vl(e),4&n){if(null===e.stateNode)throw Error(i(162));r=e.stateNode,a=e.memoizedProps;try{r.nodeValue=a}catch(g){kc(e,e.return,g)}}break;case 3:if(pl(t,e),vl(e),4&n&&null!==s&&s.memoizedState.isDehydrated)try{Vt(t.containerInfo)}catch(g){kc(e,e.return,g)}break;case 4:default:pl(t,e),vl(e);break;case 13:pl(t,e),vl(e),8192&(r=e.child).flags&&(a=null!==r.memoizedState,r.stateNode.isHidden=a,!a||null!==r.alternate&&null!==r.alternate.memoizedState||(Gl=$e())),4&n&&ml(e);break;case 22:if(u=null!==s&&null!==s.memoizedState,1&e.mode?(Qo=(d=Qo)||u,pl(t,e),Qo=d):pl(t,e),vl(e),8192&n){if(d=null!==e.memoizedState,(e.stateNode.isHidden=d)&&!u&&0!==(1&e.mode))for(Jo=e,u=e.child;null!==u;){for(h=Jo=u;null!==Jo;){switch(m=(f=Jo).child,f.tag){case 0:case 11:case 14:case 15:sl(4,f,f.return);break;case 1:Zo(f,f.return);var p=f.stateNode;if("function"===typeof p.componentWillUnmount){n=f,s=f.return;try{t=n,p.props=t.memoizedProps,p.state=t.memoizedState,p.componentWillUnmount()}catch(g){kc(n,s,g)}}break;case 5:Zo(f,f.return);break;case 22:if(null!==f.memoizedState){El(h);continue}}null!==m?(m.return=f,Jo=m):El(h)}u=u.sibling}e:for(u=null,h=e;;){if(5===h.tag){if(null===u){u=h;try{r=h.stateNode,d?"function"===typeof(a=r.style).setProperty?a.setProperty("display","none","important"):a.display="none":(l=h.stateNode,o=void 0!==(c=h.memoizedProps.style)&&null!==c&&c.hasOwnProperty("display")?c.display:null,l.style.display=pe("display",o))}catch(g){kc(e,e.return,g)}}}else if(6===h.tag){if(null===u)try{h.stateNode.nodeValue=d?"":h.memoizedProps}catch(g){kc(e,e.return,g)}}else if((22!==h.tag&&23!==h.tag||null===h.memoizedState||h===e)&&null!==h.child){h.child.return=h,h=h.child;continue}if(h===e)break e;for(;null===h.sibling;){if(null===h.return||h.return===e)break e;u===h&&(u=null),h=h.return}u===h&&(u=null),h.sibling.return=h.return,h=h.sibling}}break;case 19:pl(t,e),vl(e),4&n&&ml(e);case 21:}}function vl(e){var t=e.flags;if(2&t){try{e:{for(var s=e.return;null!==s;){if(al(s)){var n=s;break e}s=s.return}throw Error(i(160))}switch(n.tag){case 5:var r=n.stateNode;32&n.flags&&(he(r,""),n.flags&=-33),cl(e,ol(e),r);break;case 3:case 4:var a=n.stateNode.containerInfo;ll(e,ol(e),a);break;default:throw Error(i(161))}}catch(o){kc(e,e.return,o)}e.flags&=-3}4096&t&&(e.flags&=-4097)}function yl(e,t,s){Jo=e,bl(e,t,s)}function bl(e,t,s){for(var n=0!==(1&e.mode);null!==Jo;){var r=Jo,i=r.child;if(22===r.tag&&n){var a=null!==r.memoizedState||Xo;if(!a){var o=r.alternate,l=null!==o&&null!==o.memoizedState||Qo;o=Xo;var c=Qo;if(Xo=a,(Qo=l)&&!c)for(Jo=r;null!==Jo;)l=(a=Jo).child,22===a.tag&&null!==a.memoizedState?Sl(r):null!==l?(l.return=a,Jo=l):Sl(r);for(;null!==i;)Jo=i,bl(i,t,s),i=i.sibling;Jo=r,Xo=o,Qo=c}xl(e)}else 0!==(8772&r.subtreeFlags)&&null!==i?(i.return=r,Jo=i):xl(e)}}function xl(e){for(;null!==Jo;){var t=Jo;if(0!==(8772&t.flags)){var s=t.alternate;try{if(0!==(8772&t.flags))switch(t.tag){case 0:case 11:case 15:Qo||nl(5,t);break;case 1:var n=t.stateNode;if(4&t.flags&&!Qo)if(null===s)n.componentDidMount();else{var r=t.elementType===t.type?s.memoizedProps:to(t.type,s.memoizedProps);n.componentDidUpdate(r,s.memoizedState,n.__reactInternalSnapshotBeforeUpdate)}var a=t.updateQueue;null!==a&&zi(t,a,n);break;case 3:var o=t.updateQueue;if(null!==o){if(s=null,null!==t.child)switch(t.child.tag){case 5:case 1:s=t.child.stateNode}zi(t,o,s)}break;case 5:var l=t.stateNode;if(null===s&&4&t.flags){s=l;var c=t.memoizedProps;switch(t.type){case"button":case"input":case"select":case"textarea":c.autoFocus&&s.focus();break;case"img":c.src&&(s.src=c.src)}}break;case 6:case 4:case 12:case 19:case 17:case 21:case 22:case 23:case 25:break;case 13:if(null===t.memoizedState){var d=t.alternate;if(null!==d){var u=d.memoizedState;if(null!==u){var h=u.dehydrated;null!==h&&Vt(h)}}}break;default:throw Error(i(163))}Qo||512&t.flags&&rl(t)}catch(f){kc(t,t.return,f)}}if(t===e){Jo=null;break}if(null!==(s=t.sibling)){s.return=t.return,Jo=s;break}Jo=t.return}}function El(e){for(;null!==Jo;){var t=Jo;if(t===e){Jo=null;break}var s=t.sibling;if(null!==s){s.return=t.return,Jo=s;break}Jo=t.return}}function Sl(e){for(;null!==Jo;){var t=Jo;try{switch(t.tag){case 0:case 11:case 15:var s=t.return;try{nl(4,t)}catch(l){kc(t,s,l)}break;case 1:var n=t.stateNode;if("function"===typeof n.componentDidMount){var r=t.return;try{n.componentDidMount()}catch(l){kc(t,r,l)}}var i=t.return;try{rl(t)}catch(l){kc(t,i,l)}break;case 5:var a=t.return;try{rl(t)}catch(l){kc(t,a,l)}}}catch(l){kc(t,t.return,l)}if(t===e){Jo=null;break}var o=t.sibling;if(null!==o){o.return=t.return,Jo=o;break}Jo=t.return}}var Tl,kl=Math.ceil,wl=x.ReactCurrentDispatcher,Ll=x.ReactCurrentOwner,Cl=x.ReactCurrentBatchConfig,Al=0,Rl=null,_l=null,Nl=0,Il=0,jl=kr(0),Pl=0,Dl=null,Ml=0,Ol=0,Fl=0,Ul=null,Bl=null,Gl=0,Vl=1/0,zl=null,Hl=!1,Kl=null,Wl=null,ql=!1,Yl=null,Xl=0,Ql=0,$l=null,Jl=-1,Zl=0;function ec(){return 0!==(6&Al)?$e():-1!==Jl?Jl:Jl=$e()}function tc(e){return 0===(1&e.mode)?1:0!==(2&Al)&&0!==Nl?Nl&-Nl:null!==pi.transition?(0===Zl&&(Zl=pt()),Zl):0!==(e=bt)?e:e=void 0===(e=window.event)?16:Qt(e.type)}function sc(e,t,s,n){if(50<Ql)throw Ql=0,$l=null,Error(i(185));vt(e,s,n),0!==(2&Al)&&e===Rl||(e===Rl&&(0===(2&Al)&&(Ol|=s),4===Pl&&oc(e,Nl)),nc(e,n),1===s&&0===Al&&0===(1&t.mode)&&(Vl=$e()+500,Ur&&Vr()))}function nc(e,t){var s=e.callbackNode;!function(e,t){for(var s=e.suspendedLanes,n=e.pingedLanes,r=e.expirationTimes,i=e.pendingLanes;0<i;){var a=31-at(i),o=1<<a,l=r[a];-1===l?0!==(o&s)&&0===(o&n)||(r[a]=ft(o,t)):l<=t&&(e.expiredLanes|=o),i&=~o}}(e,t);var n=ht(e,e===Rl?Nl:0);if(0===n)null!==s&&Ye(s),e.callbackNode=null,e.callbackPriority=0;else if(t=n&-n,e.callbackPriority!==t){if(null!=s&&Ye(s),1===t)0===e.tag?function(e){Ur=!0,Gr(e)}(lc.bind(null,e)):Gr(lc.bind(null,e)),ar(function(){0===(6&Al)&&Vr()}),s=null;else{switch(xt(n)){case 1:s=Ze;break;case 4:s=et;break;case 16:default:s=tt;break;case 536870912:s=nt}s=Rc(s,rc.bind(null,e))}e.callbackPriority=t,e.callbackNode=s}}function rc(e,t){if(Jl=-1,Zl=0,0!==(6&Al))throw Error(i(327));var s=e.callbackNode;if(Sc()&&e.callbackNode!==s)return null;var n=ht(e,e===Rl?Nl:0);if(0===n)return null;if(0!==(30&n)||0!==(n&e.expiredLanes)||t)t=gc(e,n);else{t=n;var r=Al;Al|=2;var a=mc();for(Rl===e&&Nl===t||(zl=null,Vl=$e()+500,hc(e,t));;)try{yc();break}catch(l){fc(e,l)}Li(),wl.current=a,Al=r,null!==_l?t=0:(Rl=null,Nl=0,t=Pl)}if(0!==t){if(2===t&&(0!==(r=mt(e))&&(n=r,t=ic(e,r))),1===t)throw s=Dl,hc(e,0),oc(e,n),nc(e,$e()),s;if(6===t)oc(e,n);else{if(r=e.current.alternate,0===(30&n)&&!function(e){for(var t=e;;){if(16384&t.flags){var s=t.updateQueue;if(null!==s&&null!==(s=s.stores))for(var n=0;n<s.length;n++){var r=s[n],i=r.getSnapshot;r=r.value;try{if(!on(i(),r))return!1}catch(o){return!1}}}if(s=t.child,16384&t.subtreeFlags&&null!==s)s.return=t,t=s;else{if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return!0;t=t.return}t.sibling.return=t.return,t=t.sibling}}return!0}(r)&&(2===(t=gc(e,n))&&(0!==(a=mt(e))&&(n=a,t=ic(e,a))),1===t))throw s=Dl,hc(e,0),oc(e,n),nc(e,$e()),s;switch(e.finishedWork=r,e.finishedLanes=n,t){case 0:case 1:throw Error(i(345));case 2:case 5:Ec(e,Bl,zl);break;case 3:if(oc(e,n),(130023424&n)===n&&10<(t=Gl+500-$e())){if(0!==ht(e,0))break;if(((r=e.suspendedLanes)&n)!==n){ec(),e.pingedLanes|=e.suspendedLanes&r;break}e.timeoutHandle=nr(Ec.bind(null,e,Bl,zl),t);break}Ec(e,Bl,zl);break;case 4:if(oc(e,n),(4194240&n)===n)break;for(t=e.eventTimes,r=-1;0<n;){var o=31-at(n);a=1<<o,(o=t[o])>r&&(r=o),n&=~a}if(n=r,10<(n=(120>(n=$e()-n)?120:480>n?480:1080>n?1080:1920>n?1920:3e3>n?3e3:4320>n?4320:1960*kl(n/1960))-n)){e.timeoutHandle=nr(Ec.bind(null,e,Bl,zl),n);break}Ec(e,Bl,zl);break;default:throw Error(i(329))}}}return nc(e,$e()),e.callbackNode===s?rc.bind(null,e):null}function ic(e,t){var s=Ul;return e.current.memoizedState.isDehydrated&&(hc(e,t).flags|=256),2!==(e=gc(e,t))&&(t=Bl,Bl=s,null!==t&&ac(t)),e}function ac(e){null===Bl?Bl=e:Bl.push.apply(Bl,e)}function oc(e,t){for(t&=~Fl,t&=~Ol,e.suspendedLanes|=t,e.pingedLanes&=~t,e=e.expirationTimes;0<t;){var s=31-at(t),n=1<<s;e[s]=-1,t&=~n}}function lc(e){if(0!==(6&Al))throw Error(i(327));Sc();var t=ht(e,0);if(0===(1&t))return nc(e,$e()),null;var s=gc(e,t);if(0!==e.tag&&2===s){var n=mt(e);0!==n&&(t=n,s=ic(e,n))}if(1===s)throw s=Dl,hc(e,0),oc(e,t),nc(e,$e()),s;if(6===s)throw Error(i(345));return e.finishedWork=e.current.alternate,e.finishedLanes=t,Ec(e,Bl,zl),nc(e,$e()),null}function cc(e,t){var s=Al;Al|=1;try{return e(t)}finally{0===(Al=s)&&(Vl=$e()+500,Ur&&Vr())}}function dc(e){null!==Yl&&0===Yl.tag&&0===(6&Al)&&Sc();var t=Al;Al|=1;var s=Cl.transition,n=bt;try{if(Cl.transition=null,bt=1,e)return e()}finally{bt=n,Cl.transition=s,0===(6&(Al=t))&&Vr()}}function uc(){Il=jl.current,wr(jl)}function hc(e,t){e.finishedWork=null,e.finishedLanes=0;var s=e.timeoutHandle;if(-1!==s&&(e.timeoutHandle=-1,rr(s)),null!==_l)for(s=_l.return;null!==s;){var n=s;switch(ti(n),n.tag){case 1:null!==(n=n.type.childContextTypes)&&void 0!==n&&jr();break;case 3:Qi(),wr(Rr),wr(Ar),sa();break;case 5:Ji(n);break;case 4:Qi();break;case 13:case 19:wr(Zi);break;case 10:Ci(n.type._context);break;case 22:case 23:uc()}s=s.return}if(Rl=e,_l=e=jc(e.current,null),Nl=Il=t,Pl=0,Dl=null,Fl=Ol=Ml=0,Bl=Ul=null,null!==Ni){for(t=0;t<Ni.length;t++)if(null!==(n=(s=Ni[t]).interleaved)){s.interleaved=null;var r=n.next,i=s.pending;if(null!==i){var a=i.next;i.next=r,n.next=a}s.pending=n}Ni=null}return e}function fc(e,t){for(;;){var s=_l;try{if(Li(),na.current=$a,ca){for(var n=aa.memoizedState;null!==n;){var r=n.queue;null!==r&&(r.pending=null),n=n.next}ca=!1}if(ia=0,la=oa=aa=null,da=!1,ua=0,Ll.current=null,null===s||null===s.return){Pl=1,Dl=t,_l=null;break}e:{var a=e,o=s.return,l=s,c=t;if(t=Nl,l.flags|=32768,null!==c&&"object"===typeof c&&"function"===typeof c.then){var d=c,u=l,h=u.tag;if(0===(1&u.mode)&&(0===h||11===h||15===h)){var f=u.alternate;f?(u.updateQueue=f.updateQueue,u.memoizedState=f.memoizedState,u.lanes=f.lanes):(u.updateQueue=null,u.memoizedState=null)}var m=go(o);if(null!==m){m.flags&=-257,vo(m,o,l,0,t),1&m.mode&&po(a,d,t),c=d;var p=(t=m).updateQueue;if(null===p){var g=new Set;g.add(c),t.updateQueue=g}else p.add(c);break e}if(0===(1&t)){po(a,d,t),pc();break e}c=Error(i(426))}else if(ri&&1&l.mode){var v=go(o);if(null!==v){0===(65536&v.flags)&&(v.flags|=256),vo(v,o,l,0,t),mi(lo(c,l));break e}}a=c=lo(c,l),4!==Pl&&(Pl=2),null===Ul?Ul=[a]:Ul.push(a),a=o;do{switch(a.tag){case 3:a.flags|=65536,t&=-t,a.lanes|=t,Gi(a,fo(0,c,t));break e;case 1:l=c;var y=a.type,b=a.stateNode;if(0===(128&a.flags)&&("function"===typeof y.getDerivedStateFromError||null!==b&&"function"===typeof b.componentDidCatch&&(null===Wl||!Wl.has(b)))){a.flags|=65536,t&=-t,a.lanes|=t,Gi(a,mo(a,l,t));break e}}a=a.return}while(null!==a)}xc(s)}catch(x){t=x,_l===s&&null!==s&&(_l=s=s.return);continue}break}}function mc(){var e=wl.current;return wl.current=$a,null===e?$a:e}function pc(){0!==Pl&&3!==Pl&&2!==Pl||(Pl=4),null===Rl||0===(268435455&Ml)&&0===(268435455&Ol)||oc(Rl,Nl)}function gc(e,t){var s=Al;Al|=2;var n=mc();for(Rl===e&&Nl===t||(zl=null,hc(e,t));;)try{vc();break}catch(r){fc(e,r)}if(Li(),Al=s,wl.current=n,null!==_l)throw Error(i(261));return Rl=null,Nl=0,Pl}function vc(){for(;null!==_l;)bc(_l)}function yc(){for(;null!==_l&&!Xe();)bc(_l)}function bc(e){var t=Tl(e.alternate,e,Il);e.memoizedProps=e.pendingProps,null===t?xc(e):_l=t,Ll.current=null}function xc(e){var t=e;do{var s=t.alternate;if(e=t.return,0===(32768&t.flags)){if(null!==(s=qo(s,t,Il)))return void(_l=s)}else{if(null!==(s=Yo(s,t)))return s.flags&=32767,void(_l=s);if(null===e)return Pl=6,void(_l=null);e.flags|=32768,e.subtreeFlags=0,e.deletions=null}if(null!==(t=t.sibling))return void(_l=t);_l=t=e}while(null!==t);0===Pl&&(Pl=5)}function Ec(e,t,s){var n=bt,r=Cl.transition;try{Cl.transition=null,bt=1,function(e,t,s,n){do{Sc()}while(null!==Yl);if(0!==(6&Al))throw Error(i(327));s=e.finishedWork;var r=e.finishedLanes;if(null===s)return null;if(e.finishedWork=null,e.finishedLanes=0,s===e.current)throw Error(i(177));e.callbackNode=null,e.callbackPriority=0;var a=s.lanes|s.childLanes;if(function(e,t){var s=e.pendingLanes&~t;e.pendingLanes=t,e.suspendedLanes=0,e.pingedLanes=0,e.expiredLanes&=t,e.mutableReadLanes&=t,e.entangledLanes&=t,t=e.entanglements;var n=e.eventTimes;for(e=e.expirationTimes;0<s;){var r=31-at(s),i=1<<r;t[r]=0,n[r]=-1,e[r]=-1,s&=~i}}(e,a),e===Rl&&(_l=Rl=null,Nl=0),0===(2064&s.subtreeFlags)&&0===(2064&s.flags)||ql||(ql=!0,Rc(tt,function(){return Sc(),null})),a=0!==(15990&s.flags),0!==(15990&s.subtreeFlags)||a){a=Cl.transition,Cl.transition=null;var o=bt;bt=1;var l=Al;Al|=4,Ll.current=null,function(e,t){if(er=Ht,fn(e=hn())){if("selectionStart"in e)var s={start:e.selectionStart,end:e.selectionEnd};else e:{var n=(s=(s=e.ownerDocument)&&s.defaultView||window).getSelection&&s.getSelection();if(n&&0!==n.rangeCount){s=n.anchorNode;var r=n.anchorOffset,a=n.focusNode;n=n.focusOffset;try{s.nodeType,a.nodeType}catch(E){s=null;break e}var o=0,l=-1,c=-1,d=0,u=0,h=e,f=null;t:for(;;){for(var m;h!==s||0!==r&&3!==h.nodeType||(l=o+r),h!==a||0!==n&&3!==h.nodeType||(c=o+n),3===h.nodeType&&(o+=h.nodeValue.length),null!==(m=h.firstChild);)f=h,h=m;for(;;){if(h===e)break t;if(f===s&&++d===r&&(l=o),f===a&&++u===n&&(c=o),null!==(m=h.nextSibling))break;f=(h=f).parentNode}h=m}s=-1===l||-1===c?null:{start:l,end:c}}else s=null}s=s||{start:0,end:0}}else s=null;for(tr={focusedElem:e,selectionRange:s},Ht=!1,Jo=t;null!==Jo;)if(e=(t=Jo).child,0!==(1028&t.subtreeFlags)&&null!==e)e.return=t,Jo=e;else for(;null!==Jo;){t=Jo;try{var p=t.alternate;if(0!==(1024&t.flags))switch(t.tag){case 0:case 11:case 15:case 5:case 6:case 4:case 17:break;case 1:if(null!==p){var g=p.memoizedProps,v=p.memoizedState,y=t.stateNode,b=y.getSnapshotBeforeUpdate(t.elementType===t.type?g:to(t.type,g),v);y.__reactInternalSnapshotBeforeUpdate=b}break;case 3:var x=t.stateNode.containerInfo;1===x.nodeType?x.textContent="":9===x.nodeType&&x.documentElement&&x.removeChild(x.documentElement);break;default:throw Error(i(163))}}catch(E){kc(t,t.return,E)}if(null!==(e=t.sibling)){e.return=t.return,Jo=e;break}Jo=t.return}p=tl,tl=!1}(e,s),gl(s,e),mn(tr),Ht=!!er,tr=er=null,e.current=s,yl(s,e,r),Qe(),Al=l,bt=o,Cl.transition=a}else e.current=s;if(ql&&(ql=!1,Yl=e,Xl=r),a=e.pendingLanes,0===a&&(Wl=null),function(e){if(it&&"function"===typeof it.onCommitFiberRoot)try{it.onCommitFiberRoot(rt,e,void 0,128===(128&e.current.flags))}catch(t){}}(s.stateNode),nc(e,$e()),null!==t)for(n=e.onRecoverableError,s=0;s<t.length;s++)r=t[s],n(r.value,{componentStack:r.stack,digest:r.digest});if(Hl)throw Hl=!1,e=Kl,Kl=null,e;0!==(1&Xl)&&0!==e.tag&&Sc(),a=e.pendingLanes,0!==(1&a)?e===$l?Ql++:(Ql=0,$l=e):Ql=0,Vr()}(e,t,s,n)}finally{Cl.transition=r,bt=n}return null}function Sc(){if(null!==Yl){var e=xt(Xl),t=Cl.transition,s=bt;try{if(Cl.transition=null,bt=16>e?16:e,null===Yl)var n=!1;else{if(e=Yl,Yl=null,Xl=0,0!==(6&Al))throw Error(i(331));var r=Al;for(Al|=4,Jo=e.current;null!==Jo;){var a=Jo,o=a.child;if(0!==(16&Jo.flags)){var l=a.deletions;if(null!==l){for(var c=0;c<l.length;c++){var d=l[c];for(Jo=d;null!==Jo;){var u=Jo;switch(u.tag){case 0:case 11:case 15:sl(8,u,a)}var h=u.child;if(null!==h)h.return=u,Jo=h;else for(;null!==Jo;){var f=(u=Jo).sibling,m=u.return;if(il(u),u===d){Jo=null;break}if(null!==f){f.return=m,Jo=f;break}Jo=m}}}var p=a.alternate;if(null!==p){var g=p.child;if(null!==g){p.child=null;do{var v=g.sibling;g.sibling=null,g=v}while(null!==g)}}Jo=a}}if(0!==(2064&a.subtreeFlags)&&null!==o)o.return=a,Jo=o;else e:for(;null!==Jo;){if(0!==(2048&(a=Jo).flags))switch(a.tag){case 0:case 11:case 15:sl(9,a,a.return)}var y=a.sibling;if(null!==y){y.return=a.return,Jo=y;break e}Jo=a.return}}var b=e.current;for(Jo=b;null!==Jo;){var x=(o=Jo).child;if(0!==(2064&o.subtreeFlags)&&null!==x)x.return=o,Jo=x;else e:for(o=b;null!==Jo;){if(0!==(2048&(l=Jo).flags))try{switch(l.tag){case 0:case 11:case 15:nl(9,l)}}catch(S){kc(l,l.return,S)}if(l===o){Jo=null;break e}var E=l.sibling;if(null!==E){E.return=l.return,Jo=E;break e}Jo=l.return}}if(Al=r,Vr(),it&&"function"===typeof it.onPostCommitFiberRoot)try{it.onPostCommitFiberRoot(rt,e)}catch(S){}n=!0}return n}finally{bt=s,Cl.transition=t}}return!1}function Tc(e,t,s){e=Ui(e,t=fo(0,t=lo(s,t),1),1),t=ec(),null!==e&&(vt(e,1,t),nc(e,t))}function kc(e,t,s){if(3===e.tag)Tc(e,e,s);else for(;null!==t;){if(3===t.tag){Tc(t,e,s);break}if(1===t.tag){var n=t.stateNode;if("function"===typeof t.type.getDerivedStateFromError||"function"===typeof n.componentDidCatch&&(null===Wl||!Wl.has(n))){t=Ui(t,e=mo(t,e=lo(s,e),1),1),e=ec(),null!==t&&(vt(t,1,e),nc(t,e));break}}t=t.return}}function wc(e,t,s){var n=e.pingCache;null!==n&&n.delete(t),t=ec(),e.pingedLanes|=e.suspendedLanes&s,Rl===e&&(Nl&s)===s&&(4===Pl||3===Pl&&(130023424&Nl)===Nl&&500>$e()-Gl?hc(e,0):Fl|=s),nc(e,t)}function Lc(e,t){0===t&&(0===(1&e.mode)?t=1:(t=dt,0===(130023424&(dt<<=1))&&(dt=4194304)));var s=ec();null!==(e=Pi(e,t))&&(vt(e,t,s),nc(e,s))}function Cc(e){var t=e.memoizedState,s=0;null!==t&&(s=t.retryLane),Lc(e,s)}function Ac(e,t){var s=0;switch(e.tag){case 13:var n=e.stateNode,r=e.memoizedState;null!==r&&(s=r.retryLane);break;case 19:n=e.stateNode;break;default:throw Error(i(314))}null!==n&&n.delete(t),Lc(e,s)}function Rc(e,t){return qe(e,t)}function _c(e,t,s,n){this.tag=e,this.key=s,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=n,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Nc(e,t,s,n){return new _c(e,t,s,n)}function Ic(e){return!(!(e=e.prototype)||!e.isReactComponent)}function jc(e,t){var s=e.alternate;return null===s?((s=Nc(e.tag,t,e.key,e.mode)).elementType=e.elementType,s.type=e.type,s.stateNode=e.stateNode,s.alternate=e,e.alternate=s):(s.pendingProps=t,s.type=e.type,s.flags=0,s.subtreeFlags=0,s.deletions=null),s.flags=14680064&e.flags,s.childLanes=e.childLanes,s.lanes=e.lanes,s.child=e.child,s.memoizedProps=e.memoizedProps,s.memoizedState=e.memoizedState,s.updateQueue=e.updateQueue,t=e.dependencies,s.dependencies=null===t?null:{lanes:t.lanes,firstContext:t.firstContext},s.sibling=e.sibling,s.index=e.index,s.ref=e.ref,s}function Pc(e,t,s,n,r,a){var o=2;if(n=e,"function"===typeof e)Ic(e)&&(o=1);else if("string"===typeof e)o=5;else e:switch(e){case T:return Dc(s.children,r,a,t);case k:o=8,r|=8;break;case w:return(e=Nc(12,s,t,2|r)).elementType=w,e.lanes=a,e;case R:return(e=Nc(13,s,t,r)).elementType=R,e.lanes=a,e;case _:return(e=Nc(19,s,t,r)).elementType=_,e.lanes=a,e;case j:return Mc(s,r,a,t);default:if("object"===typeof e&&null!==e)switch(e.$$typeof){case L:o=10;break e;case C:o=9;break e;case A:o=11;break e;case N:o=14;break e;case I:o=16,n=null;break e}throw Error(i(130,null==e?e:typeof e,""))}return(t=Nc(o,s,t,r)).elementType=e,t.type=n,t.lanes=a,t}function Dc(e,t,s,n){return(e=Nc(7,e,n,t)).lanes=s,e}function Mc(e,t,s,n){return(e=Nc(22,e,n,t)).elementType=j,e.lanes=s,e.stateNode={isHidden:!1},e}function Oc(e,t,s){return(e=Nc(6,e,null,t)).lanes=s,e}function Fc(e,t,s){return(t=Nc(4,null!==e.children?e.children:[],e.key,t)).lanes=s,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}function Uc(e,t,s,n,r){this.tag=t,this.containerInfo=e,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=gt(0),this.expirationTimes=gt(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=gt(0),this.identifierPrefix=n,this.onRecoverableError=r,this.mutableSourceEagerHydrationData=null}function Bc(e,t,s,n,r,i,a,o,l){return e=new Uc(e,t,s,o,l),1===t?(t=1,!0===i&&(t|=8)):t=0,i=Nc(3,null,null,t),e.current=i,i.stateNode=e,i.memoizedState={element:n,isDehydrated:s,cache:null,transitions:null,pendingSuspenseBoundaries:null},Mi(i),e}function Gc(e){if(!e)return Cr;e:{if(Ve(e=e._reactInternals)!==e||1!==e.tag)throw Error(i(170));var t=e;do{switch(t.tag){case 3:t=t.stateNode.context;break e;case 1:if(Ir(t.type)){t=t.stateNode.__reactInternalMemoizedMergedChildContext;break e}}t=t.return}while(null!==t);throw Error(i(171))}if(1===e.tag){var s=e.type;if(Ir(s))return Dr(e,s,t)}return t}function Vc(e,t,s,n,r,i,a,o,l){return(e=Bc(s,n,!0,e,0,i,0,o,l)).context=Gc(null),s=e.current,(i=Fi(n=ec(),r=tc(s))).callback=void 0!==t&&null!==t?t:null,Ui(s,i,r),e.current.lanes=r,vt(e,r,n),nc(e,n),e}function zc(e,t,s,n){var r=t.current,i=ec(),a=tc(r);return s=Gc(s),null===t.context?t.context=s:t.pendingContext=s,(t=Fi(i,a)).payload={element:e},null!==(n=void 0===n?null:n)&&(t.callback=n),null!==(e=Ui(r,t,a))&&(sc(e,r,a,i),Bi(e,r,a)),a}function Hc(e){return(e=e.current).child?(e.child.tag,e.child.stateNode):null}function Kc(e,t){if(null!==(e=e.memoizedState)&&null!==e.dehydrated){var s=e.retryLane;e.retryLane=0!==s&&s<t?s:t}}function Wc(e,t){Kc(e,t),(e=e.alternate)&&Kc(e,t)}Tl=function(e,t,s){if(null!==e)if(e.memoizedProps!==t.pendingProps||Rr.current)bo=!0;else{if(0===(e.lanes&s)&&0===(128&t.flags))return bo=!1,function(e,t,s){switch(t.tag){case 3:Ro(t),fi();break;case 5:$i(t);break;case 1:Ir(t.type)&&Mr(t);break;case 4:Xi(t,t.stateNode.containerInfo);break;case 10:var n=t.type._context,r=t.memoizedProps.value;Lr(Si,n._currentValue),n._currentValue=r;break;case 13:if(null!==(n=t.memoizedState))return null!==n.dehydrated?(Lr(Zi,1&Zi.current),t.flags|=128,null):0!==(s&t.child.childLanes)?Oo(e,t,s):(Lr(Zi,1&Zi.current),null!==(e=Ho(e,t,s))?e.sibling:null);Lr(Zi,1&Zi.current);break;case 19:if(n=0!==(s&t.childLanes),0!==(128&e.flags)){if(n)return Vo(e,t,s);t.flags|=128}if(null!==(r=t.memoizedState)&&(r.rendering=null,r.tail=null,r.lastEffect=null),Lr(Zi,Zi.current),n)break;return null;case 22:case 23:return t.lanes=0,ko(e,t,s)}return Ho(e,t,s)}(e,t,s);bo=0!==(131072&e.flags)}else bo=!1,ri&&0!==(1048576&t.flags)&&Zr(t,Wr,t.index);switch(t.lanes=0,t.tag){case 2:var n=t.type;zo(e,t),e=t.pendingProps;var r=Nr(t,Ar.current);Ri(t,s),r=pa(null,t,n,e,r,s);var a=ga();return t.flags|=1,"object"===typeof r&&null!==r&&"function"===typeof r.render&&void 0===r.$$typeof?(t.tag=1,t.memoizedState=null,t.updateQueue=null,Ir(n)?(a=!0,Mr(t)):a=!1,t.memoizedState=null!==r.state&&void 0!==r.state?r.state:null,Mi(t),r.updater=no,t.stateNode=r,r._reactInternals=t,oo(t,n,e,s),t=Ao(null,t,n,!0,a,s)):(t.tag=0,ri&&a&&ei(t),xo(null,t,r,s),t=t.child),t;case 16:n=t.elementType;e:{switch(zo(e,t),e=t.pendingProps,n=(r=n._init)(n._payload),t.type=n,r=t.tag=function(e){if("function"===typeof e)return Ic(e)?1:0;if(void 0!==e&&null!==e){if((e=e.$$typeof)===A)return 11;if(e===N)return 14}return 2}(n),e=to(n,e),r){case 0:t=Lo(null,t,n,e,s);break e;case 1:t=Co(null,t,n,e,s);break e;case 11:t=Eo(null,t,n,e,s);break e;case 14:t=So(null,t,n,to(n.type,e),s);break e}throw Error(i(306,n,""))}return t;case 0:return n=t.type,r=t.pendingProps,Lo(e,t,n,r=t.elementType===n?r:to(n,r),s);case 1:return n=t.type,r=t.pendingProps,Co(e,t,n,r=t.elementType===n?r:to(n,r),s);case 3:e:{if(Ro(t),null===e)throw Error(i(387));n=t.pendingProps,r=(a=t.memoizedState).element,Oi(e,t),Vi(t,n,null,s);var o=t.memoizedState;if(n=o.element,a.isDehydrated){if(a={element:n,isDehydrated:!1,cache:o.cache,pendingSuspenseBoundaries:o.pendingSuspenseBoundaries,transitions:o.transitions},t.updateQueue.baseState=a,t.memoizedState=a,256&t.flags){t=_o(e,t,n,s,r=lo(Error(i(423)),t));break e}if(n!==r){t=_o(e,t,n,s,r=lo(Error(i(424)),t));break e}for(ni=cr(t.stateNode.containerInfo.firstChild),si=t,ri=!0,ii=null,s=Ei(t,null,n,s),t.child=s;s;)s.flags=-3&s.flags|4096,s=s.sibling}else{if(fi(),n===r){t=Ho(e,t,s);break e}xo(e,t,n,s)}t=t.child}return t;case 5:return $i(t),null===e&&ci(t),n=t.type,r=t.pendingProps,a=null!==e?e.memoizedProps:null,o=r.children,sr(n,r)?o=null:null!==a&&sr(n,a)&&(t.flags|=32),wo(e,t),xo(e,t,o,s),t.child;case 6:return null===e&&ci(t),null;case 13:return Oo(e,t,s);case 4:return Xi(t,t.stateNode.containerInfo),n=t.pendingProps,null===e?t.child=xi(t,null,n,s):xo(e,t,n,s),t.child;case 11:return n=t.type,r=t.pendingProps,Eo(e,t,n,r=t.elementType===n?r:to(n,r),s);case 7:return xo(e,t,t.pendingProps,s),t.child;case 8:case 12:return xo(e,t,t.pendingProps.children,s),t.child;case 10:e:{if(n=t.type._context,r=t.pendingProps,a=t.memoizedProps,o=r.value,Lr(Si,n._currentValue),n._currentValue=o,null!==a)if(on(a.value,o)){if(a.children===r.children&&!Rr.current){t=Ho(e,t,s);break e}}else for(null!==(a=t.child)&&(a.return=t);null!==a;){var l=a.dependencies;if(null!==l){o=a.child;for(var c=l.firstContext;null!==c;){if(c.context===n){if(1===a.tag){(c=Fi(-1,s&-s)).tag=2;var d=a.updateQueue;if(null!==d){var u=(d=d.shared).pending;null===u?c.next=c:(c.next=u.next,u.next=c),d.pending=c}}a.lanes|=s,null!==(c=a.alternate)&&(c.lanes|=s),Ai(a.return,s,t),l.lanes|=s;break}c=c.next}}else if(10===a.tag)o=a.type===t.type?null:a.child;else if(18===a.tag){if(null===(o=a.return))throw Error(i(341));o.lanes|=s,null!==(l=o.alternate)&&(l.lanes|=s),Ai(o,s,t),o=a.sibling}else o=a.child;if(null!==o)o.return=a;else for(o=a;null!==o;){if(o===t){o=null;break}if(null!==(a=o.sibling)){a.return=o.return,o=a;break}o=o.return}a=o}xo(e,t,r.children,s),t=t.child}return t;case 9:return r=t.type,n=t.pendingProps.children,Ri(t,s),n=n(r=_i(r)),t.flags|=1,xo(e,t,n,s),t.child;case 14:return r=to(n=t.type,t.pendingProps),So(e,t,n,r=to(n.type,r),s);case 15:return To(e,t,t.type,t.pendingProps,s);case 17:return n=t.type,r=t.pendingProps,r=t.elementType===n?r:to(n,r),zo(e,t),t.tag=1,Ir(n)?(e=!0,Mr(t)):e=!1,Ri(t,s),io(t,n,r),oo(t,n,r,s),Ao(null,t,n,!0,e,s);case 19:return Vo(e,t,s);case 22:return ko(e,t,s)}throw Error(i(156,t.tag))};var qc="function"===typeof reportError?reportError:function(e){console.error(e)};function Yc(e){this._internalRoot=e}function Xc(e){this._internalRoot=e}function Qc(e){return!(!e||1!==e.nodeType&&9!==e.nodeType&&11!==e.nodeType)}function $c(e){return!(!e||1!==e.nodeType&&9!==e.nodeType&&11!==e.nodeType&&(8!==e.nodeType||" react-mount-point-unstable "!==e.nodeValue))}function Jc(){}function Zc(e,t,s,n,r){var i=s._reactRootContainer;if(i){var a=i;if("function"===typeof r){var o=r;r=function(){var e=Hc(a);o.call(e)}}zc(t,a,e,r)}else a=function(e,t,s,n,r){if(r){if("function"===typeof n){var i=n;n=function(){var e=Hc(a);i.call(e)}}var a=Vc(t,n,e,0,null,!1,0,"",Jc);return e._reactRootContainer=a,e[mr]=a.current,Vn(8===e.nodeType?e.parentNode:e),dc(),a}for(;r=e.lastChild;)e.removeChild(r);if("function"===typeof n){var o=n;n=function(){var e=Hc(l);o.call(e)}}var l=Bc(e,0,!1,null,0,!1,0,"",Jc);return e._reactRootContainer=l,e[mr]=l.current,Vn(8===e.nodeType?e.parentNode:e),dc(function(){zc(t,l,s,n)}),l}(s,t,e,r,n);return Hc(a)}Xc.prototype.render=Yc.prototype.render=function(e){var t=this._internalRoot;if(null===t)throw Error(i(409));zc(e,t,null,null)},Xc.prototype.unmount=Yc.prototype.unmount=function(){var e=this._internalRoot;if(null!==e){this._internalRoot=null;var t=e.containerInfo;dc(function(){zc(null,e,null,null)}),t[mr]=null}},Xc.prototype.unstable_scheduleHydration=function(e){if(e){var t=kt();e={blockedOn:null,target:e,priority:t};for(var s=0;s<jt.length&&0!==t&&t<jt[s].priority;s++);jt.splice(s,0,e),0===s&&Ot(e)}},Et=function(e){switch(e.tag){case 3:var t=e.stateNode;if(t.current.memoizedState.isDehydrated){var s=ut(t.pendingLanes);0!==s&&(yt(t,1|s),nc(t,$e()),0===(6&Al)&&(Vl=$e()+500,Vr()))}break;case 13:dc(function(){var t=Pi(e,1);if(null!==t){var s=ec();sc(t,e,1,s)}}),Wc(e,1)}},St=function(e){if(13===e.tag){var t=Pi(e,134217728);if(null!==t)sc(t,e,134217728,ec());Wc(e,134217728)}},Tt=function(e){if(13===e.tag){var t=tc(e),s=Pi(e,t);if(null!==s)sc(s,e,t,ec());Wc(e,t)}},kt=function(){return bt},wt=function(e,t){var s=bt;try{return bt=e,t()}finally{bt=s}},Se=function(e,t,s){switch(t){case"input":if(J(e,s),t=s.name,"radio"===s.type&&null!=t){for(s=e;s.parentNode;)s=s.parentNode;for(s=s.querySelectorAll("input[name="+JSON.stringify(""+t)+'][type="radio"]'),t=0;t<s.length;t++){var n=s[t];if(n!==e&&n.form===e.form){var r=Er(n);if(!r)throw Error(i(90));q(n),J(n,r)}}}break;case"textarea":ie(e,s);break;case"select":null!=(t=s.value)&&se(e,!!s.multiple,t,!1)}},Ae=cc,Re=dc;var ed={usingClientEntryPoint:!1,Events:[br,xr,Er,Le,Ce,cc]},td={findFiberByHostInstance:yr,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},sd={bundleType:td.bundleType,version:td.version,rendererPackageName:td.rendererPackageName,rendererConfig:td.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:x.ReactCurrentDispatcher,findHostInstanceByFiber:function(e){return null===(e=Ke(e))?null:e.stateNode},findFiberByHostInstance:td.findFiberByHostInstance||function(){return null},findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if("undefined"!==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__){var nd=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!nd.isDisabled&&nd.supportsFiber)try{rt=nd.inject(sd),it=nd}catch(de){}}t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=ed,t.createPortal=function(e,t){var s=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;if(!Qc(t))throw Error(i(200));return function(e,t,s){var n=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null;return{$$typeof:S,key:null==n?null:""+n,children:e,containerInfo:t,implementation:s}}(e,t,null,s)},t.createRoot=function(e,t){if(!Qc(e))throw Error(i(299));var s=!1,n="",r=qc;return null!==t&&void 0!==t&&(!0===t.unstable_strictMode&&(s=!0),void 0!==t.identifierPrefix&&(n=t.identifierPrefix),void 0!==t.onRecoverableError&&(r=t.onRecoverableError)),t=Bc(e,1,!1,null,0,s,0,n,r),e[mr]=t.current,Vn(8===e.nodeType?e.parentNode:e),new Yc(t)},t.findDOMNode=function(e){if(null==e)return null;if(1===e.nodeType)return e;var t=e._reactInternals;if(void 0===t){if("function"===typeof e.render)throw Error(i(188));throw e=Object.keys(e).join(","),Error(i(268,e))}return e=null===(e=Ke(t))?null:e.stateNode},t.flushSync=function(e){return dc(e)},t.hydrate=function(e,t,s){if(!$c(t))throw Error(i(200));return Zc(null,e,t,!0,s)},t.hydrateRoot=function(e,t,s){if(!Qc(e))throw Error(i(405));var n=null!=s&&s.hydratedSources||null,r=!1,a="",o=qc;if(null!==s&&void 0!==s&&(!0===s.unstable_strictMode&&(r=!0),void 0!==s.identifierPrefix&&(a=s.identifierPrefix),void 0!==s.onRecoverableError&&(o=s.onRecoverableError)),t=Vc(t,null,e,1,null!=s?s:null,r,0,a,o),e[mr]=t.current,Vn(e),n)for(e=0;e<n.length;e++)r=(r=(s=n[e])._getVersion)(s._source),null==t.mutableSourceEagerHydrationData?t.mutableSourceEagerHydrationData=[s,r]:t.mutableSourceEagerHydrationData.push(s,r);return new Xc(t)},t.render=function(e,t,s){if(!$c(t))throw Error(i(200));return Zc(null,e,t,!1,s)},t.unmountComponentAtNode=function(e){if(!$c(e))throw Error(i(40));return!!e._reactRootContainer&&(dc(function(){Zc(null,null,e,!1,function(){e._reactRootContainer=null,e[mr]=null})}),!0)},t.unstable_batchedUpdates=cc,t.unstable_renderSubtreeIntoContainer=function(e,t,s,n){if(!$c(s))throw Error(i(200));if(null==e||void 0===e._reactInternals)throw Error(i(38));return Zc(e,t,s,!1,n)},t.version="18.3.1-next-f1338f8080-20240426"},853:(e,t,s)=>{e.exports=s(234)},950:(e,t,s)=>{!function e(){if("undefined"!==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__&&"function"===typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE)try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(e)}catch(t){console.error(t)}}(),e.exports=s(730)}},t={};function s(n){var r=t[n];if(void 0!==r)return r.exports;var i=t[n]={exports:{}};return e[n](i,i.exports,s),i.exports}(()=>{var e,t=Object.getPrototypeOf?e=>Object.getPrototypeOf(e):e=>e.__proto__;s.t=function(n,r){if(1&r&&(n=this(n)),8&r)return n;if("object"===typeof n&&n){if(4&r&&n.__esModule)return n;if(16&r&&"function"===typeof n.then)return n}var i=Object.create(null);s.r(i);var a={};e=e||[null,t({}),t([]),t(t)];for(var o=2&r&&n;("object"==typeof o||"function"==typeof o)&&!~e.indexOf(o);o=t(o))Object.getOwnPropertyNames(o).forEach(e=>a[e]=()=>n[e]);return a.default=()=>n,s.d(i,a),i}})(),s.d=(e,t)=>{for(var n in t)s.o(t,n)&&!s.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},s.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}(),s.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),s.r=e=>{"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var n={};s.r(n),s.d(n,{hasBrowserEnv:()=>Xt,hasStandardBrowserEnv:()=>$t,hasStandardBrowserWebWorkerEnv:()=>Jt,navigator:()=>Qt,origin:()=>Zt});var r,i=s(43),a=s.t(i,2),o=s(391);function l(){return l=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var s=arguments[t];for(var n in s)Object.prototype.hasOwnProperty.call(s,n)&&(e[n]=s[n])}return e},l.apply(this,arguments)}!function(e){e.Pop="POP",e.Push="PUSH",e.Replace="REPLACE"}(r||(r={}));const c="popstate";function d(e,t){if(!1===e||null===e||"undefined"===typeof e)throw new Error(t)}function u(e,t){if(!e){"undefined"!==typeof console&&console.warn(t);try{throw new Error(t)}catch(s){}}}function h(e,t){return{usr:e.state,key:e.key,idx:t}}function f(e,t,s,n){return void 0===s&&(s=null),l({pathname:"string"===typeof e?e:e.pathname,search:"",hash:""},"string"===typeof t?p(t):t,{state:s,key:t&&t.key||n||Math.random().toString(36).substr(2,8)})}function m(e){let{pathname:t="/",search:s="",hash:n=""}=e;return s&&"?"!==s&&(t+="?"===s.charAt(0)?s:"?"+s),n&&"#"!==n&&(t+="#"===n.charAt(0)?n:"#"+n),t}function p(e){let t={};if(e){let s=e.indexOf("#");s>=0&&(t.hash=e.substr(s),e=e.substr(0,s));let n=e.indexOf("?");n>=0&&(t.search=e.substr(n),e=e.substr(0,n)),e&&(t.pathname=e)}return t}function g(e,t,s,n){void 0===n&&(n={});let{window:i=document.defaultView,v5Compat:a=!1}=n,o=i.history,u=r.Pop,p=null,g=v();function v(){return(o.state||{idx:null}).idx}function y(){u=r.Pop;let e=v(),t=null==e?null:e-g;g=e,p&&p({action:u,location:x.location,delta:t})}function b(e){let t="null"!==i.location.origin?i.location.origin:i.location.href,s="string"===typeof e?e:m(e);return s=s.replace(/ $/,"%20"),d(t,"No window.location.(origin|href) available to create URL for href: "+s),new URL(s,t)}null==g&&(g=0,o.replaceState(l({},o.state,{idx:g}),""));let x={get action(){return u},get location(){return e(i,o)},listen(e){if(p)throw new Error("A history only accepts one active listener");return i.addEventListener(c,y),p=e,()=>{i.removeEventListener(c,y),p=null}},createHref:e=>t(i,e),createURL:b,encodeLocation(e){let t=b(e);return{pathname:t.pathname,search:t.search,hash:t.hash}},push:function(e,t){u=r.Push;let n=f(x.location,e,t);s&&s(n,e),g=v()+1;let l=h(n,g),c=x.createHref(n);try{o.pushState(l,"",c)}catch(d){if(d instanceof DOMException&&"DataCloneError"===d.name)throw d;i.location.assign(c)}a&&p&&p({action:u,location:x.location,delta:1})},replace:function(e,t){u=r.Replace;let n=f(x.location,e,t);s&&s(n,e),g=v();let i=h(n,g),l=x.createHref(n);o.replaceState(i,"",l),a&&p&&p({action:u,location:x.location,delta:0})},go:e=>o.go(e)};return x}var v;!function(e){e.data="data",e.deferred="deferred",e.redirect="redirect",e.error="error"}(v||(v={}));new Set(["lazy","caseSensitive","path","id","index","children"]);function y(e,t,s){return void 0===s&&(s="/"),b(e,t,s,!1)}function b(e,t,s,n){let r=j(("string"===typeof t?p(t):t).pathname||"/",s);if(null==r)return null;let i=x(e);!function(e){e.sort((e,t)=>e.score!==t.score?t.score-e.score:function(e,t){let s=e.length===t.length&&e.slice(0,-1).every((e,s)=>e===t[s]);return s?e[e.length-1]-t[t.length-1]:0}(e.routesMeta.map(e=>e.childrenIndex),t.routesMeta.map(e=>e.childrenIndex)))}(i);let a=null;for(let o=0;null==a&&o<i.length;++o){let e=I(r);a=_(i[o],e,n)}return a}function x(e,t,s,n){void 0===t&&(t=[]),void 0===s&&(s=[]),void 0===n&&(n="");let r=(e,r,i)=>{let a={relativePath:void 0===i?e.path||"":i,caseSensitive:!0===e.caseSensitive,childrenIndex:r,route:e};a.relativePath.startsWith("/")&&(d(a.relativePath.startsWith(n),'Absolute route path "'+a.relativePath+'" nested under path "'+n+'" is not valid. An absolute child route path must start with the combined path of all its parent routes.'),a.relativePath=a.relativePath.slice(n.length));let o=G([n,a.relativePath]),l=s.concat(a);e.children&&e.children.length>0&&(d(!0!==e.index,'Index routes must not have child routes. Please remove all child routes from route path "'+o+'".'),x(e.children,t,l,o)),(null!=e.path||e.index)&&t.push({path:o,score:R(o,e.index),routesMeta:l})};return e.forEach((e,t)=>{var s;if(""!==e.path&&null!=(s=e.path)&&s.includes("?"))for(let n of E(e.path))r(e,t,n);else r(e,t)}),t}function E(e){let t=e.split("/");if(0===t.length)return[];let[s,...n]=t,r=s.endsWith("?"),i=s.replace(/\?$/,"");if(0===n.length)return r?[i,""]:[i];let a=E(n.join("/")),o=[];return o.push(...a.map(e=>""===e?i:[i,e].join("/"))),r&&o.push(...a),o.map(t=>e.startsWith("/")&&""===t?"/":t)}const S=/^:[\w-]+$/,T=3,k=2,w=1,L=10,C=-2,A=e=>"*"===e;function R(e,t){let s=e.split("/"),n=s.length;return s.some(A)&&(n+=C),t&&(n+=k),s.filter(e=>!A(e)).reduce((e,t)=>e+(S.test(t)?T:""===t?w:L),n)}function _(e,t,s){void 0===s&&(s=!1);let{routesMeta:n}=e,r={},i="/",a=[];for(let o=0;o<n.length;++o){let e=n[o],l=o===n.length-1,c="/"===i?t:t.slice(i.length)||"/",d=N({path:e.relativePath,caseSensitive:e.caseSensitive,end:l},c),u=e.route;if(!d&&l&&s&&!n[n.length-1].route.index&&(d=N({path:e.relativePath,caseSensitive:e.caseSensitive,end:!1},c)),!d)return null;Object.assign(r,d.params),a.push({params:r,pathname:G([i,d.pathname]),pathnameBase:V(G([i,d.pathnameBase])),route:u}),"/"!==d.pathnameBase&&(i=G([i,d.pathnameBase]))}return a}function N(e,t){"string"===typeof e&&(e={path:e,caseSensitive:!1,end:!0});let[s,n]=function(e,t,s){void 0===t&&(t=!1);void 0===s&&(s=!0);u("*"===e||!e.endsWith("*")||e.endsWith("/*"),'Route path "'+e+'" will be treated as if it were "'+e.replace(/\*$/,"/*")+'" because the `*` character must always follow a `/` in the pattern. To get rid of this warning, please change the route path to "'+e.replace(/\*$/,"/*")+'".');let n=[],r="^"+e.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(e,t,s)=>(n.push({paramName:t,isOptional:null!=s}),s?"/?([^\\/]+)?":"/([^\\/]+)"));e.endsWith("*")?(n.push({paramName:"*"}),r+="*"===e||"/*"===e?"(.*)$":"(?:\\/(.+)|\\/*)$"):s?r+="\\/*$":""!==e&&"/"!==e&&(r+="(?:(?=\\/|$))");let i=new RegExp(r,t?void 0:"i");return[i,n]}(e.path,e.caseSensitive,e.end),r=t.match(s);if(!r)return null;let i=r[0],a=i.replace(/(.)\/+$/,"$1"),o=r.slice(1);return{params:n.reduce((e,t,s)=>{let{paramName:n,isOptional:r}=t;if("*"===n){let e=o[s]||"";a=i.slice(0,i.length-e.length).replace(/(.)\/+$/,"$1")}const l=o[s];return e[n]=r&&!l?void 0:(l||"").replace(/%2F/g,"/"),e},{}),pathname:i,pathnameBase:a,pattern:e}}function I(e){try{return e.split("/").map(e=>decodeURIComponent(e).replace(/\//g,"%2F")).join("/")}catch(t){return u(!1,'The URL path "'+e+'" could not be decoded because it is is a malformed URL segment. This is probably due to a bad percent encoding ('+t+")."),e}}function j(e,t){if("/"===t)return e;if(!e.toLowerCase().startsWith(t.toLowerCase()))return null;let s=t.endsWith("/")?t.length-1:t.length,n=e.charAt(s);return n&&"/"!==n?null:e.slice(s)||"/"}const P=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i;function D(e,t){void 0===t&&(t="/");let s,{pathname:n,search:r="",hash:i=""}="string"===typeof e?p(e):e;if(n)if(a=n,P.test(a))s=n;else{if(n.includes("//")){let e=n;n=n.replace(/\/\/+/g,"/"),u(!1,"Pathnames cannot have embedded double slashes - normalizing "+e+" -> "+n)}s=n.startsWith("/")?M(n.substring(1),"/"):M(n,t)}else s=t;var a;return{pathname:s,search:z(r),hash:H(i)}}function M(e,t){let s=t.replace(/\/+$/,"").split("/");return e.split("/").forEach(e=>{".."===e?s.length>1&&s.pop():"."!==e&&s.push(e)}),s.length>1?s.join("/"):"/"}function O(e,t,s,n){return"Cannot include a '"+e+"' character in a manually specified `to."+t+"` field ["+JSON.stringify(n)+"].  Please separate it out to the `to."+s+'` field. Alternatively you may provide the full path as a string in <Link to="..."> and the router will parse it for you.'}function F(e){return e.filter((e,t)=>0===t||e.route.path&&e.route.path.length>0)}function U(e,t){let s=F(e);return t?s.map((e,t)=>t===s.length-1?e.pathname:e.pathnameBase):s.map(e=>e.pathnameBase)}function B(e,t,s,n){let r;void 0===n&&(n=!1),"string"===typeof e?r=p(e):(r=l({},e),d(!r.pathname||!r.pathname.includes("?"),O("?","pathname","search",r)),d(!r.pathname||!r.pathname.includes("#"),O("#","pathname","hash",r)),d(!r.search||!r.search.includes("#"),O("#","search","hash",r)));let i,a=""===e||""===r.pathname,o=a?"/":r.pathname;if(null==o)i=s;else{let e=t.length-1;if(!n&&o.startsWith("..")){let t=o.split("/");for(;".."===t[0];)t.shift(),e-=1;r.pathname=t.join("/")}i=e>=0?t[e]:"/"}let c=D(r,i),u=o&&"/"!==o&&o.endsWith("/"),h=(a||"."===o)&&s.endsWith("/");return c.pathname.endsWith("/")||!u&&!h||(c.pathname+="/"),c}const G=e=>e.join("/").replace(/\/\/+/g,"/"),V=e=>e.replace(/\/+$/,"").replace(/^\/*/,"/"),z=e=>e&&"?"!==e?e.startsWith("?")?e:"?"+e:"",H=e=>e&&"#"!==e?e.startsWith("#")?e:"#"+e:"";Error;function K(e){return null!=e&&"number"===typeof e.status&&"string"===typeof e.statusText&&"boolean"===typeof e.internal&&"data"in e}const W=["post","put","patch","delete"],q=(new Set(W),["get",...W]);new Set(q),new Set([301,302,303,307,308]),new Set([307,308]);Symbol("deferred");function Y(){return Y=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var s=arguments[t];for(var n in s)Object.prototype.hasOwnProperty.call(s,n)&&(e[n]=s[n])}return e},Y.apply(this,arguments)}const X=i.createContext(null);const Q=i.createContext(null);const $=i.createContext(null);const J=i.createContext(null);const Z=i.createContext({outlet:null,matches:[],isDataRoute:!1});const ee=i.createContext(null);function te(){return null!=i.useContext(J)}function se(){return te()||d(!1),i.useContext(J).location}function ne(e){i.useContext($).static||i.useLayoutEffect(e)}function re(){let{isDataRoute:e}=i.useContext(Z);return e?function(){let{router:e}=pe(fe.UseNavigateStable),t=ve(me.UseNavigateStable),s=i.useRef(!1);return ne(()=>{s.current=!0}),i.useCallback(function(n,r){void 0===r&&(r={}),s.current&&("number"===typeof n?e.navigate(n):e.navigate(n,Y({fromRouteId:t},r)))},[e,t])}():function(){te()||d(!1);let e=i.useContext(X),{basename:t,future:s,navigator:n}=i.useContext($),{matches:r}=i.useContext(Z),{pathname:a}=se(),o=JSON.stringify(U(r,s.v7_relativeSplatPath)),l=i.useRef(!1);return ne(()=>{l.current=!0}),i.useCallback(function(s,r){if(void 0===r&&(r={}),!l.current)return;if("number"===typeof s)return void n.go(s);let i=B(s,JSON.parse(o),a,"path"===r.relative);null==e&&"/"!==t&&(i.pathname="/"===i.pathname?t:G([t,i.pathname])),(r.replace?n.replace:n.push)(i,r.state,r)},[t,n,o,a,e])}()}function ie(){let{matches:e}=i.useContext(Z),t=e[e.length-1];return t?t.params:{}}function ae(e,t){let{relative:s}=void 0===t?{}:t,{future:n}=i.useContext($),{matches:r}=i.useContext(Z),{pathname:a}=se(),o=JSON.stringify(U(r,n.v7_relativeSplatPath));return i.useMemo(()=>B(e,JSON.parse(o),a,"path"===s),[e,o,a,s])}function oe(e,t,s,n){te()||d(!1);let{navigator:a}=i.useContext($),{matches:o}=i.useContext(Z),l=o[o.length-1],c=l?l.params:{},u=(l&&l.pathname,l?l.pathnameBase:"/");l&&l.route;let h,f=se();if(t){var m;let e="string"===typeof t?p(t):t;"/"===u||(null==(m=e.pathname)?void 0:m.startsWith(u))||d(!1),h=e}else h=f;let g=h.pathname||"/",v=g;if("/"!==u){let e=u.replace(/^\//,"").split("/");v="/"+g.replace(/^\//,"").split("/").slice(e.length).join("/")}let b=y(e,{pathname:v});let x=he(b&&b.map(e=>Object.assign({},e,{params:Object.assign({},c,e.params),pathname:G([u,a.encodeLocation?a.encodeLocation(e.pathname).pathname:e.pathname]),pathnameBase:"/"===e.pathnameBase?u:G([u,a.encodeLocation?a.encodeLocation(e.pathnameBase).pathname:e.pathnameBase])})),o,s,n);return t&&x?i.createElement(J.Provider,{value:{location:Y({pathname:"/",search:"",hash:"",state:null,key:"default"},h),navigationType:r.Pop}},x):x}function le(){let e=function(){var e;let t=i.useContext(ee),s=ge(me.UseRouteError),n=ve(me.UseRouteError);if(void 0!==t)return t;return null==(e=s.errors)?void 0:e[n]}(),t=K(e)?e.status+" "+e.statusText:e instanceof Error?e.message:JSON.stringify(e),s=e instanceof Error?e.stack:null,n="rgba(200,200,200, 0.5)",r={padding:"0.5rem",backgroundColor:n};return i.createElement(i.Fragment,null,i.createElement("h2",null,"Unexpected Application Error!"),i.createElement("h3",{style:{fontStyle:"italic"}},t),s?i.createElement("pre",{style:r},s):null,null)}const ce=i.createElement(le,null);class de extends i.Component{constructor(e){super(e),this.state={location:e.location,revalidation:e.revalidation,error:e.error}}static getDerivedStateFromError(e){return{error:e}}static getDerivedStateFromProps(e,t){return t.location!==e.location||"idle"!==t.revalidation&&"idle"===e.revalidation?{error:e.error,location:e.location,revalidation:e.revalidation}:{error:void 0!==e.error?e.error:t.error,location:t.location,revalidation:e.revalidation||t.revalidation}}componentDidCatch(e,t){console.error("React Router caught the following error during render",e,t)}render(){return void 0!==this.state.error?i.createElement(Z.Provider,{value:this.props.routeContext},i.createElement(ee.Provider,{value:this.state.error,children:this.props.component})):this.props.children}}function ue(e){let{routeContext:t,match:s,children:n}=e,r=i.useContext(X);return r&&r.static&&r.staticContext&&(s.route.errorElement||s.route.ErrorBoundary)&&(r.staticContext._deepestRenderedBoundaryId=s.route.id),i.createElement(Z.Provider,{value:t},n)}function he(e,t,s,n){var r;if(void 0===t&&(t=[]),void 0===s&&(s=null),void 0===n&&(n=null),null==e){var a;if(!s)return null;if(s.errors)e=s.matches;else{if(!(null!=(a=n)&&a.v7_partialHydration&&0===t.length&&!s.initialized&&s.matches.length>0))return null;e=s.matches}}let o=e,l=null==(r=s)?void 0:r.errors;if(null!=l){let e=o.findIndex(e=>e.route.id&&void 0!==(null==l?void 0:l[e.route.id]));e>=0||d(!1),o=o.slice(0,Math.min(o.length,e+1))}let c=!1,u=-1;if(s&&n&&n.v7_partialHydration)for(let i=0;i<o.length;i++){let e=o[i];if((e.route.HydrateFallback||e.route.hydrateFallbackElement)&&(u=i),e.route.id){let{loaderData:t,errors:n}=s,r=e.route.loader&&void 0===t[e.route.id]&&(!n||void 0===n[e.route.id]);if(e.route.lazy||r){c=!0,o=u>=0?o.slice(0,u+1):[o[0]];break}}}return o.reduceRight((e,n,r)=>{let a,d=!1,h=null,f=null;var m;s&&(a=l&&n.route.id?l[n.route.id]:void 0,h=n.route.errorElement||ce,c&&(u<0&&0===r?(m="route-fallback",!1||ye[m]||(ye[m]=!0),d=!0,f=null):u===r&&(d=!0,f=n.route.hydrateFallbackElement||null)));let p=t.concat(o.slice(0,r+1)),g=()=>{let t;return t=a?h:d?f:n.route.Component?i.createElement(n.route.Component,null):n.route.element?n.route.element:e,i.createElement(ue,{match:n,routeContext:{outlet:e,matches:p,isDataRoute:null!=s},children:t})};return s&&(n.route.ErrorBoundary||n.route.errorElement||0===r)?i.createElement(de,{location:s.location,revalidation:s.revalidation,component:h,error:a,children:g(),routeContext:{outlet:null,matches:p,isDataRoute:!0}}):g()},null)}var fe=function(e){return e.UseBlocker="useBlocker",e.UseRevalidator="useRevalidator",e.UseNavigateStable="useNavigate",e}(fe||{}),me=function(e){return e.UseBlocker="useBlocker",e.UseLoaderData="useLoaderData",e.UseActionData="useActionData",e.UseRouteError="useRouteError",e.UseNavigation="useNavigation",e.UseRouteLoaderData="useRouteLoaderData",e.UseMatches="useMatches",e.UseRevalidator="useRevalidator",e.UseNavigateStable="useNavigate",e.UseRouteId="useRouteId",e}(me||{});function pe(e){let t=i.useContext(X);return t||d(!1),t}function ge(e){let t=i.useContext(Q);return t||d(!1),t}function ve(e){let t=function(){let e=i.useContext(Z);return e||d(!1),e}(),s=t.matches[t.matches.length-1];return s.route.id||d(!1),s.route.id}const ye={};function be(e,t){null==e||e.v7_startTransition,void 0===(null==e?void 0:e.v7_relativeSplatPath)&&(!t||t.v7_relativeSplatPath),t&&(t.v7_fetcherPersist,t.v7_normalizeFormMethod,t.v7_partialHydration,t.v7_skipActionErrorRevalidation)}a.startTransition;function xe(e){let{to:t,replace:s,state:n,relative:r}=e;te()||d(!1);let{future:a,static:o}=i.useContext($),{matches:l}=i.useContext(Z),{pathname:c}=se(),u=re(),h=B(t,U(l,a.v7_relativeSplatPath),c,"path"===r),f=JSON.stringify(h);return i.useEffect(()=>u(JSON.parse(f),{replace:s,state:n,relative:r}),[u,f,r,s,n]),null}function Ee(e){d(!1)}function Se(e){let{basename:t="/",children:s=null,location:n,navigationType:a=r.Pop,navigator:o,static:l=!1,future:c}=e;te()&&d(!1);let u=t.replace(/^\/*/,"/"),h=i.useMemo(()=>({basename:u,navigator:o,static:l,future:Y({v7_relativeSplatPath:!1},c)}),[u,c,o,l]);"string"===typeof n&&(n=p(n));let{pathname:f="/",search:m="",hash:g="",state:v=null,key:y="default"}=n,b=i.useMemo(()=>{let e=j(f,u);return null==e?null:{location:{pathname:e,search:m,hash:g,state:v,key:y},navigationType:a}},[u,f,m,g,v,y,a]);return null==b?null:i.createElement($.Provider,{value:h},i.createElement(J.Provider,{children:s,value:b}))}function Te(e){let{children:t,location:s}=e;return oe(ke(t),s)}new Promise(()=>{});i.Component;function ke(e,t){void 0===t&&(t=[]);let s=[];return i.Children.forEach(e,(e,n)=>{if(!i.isValidElement(e))return;let r=[...t,n];if(e.type===i.Fragment)return void s.push.apply(s,ke(e.props.children,r));e.type!==Ee&&d(!1),e.props.index&&e.props.children&&d(!1);let a={id:e.props.id||r.join("-"),caseSensitive:e.props.caseSensitive,element:e.props.element,Component:e.props.Component,index:e.props.index,path:e.props.path,loader:e.props.loader,action:e.props.action,errorElement:e.props.errorElement,ErrorBoundary:e.props.ErrorBoundary,hasErrorBoundary:null!=e.props.ErrorBoundary||null!=e.props.errorElement,shouldRevalidate:e.props.shouldRevalidate,handle:e.props.handle,lazy:e.props.lazy};e.props.children&&(a.children=ke(e.props.children,r)),s.push(a)}),s}var we=s(950),Le=s.t(we,2);function Ce(){return Ce=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var s=arguments[t];for(var n in s)Object.prototype.hasOwnProperty.call(s,n)&&(e[n]=s[n])}return e},Ce.apply(this,arguments)}function Ae(e,t){if(null==e)return{};var s,n,r={},i=Object.keys(e);for(n=0;n<i.length;n++)s=i[n],t.indexOf(s)>=0||(r[s]=e[s]);return r}function Re(e){return void 0===e&&(e=""),new URLSearchParams("string"===typeof e||Array.isArray(e)||e instanceof URLSearchParams?e:Object.keys(e).reduce((t,s)=>{let n=e[s];return t.concat(Array.isArray(n)?n.map(e=>[s,e]):[[s,n]])},[]))}new Set(["application/x-www-form-urlencoded","multipart/form-data","text/plain"]);const _e=["onClick","relative","reloadDocument","replace","state","target","to","preventScrollReset","viewTransition"];try{window.__reactRouterVersion="6"}catch(Np){}new Map;const Ne=a.startTransition;Le.flushSync,a.useId;function Ie(e){let{basename:t,children:s,future:n,window:r}=e,a=i.useRef();var o;null==a.current&&(a.current=(void 0===(o={window:r,v5Compat:!0})&&(o={}),g(function(e,t){let{pathname:s,search:n,hash:r}=e.location;return f("",{pathname:s,search:n,hash:r},t.state&&t.state.usr||null,t.state&&t.state.key||"default")},function(e,t){return"string"===typeof t?t:m(t)},null,o)));let l=a.current,[c,d]=i.useState({action:l.action,location:l.location}),{v7_startTransition:u}=n||{},h=i.useCallback(e=>{u&&Ne?Ne(()=>d(e)):d(e)},[d,u]);return i.useLayoutEffect(()=>l.listen(h),[l,h]),i.useEffect(()=>be(n),[n]),i.createElement(Se,{basename:t,children:s,location:c.location,navigationType:c.action,navigator:l,future:n})}const je="undefined"!==typeof window&&"undefined"!==typeof window.document&&"undefined"!==typeof window.document.createElement,Pe=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,De=i.forwardRef(function(e,t){let s,{onClick:n,relative:r,reloadDocument:a,replace:o,state:l,target:c,to:u,preventScrollReset:h,viewTransition:f}=e,p=Ae(e,_e),{basename:g}=i.useContext($),v=!1;if("string"===typeof u&&Pe.test(u)&&(s=u,je))try{let e=new URL(window.location.href),t=u.startsWith("//")?new URL(e.protocol+u):new URL(u),s=j(t.pathname,g);t.origin===e.origin&&null!=s?u=s+t.search+t.hash:v=!0}catch(Np){}let y=function(e,t){let{relative:s}=void 0===t?{}:t;te()||d(!1);let{basename:n,navigator:r}=i.useContext($),{hash:a,pathname:o,search:l}=ae(e,{relative:s}),c=o;return"/"!==n&&(c="/"===o?n:G([n,o])),r.createHref({pathname:c,search:l,hash:a})}(u,{relative:r}),b=function(e,t){let{target:s,replace:n,state:r,preventScrollReset:a,relative:o,viewTransition:l}=void 0===t?{}:t,c=re(),d=se(),u=ae(e,{relative:o});return i.useCallback(t=>{if(function(e,t){return 0===e.button&&(!t||"_self"===t)&&!function(e){return!!(e.metaKey||e.altKey||e.ctrlKey||e.shiftKey)}(e)}(t,s)){t.preventDefault();let s=void 0!==n?n:m(d)===m(u);c(e,{replace:s,state:r,preventScrollReset:a,relative:o,viewTransition:l})}},[d,c,u,n,r,s,e,a,o,l])}(u,{replace:o,state:l,target:c,preventScrollReset:h,relative:r,viewTransition:f});return i.createElement("a",Ce({},p,{href:s||y,onClick:v||a?n:function(e){n&&n(e),e.defaultPrevented||b(e)},ref:t,target:c}))});var Me,Oe;function Fe(e){let t=i.useRef(Re(e)),s=i.useRef(!1),n=se(),r=i.useMemo(()=>function(e,t){let s=Re(e);return t&&t.forEach((e,n)=>{s.has(n)||t.getAll(n).forEach(e=>{s.append(n,e)})}),s}(n.search,s.current?null:t.current),[n.search]),a=re(),o=i.useCallback((e,t)=>{const n=Re("function"===typeof e?e(r):e);s.current=!0,a("?"+n,t)},[a,r]);return[r,o]}(function(e){e.UseScrollRestoration="useScrollRestoration",e.UseSubmit="useSubmit",e.UseSubmitFetcher="useSubmitFetcher",e.UseFetcher="useFetcher",e.useViewTransitionState="useViewTransitionState"})(Me||(Me={})),function(e){e.UseFetcher="useFetcher",e.UseFetchers="useFetchers",e.UseScrollRestoration="useScrollRestoration"}(Oe||(Oe={}));function Ue(e,t){return function(){return e.apply(t,arguments)}}const{toString:Be}=Object.prototype,{getPrototypeOf:Ge}=Object,{iterator:Ve,toStringTag:ze}=Symbol,He=(Ke=Object.create(null),e=>{const t=Be.call(e);return Ke[t]||(Ke[t]=t.slice(8,-1).toLowerCase())});var Ke;const We=e=>(e=e.toLowerCase(),t=>He(t)===e),qe=e=>t=>typeof t===e,{isArray:Ye}=Array,Xe=qe("undefined");function Qe(e){return null!==e&&!Xe(e)&&null!==e.constructor&&!Xe(e.constructor)&&Ze(e.constructor.isBuffer)&&e.constructor.isBuffer(e)}const $e=We("ArrayBuffer");const Je=qe("string"),Ze=qe("function"),et=qe("number"),tt=e=>null!==e&&"object"===typeof e,st=e=>{if("object"!==He(e))return!1;const t=Ge(e);return(null===t||t===Object.prototype||null===Object.getPrototypeOf(t))&&!(ze in e)&&!(Ve in e)},nt=We("Date"),rt=We("File"),it=We("Blob"),at=We("FileList"),ot=We("URLSearchParams"),[lt,ct,dt,ut]=["ReadableStream","Request","Response","Headers"].map(We);function ht(e,t){let s,n,{allOwnKeys:r=!1}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(null!==e&&"undefined"!==typeof e)if("object"!==typeof e&&(e=[e]),Ye(e))for(s=0,n=e.length;s<n;s++)t.call(null,e[s],s,e);else{if(Qe(e))return;const n=r?Object.getOwnPropertyNames(e):Object.keys(e),i=n.length;let a;for(s=0;s<i;s++)a=n[s],t.call(null,e[a],a,e)}}function ft(e,t){if(Qe(e))return null;t=t.toLowerCase();const s=Object.keys(e);let n,r=s.length;for(;r-- >0;)if(n=s[r],t===n.toLowerCase())return n;return null}const mt="undefined"!==typeof globalThis?globalThis:"undefined"!==typeof self?self:"undefined"!==typeof window?window:s.g,pt=e=>!Xe(e)&&e!==mt;const gt=(vt="undefined"!==typeof Uint8Array&&Ge(Uint8Array),e=>vt&&e instanceof vt);var vt;const yt=We("HTMLFormElement"),bt=(e=>{let{hasOwnProperty:t}=e;return(e,s)=>t.call(e,s)})(Object.prototype),xt=We("RegExp"),Et=(e,t)=>{const s=Object.getOwnPropertyDescriptors(e),n={};ht(s,(s,r)=>{let i;!1!==(i=t(s,r,e))&&(n[r]=i||s)}),Object.defineProperties(e,n)};const St=We("AsyncFunction"),Tt=((e,t)=>{return e?setImmediate:t?(s="axios@".concat(Math.random()),n=[],mt.addEventListener("message",e=>{let{source:t,data:r}=e;t===mt&&r===s&&n.length&&n.shift()()},!1),e=>{n.push(e),mt.postMessage(s,"*")}):e=>setTimeout(e);var s,n})("function"===typeof setImmediate,Ze(mt.postMessage)),kt="undefined"!==typeof queueMicrotask?queueMicrotask.bind(mt):"undefined"!==typeof process&&process.nextTick||Tt,wt={isArray:Ye,isArrayBuffer:$e,isBuffer:Qe,isFormData:e=>{let t;return e&&("function"===typeof FormData&&e instanceof FormData||Ze(e.append)&&("formdata"===(t=He(e))||"object"===t&&Ze(e.toString)&&"[object FormData]"===e.toString()))},isArrayBufferView:function(e){let t;return t="undefined"!==typeof ArrayBuffer&&ArrayBuffer.isView?ArrayBuffer.isView(e):e&&e.buffer&&$e(e.buffer),t},isString:Je,isNumber:et,isBoolean:e=>!0===e||!1===e,isObject:tt,isPlainObject:st,isEmptyObject:e=>{if(!tt(e)||Qe(e))return!1;try{return 0===Object.keys(e).length&&Object.getPrototypeOf(e)===Object.prototype}catch(Np){return!1}},isReadableStream:lt,isRequest:ct,isResponse:dt,isHeaders:ut,isUndefined:Xe,isDate:nt,isFile:rt,isBlob:it,isRegExp:xt,isFunction:Ze,isStream:e=>tt(e)&&Ze(e.pipe),isURLSearchParams:ot,isTypedArray:gt,isFileList:at,forEach:ht,merge:function e(){const{caseless:t,skipUndefined:s}=pt(this)&&this||{},n={},r=(r,i)=>{const a=t&&ft(n,i)||i;st(n[a])&&st(r)?n[a]=e(n[a],r):st(r)?n[a]=e({},r):Ye(r)?n[a]=r.slice():s&&Xe(r)||(n[a]=r)};for(let i=0,a=arguments.length;i<a;i++)arguments[i]&&ht(arguments[i],r);return n},extend:function(e,t,s){let{allOwnKeys:n}=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return ht(t,(t,n)=>{s&&Ze(t)?e[n]=Ue(t,s):e[n]=t},{allOwnKeys:n}),e},trim:e=>e.trim?e.trim():e.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,""),stripBOM:e=>(65279===e.charCodeAt(0)&&(e=e.slice(1)),e),inherits:(e,t,s,n)=>{e.prototype=Object.create(t.prototype,n),e.prototype.constructor=e,Object.defineProperty(e,"super",{value:t.prototype}),s&&Object.assign(e.prototype,s)},toFlatObject:(e,t,s,n)=>{let r,i,a;const o={};if(t=t||{},null==e)return t;do{for(r=Object.getOwnPropertyNames(e),i=r.length;i-- >0;)a=r[i],n&&!n(a,e,t)||o[a]||(t[a]=e[a],o[a]=!0);e=!1!==s&&Ge(e)}while(e&&(!s||s(e,t))&&e!==Object.prototype);return t},kindOf:He,kindOfTest:We,endsWith:(e,t,s)=>{e=String(e),(void 0===s||s>e.length)&&(s=e.length),s-=t.length;const n=e.indexOf(t,s);return-1!==n&&n===s},toArray:e=>{if(!e)return null;if(Ye(e))return e;let t=e.length;if(!et(t))return null;const s=new Array(t);for(;t-- >0;)s[t]=e[t];return s},forEachEntry:(e,t)=>{const s=(e&&e[Ve]).call(e);let n;for(;(n=s.next())&&!n.done;){const s=n.value;t.call(e,s[0],s[1])}},matchAll:(e,t)=>{let s;const n=[];for(;null!==(s=e.exec(t));)n.push(s);return n},isHTMLForm:yt,hasOwnProperty:bt,hasOwnProp:bt,reduceDescriptors:Et,freezeMethods:e=>{Et(e,(t,s)=>{if(Ze(e)&&-1!==["arguments","caller","callee"].indexOf(s))return!1;const n=e[s];Ze(n)&&(t.enumerable=!1,"writable"in t?t.writable=!1:t.set||(t.set=()=>{throw Error("Can not rewrite read-only method '"+s+"'")}))})},toObjectSet:(e,t)=>{const s={},n=e=>{e.forEach(e=>{s[e]=!0})};return Ye(e)?n(e):n(String(e).split(t)),s},toCamelCase:e=>e.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(e,t,s){return t.toUpperCase()+s}),noop:()=>{},toFiniteNumber:(e,t)=>null!=e&&Number.isFinite(e=+e)?e:t,findKey:ft,global:mt,isContextDefined:pt,isSpecCompliantForm:function(e){return!!(e&&Ze(e.append)&&"FormData"===e[ze]&&e[Ve])},toJSONObject:e=>{const t=new Array(10),s=(e,n)=>{if(tt(e)){if(t.indexOf(e)>=0)return;if(Qe(e))return e;if(!("toJSON"in e)){t[n]=e;const r=Ye(e)?[]:{};return ht(e,(e,t)=>{const i=s(e,n+1);!Xe(i)&&(r[t]=i)}),t[n]=void 0,r}}return e};return s(e,0)},isAsyncFn:St,isThenable:e=>e&&(tt(e)||Ze(e))&&Ze(e.then)&&Ze(e.catch),setImmediate:Tt,asap:kt,isIterable:e=>null!=e&&Ze(e[Ve])};function Lt(e,t,s,n,r){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=(new Error).stack,this.message=e,this.name="AxiosError",t&&(this.code=t),s&&(this.config=s),n&&(this.request=n),r&&(this.response=r,this.status=r.status?r.status:null)}wt.inherits(Lt,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:wt.toJSONObject(this.config),code:this.code,status:this.status}}});const Ct=Lt.prototype,At={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(e=>{At[e]={value:e}}),Object.defineProperties(Lt,At),Object.defineProperty(Ct,"isAxiosError",{value:!0}),Lt.from=(e,t,s,n,r,i)=>{const a=Object.create(Ct);wt.toFlatObject(e,a,function(e){return e!==Error.prototype},e=>"isAxiosError"!==e);const o=e&&e.message?e.message:"Error",l=null==t&&e?e.code:t;return Lt.call(a,o,l,s,n,r),e&&null==a.cause&&Object.defineProperty(a,"cause",{value:e,configurable:!0}),a.name=e&&e.name||"Error",i&&Object.assign(a,i),a};const Rt=Lt;function _t(e){return wt.isPlainObject(e)||wt.isArray(e)}function Nt(e){return wt.endsWith(e,"[]")?e.slice(0,-2):e}function It(e,t,s){return e?e.concat(t).map(function(e,t){return e=Nt(e),!s&&t?"["+e+"]":e}).join(s?".":""):t}const jt=wt.toFlatObject(wt,{},null,function(e){return/^is[A-Z]/.test(e)});const Pt=function(e,t,s){if(!wt.isObject(e))throw new TypeError("target must be an object");t=t||new FormData;const n=(s=wt.toFlatObject(s,{metaTokens:!0,dots:!1,indexes:!1},!1,function(e,t){return!wt.isUndefined(t[e])})).metaTokens,r=s.visitor||c,i=s.dots,a=s.indexes,o=(s.Blob||"undefined"!==typeof Blob&&Blob)&&wt.isSpecCompliantForm(t);if(!wt.isFunction(r))throw new TypeError("visitor must be a function");function l(e){if(null===e)return"";if(wt.isDate(e))return e.toISOString();if(wt.isBoolean(e))return e.toString();if(!o&&wt.isBlob(e))throw new Rt("Blob is not supported. Use a Buffer instead.");return wt.isArrayBuffer(e)||wt.isTypedArray(e)?o&&"function"===typeof Blob?new Blob([e]):Buffer.from(e):e}function c(e,s,r){let o=e;if(e&&!r&&"object"===typeof e)if(wt.endsWith(s,"{}"))s=n?s:s.slice(0,-2),e=JSON.stringify(e);else if(wt.isArray(e)&&function(e){return wt.isArray(e)&&!e.some(_t)}(e)||(wt.isFileList(e)||wt.endsWith(s,"[]"))&&(o=wt.toArray(e)))return s=Nt(s),o.forEach(function(e,n){!wt.isUndefined(e)&&null!==e&&t.append(!0===a?It([s],n,i):null===a?s:s+"[]",l(e))}),!1;return!!_t(e)||(t.append(It(r,s,i),l(e)),!1)}const d=[],u=Object.assign(jt,{defaultVisitor:c,convertValue:l,isVisitable:_t});if(!wt.isObject(e))throw new TypeError("data must be an object");return function e(s,n){if(!wt.isUndefined(s)){if(-1!==d.indexOf(s))throw Error("Circular reference detected in "+n.join("."));d.push(s),wt.forEach(s,function(s,i){!0===(!(wt.isUndefined(s)||null===s)&&r.call(t,s,wt.isString(i)?i.trim():i,n,u))&&e(s,n?n.concat(i):[i])}),d.pop()}}(e),t};function Dt(e){const t={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(e).replace(/[!'()~]|%20|%00/g,function(e){return t[e]})}function Mt(e,t){this._pairs=[],e&&Pt(e,this,t)}const Ot=Mt.prototype;Ot.append=function(e,t){this._pairs.push([e,t])},Ot.toString=function(e){const t=e?function(t){return e.call(this,t,Dt)}:Dt;return this._pairs.map(function(e){return t(e[0])+"="+t(e[1])},"").join("&")};const Ft=Mt;function Ut(e){return encodeURIComponent(e).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+")}function Bt(e,t,s){if(!t)return e;const n=s&&s.encode||Ut;wt.isFunction(s)&&(s={serialize:s});const r=s&&s.serialize;let i;if(i=r?r(t,s):wt.isURLSearchParams(t)?t.toString():new Ft(t,s).toString(n),i){const t=e.indexOf("#");-1!==t&&(e=e.slice(0,t)),e+=(-1===e.indexOf("?")?"?":"&")+i}return e}const Gt=class{constructor(){this.handlers=[]}use(e,t,s){return this.handlers.push({fulfilled:e,rejected:t,synchronous:!!s&&s.synchronous,runWhen:s?s.runWhen:null}),this.handlers.length-1}eject(e){this.handlers[e]&&(this.handlers[e]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(e){wt.forEach(this.handlers,function(t){null!==t&&e(t)})}},Vt={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1};function zt(e){return zt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},zt(e)}function Ht(e){var t=function(e,t){if("object"!=zt(e)||!e)return e;var s=e[Symbol.toPrimitive];if(void 0!==s){var n=s.call(e,t||"default");if("object"!=zt(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==zt(t)?t:t+""}function Kt(e,t,s){return(t=Ht(t))in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}function Wt(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),s.push.apply(s,n)}return s}function qt(e){for(var t=1;t<arguments.length;t++){var s=null!=arguments[t]?arguments[t]:{};t%2?Wt(Object(s),!0).forEach(function(t){Kt(e,t,s[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):Wt(Object(s)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(s,t))})}return e}const Yt={isBrowser:!0,classes:{URLSearchParams:"undefined"!==typeof URLSearchParams?URLSearchParams:Ft,FormData:"undefined"!==typeof FormData?FormData:null,Blob:"undefined"!==typeof Blob?Blob:null},protocols:["http","https","file","blob","url","data"]},Xt="undefined"!==typeof window&&"undefined"!==typeof document,Qt="object"===typeof navigator&&navigator||void 0,$t=Xt&&(!Qt||["ReactNative","NativeScript","NS"].indexOf(Qt.product)<0),Jt="undefined"!==typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope&&"function"===typeof self.importScripts,Zt=Xt&&window.location.href||"http://localhost",es=qt(qt({},n),Yt);const ts=function(e){function t(e,s,n,r){let i=e[r++];if("__proto__"===i)return!0;const a=Number.isFinite(+i),o=r>=e.length;if(i=!i&&wt.isArray(n)?n.length:i,o)return wt.hasOwnProp(n,i)?n[i]=[n[i],s]:n[i]=s,!a;n[i]&&wt.isObject(n[i])||(n[i]=[]);return t(e,s,n[i],r)&&wt.isArray(n[i])&&(n[i]=function(e){const t={},s=Object.keys(e);let n;const r=s.length;let i;for(n=0;n<r;n++)i=s[n],t[i]=e[i];return t}(n[i])),!a}if(wt.isFormData(e)&&wt.isFunction(e.entries)){const s={};return wt.forEachEntry(e,(e,n)=>{t(function(e){return wt.matchAll(/\w+|\[(\w*)]/g,e).map(e=>"[]"===e[0]?"":e[1]||e[0])}(e),n,s,0)}),s}return null};const ss={transitional:Vt,adapter:["xhr","http","fetch"],transformRequest:[function(e,t){const s=t.getContentType()||"",n=s.indexOf("application/json")>-1,r=wt.isObject(e);r&&wt.isHTMLForm(e)&&(e=new FormData(e));if(wt.isFormData(e))return n?JSON.stringify(ts(e)):e;if(wt.isArrayBuffer(e)||wt.isBuffer(e)||wt.isStream(e)||wt.isFile(e)||wt.isBlob(e)||wt.isReadableStream(e))return e;if(wt.isArrayBufferView(e))return e.buffer;if(wt.isURLSearchParams(e))return t.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),e.toString();let i;if(r){if(s.indexOf("application/x-www-form-urlencoded")>-1)return function(e,t){return Pt(e,new es.classes.URLSearchParams,qt({visitor:function(e,t,s,n){return es.isNode&&wt.isBuffer(e)?(this.append(t,e.toString("base64")),!1):n.defaultVisitor.apply(this,arguments)}},t))}(e,this.formSerializer).toString();if((i=wt.isFileList(e))||s.indexOf("multipart/form-data")>-1){const t=this.env&&this.env.FormData;return Pt(i?{"files[]":e}:e,t&&new t,this.formSerializer)}}return r||n?(t.setContentType("application/json",!1),function(e,t,s){if(wt.isString(e))try{return(t||JSON.parse)(e),wt.trim(e)}catch(Np){if("SyntaxError"!==Np.name)throw Np}return(s||JSON.stringify)(e)}(e)):e}],transformResponse:[function(e){const t=this.transitional||ss.transitional,s=t&&t.forcedJSONParsing,n="json"===this.responseType;if(wt.isResponse(e)||wt.isReadableStream(e))return e;if(e&&wt.isString(e)&&(s&&!this.responseType||n)){const s=!(t&&t.silentJSONParsing)&&n;try{return JSON.parse(e,this.parseReviver)}catch(Np){if(s){if("SyntaxError"===Np.name)throw Rt.from(Np,Rt.ERR_BAD_RESPONSE,this,null,this.response);throw Np}}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:es.classes.FormData,Blob:es.classes.Blob},validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};wt.forEach(["delete","get","head","post","put","patch"],e=>{ss.headers[e]={}});const ns=ss,rs=wt.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),is=Symbol("internals");function as(e){return e&&String(e).trim().toLowerCase()}function os(e){return!1===e||null==e?e:wt.isArray(e)?e.map(os):String(e)}function ls(e,t,s,n,r){return wt.isFunction(n)?n.call(this,t,s):(r&&(t=s),wt.isString(t)?wt.isString(n)?-1!==t.indexOf(n):wt.isRegExp(n)?n.test(t):void 0:void 0)}class cs{constructor(e){e&&this.set(e)}set(e,t,s){const n=this;function r(e,t,s){const r=as(t);if(!r)throw new Error("header name must be a non-empty string");const i=wt.findKey(n,r);(!i||void 0===n[i]||!0===s||void 0===s&&!1!==n[i])&&(n[i||t]=os(e))}const i=(e,t)=>wt.forEach(e,(e,s)=>r(e,s,t));if(wt.isPlainObject(e)||e instanceof this.constructor)i(e,t);else if(wt.isString(e)&&(e=e.trim())&&!/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(e.trim()))i((e=>{const t={};let s,n,r;return e&&e.split("\n").forEach(function(e){r=e.indexOf(":"),s=e.substring(0,r).trim().toLowerCase(),n=e.substring(r+1).trim(),!s||t[s]&&rs[s]||("set-cookie"===s?t[s]?t[s].push(n):t[s]=[n]:t[s]=t[s]?t[s]+", "+n:n)}),t})(e),t);else if(wt.isObject(e)&&wt.isIterable(e)){let s,n,r={};for(const t of e){if(!wt.isArray(t))throw TypeError("Object iterator must return a key-value pair");r[n=t[0]]=(s=r[n])?wt.isArray(s)?[...s,t[1]]:[s,t[1]]:t[1]}i(r,t)}else null!=e&&r(t,e,s);return this}get(e,t){if(e=as(e)){const s=wt.findKey(this,e);if(s){const e=this[s];if(!t)return e;if(!0===t)return function(e){const t=Object.create(null),s=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let n;for(;n=s.exec(e);)t[n[1]]=n[2];return t}(e);if(wt.isFunction(t))return t.call(this,e,s);if(wt.isRegExp(t))return t.exec(e);throw new TypeError("parser must be boolean|regexp|function")}}}has(e,t){if(e=as(e)){const s=wt.findKey(this,e);return!(!s||void 0===this[s]||t&&!ls(0,this[s],s,t))}return!1}delete(e,t){const s=this;let n=!1;function r(e){if(e=as(e)){const r=wt.findKey(s,e);!r||t&&!ls(0,s[r],r,t)||(delete s[r],n=!0)}}return wt.isArray(e)?e.forEach(r):r(e),n}clear(e){const t=Object.keys(this);let s=t.length,n=!1;for(;s--;){const r=t[s];e&&!ls(0,this[r],r,e,!0)||(delete this[r],n=!0)}return n}normalize(e){const t=this,s={};return wt.forEach(this,(n,r)=>{const i=wt.findKey(s,r);if(i)return t[i]=os(n),void delete t[r];const a=e?function(e){return e.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(e,t,s)=>t.toUpperCase()+s)}(r):String(r).trim();a!==r&&delete t[r],t[a]=os(n),s[a]=!0}),this}concat(){for(var e=arguments.length,t=new Array(e),s=0;s<e;s++)t[s]=arguments[s];return this.constructor.concat(this,...t)}toJSON(e){const t=Object.create(null);return wt.forEach(this,(s,n)=>{null!=s&&!1!==s&&(t[n]=e&&wt.isArray(s)?s.join(", "):s)}),t}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(e=>{let[t,s]=e;return t+": "+s}).join("\n")}getSetCookie(){return this.get("set-cookie")||[]}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(e){return e instanceof this?e:new this(e)}static concat(e){const t=new this(e);for(var s=arguments.length,n=new Array(s>1?s-1:0),r=1;r<s;r++)n[r-1]=arguments[r];return n.forEach(e=>t.set(e)),t}static accessor(e){const t=(this[is]=this[is]={accessors:{}}).accessors,s=this.prototype;function n(e){const n=as(e);t[n]||(!function(e,t){const s=wt.toCamelCase(" "+t);["get","set","has"].forEach(n=>{Object.defineProperty(e,n+s,{value:function(e,s,r){return this[n].call(this,t,e,s,r)},configurable:!0})})}(s,e),t[n]=!0)}return wt.isArray(e)?e.forEach(n):n(e),this}}cs.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]),wt.reduceDescriptors(cs.prototype,(e,t)=>{let{value:s}=e,n=t[0].toUpperCase()+t.slice(1);return{get:()=>s,set(e){this[n]=e}}}),wt.freezeMethods(cs);const ds=cs;function us(e,t){const s=this||ns,n=t||s,r=ds.from(n.headers);let i=n.data;return wt.forEach(e,function(e){i=e.call(s,i,r.normalize(),t?t.status:void 0)}),r.normalize(),i}function hs(e){return!(!e||!e.__CANCEL__)}function fs(e,t,s){Rt.call(this,null==e?"canceled":e,Rt.ERR_CANCELED,t,s),this.name="CanceledError"}wt.inherits(fs,Rt,{__CANCEL__:!0});const ms=fs;function ps(e,t,s){const n=s.config.validateStatus;s.status&&n&&!n(s.status)?t(new Rt("Request failed with status code "+s.status,[Rt.ERR_BAD_REQUEST,Rt.ERR_BAD_RESPONSE][Math.floor(s.status/100)-4],s.config,s.request,s)):e(s)}const gs=function(e,t){e=e||10;const s=new Array(e),n=new Array(e);let r,i=0,a=0;return t=void 0!==t?t:1e3,function(o){const l=Date.now(),c=n[a];r||(r=l),s[i]=o,n[i]=l;let d=a,u=0;for(;d!==i;)u+=s[d++],d%=e;if(i=(i+1)%e,i===a&&(a=(a+1)%e),l-r<t)return;const h=c&&l-c;return h?Math.round(1e3*u/h):void 0}};const vs=function(e,t){let s,n,r=0,i=1e3/t;const a=function(t){let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Date.now();r=i,s=null,n&&(clearTimeout(n),n=null),e(...t)};return[function(){const e=Date.now(),t=e-r;for(var o=arguments.length,l=new Array(o),c=0;c<o;c++)l[c]=arguments[c];t>=i?a(l,e):(s=l,n||(n=setTimeout(()=>{n=null,a(s)},i-t)))},()=>s&&a(s)]},ys=function(e,t){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3,n=0;const r=gs(50,250);return vs(s=>{const i=s.loaded,a=s.lengthComputable?s.total:void 0,o=i-n,l=r(o);n=i;e({loaded:i,total:a,progress:a?i/a:void 0,bytes:o,rate:l||void 0,estimated:l&&a&&i<=a?(a-i)/l:void 0,event:s,lengthComputable:null!=a,[t?"download":"upload"]:!0})},s)},bs=(e,t)=>{const s=null!=e;return[n=>t[0]({lengthComputable:s,total:e,loaded:n}),t[1]]},xs=e=>function(){for(var t=arguments.length,s=new Array(t),n=0;n<t;n++)s[n]=arguments[n];return wt.asap(()=>e(...s))},Es=es.hasStandardBrowserEnv?((e,t)=>s=>(s=new URL(s,es.origin),e.protocol===s.protocol&&e.host===s.host&&(t||e.port===s.port)))(new URL(es.origin),es.navigator&&/(msie|trident)/i.test(es.navigator.userAgent)):()=>!0,Ss=es.hasStandardBrowserEnv?{write(e,t,s,n,r,i,a){if("undefined"===typeof document)return;const o=["".concat(e,"=").concat(encodeURIComponent(t))];wt.isNumber(s)&&o.push("expires=".concat(new Date(s).toUTCString())),wt.isString(n)&&o.push("path=".concat(n)),wt.isString(r)&&o.push("domain=".concat(r)),!0===i&&o.push("secure"),wt.isString(a)&&o.push("SameSite=".concat(a)),document.cookie=o.join("; ")},read(e){if("undefined"===typeof document)return null;const t=document.cookie.match(new RegExp("(?:^|; )"+e+"=([^;]*)"));return t?decodeURIComponent(t[1]):null},remove(e){this.write(e,"",Date.now()-864e5,"/")}}:{write(){},read:()=>null,remove(){}};function Ts(e,t,s){let n=!/^([a-z][a-z\d+\-.]*:)?\/\//i.test(t);return e&&(n||0==s)?function(e,t){return t?e.replace(/\/?\/$/,"")+"/"+t.replace(/^\/+/,""):e}(e,t):t}const ks=e=>e instanceof ds?qt({},e):e;function ws(e,t){t=t||{};const s={};function n(e,t,s,n){return wt.isPlainObject(e)&&wt.isPlainObject(t)?wt.merge.call({caseless:n},e,t):wt.isPlainObject(t)?wt.merge({},t):wt.isArray(t)?t.slice():t}function r(e,t,s,r){return wt.isUndefined(t)?wt.isUndefined(e)?void 0:n(void 0,e,0,r):n(e,t,0,r)}function i(e,t){if(!wt.isUndefined(t))return n(void 0,t)}function a(e,t){return wt.isUndefined(t)?wt.isUndefined(e)?void 0:n(void 0,e):n(void 0,t)}function o(s,r,i){return i in t?n(s,r):i in e?n(void 0,s):void 0}const l={url:i,method:i,data:i,baseURL:a,transformRequest:a,transformResponse:a,paramsSerializer:a,timeout:a,timeoutMessage:a,withCredentials:a,withXSRFToken:a,adapter:a,responseType:a,xsrfCookieName:a,xsrfHeaderName:a,onUploadProgress:a,onDownloadProgress:a,decompress:a,maxContentLength:a,maxBodyLength:a,beforeRedirect:a,transport:a,httpAgent:a,httpsAgent:a,cancelToken:a,socketPath:a,responseEncoding:a,validateStatus:o,headers:(e,t,s)=>r(ks(e),ks(t),0,!0)};return wt.forEach(Object.keys(qt(qt({},e),t)),function(n){const i=l[n]||r,a=i(e[n],t[n],n);wt.isUndefined(a)&&i!==o||(s[n]=a)}),s}const Ls=e=>{const t=ws({},e);let{data:s,withXSRFToken:n,xsrfHeaderName:r,xsrfCookieName:i,headers:a,auth:o}=t;if(t.headers=a=ds.from(a),t.url=Bt(Ts(t.baseURL,t.url,t.allowAbsoluteUrls),e.params,e.paramsSerializer),o&&a.set("Authorization","Basic "+btoa((o.username||"")+":"+(o.password?unescape(encodeURIComponent(o.password)):""))),wt.isFormData(s))if(es.hasStandardBrowserEnv||es.hasStandardBrowserWebWorkerEnv)a.setContentType(void 0);else if(wt.isFunction(s.getHeaders)){const e=s.getHeaders(),t=["content-type","content-length"];Object.entries(e).forEach(e=>{let[s,n]=e;t.includes(s.toLowerCase())&&a.set(s,n)})}if(es.hasStandardBrowserEnv&&(n&&wt.isFunction(n)&&(n=n(t)),n||!1!==n&&Es(t.url))){const e=r&&i&&Ss.read(i);e&&a.set(r,e)}return t},Cs="undefined"!==typeof XMLHttpRequest&&function(e){return new Promise(function(t,s){const n=Ls(e);let r=n.data;const i=ds.from(n.headers).normalize();let a,o,l,c,d,{responseType:u,onUploadProgress:h,onDownloadProgress:f}=n;function m(){c&&c(),d&&d(),n.cancelToken&&n.cancelToken.unsubscribe(a),n.signal&&n.signal.removeEventListener("abort",a)}let p=new XMLHttpRequest;function g(){if(!p)return;const n=ds.from("getAllResponseHeaders"in p&&p.getAllResponseHeaders());ps(function(e){t(e),m()},function(e){s(e),m()},{data:u&&"text"!==u&&"json"!==u?p.response:p.responseText,status:p.status,statusText:p.statusText,headers:n,config:e,request:p}),p=null}p.open(n.method.toUpperCase(),n.url,!0),p.timeout=n.timeout,"onloadend"in p?p.onloadend=g:p.onreadystatechange=function(){p&&4===p.readyState&&(0!==p.status||p.responseURL&&0===p.responseURL.indexOf("file:"))&&setTimeout(g)},p.onabort=function(){p&&(s(new Rt("Request aborted",Rt.ECONNABORTED,e,p)),p=null)},p.onerror=function(t){const n=t&&t.message?t.message:"Network Error",r=new Rt(n,Rt.ERR_NETWORK,e,p);r.event=t||null,s(r),p=null},p.ontimeout=function(){let t=n.timeout?"timeout of "+n.timeout+"ms exceeded":"timeout exceeded";const r=n.transitional||Vt;n.timeoutErrorMessage&&(t=n.timeoutErrorMessage),s(new Rt(t,r.clarifyTimeoutError?Rt.ETIMEDOUT:Rt.ECONNABORTED,e,p)),p=null},void 0===r&&i.setContentType(null),"setRequestHeader"in p&&wt.forEach(i.toJSON(),function(e,t){p.setRequestHeader(t,e)}),wt.isUndefined(n.withCredentials)||(p.withCredentials=!!n.withCredentials),u&&"json"!==u&&(p.responseType=n.responseType),f&&([l,d]=ys(f,!0),p.addEventListener("progress",l)),h&&p.upload&&([o,c]=ys(h),p.upload.addEventListener("progress",o),p.upload.addEventListener("loadend",c)),(n.cancelToken||n.signal)&&(a=t=>{p&&(s(!t||t.type?new ms(null,e,p):t),p.abort(),p=null)},n.cancelToken&&n.cancelToken.subscribe(a),n.signal&&(n.signal.aborted?a():n.signal.addEventListener("abort",a)));const v=function(e){const t=/^([-+\w]{1,25})(:?\/\/|:)/.exec(e);return t&&t[1]||""}(n.url);v&&-1===es.protocols.indexOf(v)?s(new Rt("Unsupported protocol "+v+":",Rt.ERR_BAD_REQUEST,e)):p.send(r||null)})},As=(e,t)=>{const{length:s}=e=e?e.filter(Boolean):[];if(t||s){let s,n=new AbortController;const r=function(e){if(!s){s=!0,a();const t=e instanceof Error?e:this.reason;n.abort(t instanceof Rt?t:new ms(t instanceof Error?t.message:t))}};let i=t&&setTimeout(()=>{i=null,r(new Rt("timeout ".concat(t," of ms exceeded"),Rt.ETIMEDOUT))},t);const a=()=>{e&&(i&&clearTimeout(i),i=null,e.forEach(e=>{e.unsubscribe?e.unsubscribe(r):e.removeEventListener("abort",r)}),e=null)};e.forEach(e=>e.addEventListener("abort",r));const{signal:o}=n;return o.unsubscribe=()=>wt.asap(a),o}};function Rs(e,t){this.v=e,this.k=t}function _s(e){return function(){return new Ns(e.apply(this,arguments))}}function Ns(e){var t,s;function n(t,s){try{var i=e[t](s),a=i.value,o=a instanceof Rs;Promise.resolve(o?a.v:a).then(function(s){if(o){var l="return"===t?"return":"next";if(!a.k||s.done)return n(l,s);s=e[l](s).value}r(i.done?"return":"normal",s)},function(e){n("throw",e)})}catch(e){r("throw",e)}}function r(e,r){switch(e){case"return":t.resolve({value:r,done:!0});break;case"throw":t.reject(r);break;default:t.resolve({value:r,done:!1})}(t=t.next)?n(t.key,t.arg):s=null}this._invoke=function(e,r){return new Promise(function(i,a){var o={key:e,arg:r,resolve:i,reject:a,next:null};s?s=s.next=o:(t=s=o,n(e,r))})},"function"!=typeof e.return&&(this.return=void 0)}function Is(e){return new Rs(e,0)}function js(e){var t={},s=!1;function n(t,n){return s=!0,n=new Promise(function(s){s(e[t](n))}),{done:!1,value:new Rs(n,1)}}return t["undefined"!=typeof Symbol&&Symbol.iterator||"@@iterator"]=function(){return this},t.next=function(e){return s?(s=!1,e):n("next",e)},"function"==typeof e.throw&&(t.throw=function(e){if(s)throw s=!1,e;return n("throw",e)}),"function"==typeof e.return&&(t.return=function(e){return s?(s=!1,e):n("return",e)}),t}function Ps(e){var t,s,n,r=2;for("undefined"!=typeof Symbol&&(s=Symbol.asyncIterator,n=Symbol.iterator);r--;){if(s&&null!=(t=e[s]))return t.call(e);if(n&&null!=(t=e[n]))return new Ds(t.call(e));s="@@asyncIterator",n="@@iterator"}throw new TypeError("Object is not async iterable")}function Ds(e){function t(e){if(Object(e)!==e)return Promise.reject(new TypeError(e+" is not an object."));var t=e.done;return Promise.resolve(e.value).then(function(e){return{value:e,done:t}})}return Ds=function(e){this.s=e,this.n=e.next},Ds.prototype={s:null,n:null,next:function(){return t(this.n.apply(this.s,arguments))},return:function(e){var s=this.s.return;return void 0===s?Promise.resolve({value:e,done:!0}):t(s.apply(this.s,arguments))},throw:function(e){var s=this.s.return;return void 0===s?Promise.reject(e):t(s.apply(this.s,arguments))}},new Ds(e)}Ns.prototype["function"==typeof Symbol&&Symbol.asyncIterator||"@@asyncIterator"]=function(){return this},Ns.prototype.next=function(e){return this._invoke("next",e)},Ns.prototype.throw=function(e){return this._invoke("throw",e)},Ns.prototype.return=function(e){return this._invoke("return",e)};const Ms=function*(e,t){let s=e.byteLength;if(!t||s<t)return void(yield e);let n,r=0;for(;r<s;)n=r+t,yield e.slice(r,n),r=n},Os=function(){var e=_s(function*(e,t){var s,n=!1,r=!1;try{for(var i,a=Ps(Fs(e));n=!(i=yield Is(a.next())).done;n=!1){const e=i.value;yield*js(Ps(Ms(e,t)))}}catch(o){r=!0,s=o}finally{try{n&&null!=a.return&&(yield Is(a.return()))}finally{if(r)throw s}}});return function(t,s){return e.apply(this,arguments)}}(),Fs=function(){var e=_s(function*(e){if(e[Symbol.asyncIterator])return void(yield*js(Ps(e)));const t=e.getReader();try{for(;;){const{done:e,value:s}=yield Is(t.read());if(e)break;yield s}}finally{yield Is(t.cancel())}});return function(t){return e.apply(this,arguments)}}(),Us=(e,t,s,n)=>{const r=Os(e,t);let i,a=0,o=e=>{i||(i=!0,n&&n(e))};return new ReadableStream({async pull(e){try{const{done:t,value:n}=await r.next();if(t)return o(),void e.close();let i=n.byteLength;if(s){let e=a+=i;s(e)}e.enqueue(new Uint8Array(n))}catch(t){throw o(t),t}},cancel:e=>(o(e),r.return())},{highWaterMark:2})},{isFunction:Bs}=wt,Gs=(e=>{let{Request:t,Response:s}=e;return{Request:t,Response:s}})(wt.global),{ReadableStream:Vs,TextEncoder:zs}=wt.global,Hs=function(e){try{for(var t=arguments.length,s=new Array(t>1?t-1:0),n=1;n<t;n++)s[n-1]=arguments[n];return!!e(...s)}catch(Np){return!1}},Ks=e=>{e=wt.merge.call({skipUndefined:!0},Gs,e);const{fetch:t,Request:s,Response:n}=e,r=t?Bs(t):"function"===typeof fetch,i=Bs(s),a=Bs(n);if(!r)return!1;const o=r&&Bs(Vs),l=r&&("function"===typeof zs?(c=new zs,e=>c.encode(e)):async e=>new Uint8Array(await new s(e).arrayBuffer()));var c;const d=i&&o&&Hs(()=>{let e=!1;const t=new s(es.origin,{body:new Vs,method:"POST",get duplex(){return e=!0,"half"}}).headers.has("Content-Type");return e&&!t}),u=a&&o&&Hs(()=>wt.isReadableStream(new n("").body)),h={stream:u&&(e=>e.body)};r&&["text","arrayBuffer","blob","formData","stream"].forEach(e=>{!h[e]&&(h[e]=(t,s)=>{let n=t&&t[e];if(n)return n.call(t);throw new Rt("Response type '".concat(e,"' is not supported"),Rt.ERR_NOT_SUPPORT,s)})});const f=async(e,t)=>{const n=wt.toFiniteNumber(e.getContentLength());return null==n?(async e=>{if(null==e)return 0;if(wt.isBlob(e))return e.size;if(wt.isSpecCompliantForm(e)){const t=new s(es.origin,{method:"POST",body:e});return(await t.arrayBuffer()).byteLength}return wt.isArrayBufferView(e)||wt.isArrayBuffer(e)?e.byteLength:(wt.isURLSearchParams(e)&&(e+=""),wt.isString(e)?(await l(e)).byteLength:void 0)})(t):n};return async e=>{let{url:r,method:a,data:o,signal:l,cancelToken:c,timeout:m,onDownloadProgress:p,onUploadProgress:g,responseType:v,headers:y,withCredentials:b="same-origin",fetchOptions:x}=Ls(e),E=t||fetch;v=v?(v+"").toLowerCase():"text";let S=As([l,c&&c.toAbortSignal()],m),T=null;const k=S&&S.unsubscribe&&(()=>{S.unsubscribe()});let w;try{if(g&&d&&"get"!==a&&"head"!==a&&0!==(w=await f(y,o))){let e,t=new s(r,{method:"POST",body:o,duplex:"half"});if(wt.isFormData(o)&&(e=t.headers.get("content-type"))&&y.setContentType(e),t.body){const[e,s]=bs(w,ys(xs(g)));o=Us(t.body,65536,e,s)}}wt.isString(b)||(b=b?"include":"omit");const t=i&&"credentials"in s.prototype,l=qt(qt({},x),{},{signal:S,method:a.toUpperCase(),headers:y.normalize().toJSON(),body:o,duplex:"half",credentials:t?b:void 0});T=i&&new s(r,l);let c=await(i?E(T,x):E(r,l));const m=u&&("stream"===v||"response"===v);if(u&&(p||m&&k)){const e={};["status","statusText","headers"].forEach(t=>{e[t]=c[t]});const t=wt.toFiniteNumber(c.headers.get("content-length")),[s,r]=p&&bs(t,ys(xs(p),!0))||[];c=new n(Us(c.body,65536,s,()=>{r&&r(),k&&k()}),e)}v=v||"text";let L=await h[wt.findKey(h,v)||"text"](c,e);return!m&&k&&k(),await new Promise((t,s)=>{ps(t,s,{data:L,headers:ds.from(c.headers),status:c.status,statusText:c.statusText,config:e,request:T})})}catch(L){if(k&&k(),L&&"TypeError"===L.name&&/Load failed|fetch/i.test(L.message))throw Object.assign(new Rt("Network Error",Rt.ERR_NETWORK,e,T),{cause:L.cause||L});throw Rt.from(L,L&&L.code,e,T)}}},Ws=new Map,qs=e=>{let t=e&&e.env||{};const{fetch:s,Request:n,Response:r}=t,i=[n,r,s];let a,o,l=i.length,c=Ws;for(;l--;)a=i[l],o=c.get(a),void 0===o&&c.set(a,o=l?new Map:Ks(t)),c=o;return o},Ys=(qs(),{http:null,xhr:Cs,fetch:{get:qs}});wt.forEach(Ys,(e,t)=>{if(e){try{Object.defineProperty(e,"name",{value:t})}catch(Np){}Object.defineProperty(e,"adapterName",{value:t})}});const Xs=e=>"- ".concat(e),Qs=e=>wt.isFunction(e)||null===e||!1===e;const $s={getAdapter:function(e,t){e=wt.isArray(e)?e:[e];const{length:s}=e;let n,r;const i={};for(let a=0;a<s;a++){let s;if(n=e[a],r=n,!Qs(n)&&(r=Ys[(s=String(n)).toLowerCase()],void 0===r))throw new Rt("Unknown adapter '".concat(s,"'"));if(r&&(wt.isFunction(r)||(r=r.get(t))))break;i[s||"#"+a]=r}if(!r){const e=Object.entries(i).map(e=>{let[t,s]=e;return"adapter ".concat(t," ")+(!1===s?"is not supported by the environment":"is not available in the build")});let t=s?e.length>1?"since :\n"+e.map(Xs).join("\n"):" "+Xs(e[0]):"as no adapter specified";throw new Rt("There is no suitable adapter to dispatch the request "+t,"ERR_NOT_SUPPORT")}return r},adapters:Ys};function Js(e){if(e.cancelToken&&e.cancelToken.throwIfRequested(),e.signal&&e.signal.aborted)throw new ms(null,e)}function Zs(e){Js(e),e.headers=ds.from(e.headers),e.data=us.call(e,e.transformRequest),-1!==["post","put","patch"].indexOf(e.method)&&e.headers.setContentType("application/x-www-form-urlencoded",!1);return $s.getAdapter(e.adapter||ns.adapter,e)(e).then(function(t){return Js(e),t.data=us.call(e,e.transformResponse,t),t.headers=ds.from(t.headers),t},function(t){return hs(t)||(Js(e),t&&t.response&&(t.response.data=us.call(e,e.transformResponse,t.response),t.response.headers=ds.from(t.response.headers))),Promise.reject(t)})}const en="1.13.2",tn={};["object","boolean","number","function","string","symbol"].forEach((e,t)=>{tn[e]=function(s){return typeof s===e||"a"+(t<1?"n ":" ")+e}});const sn={};tn.transitional=function(e,t,s){function n(e,t){return"[Axios v"+en+"] Transitional option '"+e+"'"+t+(s?". "+s:"")}return(s,r,i)=>{if(!1===e)throw new Rt(n(r," has been removed"+(t?" in "+t:"")),Rt.ERR_DEPRECATED);return t&&!sn[r]&&(sn[r]=!0,console.warn(n(r," has been deprecated since v"+t+" and will be removed in the near future"))),!e||e(s,r,i)}},tn.spelling=function(e){return(t,s)=>(console.warn("".concat(s," is likely a misspelling of ").concat(e)),!0)};const nn={assertOptions:function(e,t,s){if("object"!==typeof e)throw new Rt("options must be an object",Rt.ERR_BAD_OPTION_VALUE);const n=Object.keys(e);let r=n.length;for(;r-- >0;){const i=n[r],a=t[i];if(a){const t=e[i],s=void 0===t||a(t,i,e);if(!0!==s)throw new Rt("option "+i+" must be "+s,Rt.ERR_BAD_OPTION_VALUE);continue}if(!0!==s)throw new Rt("Unknown option "+i,Rt.ERR_BAD_OPTION)}},validators:tn},rn=nn.validators;class an{constructor(e){this.defaults=e||{},this.interceptors={request:new Gt,response:new Gt}}async request(e,t){try{return await this._request(e,t)}catch(s){if(s instanceof Error){let e={};Error.captureStackTrace?Error.captureStackTrace(e):e=new Error;const t=e.stack?e.stack.replace(/^.+\n/,""):"";try{s.stack?t&&!String(s.stack).endsWith(t.replace(/^.+\n.+\n/,""))&&(s.stack+="\n"+t):s.stack=t}catch(Np){}}throw s}}_request(e,t){"string"===typeof e?(t=t||{}).url=e:t=e||{},t=ws(this.defaults,t);const{transitional:s,paramsSerializer:n,headers:r}=t;void 0!==s&&nn.assertOptions(s,{silentJSONParsing:rn.transitional(rn.boolean),forcedJSONParsing:rn.transitional(rn.boolean),clarifyTimeoutError:rn.transitional(rn.boolean)},!1),null!=n&&(wt.isFunction(n)?t.paramsSerializer={serialize:n}:nn.assertOptions(n,{encode:rn.function,serialize:rn.function},!0)),void 0!==t.allowAbsoluteUrls||(void 0!==this.defaults.allowAbsoluteUrls?t.allowAbsoluteUrls=this.defaults.allowAbsoluteUrls:t.allowAbsoluteUrls=!0),nn.assertOptions(t,{baseUrl:rn.spelling("baseURL"),withXsrfToken:rn.spelling("withXSRFToken")},!0),t.method=(t.method||this.defaults.method||"get").toLowerCase();let i=r&&wt.merge(r.common,r[t.method]);r&&wt.forEach(["delete","get","head","post","put","patch","common"],e=>{delete r[e]}),t.headers=ds.concat(i,r);const a=[];let o=!0;this.interceptors.request.forEach(function(e){"function"===typeof e.runWhen&&!1===e.runWhen(t)||(o=o&&e.synchronous,a.unshift(e.fulfilled,e.rejected))});const l=[];let c;this.interceptors.response.forEach(function(e){l.push(e.fulfilled,e.rejected)});let d,u=0;if(!o){const e=[Zs.bind(this),void 0];for(e.unshift(...a),e.push(...l),d=e.length,c=Promise.resolve(t);u<d;)c=c.then(e[u++],e[u++]);return c}d=a.length;let h=t;for(;u<d;){const e=a[u++],t=a[u++];try{h=e(h)}catch(f){t.call(this,f);break}}try{c=Zs.call(this,h)}catch(f){return Promise.reject(f)}for(u=0,d=l.length;u<d;)c=c.then(l[u++],l[u++]);return c}getUri(e){return Bt(Ts((e=ws(this.defaults,e)).baseURL,e.url,e.allowAbsoluteUrls),e.params,e.paramsSerializer)}}wt.forEach(["delete","get","head","options"],function(e){an.prototype[e]=function(t,s){return this.request(ws(s||{},{method:e,url:t,data:(s||{}).data}))}}),wt.forEach(["post","put","patch"],function(e){function t(t){return function(s,n,r){return this.request(ws(r||{},{method:e,headers:t?{"Content-Type":"multipart/form-data"}:{},url:s,data:n}))}}an.prototype[e]=t(),an.prototype[e+"Form"]=t(!0)});const on=an;class ln{constructor(e){if("function"!==typeof e)throw new TypeError("executor must be a function.");let t;this.promise=new Promise(function(e){t=e});const s=this;this.promise.then(e=>{if(!s._listeners)return;let t=s._listeners.length;for(;t-- >0;)s._listeners[t](e);s._listeners=null}),this.promise.then=e=>{let t;const n=new Promise(e=>{s.subscribe(e),t=e}).then(e);return n.cancel=function(){s.unsubscribe(t)},n},e(function(e,n,r){s.reason||(s.reason=new ms(e,n,r),t(s.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(e){this.reason?e(this.reason):this._listeners?this._listeners.push(e):this._listeners=[e]}unsubscribe(e){if(!this._listeners)return;const t=this._listeners.indexOf(e);-1!==t&&this._listeners.splice(t,1)}toAbortSignal(){const e=new AbortController,t=t=>{e.abort(t)};return this.subscribe(t),e.signal.unsubscribe=()=>this.unsubscribe(t),e.signal}static source(){let e;return{token:new ln(function(t){e=t}),cancel:e}}}const cn=ln;const dn={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511,WebServerIsDown:521,ConnectionTimedOut:522,OriginIsUnreachable:523,TimeoutOccurred:524,SslHandshakeFailed:525,InvalidSslCertificate:526};Object.entries(dn).forEach(e=>{let[t,s]=e;dn[s]=t});const un=dn;const hn=function e(t){const s=new on(t),n=Ue(on.prototype.request,s);return wt.extend(n,on.prototype,s,{allOwnKeys:!0}),wt.extend(n,s,null,{allOwnKeys:!0}),n.create=function(s){return e(ws(t,s))},n}(ns);hn.Axios=on,hn.CanceledError=ms,hn.CancelToken=cn,hn.isCancel=hs,hn.VERSION=en,hn.toFormData=Pt,hn.AxiosError=Rt,hn.Cancel=hn.CanceledError,hn.all=function(e){return Promise.all(e)},hn.spread=function(e){return function(t){return e.apply(null,t)}},hn.isAxiosError=function(e){return wt.isObject(e)&&!0===e.isAxiosError},hn.mergeConfig=ws,hn.AxiosHeaders=ds,hn.formToJSON=e=>ts(wt.isHTMLForm(e)?new FormData(e):e),hn.getAdapter=$s.getAdapter,hn.HttpStatusCode=un,hn.default=hn;const fn=hn,mn="localhost"===window.location.hostname?"http://localhost:8000":"",pn=function(e,t){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";return t?"".concat(mn,"/api/image/").concat(e,"/").concat(t).concat(s):null},gn=function(e){return pn("poster",e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:"")},vn=function(e){return pn("backdrop",e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:"")},yn=e=>{if(!e)return"";const t=Math.floor(e/3600),s=Math.floor(e%3600/60);return t>0?"".concat(t,"h ").concat(s,"min"):"".concat(s," min")};var bn=s(579);const xn=(0,i.createContext)(null);function En(e){let{children:t}=e;const[s,n]=(0,i.useState)(null),[r,a]=(0,i.useState)(!0),[o,l]=(0,i.useState)(localStorage.getItem("hermes_token"));(0,i.useEffect)(()=>{o?fn.defaults.headers.common.Authorization="Bearer ".concat(o):delete fn.defaults.headers.common.Authorization},[o]),(0,i.useEffect)(()=>{(async()=>{if(o)try{const e=await fn.get("".concat(mn,"/api/auth/me"));n(e.data)}catch(e){localStorage.removeItem("hermes_token"),l(null),n(null)}a(!1)})()},[o]);const c={user:s,loading:r,isAuthenticated:!!s,isAdmin:(null===s||void 0===s?void 0:s.is_admin)||!1,isPremium:(null===s||void 0===s?void 0:s.is_premium)||(null===s||void 0===s?void 0:s.is_admin)||!1,login:async(e,t)=>{try{const s=await fn.post("".concat(mn,"/api/auth/login"),{username:e,password:t});if("success"===s.data.status)return localStorage.setItem("hermes_token",s.data.token),l(s.data.token),n(s.data.user),{success:!0}}catch(i){var s,r;return{success:!1,error:(null===(s=i.response)||void 0===s||null===(r=s.data)||void 0===r?void 0:r.detail)||"Error iniciant sessi\xf3"}}},register:async(e,t,s,r)=>{try{const i=await fn.post("".concat(mn,"/api/auth/register"),{username:e,password:t,email:s,display_name:r});if("success"===i.data.status)return localStorage.setItem("hermes_token",i.data.token),l(i.data.token),n(i.data.user),{success:!0}}catch(o){var i,a;return{success:!1,error:(null===(i=o.response)||void 0===i||null===(a=i.data)||void 0===a?void 0:a.detail)||"Error registrant usuari"}}},logout:()=>{localStorage.removeItem("hermes_token"),l(null),n(null),delete fn.defaults.headers.common.Authorization},updateProfile:async e=>{try{if("success"===(await fn.put("".concat(mn,"/api/auth/profile"),e)).data.status){const e=await fn.get("".concat(mn,"/api/auth/me"));return n(e.data),{success:!0}}}catch(r){var t,s;return{success:!1,error:(null===(t=r.response)||void 0===t||null===(s=t.data)||void 0===s?void 0:s.detail)||"Error actualitzant perfil"}}}};return(0,bn.jsx)(xn.Provider,{value:c,children:t})}function Sn(){const e=(0,i.useContext)(xn);if(!e)throw new Error("useAuth ha de ser usat dins de AuthProvider");return e}const Tn=(0,i.createContext)(null);function kn(e){let{children:t}=e;const[s,n]=(0,i.useState)(!0),[r,a]=(0,i.useState)({current:0,total:6,message:"Inicialitzant..."}),[o,l]=(0,i.useState)({data:null,timestamp:null,pages:{}}),[c,d]=(0,i.useState)({data:null,timestamp:null,pages:{}}),[u,h]=(0,i.useState)({data:null,timestamp:null}),[f,m]=(0,i.useState)({data:null,timestamp:null}),[p,g]=(0,i.useState)({data:null,timestamp:null}),[v,y]=(0,i.useState)({data:null,timestamp:null}),b=e=>!(!e.data||!e.timestamp)&&Date.now()-e.timestamp<3e5,x=(0,i.useCallback)(async()=>{n(!0);let e=0;try{a({current:++e,total:6,message:"Carregant pel\xb7l\xedcules..."});try{const e=await fn.get("".concat(mn,"/api/library/movies"),{params:{page:1,limit:50,sort_by:"name"}});l({data:e.data,timestamp:Date.now(),pages:{1:{data:e.data.items,timestamp:Date.now()}}})}catch(Np){console.error("Error loading movies:",Np)}a({current:++e,total:6,message:"Carregant s\xe8ries..."});try{const e=await fn.get("".concat(mn,"/api/library/series"),{params:{page:1,limit:50,sort_by:"name"}});d({data:e.data,timestamp:Date.now(),pages:{1:{data:e.data.items,timestamp:Date.now()}}})}catch(Np){console.error("Error loading series:",Np)}a({current:++e,total:6,message:"Carregant llibres..."});try{const e=await fn.get("".concat(mn,"/api/library/books"));h({data:e.data,timestamp:Date.now()})}catch(Np){console.debug("Books endpoint no disponible")}a({current:++e,total:6,message:"Carregant audiollibres..."});try{const e=await fn.get("".concat(mn,"/api/library/audiobooks"));m({data:e.data,timestamp:Date.now()})}catch(Np){console.debug("Audiobooks endpoint no disponible")}a({current:++e,total:6,message:"Carregant inici..."});try{const[e,t]=await Promise.all([fn.get("".concat(mn,"/api/library/recent")).catch(()=>({data:[]})),fn.get("".concat(mn,"/api/user/continue-watching")).catch(()=>({data:[]}))]);g({data:{recent:e.data,continueWatching:t.data},timestamp:Date.now()})}catch(Np){console.error("Error loading home:",Np)}a({current:++e,total:6,message:"Finalitzant..."});try{const e=await fn.get("".concat(mn,"/api/library/stats"));y({data:e.data,timestamp:Date.now()})}catch(Np){console.error("Error loading stats:",Np)}}catch(t){console.error("Error preloading data:",t)}finally{setTimeout(()=>{n(!1)},300)}},[]),E=(0,i.useCallback)(async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:50,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"name",n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,i=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const a="".concat(e,"-").concat(t,"-").concat(s,"-").concat(n||"all","-").concat(r||"none");if(!i&&o.pages[a]&&b({data:!0,timestamp:o.pages[a].timestamp}))return o.pages[a].data;try{const i={page:e,limit:t,sort_by:s};n&&"all"!==n&&(i.content_type=n),r&&!["name","year"].includes(r)&&(i.category=r);const o=await fn.get("".concat(mn,"/api/library/movies"),{params:i});return l(e=>qt(qt({},e),{},{pages:qt(qt({},e.pages),{},{[a]:{data:o.data,timestamp:Date.now()}})})),o.data}catch(c){throw console.error("Error fetching movies:",c),c}},[o.pages]),S=(0,i.useCallback)(async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:50,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"name",n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,i=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const a="".concat(e,"-").concat(t,"-").concat(s,"-").concat(n||"all","-").concat(r||"none");if(!i&&c.pages[a]&&b({data:!0,timestamp:c.pages[a].timestamp}))return c.pages[a].data;try{const i={page:e,limit:t,sort_by:s};n&&"all"!==n&&(i.content_type=n),r&&!["name","year"].includes(r)&&(i.category=r);const o=await fn.get("".concat(mn,"/api/library/series"),{params:i});return d(e=>qt(qt({},e),{},{pages:qt(qt({},e.pages),{},{[a]:{data:o.data,timestamp:Date.now()}})})),o.data}catch(o){throw console.error("Error fetching series:",o),o}},[c.pages]),T=(0,i.useCallback)(async function(){if(!(arguments.length>0&&void 0!==arguments[0]&&arguments[0])&&b(u))return u.data;try{const e=await fn.get("".concat(mn,"/api/library/books"));return h({data:e.data,timestamp:Date.now()}),e.data}catch(e){return console.debug("Books endpoint no disponible"),[]}},[u]),k=(0,i.useCallback)(async function(){if(!(arguments.length>0&&void 0!==arguments[0]&&arguments[0])&&b(f))return f.data;try{const e=await fn.get("".concat(mn,"/api/library/audiobooks"));return m({data:e.data,timestamp:Date.now()}),e.data}catch(e){return console.debug("Audiobooks endpoint no disponible"),[]}},[f]),w=(0,i.useCallback)(async function(){if(!(arguments.length>0&&void 0!==arguments[0]&&arguments[0])&&b(p))return p.data;try{const[e,t]=await Promise.all([fn.get("".concat(mn,"/api/library/recent")).catch(()=>({data:[]})),fn.get("".concat(mn,"/api/user/continue-watching")).catch(()=>({data:[]}))]),s={recent:e.data,continueWatching:t.data};return g({data:s,timestamp:Date.now()}),s}catch(e){throw console.error("Error fetching home data:",e),e}},[p]),L=(0,i.useCallback)(function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"all";"all"!==e&&"movies"!==e||l({data:null,timestamp:null,pages:{}}),"all"!==e&&"series"!==e||d({data:null,timestamp:null,pages:{}}),"all"!==e&&"books"!==e||h({data:null,timestamp:null}),"all"!==e&&"audiobooks"!==e||m({data:null,timestamp:null}),"all"!==e&&"home"!==e||g({data:null,timestamp:null}),"all"!==e&&"stats"!==e||y({data:null,timestamp:null})},[]),C=(0,i.useCallback)(()=>{L("all"),x()},[L,x]),A={initialLoading:s,loadingProgress:r,getMovies:E,getSeries:S,getBooks:T,getAudiobooks:k,getHomeData:w,moviesCache:o,seriesCache:c,booksCache:u,audiobooksCache:f,homeCache:p,statsCache:v,invalidateCache:L,refreshAll:C,preloadData:x};return(0,bn.jsx)(Tn.Provider,{value:A,children:t})}function wn(){const e=(0,i.useContext)(Tn);if(!e)throw new Error("useLibrary ha de ser usat dins de LibraryProvider");return e}const Ln=e=>{let{size:t=24,className:s=""}=e;return(0,bn.jsxs)("svg",{className:"icon icon-movie ".concat(s),width:t,height:t,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,bn.jsx)("path",{d:"M19.82 2H4.18C2.97 2 2 2.97 2 4.18v15.64C2 21.03 2.97 22 4.18 22h15.64c1.21 0 2.18-.97 2.18-2.18V4.18C22 2.97 21.03 2 19.82 2z"}),(0,bn.jsx)("path",{d:"M7 2v20"}),(0,bn.jsx)("path",{d:"M17 2v20"}),(0,bn.jsx)("path",{d:"M2 12h20"}),(0,bn.jsx)("path",{d:"M2 7h5"}),(0,bn.jsx)("path",{d:"M2 17h5"}),(0,bn.jsx)("path",{d:"M17 17h5"}),(0,bn.jsx)("path",{d:"M17 7h5"}),(0,bn.jsx)("circle",{cx:"12",cy:"12",r:"2",fill:"currentColor",stroke:"none"})]})},Cn=e=>{let{size:t=24,className:s=""}=e;return(0,bn.jsxs)("svg",{className:"icon icon-series ".concat(s),width:t,height:t,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,bn.jsx)("rect",{x:"4",y:"6",width:"16",height:"12",rx:"2"}),(0,bn.jsx)("path",{d:"M2 8v8"}),(0,bn.jsx)("path",{d:"M22 8v8"}),(0,bn.jsx)("polygon",{points:"10 9 10 15 15 12 10 9",fill:"currentColor",stroke:"none"})]})},An=e=>{let{size:t=24,className:s=""}=e;return(0,bn.jsxs)("svg",{className:"icon icon-tv ".concat(s),width:t,height:t,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,bn.jsx)("rect",{x:"2",y:"7",width:"20",height:"14",rx:"2"}),(0,bn.jsx)("path",{d:"M17 2l-5 5-5-5"}),(0,bn.jsx)("circle",{cx:"12",cy:"14",r:"3"})]})},Rn=e=>{let{size:t=24,className:s=""}=e;return(0,bn.jsxs)("svg",{className:"icon icon-book ".concat(s),width:t,height:t,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,bn.jsx)("path",{d:"M12 6.25278C12 6.25278 10.5 3 6.5 3C4 3 2 4.5 2 7V19C2 19 4 17.5 6.5 17.5C9 17.5 10.5 18.5 12 20"}),(0,bn.jsx)("path",{d:"M12 6.25278C12 6.25278 13.5 3 17.5 3C20 3 22 4.5 22 7V19C22 19 20 17.5 17.5 17.5C15 17.5 13.5 18.5 12 20"}),(0,bn.jsx)("path",{d:"M12 6.25278V20"})]})},_n=e=>{let{size:t=24,className:s=""}=e;return(0,bn.jsxs)("svg",{className:"icon icon-audiobook ".concat(s),width:t,height:t,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,bn.jsx)("path",{d:"M3 18v-6a9 9 0 0 1 18 0v6"}),(0,bn.jsx)("path",{d:"M21 19a2 2 0 0 1-2 2h-1a2 2 0 0 1-2-2v-3a2 2 0 0 1 2-2h3v5z"}),(0,bn.jsx)("path",{d:"M3 19a2 2 0 0 0 2 2h1a2 2 0 0 0 2-2v-3a2 2 0 0 0-2-2H3v5z"}),(0,bn.jsx)("circle",{cx:"12",cy:"13",r:"2"}),(0,bn.jsx)("path",{d:"M12 15v3"}),(0,bn.jsx)("path",{d:"M9.5 5.5a4 4 0 0 1 5 0"})]})},Nn=e=>{let{size:t=24,className:s=""}=e;return(0,bn.jsxs)("svg",{className:"icon icon-programs ".concat(s),width:t,height:t,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,bn.jsx)("rect",{x:"2",y:"3",width:"20",height:"14",rx:"2"}),(0,bn.jsx)("path",{d:"M8 21h8"}),(0,bn.jsx)("path",{d:"M12 17v4"}),(0,bn.jsx)("path",{d:"M7 8h2"}),(0,bn.jsx)("path",{d:"M7 11h4"}),(0,bn.jsx)("rect",{x:"13",y:"7",width:"5",height:"5",rx:"1",fill:"currentColor",opacity:"0.3"})]})},In=e=>{let{size:t=24,className:s=""}=e;return(0,bn.jsx)("svg",{className:"icon icon-play ".concat(s),width:t,height:t,viewBox:"0 0 24 24",fill:"currentColor",children:(0,bn.jsx)("polygon",{points:"5 3 19 12 5 21 5 3"})})},jn=e=>{let{size:t=24,className:s=""}=e;return(0,bn.jsx)("svg",{className:"icon icon-info ".concat(s),width:t,height:t,viewBox:"0 0 24 24",fill:"currentColor",children:(0,bn.jsx)("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-6h2v6zm0-8h-2V7h2v2z"})})},Pn=e=>{let{size:t=14,filled:s=!0,className:n=""}=e;return(0,bn.jsx)("svg",{className:"icon icon-star ".concat(n),width:t,height:t,viewBox:"0 0 24 24",fill:s?"currentColor":"none",stroke:"currentColor",strokeWidth:"1",children:(0,bn.jsx)("polygon",{points:"12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"})})},Dn=e=>{let{size:t=18,className:s=""}=e;return(0,bn.jsxs)("svg",{className:"icon icon-edit ".concat(s),width:t,height:t,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[(0,bn.jsx)("path",{d:"M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"}),(0,bn.jsx)("path",{d:"M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"})]})},Mn=e=>{let{size:t=18,filled:s=!1,className:n=""}=e;return(0,bn.jsx)("svg",{className:"icon icon-bookmark ".concat(n),width:t,height:t,viewBox:"0 0 24 24",fill:s?"currentColor":"none",stroke:"currentColor",strokeWidth:"2",children:(0,bn.jsx)("path",{d:"M19 21l-7-5-7 5V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2z"})})},On=e=>{let{size:t=20,className:s=""}=e;return(0,bn.jsxs)("svg",{className:"icon icon-search ".concat(s),width:t,height:t,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[(0,bn.jsx)("circle",{cx:"11",cy:"11",r:"8"}),(0,bn.jsx)("line",{x1:"21",y1:"21",x2:"16.65",y2:"16.65"})]})},Fn=e=>{let{size:t=20,className:s=""}=e;return(0,bn.jsx)("svg",{className:"icon icon-chevron-left ".concat(s),width:t,height:t,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:(0,bn.jsx)("polyline",{points:"15 18 9 12 15 6"})})},Un=e=>{let{size:t=20,className:s=""}=e;return(0,bn.jsx)("svg",{className:"icon icon-chevron-right ".concat(s),width:t,height:t,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:(0,bn.jsx)("polyline",{points:"9 18 15 12 9 6"})})},Bn=e=>{let{size:t=18,className:s=""}=e;return(0,bn.jsxs)("svg",{className:"icon icon-settings ".concat(s),width:t,height:t,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[(0,bn.jsx)("circle",{cx:"12",cy:"12",r:"3"}),(0,bn.jsx)("path",{d:"M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"})]})},Gn=e=>{let{size:t=18,className:s=""}=e;return(0,bn.jsxs)("svg",{className:"icon icon-logout ".concat(s),width:t,height:t,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[(0,bn.jsx)("path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"}),(0,bn.jsx)("polyline",{points:"16 17 21 12 16 7"}),(0,bn.jsx)("line",{x1:"21",y1:"12",x2:"9",y2:"12"})]})},Vn=e=>{let{size:t=18,className:s=""}=e;return(0,bn.jsxs)("svg",{className:"icon icon-login ".concat(s),width:t,height:t,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[(0,bn.jsx)("path",{d:"M15 3h4a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-4"}),(0,bn.jsx)("polyline",{points:"10 17 15 12 10 7"}),(0,bn.jsx)("line",{x1:"15",y1:"12",x2:"3",y2:"12"})]})},zn=e=>{let{size:t=18,className:s=""}=e;return(0,bn.jsxs)("svg",{className:"icon icon-user ".concat(s),width:t,height:t,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[(0,bn.jsx)("path",{d:"M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"}),(0,bn.jsx)("circle",{cx:"12",cy:"7",r:"4"})]})},Hn=e=>{let{size:t=18,className:s=""}=e;return(0,bn.jsxs)("svg",{className:"icon icon-stats ".concat(s),width:t,height:t,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[(0,bn.jsx)("line",{x1:"18",y1:"20",x2:"18",y2:"10"}),(0,bn.jsx)("line",{x1:"12",y1:"20",x2:"12",y2:"4"}),(0,bn.jsx)("line",{x1:"6",y1:"20",x2:"6",y2:"14"})]})},Kn=e=>{let{size:t=18,className:s=""}=e;return(0,bn.jsxs)("svg",{className:"icon icon-preferences ".concat(s),width:t,height:t,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[(0,bn.jsx)("circle",{cx:"12",cy:"12",r:"10"}),(0,bn.jsx)("path",{d:"M8 14s1.5 2 4 2 4-2 4-2"}),(0,bn.jsx)("line",{x1:"9",y1:"9",x2:"9.01",y2:"9"}),(0,bn.jsx)("line",{x1:"15",y1:"9",x2:"15.01",y2:"9"})]})},Wn=e=>{let{size:t=18,className:s=""}=e;return(0,bn.jsx)("svg",{className:"icon icon-watchlist ".concat(s),width:t,height:t,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:(0,bn.jsx)("path",{d:"M19 21l-7-5-7 5V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2z"})})},qn=e=>{let{size:t=24,className:s=""}=e;return(0,bn.jsxs)("svg",{className:"icon icon-close ".concat(s),width:t,height:t,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[(0,bn.jsx)("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),(0,bn.jsx)("line",{x1:"6",y1:"6",x2:"18",y2:"18"})]})},Yn=e=>{let{size:t=24,className:s=""}=e;return(0,bn.jsxs)("svg",{className:"icon icon-download ".concat(s),width:t,height:t,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[(0,bn.jsx)("path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"}),(0,bn.jsx)("polyline",{points:"7 10 12 15 17 10"}),(0,bn.jsx)("line",{x1:"12",y1:"15",x2:"12",y2:"3"})]})},Xn=e=>{let{size:t=24,className:s=""}=e;return(0,bn.jsxs)("svg",{className:"icon icon-refresh ".concat(s),width:t,height:t,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[(0,bn.jsx)("polyline",{points:"23 4 23 10 17 10"}),(0,bn.jsx)("polyline",{points:"1 20 1 14 7 14"}),(0,bn.jsx)("path",{d:"M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"})]})},Qn=e=>{let{size:t=24,className:s=""}=e;return(0,bn.jsxs)("svg",{className:"icon icon-clock ".concat(s),width:t,height:t,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[(0,bn.jsx)("circle",{cx:"12",cy:"12",r:"10"}),(0,bn.jsx)("polyline",{points:"12 6 12 12 16 14"})]})},$n=e=>{let{size:t=24,className:s=""}=e;return(0,bn.jsx)("svg",{className:"icon icon-key ".concat(s),width:t,height:t,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:(0,bn.jsx)("path",{d:"M21 2l-2 2m-7.61 7.61a5.5 5.5 0 1 1-7.778 7.778 5.5 5.5 0 0 1 7.777-7.777zm0 0L15.5 7.5m0 0l3 3L22 7l-3-3m-3.5 3.5L19 4"})})},Jn=e=>{let{size:t=24,className:s=""}=e;return(0,bn.jsx)("svg",{className:"icon icon-check ".concat(s),width:t,height:t,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:(0,bn.jsx)("polyline",{points:"20 6 9 17 4 12"})})},Zn=e=>{let{size:t=24,className:s=""}=e;return(0,bn.jsxs)("svg",{className:"icon icon-users ".concat(s),width:t,height:t,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[(0,bn.jsx)("path",{d:"M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"}),(0,bn.jsx)("circle",{cx:"9",cy:"7",r:"4"}),(0,bn.jsx)("path",{d:"M23 21v-2a4 4 0 0 0-3-3.87"}),(0,bn.jsx)("path",{d:"M16 3.13a4 4 0 0 1 0 7.75"})]})},er=e=>{let{size:t=24,className:s=""}=e;return(0,bn.jsxs)("svg",{className:"icon icon-copy ".concat(s),width:t,height:t,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[(0,bn.jsx)("rect",{x:"9",y:"9",width:"13",height:"13",rx:"2",ry:"2"}),(0,bn.jsx)("path",{d:"M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"})]})},tr=e=>{let{size:t=24,className:s=""}=e;return(0,bn.jsxs)("svg",{className:"icon icon-trash ".concat(s),width:t,height:t,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[(0,bn.jsx)("polyline",{points:"3 6 5 6 21 6"}),(0,bn.jsx)("path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"})]})},sr=e=>{let{size:t=24,className:s=""}=e;return(0,bn.jsxs)("svg",{className:"icon icon-mail ".concat(s),width:t,height:t,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[(0,bn.jsx)("path",{d:"M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"}),(0,bn.jsx)("polyline",{points:"22,6 12,13 2,6"})]})},nr=e=>{let{size:t=24,className:s=""}=e;return(0,bn.jsxs)("svg",{className:"icon icon-database ".concat(s),width:t,height:t,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[(0,bn.jsx)("ellipse",{cx:"12",cy:"5",rx:"9",ry:"3"}),(0,bn.jsx)("path",{d:"M21 12c0 1.66-4 3-9 3s-9-1.34-9-3"}),(0,bn.jsx)("path",{d:"M3 5v14c0 1.66 4 3 9 3s9-1.34 9-3V5"})]})},rr=e=>{let{size:t=24,className:s=""}=e;return(0,bn.jsxs)("svg",{className:"icon icon-sync ".concat(s),width:t,height:t,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[(0,bn.jsx)("polyline",{points:"23 4 23 10 17 10"}),(0,bn.jsx)("polyline",{points:"1 20 1 14 7 14"}),(0,bn.jsx)("path",{d:"M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"})]})},ir=e=>{let{size:t=24,className:s=""}=e;return(0,bn.jsxs)("svg",{className:"icon icon-server ".concat(s),width:t,height:t,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[(0,bn.jsx)("rect",{x:"2",y:"2",width:"20",height:"8",rx:"2",ry:"2"}),(0,bn.jsx)("rect",{x:"2",y:"14",width:"20",height:"8",rx:"2",ry:"2"}),(0,bn.jsx)("line",{x1:"6",y1:"6",x2:"6.01",y2:"6"}),(0,bn.jsx)("line",{x1:"6",y1:"18",x2:"6.01",y2:"18"})]})},ar=e=>{let{size:t=24,className:s=""}=e;return(0,bn.jsxs)("svg",{className:"icon icon-calendar ".concat(s),width:t,height:t,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[(0,bn.jsx)("rect",{x:"3",y:"4",width:"18",height:"18",rx:"2",ry:"2"}),(0,bn.jsx)("line",{x1:"16",y1:"2",x2:"16",y2:"6"}),(0,bn.jsx)("line",{x1:"8",y1:"2",x2:"8",y2:"6"}),(0,bn.jsx)("line",{x1:"3",y1:"10",x2:"21",y2:"10"})]})},or=e=>{let{size:t=24,className:s=""}=e;return(0,bn.jsx)("svg",{className:"icon icon-activity ".concat(s),width:t,height:t,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:(0,bn.jsx)("polyline",{points:"22 12 18 12 15 21 9 3 6 12 2 12"})})},lr=e=>{let{size:t=24,className:s=""}=e;return(0,bn.jsxs)("svg",{className:"icon icon-clipboard ".concat(s),width:t,height:t,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[(0,bn.jsx)("path",{d:"M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2"}),(0,bn.jsx)("rect",{x:"8",y:"2",width:"8",height:"4",rx:"1",ry:"1"})]})},cr=e=>{let{size:t=24,className:s=""}=e;return(0,bn.jsxs)("svg",{className:"icon icon-camera ".concat(s),width:t,height:t,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[(0,bn.jsx)("path",{d:"M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2z"}),(0,bn.jsx)("circle",{cx:"12",cy:"13",r:"4"})]})},dr=e=>{let{size:t=24,className:s=""}=e;return(0,bn.jsxs)("svg",{className:"icon icon-alert ".concat(s),width:t,height:t,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[(0,bn.jsx)("circle",{cx:"12",cy:"12",r:"10"}),(0,bn.jsx)("line",{x1:"12",y1:"8",x2:"12",y2:"12"}),(0,bn.jsx)("line",{x1:"12",y1:"16",x2:"12.01",y2:"16"})]})},ur=e=>{let{size:t=24,className:s=""}=e;return(0,bn.jsxs)("svg",{className:"icon icon-plus ".concat(s),width:t,height:t,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[(0,bn.jsx)("line",{x1:"12",y1:"5",x2:"12",y2:"19"}),(0,bn.jsx)("line",{x1:"5",y1:"12",x2:"19",y2:"12"})]})},hr=e=>{let{size:t=24,className:s=""}=e;return(0,bn.jsxs)("svg",{className:"icon icon-file ".concat(s),width:t,height:t,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[(0,bn.jsx)("path",{d:"M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"}),(0,bn.jsx)("polyline",{points:"13 2 13 9 20 9"})]})},fr=e=>{let{size:t=24,className:s=""}=e;return(0,bn.jsxs)("svg",{className:"icon icon-grid ".concat(s),width:t,height:t,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[(0,bn.jsx)("rect",{x:"3",y:"3",width:"7",height:"7"}),(0,bn.jsx)("rect",{x:"14",y:"3",width:"7",height:"7"}),(0,bn.jsx)("rect",{x:"14",y:"14",width:"7",height:"7"}),(0,bn.jsx)("rect",{x:"3",y:"14",width:"7",height:"7"})]})},mr=e=>{let{size:t=24,className:s=""}=e;return(0,bn.jsxs)("svg",{className:"icon icon-list ".concat(s),width:t,height:t,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[(0,bn.jsx)("line",{x1:"8",y1:"6",x2:"21",y2:"6"}),(0,bn.jsx)("line",{x1:"8",y1:"12",x2:"21",y2:"12"}),(0,bn.jsx)("line",{x1:"8",y1:"18",x2:"21",y2:"18"}),(0,bn.jsx)("line",{x1:"3",y1:"6",x2:"3.01",y2:"6"}),(0,bn.jsx)("line",{x1:"3",y1:"12",x2:"3.01",y2:"12"}),(0,bn.jsx)("line",{x1:"3",y1:"18",x2:"3.01",y2:"18"})]})},pr=e=>{let{size:t=24,className:s=""}=e;return(0,bn.jsxs)("svg",{className:"icon icon-back ".concat(s),width:t,height:t,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[(0,bn.jsx)("line",{x1:"19",y1:"12",x2:"5",y2:"12"}),(0,bn.jsx)("polyline",{points:"12 19 5 12 12 5"})]})},gr=e=>{let{size:t=24,className:s=""}=e;return(0,bn.jsxs)("svg",{className:"icon icon-author ".concat(s),width:t,height:t,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[(0,bn.jsx)("path",{d:"M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"}),(0,bn.jsx)("circle",{cx:"12",cy:"7",r:"4"})]})},vr=e=>{let{size:t=24,className:s=""}=e;return(0,bn.jsxs)("svg",{className:"icon icon-epub ".concat(s),width:t,height:t,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[(0,bn.jsx)("path",{d:"M4 19.5A2.5 2.5 0 0 1 6.5 17H20"}),(0,bn.jsx)("path",{d:"M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"}),(0,bn.jsx)("line",{x1:"8",y1:"7",x2:"16",y2:"7"}),(0,bn.jsx)("line",{x1:"8",y1:"11",x2:"16",y2:"11"}),(0,bn.jsx)("line",{x1:"8",y1:"15",x2:"12",y2:"15"})]})},yr=e=>{let{size:t=24,className:s=""}=e;return(0,bn.jsxs)("svg",{className:"icon icon-pdf ".concat(s),width:t,height:t,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[(0,bn.jsx)("path",{d:"M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"}),(0,bn.jsx)("polyline",{points:"14 2 14 8 20 8"}),(0,bn.jsx)("line",{x1:"16",y1:"13",x2:"8",y2:"13"}),(0,bn.jsx)("line",{x1:"16",y1:"17",x2:"8",y2:"17"}),(0,bn.jsx)("polyline",{points:"10 9 9 9 8 9"})]})},br=e=>{let{size:t=24,className:s=""}=e;return(0,bn.jsxs)("svg",{className:"icon icon-mobile ".concat(s),width:t,height:t,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[(0,bn.jsx)("rect",{x:"5",y:"2",width:"14",height:"20",rx:"2",ry:"2"}),(0,bn.jsx)("line",{x1:"12",y1:"18",x2:"12.01",y2:"18"})]})},xr=e=>{let{size:t=24,className:s=""}=e;return(0,bn.jsxs)("svg",{className:"icon icon-external ".concat(s),width:t,height:t,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[(0,bn.jsx)("path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"}),(0,bn.jsx)("polyline",{points:"15 3 21 3 21 9"}),(0,bn.jsx)("line",{x1:"10",y1:"14",x2:"21",y2:"3"})]})};const Er=function(){var e,t;const[s,n]=(0,i.useState)(!1),[r,a]=(0,i.useState)(!1),o=se(),l=re(),{user:c,isAuthenticated:d,logout:u}=Sn();(0,i.useEffect)(()=>{const e=()=>{n(window.scrollY>50)};return window.addEventListener("scroll",e),()=>window.removeEventListener("scroll",e)},[]);const h=e=>o.pathname===e;return(0,bn.jsx)("nav",{className:"navbar ".concat(s?"scrolled":""),children:(0,bn.jsxs)("div",{className:"navbar-container",children:[(0,bn.jsxs)("div",{className:"navbar-left",children:[(0,bn.jsxs)(De,{to:"/",className:"navbar-logo",children:[(0,bn.jsx)("img",{src:"/img/hermes.jpeg",alt:"Hermes"}),(0,bn.jsx)("img",{src:"/img/favico.ico",alt:""})]}),(0,bn.jsxs)("div",{className:"navbar-links",children:[(0,bn.jsx)(De,{to:"/",className:"nav-link ".concat(h("/")?"active":""),children:"Inici"}),(0,bn.jsx)(De,{to:"/movies",className:"nav-link ".concat(h("/movies")?"active":""),children:"Pel\xb7l\xedcules"}),(0,bn.jsx)(De,{to:"/series",className:"nav-link ".concat(h("/series")?"active":""),children:"S\xe8ries"}),null!==c&&void 0!==c&&c.is_admin?(0,bn.jsxs)(bn.Fragment,{children:[(0,bn.jsx)(De,{to:"/programs",className:"nav-link ".concat(h("/programs")?"active":""),children:"Programes"}),(0,bn.jsx)(De,{to:"/books",className:"nav-link ".concat(h("/books")?"active":""),children:"Llibres"}),(0,bn.jsx)(De,{to:"/audiobooks",className:"nav-link ".concat(h("/audiobooks")?"active":""),children:"Audiollibres"}),(0,bn.jsx)(De,{to:"/tv",className:"nav-link ".concat(h("/tv")?"active":""),children:"Televisi\xf3"})]}):(0,bn.jsxs)(bn.Fragment,{children:[(0,bn.jsx)("span",{className:"nav-link disabled",children:"Programes"}),(0,bn.jsx)("span",{className:"nav-link disabled",children:"Llibres"}),(0,bn.jsx)("span",{className:"nav-link disabled",children:"Audiollibres"}),(0,bn.jsx)("span",{className:"nav-link disabled",children:"Televisi\xf3"})]})]})]}),(0,bn.jsx)("div",{className:"navbar-right",children:d?(0,bn.jsxs)("div",{className:"profile-menu-container",onMouseEnter:()=>a(!0),onMouseLeave:()=>a(!1),children:[(0,bn.jsx)("button",{className:"profile-button",children:(0,bn.jsx)("span",{className:"navbar-avatar ".concat(null!==c&&void 0!==c&&c.avatar?"has-image":""),children:null!==c&&void 0!==c&&c.avatar?(0,bn.jsx)("img",{src:c.avatar,alt:"Avatar"}):(null===c||void 0===c||null===(e=c.display_name)||void 0===e?void 0:e.charAt(0).toUpperCase())||(null===c||void 0===c||null===(t=c.username)||void 0===t?void 0:t.charAt(0).toUpperCase())||"U"})}),r&&(0,bn.jsxs)("div",{className:"profile-dropdown",children:[(0,bn.jsxs)("div",{className:"profile-info",children:[(0,bn.jsx)("div",{className:"profile-name",children:(null===c||void 0===c?void 0:c.display_name)||(null===c||void 0===c?void 0:c.username)}),(0,bn.jsx)("div",{className:"profile-email",children:(null===c||void 0===c?void 0:c.email)||"Sense email"})]}),(0,bn.jsx)("div",{className:"dropdown-divider"}),(null===c||void 0===c?void 0:c.is_admin)&&(0,bn.jsxs)(De,{to:"/admin",className:"dropdown-item admin",children:[(0,bn.jsx)(Bn,{})," Administraci\xf3"]}),(0,bn.jsxs)("button",{className:"dropdown-item",children:[(0,bn.jsx)(Hn,{})," Estad\xedstiques"]}),(0,bn.jsx)("div",{className:"dropdown-divider"}),(0,bn.jsxs)(De,{to:"/watchlist",className:"dropdown-item",children:[(0,bn.jsx)(Wn,{})," La meva llista"]}),(0,bn.jsxs)(De,{to:"/profile",className:"dropdown-item",children:[(0,bn.jsx)(Kn,{})," El meu perfil"]}),(0,bn.jsxs)("button",{className:"dropdown-item logout",onClick:()=>{u(),a(!1),l("/")},children:[(0,bn.jsx)(Gn,{})," Tancar sessi\xf3"]})]})]}):(0,bn.jsxs)(De,{to:"/login",className:"login-button-nav",children:[(0,bn.jsx)(Vn,{}),(0,bn.jsx)("span",{children:"Iniciar sessi\xf3"})]})})]})})};const Sr=function(e){let{progress:t}=e;const s=t?Math.round(t.current/t.total*100):0;return(0,bn.jsx)("div",{className:"startup-loading-screen",children:(0,bn.jsxs)("div",{className:"startup-loading-content",children:[(0,bn.jsx)("div",{className:"startup-loading-logo",children:(0,bn.jsx)("img",{src:"/img/hermes.png",alt:"Hermes",className:"startup-hermes-logo"})}),(0,bn.jsxs)("div",{className:"startup-progress-container",children:[(0,bn.jsx)("div",{className:"startup-progress-bar",children:(0,bn.jsx)("div",{className:"startup-progress-fill",style:{width:"".concat(s,"%")}})}),(0,bn.jsxs)("div",{className:"startup-progress-text",children:[(0,bn.jsx)("span",{className:"startup-progress-message",children:(null===t||void 0===t?void 0:t.message)||"Carregant..."}),(0,bn.jsxs)("span",{className:"startup-progress-percentage",children:[s,"%"]})]})]}),(0,bn.jsxs)("div",{className:"startup-loading-dots",children:[(0,bn.jsx)("span",{className:"startup-dot"}),(0,bn.jsx)("span",{className:"startup-dot"}),(0,bn.jsx)("span",{className:"startup-dot"})]})]})})};fn.defaults.baseURL=mn;const Tr=e=>{let{src:t,alt:s,type:n}=e;const[r,a]=(0,i.useState)(!1);return!t||r?(0,bn.jsx)("div",{className:"poster-placeholder",children:"series"===n?(0,bn.jsx)(Cn,{}):(0,bn.jsx)(Ln,{})}):(0,bn.jsx)("img",{src:t,alt:s,onError:()=>a(!0)})},kr=e=>{let{item:t,imageUrl:s,type:n}=e;const[r,a]=(0,i.useState)(s),[o,l]=(0,i.useState)(!1),[c,d]=(0,i.useState)(!s&&t.tmdb_id);return(0,i.useEffect)(()=>{if(s)return a(s),void d(!1);if(t.tmdb_id&&!s){(async()=>{let e=!1,s=null,r=null,i=null;const o="movie"===n?"movie":"tv";if("series"===n&&t.season_number&&t.episode_number)try{var l,c;const n=null===(l=(await fn.get("/api/tmdb/tv/".concat(t.tmdb_id,"/season/").concat(t.season_number))).data)||void 0===l||null===(c=l.episodes)||void 0===c?void 0:c.find(e=>e.episode_number===t.episode_number);null!==n&&void 0!==n&&n.still_path&&(a(n.still_path),s=n.still_path,e=!0)}catch(Np){console.debug("Error fetching season data, trying series info:",Np.message)}if(!e)try{var u,h;const s=await fn.get("/api/tmdb/".concat(o,"/").concat(t.tmdb_id));if(null!==(u=s.data)&&void 0!==u&&u.backdrop_path){const t="https://image.tmdb.org/t/p/w780".concat(s.data.backdrop_path);a(t),r=s.data.backdrop_path,e=!0}else if(null!==(h=s.data)&&void 0!==h&&h.poster_path){const t="https://image.tmdb.org/t/p/w500".concat(s.data.poster_path);a(t),i=s.data.poster_path,e=!0}}catch(Np){console.debug("Error fetching series/movie info:",Np.message)}if(e&&t.tmdb_id)try{await fn.post("/api/streaming/progress",{tmdb_id:t.tmdb_id,media_type:"movie"===n?"movie":"series",season_number:t.season_number||null,episode_number:t.episode_number||null,progress_percent:t.progress_percentage||0,completed:!1,title:t.series_name||t.title||"",poster_path:i||t.poster||null,backdrop_path:r||t.backdrop||null,still_path:s||null})}catch(Np){console.debug("Could not save image to progress:",Np.message)}d(!1)})()}else d(!1)},[t.tmdb_id,t.season_number,t.episode_number,s,n,t.progress_percentage,t.series_name,t.title,t.poster,t.backdrop]),c?(0,bn.jsx)("div",{className:"thumbnail-placeholder loading",children:"series"===n?(0,bn.jsx)(Cn,{}):(0,bn.jsx)(Ln,{})}):!r||o?(0,bn.jsx)("div",{className:"thumbnail-placeholder",children:"series"===n?(0,bn.jsx)(Cn,{}):(0,bn.jsx)(Ln,{})}):(0,bn.jsx)("img",{src:r,alt:t.series_name||t.title,onError:()=>l(!0)})};const wr=function(){const{isAuthenticated:e,user:t,isPremium:s}=Sn(),[n,r]=(0,i.useState)([]),[a,o]=(0,i.useState)([]),[l,c]=(0,i.useState)([]),[d,u]=(0,i.useState)([]),[h,f]=(0,i.useState)([]),[m,p]=(0,i.useState)([]),[g,v]=(0,i.useState)([]),[y,b]=(0,i.useState)([]),[x,E]=(0,i.useState)([]),[S,T]=(0,i.useState)(!0),[k,w]=(0,i.useState)(""),L=re(),C=(0,i.useCallback)(async()=>{try{if(e){try{const e=(await fn.get("/api/user/continue-watching")).data||[],t=e.filter(e=>"movie"===e.type),s=e.filter(e=>"series"===e.type||"episode"===e.type),n=e.filter(e=>"program"===e.type);r(t),o(s),c(n)}catch(Np){console.error("Error carregant continue watching:",Np)}try{const e=await fn.get("/api/user/continue-reading");u(e.data||[])}catch(Np){console.debug("Continue reading no disponible")}try{const e=await fn.get("/api/user/continue-listening");f(e.data||[])}catch(Np){console.debug("Continue listening no disponible")}try{var t;const e=await fn.get("/api/library/series?limit=10");v((null===(t=e.data)||void 0===t?void 0:t.items)||e.data||[])}catch(Np){console.error("Error carregant s\xe8ries:",Np)}try{var s;const e=await fn.get("/api/library/movies?limit=10");b((null===(s=e.data)||void 0===s?void 0:s.items)||e.data||[])}catch(Np){console.error("Error carregant pel\xb7l\xedcules:",Np)}try{var n,i;const[e,t]=await Promise.all([fn.get("/api/library/series?limit=5"),fn.get("/api/library/movies?limit=5")]),s=(null===(n=e.data)||void 0===n?void 0:n.items)||e.data||[],r=(null===(i=t.data)||void 0===i?void 0:i.items)||t.data||[],a=[...s.map(e=>qt(qt({},e),{},{type:"series"})),...r.map(e=>qt(qt({},e),{},{type:"movie"}))].sort(()=>Math.random()-.5).slice(0,8);p(a)}catch(Np){console.error("Error carregant contingut recent:",Np)}try{const e=await fn.get("/api/user/watchlist?limit=10");E(e.data||[])}catch(Np){console.debug("Watchlist no disponible")}}}catch(a){console.error("Error carregant dades:",a)}finally{T(!1)}},[e]);(0,i.useEffect)(()=>{C()},[C]);const A=e=>{e.preventDefault(),k.trim()&&L("/search?q=".concat(encodeURIComponent(k)))},R=e=>{let{title:t,items:n,type:r}=e;return n&&0!==n.length?(0,bn.jsxs)("section",{className:"content-row",children:[(0,bn.jsx)("h2",{className:"row-title",children:t}),(0,bn.jsx)("div",{className:"content-scroll",children:n.map(e=>{const t=e.type||r,n="series"===t?"/series/".concat(e.id):"/movies/".concat(e.id),i=e.poster?"".concat(mn,"/api/image/poster/").concat(e.id):null;return(0,bn.jsxs)("div",{className:"content-card",onClick:()=>L(n),children:[(0,bn.jsxs)("div",{className:"content-poster",children:[(0,bn.jsx)(Tr,{src:i,alt:e.name||e.title,type:t}),(0,bn.jsx)("div",{className:"content-hover",children:(0,bn.jsx)("button",{className:"quick-play-btn",children:s?(0,bn.jsx)(In,{}):(0,bn.jsx)(jn,{})})})]}),(0,bn.jsxs)("div",{className:"content-meta",children:[(0,bn.jsx)("h4",{children:e.name||e.title}),e.year&&(0,bn.jsx)("span",{className:"content-year",children:e.year})]})]},"".concat(t,"-").concat(e.id))})})]}):null};return S?(0,bn.jsx)("div",{className:"loading-screen",children:(0,bn.jsx)("img",{src:"/img/hermes.png",alt:"Hermes",className:"loading-logo"})}):e?(0,bn.jsxs)("div",{className:"home-container authenticated",children:[(0,bn.jsxs)("div",{className:"home-header",children:[(0,bn.jsxs)("h1",{className:"home-greeting",children:[(0,bn.jsxs)("span",{children:["Hola",null!==t&&void 0!==t&&t.display_name?", ".concat(t.display_name):"","!"]}),(0,bn.jsx)("span",{className:"greeting-subtitle",children:"Qu\xe8 et ve de gust veure avui?"})]}),(0,bn.jsxs)("form",{className:"search-bar compact",onSubmit:A,children:[(0,bn.jsx)("input",{type:"text",placeholder:"Cercar...",value:k,onChange:e=>w(e.target.value)}),(0,bn.jsx)("button",{type:"submit",children:(0,bn.jsxs)("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[(0,bn.jsx)("circle",{cx:"11",cy:"11",r:"8"}),(0,bn.jsx)("line",{x1:"21",y1:"21",x2:"16.65",y2:"16.65"})]})})]})]}),n.length>0&&(0,bn.jsxs)("section",{className:"continue-watching-section",children:[(0,bn.jsx)("h2",{className:"row-title",children:"Continuar veient pel\xb7l\xedcules"}),(0,bn.jsx)("div",{className:"content-scroll",children:n.map((e,t)=>{let s=null;return"streaming"===e.source?e.backdrop?s="https://image.tmdb.org/t/p/w780".concat(e.backdrop):e.poster&&(s="https://image.tmdb.org/t/p/w500".concat(e.poster)):(e.backdrop||e.poster)&&(s="".concat(mn,"/api/image/").concat(e.backdrop?"backdrop":"poster","/").concat(e.series_id||e.id)),(0,bn.jsxs)("div",{className:"continue-card",onClick:()=>{e.tmdb_id?L("/debrid/movie/".concat(e.tmdb_id)):L("/movies/".concat(e.series_id||e.id))},children:[(0,bn.jsxs)("div",{className:"continue-thumbnail",children:[(0,bn.jsx)(kr,{item:e,imageUrl:s,type:"movie"}),(0,bn.jsx)("div",{className:"continue-overlay",children:(0,bn.jsx)("button",{className:"play-btn",children:(0,bn.jsx)(In,{})})}),(0,bn.jsx)("div",{className:"progress-bar",children:(0,bn.jsx)("div",{className:"progress-fill",style:{width:"".concat(e.progress_percentage,"%")}})})]}),(0,bn.jsx)("div",{className:"continue-info",children:(0,bn.jsx)("h3",{className:"continue-title",children:e.series_name||e.title})})]},"streaming"===e.source?"stream-".concat(e.tmdb_id):"local-".concat(e.id,"-").concat(t))})})]}),a.length>0&&(0,bn.jsxs)("section",{className:"continue-watching-section",children:[(0,bn.jsx)("h2",{className:"row-title",children:"Continuar veient s\xe8ries"}),(0,bn.jsx)("div",{className:"content-scroll",children:a.map((e,t)=>{let s=null;return"streaming"===e.source?e.still_path?s=e.still_path.startsWith("http")?e.still_path:"https://image.tmdb.org/t/p/w500".concat(e.still_path):e.backdrop?s=e.backdrop.startsWith("http")?e.backdrop:"https://image.tmdb.org/t/p/w780".concat(e.backdrop):e.poster&&(s=e.poster.startsWith("http")?e.poster:"https://image.tmdb.org/t/p/w500".concat(e.poster)):(e.backdrop||e.poster)&&(s="".concat(mn,"/api/image/").concat(e.backdrop?"backdrop":"poster","/").concat(e.series_id)),(0,bn.jsxs)("div",{className:"continue-card",onClick:()=>{e.tmdb_id?L("/debrid/tv/".concat(e.tmdb_id,"?s=").concat(e.season_number||1,"&e=").concat(e.episode_number||1)):L("/series/".concat(e.series_id))},children:[(0,bn.jsxs)("div",{className:"continue-thumbnail",children:[(0,bn.jsx)(kr,{item:e,imageUrl:s,type:"series"}),(0,bn.jsx)("div",{className:"continue-overlay",children:(0,bn.jsx)("button",{className:"play-btn",children:(0,bn.jsx)(In,{})})}),(0,bn.jsx)("div",{className:"progress-bar",children:(0,bn.jsx)("div",{className:"progress-fill",style:{width:"".concat(e.progress_percentage,"%")}})})]}),(0,bn.jsxs)("div",{className:"continue-info",children:[(0,bn.jsx)("h3",{className:"continue-title",children:e.series_name}),(0,bn.jsxs)("p",{className:"continue-episode",children:["T",e.season_number," E",e.episode_number]})]})]},"streaming"===e.source?"stream-".concat(e.tmdb_id,"-").concat(e.season_number,"-").concat(e.episode_number):"local-".concat(e.id,"-").concat(t))})})]}),l.length>0&&(0,bn.jsxs)("section",{className:"continue-watching-section",children:[(0,bn.jsx)("h2",{className:"row-title",children:"Continuar veient programes"}),(0,bn.jsx)("div",{className:"content-scroll",children:l.map(e=>(0,bn.jsxs)("div",{className:"continue-card",onClick:()=>L("/play/program/".concat(e.id)),children:[(0,bn.jsxs)("div",{className:"continue-thumbnail",children:[e.backdrop||e.poster?(0,bn.jsx)("img",{src:"".concat(mn,"/api/image/").concat(e.backdrop?"backdrop":"poster","/").concat(e.series_id||e.id),alt:e.series_name||e.title}):(0,bn.jsx)("div",{className:"thumbnail-placeholder",children:(0,bn.jsx)(Nn,{})}),(0,bn.jsx)("div",{className:"continue-overlay",children:(0,bn.jsx)("button",{className:"play-btn",children:(0,bn.jsx)(In,{})})}),(0,bn.jsx)("div",{className:"progress-bar",children:(0,bn.jsx)("div",{className:"progress-fill",style:{width:"".concat(e.progress_percentage,"%")}})})]}),(0,bn.jsx)("div",{className:"continue-info",children:(0,bn.jsx)("h3",{className:"continue-title",children:e.series_name||e.title})})]},e.id))})]}),(null===t||void 0===t?void 0:t.is_admin)&&d.length>0&&(0,bn.jsxs)("section",{className:"continue-watching-section",children:[(0,bn.jsx)("h2",{className:"row-title",children:"Continua llegint"}),(0,bn.jsx)("div",{className:"content-scroll",children:d.map(e=>(0,bn.jsxs)("div",{className:"continue-card book-card",onClick:()=>L("/books/".concat(e.id,"/read")),children:[(0,bn.jsxs)("div",{className:"continue-thumbnail book-thumbnail",children:[e.cover?(0,bn.jsx)("img",{src:"".concat(mn,"/api/books/").concat(e.id,"/cover"),alt:e.title}):(0,bn.jsx)("div",{className:"thumbnail-placeholder",children:(0,bn.jsx)(Rn,{})}),(0,bn.jsx)("div",{className:"continue-overlay",children:(0,bn.jsx)("button",{className:"play-btn",children:(0,bn.jsx)(Rn,{})})}),(0,bn.jsx)("div",{className:"progress-bar",children:(0,bn.jsx)("div",{className:"progress-fill",style:{width:"".concat(e.progress_percentage||0,"%")}})})]}),(0,bn.jsxs)("div",{className:"continue-info",children:[(0,bn.jsx)("h3",{className:"continue-title",children:e.title}),(0,bn.jsx)("span",{className:"continue-time",children:e.current_page&&e.total_pages?"P\xe0gina ".concat(e.current_page," de ").concat(e.total_pages):"".concat(e.progress_percentage||0,"%")})]})]},e.id))})]}),(null===t||void 0===t?void 0:t.is_admin)&&h.length>0&&(0,bn.jsxs)("section",{className:"continue-watching-section",children:[(0,bn.jsx)("h2",{className:"row-title",children:"Continua escoltant"}),(0,bn.jsx)("div",{className:"content-scroll",children:h.map(e=>(0,bn.jsxs)("div",{className:"continue-card",onClick:()=>L("/audiobooks/".concat(e.id,"/listen")),children:[(0,bn.jsxs)("div",{className:"continue-thumbnail",children:[e.cover?(0,bn.jsx)("img",{src:"".concat(mn,"/api/audiobooks/").concat(e.id,"/cover"),alt:e.title}):(0,bn.jsx)("div",{className:"thumbnail-placeholder",children:(0,bn.jsx)(_n,{})}),(0,bn.jsx)("div",{className:"continue-overlay",children:(0,bn.jsx)("button",{className:"play-btn",children:(0,bn.jsx)(In,{})})}),(0,bn.jsx)("div",{className:"progress-bar",children:(0,bn.jsx)("div",{className:"progress-fill",style:{width:"".concat(e.progress_percentage||0,"%")}})})]}),(0,bn.jsx)("div",{className:"continue-info",children:(0,bn.jsx)("h3",{className:"continue-title",children:e.title})})]},e.id))})]}),(0,bn.jsx)(R,{title:"Per a tu",items:m}),x.length>0&&(0,bn.jsxs)("section",{className:"content-row",children:[(0,bn.jsxs)("h2",{className:"row-title",children:["La meva llista",(0,bn.jsx)(De,{to:"/watchlist",className:"see-all-link",children:"Veure tot"})]}),(0,bn.jsx)("div",{className:"content-scroll",children:x.map(e=>{const t="movie"===e.media_type?"movies":"series",n="/".concat(t,"/tmdb-").concat(e.tmdb_id),r=e.poster_path?"https://image.tmdb.org/t/p/w500".concat(e.poster_path):null;return(0,bn.jsxs)("div",{className:"content-card",onClick:()=>L(n),children:[(0,bn.jsxs)("div",{className:"content-poster",children:[r?(0,bn.jsx)("img",{src:r,alt:e.title}):(0,bn.jsx)("div",{className:"poster-placeholder",children:"movie"===e.media_type?(0,bn.jsx)(Ln,{}):(0,bn.jsx)(Cn,{})}),(0,bn.jsx)("div",{className:"content-hover",children:(0,bn.jsx)("button",{className:"quick-play-btn",onClick:t=>{t.stopPropagation(),s?"movie"===e.media_type?L("/debrid/movie/".concat(e.tmdb_id)):L("/debrid/tv/".concat(e.tmdb_id,"?s=1&e=1")):L(n)},children:s?(0,bn.jsx)(In,{}):(0,bn.jsx)(jn,{})})})]}),(0,bn.jsxs)("div",{className:"content-meta",children:[(0,bn.jsx)("h4",{children:e.title}),(0,bn.jsxs)("div",{className:"content-meta-row",children:[e.year&&(0,bn.jsx)("span",{className:"content-year",children:e.year}),e.rating&&(0,bn.jsxs)("span",{className:"content-rating",children:[(0,bn.jsx)(Pn,{})," ",e.rating.toFixed(1)]})]})]})]},"watchlist-".concat(e.id))})})]}),(0,bn.jsx)(R,{title:"S\xe8ries",items:g,type:"series"}),(0,bn.jsx)(R,{title:"Pel\xb7l\xedcules",items:y,type:"movie"}),(0,bn.jsx)("section",{className:"quick-access",children:(0,bn.jsxs)("div",{className:"quick-access-grid",children:[(0,bn.jsxs)(De,{to:"/movies",className:"quick-card",children:[(0,bn.jsx)("div",{className:"quick-bubble gradient-movies"}),(0,bn.jsx)(Ln,{}),(0,bn.jsx)("span",{children:"Pel\xb7l\xedcules"})]}),(0,bn.jsxs)(De,{to:"/series",className:"quick-card",children:[(0,bn.jsx)("div",{className:"quick-bubble gradient-series"}),(0,bn.jsx)(Cn,{}),(0,bn.jsx)("span",{children:"S\xe8ries"})]}),null!==t&&void 0!==t&&t.is_admin?(0,bn.jsxs)(bn.Fragment,{children:[(0,bn.jsxs)(De,{to:"/programs",className:"quick-card",children:[(0,bn.jsx)("div",{className:"quick-bubble gradient-programs"}),(0,bn.jsx)(Nn,{}),(0,bn.jsx)("span",{children:"Programes"})]}),(0,bn.jsxs)(De,{to:"/books",className:"quick-card",children:[(0,bn.jsx)("div",{className:"quick-bubble gradient-books"}),(0,bn.jsx)(Rn,{}),(0,bn.jsx)("span",{children:"Llibres"})]}),(0,bn.jsxs)(De,{to:"/audiobooks",className:"quick-card",children:[(0,bn.jsx)("div",{className:"quick-bubble gradient-audiobooks"}),(0,bn.jsx)(_n,{}),(0,bn.jsx)("span",{children:"Audiollibres"})]}),(0,bn.jsxs)(De,{to:"/tv",className:"quick-card",children:[(0,bn.jsx)("div",{className:"quick-bubble gradient-tv"}),(0,bn.jsx)(An,{}),(0,bn.jsx)("span",{children:"TV en directe"})]})]}):(0,bn.jsxs)(bn.Fragment,{children:[(0,bn.jsxs)("div",{className:"quick-card inactive",children:[(0,bn.jsx)("div",{className:"quick-bubble gradient-programs"}),(0,bn.jsx)(Nn,{}),(0,bn.jsx)("span",{children:"Programes"}),(0,bn.jsx)("span",{className:"coming-soon",children:"Properament"})]}),(0,bn.jsxs)("div",{className:"quick-card inactive",children:[(0,bn.jsx)("div",{className:"quick-bubble gradient-books"}),(0,bn.jsx)(Rn,{}),(0,bn.jsx)("span",{children:"Llibres"}),(0,bn.jsx)("span",{className:"coming-soon",children:"Properament"})]}),(0,bn.jsxs)("div",{className:"quick-card inactive",children:[(0,bn.jsx)("div",{className:"quick-bubble gradient-audiobooks"}),(0,bn.jsx)(_n,{}),(0,bn.jsx)("span",{children:"Audiollibres"}),(0,bn.jsx)("span",{className:"coming-soon",children:"Properament"})]}),(0,bn.jsxs)("div",{className:"quick-card inactive",children:[(0,bn.jsx)("div",{className:"quick-bubble gradient-tv"}),(0,bn.jsx)(An,{}),(0,bn.jsx)("span",{children:"TV en directe"}),(0,bn.jsx)("span",{className:"coming-soon",children:"Properament"})]})]})]})})]}):(0,bn.jsx)("div",{className:"home-container",children:(0,bn.jsxs)("section",{className:"hero-section",children:[(0,bn.jsxs)("div",{className:"hero-bg",children:[(0,bn.jsx)("div",{className:"hero-bubble hero-bubble-1"}),(0,bn.jsx)("div",{className:"hero-bubble hero-bubble-2"})]}),(0,bn.jsxs)("div",{className:"hero-content",children:[(0,bn.jsx)("div",{className:"search-container",children:(0,bn.jsxs)("form",{className:"search-bar",onSubmit:A,children:[(0,bn.jsx)("input",{type:"text",placeholder:"Qu\xe8 et ve de gust veure?",value:k,onChange:e=>w(e.target.value)}),(0,bn.jsx)("button",{type:"submit",children:(0,bn.jsxs)("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[(0,bn.jsx)("circle",{cx:"11",cy:"11",r:"8"}),(0,bn.jsx)("line",{x1:"21",y1:"21",x2:"16.65",y2:"16.65"})]})})]})}),(0,bn.jsxs)("div",{className:"categories-grid",children:[(0,bn.jsxs)(De,{to:"/movies",className:"category-card active",children:[(0,bn.jsx)("div",{className:"card-glass"}),(0,bn.jsx)("div",{className:"category-bubble gradient-movies"}),(0,bn.jsxs)("div",{className:"card-content",children:[(0,bn.jsx)(Ln,{}),(0,bn.jsx)("h3",{className:"card-title",children:"Pel\xb7l\xedcules"})]}),(0,bn.jsx)("div",{className:"hover-border"})]}),(0,bn.jsxs)(De,{to:"/series",className:"category-card active",children:[(0,bn.jsx)("div",{className:"card-glass"}),(0,bn.jsx)("div",{className:"category-bubble gradient-series"}),(0,bn.jsxs)("div",{className:"card-content",children:[(0,bn.jsx)(Cn,{}),(0,bn.jsx)("h3",{className:"card-title",children:"S\xe8ries"})]}),(0,bn.jsx)("div",{className:"hover-border"})]}),(0,bn.jsxs)("div",{className:"category-card inactive",children:[(0,bn.jsx)("div",{className:"card-glass"}),(0,bn.jsx)("div",{className:"category-bubble gradient-programs"}),(0,bn.jsxs)("div",{className:"card-content",children:[(0,bn.jsx)(Nn,{}),(0,bn.jsx)("h3",{className:"card-title",children:"Programes"}),(0,bn.jsx)("span",{className:"coming-soon",children:"Properament"})]}),(0,bn.jsx)("div",{className:"hover-border"})]}),(0,bn.jsxs)("div",{className:"category-card inactive",children:[(0,bn.jsx)("div",{className:"card-glass"}),(0,bn.jsx)("div",{className:"category-bubble gradient-books"}),(0,bn.jsxs)("div",{className:"card-content",children:[(0,bn.jsx)(Rn,{}),(0,bn.jsx)("h3",{className:"card-title",children:"Llibres"}),(0,bn.jsx)("span",{className:"coming-soon",children:"Properament"})]}),(0,bn.jsx)("div",{className:"hover-border"})]}),(0,bn.jsxs)("div",{className:"category-card inactive",children:[(0,bn.jsx)("div",{className:"card-glass"}),(0,bn.jsx)("div",{className:"category-bubble gradient-audiobooks"}),(0,bn.jsxs)("div",{className:"card-content",children:[(0,bn.jsx)(_n,{}),(0,bn.jsx)("h3",{className:"card-title",children:"Audiollibres"}),(0,bn.jsx)("span",{className:"coming-soon",children:"Properament"})]}),(0,bn.jsx)("div",{className:"hover-border"})]}),(0,bn.jsxs)("div",{className:"category-card inactive",children:[(0,bn.jsx)("div",{className:"card-glass"}),(0,bn.jsx)("div",{className:"category-bubble gradient-tv"}),(0,bn.jsxs)("div",{className:"card-content",children:[(0,bn.jsx)(An,{}),(0,bn.jsx)("h3",{className:"card-title",children:"Televisi\xf3"}),(0,bn.jsx)("span",{className:"coming-soon",children:"Properament"})]}),(0,bn.jsx)("div",{className:"hover-border"})]})]})]})]})})},Lr=e=>{let{size:t=20}=e;return(0,bn.jsxs)("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,bn.jsx)("polygon",{points:"11 5 6 9 2 9 2 15 6 15 11 19 11 5"}),(0,bn.jsx)("path",{d:"M15.54 8.46a5 5 0 0 1 0 7.07"}),(0,bn.jsx)("path",{d:"M19.07 4.93a10 10 0 0 1 0 14.14"})]})},Cr=e=>{let{size:t=20}=e;return(0,bn.jsx)("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"currentColor",children:(0,bn.jsx)("rect",{x:"6",y:"6",width:"12",height:"12",rx:"1"})})},Ar=e=>{let{title:t,language:s="ca-ES",size:n="medium",showLabel:r=!1,className:a=""}=e;const[o,l]=(0,i.useState)(!1),[c,d]=(0,i.useState)(!0);(0,i.useEffect)(()=>{"speechSynthesis"in window||d(!1)},[]),(0,i.useEffect)(()=>()=>{"speechSynthesis"in window&&window.speechSynthesis.cancel()},[]);const u=(0,i.useCallback)(()=>{if(!t||!c)return;if(o)return window.speechSynthesis.cancel(),void l(!1);window.speechSynthesis.cancel();const e=new SpeechSynthesisUtterance(t);e.lang=s,e.rate=.9,e.pitch=1,e.volume=1;const n=window.speechSynthesis.getVoices().find(e=>e.lang.startsWith(s.split("-")[0]));n&&(e.voice=n),e.onstart=()=>l(!0),e.onend=()=>l(!1),e.onerror=()=>l(!1),window.speechSynthesis.speak(e)},[t,s,o,c]);if(!c)return null;const h="title-audio-player--".concat(n);return(0,bn.jsxs)("button",{className:"title-audio-player ".concat(h," ").concat(o?"title-audio-player--playing":""," ").concat(a),onClick:u,title:o?"Aturar reproducci\xf3":"Escoltar t\xedtol","aria-label":o?"Aturar reproducci\xf3":"Escoltar: ".concat(t),children:[o?(0,bn.jsx)(Cr,{size:"small"===n?16:"large"===n?24:20}):(0,bn.jsx)(Lr,{size:"small"===n?16:"large"===n?24:20}),r&&(0,bn.jsx)("span",{className:"title-audio-player__label",children:o?"Aturar":"Escoltar"})]})},Rr={card:{position:"relative",borderRadius:"8px",overflow:"hidden",cursor:"pointer",transition:"all 0.3s ease",backgroundColor:"#1e293b",flexShrink:0},cardHover:{transform:"scale(1.05)",zIndex:10,boxShadow:"0 20px 40px rgba(0, 0, 0, 0.5)"},poster:{width:"100%",aspectRatio:"2/3",backgroundColor:"#334155",position:"relative"},image:{width:"100%",height:"100%",objectFit:"cover"},placeholder:{width:"100%",height:"100%",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"48px",background:"linear-gradient(135deg, #1e3a8a 0%, #328492 100%)"},overlay:{position:"absolute",inset:0,background:"rgba(0, 0, 0, 0.5)",opacity:0,transition:"opacity 0.3s ease",display:"flex",flexDirection:"column",justifyContent:"flex-end",padding:"15px"},overlayVisible:{opacity:1},playButton:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%) scale(0.8)",background:"none",border:"none",display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",opacity:0,transition:"all 0.3s ease",color:"white"},playButtonVisible:{opacity:1,transform:"translate(-50%, -50%) scale(1)"},info:{padding:"12px",textAlign:"left"},titleRow:{display:"flex",alignItems:"center",gap:"8px",marginBottom:"4px"},title:{fontSize:"14px",fontWeight:"600",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",textAlign:"left",flex:1},meta:{fontSize:"12px",color:"rgba(255, 255, 255, 0.6)",textAlign:"left"},badge:{position:"absolute",top:"10px",left:"10px",padding:"4px 8px",background:"#328492",borderRadius:"4px",fontSize:"11px",fontWeight:"600"},progressBar:{position:"absolute",bottom:0,left:0,right:0,height:"3px",background:"rgba(255, 255, 255, 0.2)"},progress:{height:"100%",background:"#328492",transition:"width 0.3s ease"},rating:{display:"flex",alignItems:"center",gap:"4px",fontSize:"12px",color:"#fbbf24"}};function _r(e){let{item:t,type:s="series",width:n=180,isTmdb:r=!1}=e;const[a,o]=(0,i.useState)(!1),[l,c]=(0,i.useState)(!1),d=re(),{isPremium:u}=Sn(),h=r||t.is_tmdb,f=t.watch_progress||0,m=h&&t.poster?t.poster:t.poster?gn(t.id):null;return(0,bn.jsxs)("div",{style:qt(qt({},Rr.card),{},{width:"".concat(n,"px")},a?Rr.cardHover:{}),onMouseEnter:()=>o(!0),onMouseLeave:()=>o(!1),onClick:()=>{d("/".concat(s,"/").concat(t.id))},children:[(0,bn.jsxs)("div",{style:Rr.poster,children:[m&&!l?(0,bn.jsx)("img",{src:m,alt:t.name||t.title,style:Rr.image,loading:"lazy",onError:()=>c(!0)}):(0,bn.jsx)("div",{style:Rr.placeholder,children:"movies"===s?(0,bn.jsx)(Ln,{size:48}):(0,bn.jsx)(An,{size:48})}),(0,bn.jsx)("div",{style:qt(qt({},Rr.overlay),a?Rr.overlayVisible:{}),children:(0,bn.jsxs)("div",{style:Rr.rating,children:[(0,bn.jsx)(Pn,{size:12})," ",t.rating||"8.5"]})}),(0,bn.jsx)("button",{style:qt(qt({},Rr.playButton),a?Rr.playButtonVisible:{}),onClick:e=>{e.stopPropagation(),u?h&&t.tmdb_id?d("movies"===s?"/debrid/movie/".concat(t.tmdb_id):"/debrid/tv/".concat(t.tmdb_id,"?s=1&e=1")):"movies"===s?!1===t.has_file?d("/movies/".concat(t.id)):d("/play/movie/".concat(t.id)):d("/".concat(s,"/").concat(t.id)):d("/".concat(s,"/").concat(t.id))},title:u?"Reproduir":"Veure detalls",children:u?(0,bn.jsx)(In,{size:48}):(0,bn.jsx)(jn,{size:48})}),f>0&&(0,bn.jsx)("div",{style:Rr.progressBar,children:(0,bn.jsx)("div",{style:qt(qt({},Rr.progress),{},{width:"".concat(f,"%")})})})]}),(0,bn.jsxs)("div",{style:Rr.info,children:[(0,bn.jsxs)("div",{style:Rr.titleRow,children:[(0,bn.jsx)("div",{style:Rr.title,children:t.name||t.title}),a&&(0,bn.jsx)(Ar,{title:t.name||t.title,size:"small",className:"title-audio-player--inline"})]}),(0,bn.jsx)("div",{style:Rr.meta,children:(()=>{if("movies"===s){const e=t.duration?Math.round(t.duration/60):0,s=[];return e>0&&s.push("".concat(e," min")),t.year&&s.push(t.year),s.join(" \xb7 ")||""}const e=[];return t.season_count&&e.push("".concat(t.season_count," temp.")),t.episode_count&&e.push("".concat(t.episode_count," ep.")),0===e.length&&t.year?t.year:e.join(" \xb7 ")||t.year||""})()})]})]})}const Nr=i.memo(_r),Ir={movies:{title:"Pel\xb7l\xedcules",icon:Ln,storageKey:"hermes_movies_filters",apiEndpoint:"/api/library/movies",discoverEndpoint:"/api/discover/movies",importType:"movie",filterTypes:{movies:{id:"movies",label:"Pel\xb7l\xedcules",contentType:"movie"},anime:{id:"anime",label:"Anime",contentType:"anime_movie"},animation:{id:"animation",label:"Animaci\xf3",contentType:"animated"}},defaultFilter:"movies",sortOptions:[{value:"name",label:"Ordenar per nom"},{value:"year",label:"Ordenar per any"},{value:"duration",label:"Ordenar per duraci\xf3"}],categories:{name:"Per nom",year:"Per any",now_playing:"Cartellera",upcoming:"Pr\xf2ximament"},emptyText:"pel\xb7l\xedcules",searchPlaceholder:"Cerca pel\xb7l\xedcules...",tmdbSearchType:"movies"},series:{title:"S\xe8ries",icon:An,storageKey:"hermes_series_filters",apiEndpoint:"/api/library/series",discoverEndpoint:"/api/discover/series",importType:"series",filterTypes:{series:{id:"series",label:"S\xe8ries",contentType:"series"},anime:{id:"anime",label:"Anime",contentType:"anime"},cartoons:{id:"cartoons",label:"Dibuixos",contentType:"toons"}},defaultFilter:"series",sortOptions:[{value:"name",label:"Ordenar per nom"},{value:"year",label:"Ordenar per any"},{value:"episodes",label:"Ordenar per episodis"},{value:"seasons",label:"Ordenar per temporades"}],categories:{name:"Per nom",year:"Per any",on_the_air:"En emissi\xf3",airing_today:"Avui"},emptyText:"s\xe8ries",searchPlaceholder:"Cerca s\xe8ries...",tmdbSearchType:"series"}},jr=e=>{let{filter:t,isActive:s,onClick:n,onMultiSelect:r}=e;return(0,bn.jsx)("button",{className:"content-type-btn ".concat(s?"active":""),onClick:e=>{e.ctrlKey||e.metaKey?r():n()},children:t.label})};const Pr=function(e){var t;let{type:s="series"}=e;const n=Ir[s],{isAdmin:r}=Sn(),{getMovies:a,getSeries:o,invalidateCache:l}=wn(),c="movies"===s?a:o,[d,u]=(0,i.useState)([]),[h,f]=(0,i.useState)(!0),[m,p]=(0,i.useState)("name"),[g,v]=(0,i.useState)("name"),[y,b]=(0,i.useState)(1),[x,E]=(0,i.useState)(1),[S,T]=(0,i.useState)(0),[k,w]=(0,i.useState)(()=>{try{const e=localStorage.getItem(n.storageKey);if(e){const t=JSON.parse(e);if(Array.isArray(t)&&t.length>0)return t}}catch(Np){}return[n.defaultFilter]}),[L,C]=(0,i.useState)(""),[A,R]=(0,i.useState)(!1),[_,N]=(0,i.useState)(null),[I,j]=(0,i.useState)(1),[P,D]=(0,i.useState)(1),[M,O]=(0,i.useState)(!1),[F,U]=(0,i.useState)(!1),[B,G]=(0,i.useState)({current:0,total:0}),V=(0,i.useCallback)(e=>e.map(e=>{var t;return null===(t=n.filterTypes[e])||void 0===t?void 0:t.contentType}).filter(Boolean).join(","),[n.filterTypes]);(0,i.useEffect)(()=>{localStorage.setItem(n.storageKey,JSON.stringify(k))},[k,n.storageKey]),(0,i.useEffect)(()=>{const e=setTimeout(async()=>{if(L.trim()){R(!0);try{const e=await fn.get("/api/tmdb/search?q=".concat(encodeURIComponent(L))),t=(e.data[n.tmdbSearchType]||[]).map(e=>({id:"tmdb-".concat(e.tmdb_id),tmdb_id:e.tmdb_id,name:e.name,year:e.year,poster:e.poster,rating:e.rating,is_tmdb:!0}));N(t)}catch(e){console.error("Error cercant a TMDB:",e),N([])}finally{R(!1)}}else N(null)},300);return()=>clearTimeout(e)},[L,n.tmdbSearchType]);const z=(0,i.useCallback)(e=>{w([e]),b(1)},[]),H=(0,i.useCallback)(e=>{w(t=>t.includes(e)?1===t.length?t:t.filter(t=>t!==e):[...t,e]),b(1)},[]),K=(0,i.useCallback)(async()=>{try{f(!0);const e=V(k),t=["name","year"].includes(g)?g:"name",s=["name","year"].includes(g)?null:g,n=await c(y,50,t,e,s);u(n.items||[]),E(n.total_pages||1),T(n.total||0)}catch(e){console.error("Error carregant ".concat(n.emptyText,":"),e)}finally{f(!1)}},[k,y,g,c,V,n.emptyText]);(0,i.useEffect)(()=>{K()},[K]),(0,i.useEffect)(()=>{r&&!["name","year"].includes(g)&&q(g,1)},[r,g]);const W=e=>{e>=1&&e<=x&&(b(e),window.scrollTo({top:0,behavior:"smooth"}))},q=async(e,t)=>{if(r&&!["name","year"].includes(e)){O(!0);try{const r=await fn.get("".concat(n.discoverEndpoint,"?category=").concat(e,"&page=").concat(t)),a=r.data.results;D(r.data.total_pages),j(t);const o=["now_playing","upcoming","on_the_air","airing_today"].includes(e)?a:a.filter(e=>!e.in_library);if(o.length>0){U(!0),G({current:0,total:o.length});for(let e=0;e<o.length;e++){const t=o[e];try{await fn.post("/api/import/tmdb",{tmdb_id:t.id,media_type:n.importType}),G({current:e+1,total:o.length})}catch(i){console.error("Error important ".concat(t.title,":"),i)}}U(!1),l(s),await K()}}catch(a){console.error("Error carregant descobrir:",a)}finally{O(!1)}}},Y=L.trim()?_||[]:d,X=n.icon;if(h)return(0,bn.jsxs)("div",{className:"loading-screen",children:[(0,bn.jsx)("img",{src:"/img/hermes.png",alt:"Hermes",className:"loading-logo"}),(0,bn.jsxs)("div",{className:"loading-text",children:["Carregant ",n.emptyText,"..."]})]});const Q=L.trim().length>0,$=Y.length>0;return(0,bn.jsxs)("div",{className:"library-container",children:[(0,bn.jsxs)("div",{className:"library-header",children:[(0,bn.jsx)("div",{className:"library-title-row",children:(0,bn.jsxs)("div",{className:"library-title",children:[(0,bn.jsx)("span",{className:"icon",children:(0,bn.jsx)(X,{size:28})}),(0,bn.jsx)("h1",{children:n.title}),(0,bn.jsxs)("span",{className:"library-count",children:["(",S,")"]})]})}),(0,bn.jsx)("div",{className:"library-filters",children:(0,bn.jsxs)("div",{className:"search-box",children:[(0,bn.jsx)(On,{}),(0,bn.jsx)("input",{type:"text",placeholder:n.searchPlaceholder,value:L,onChange:e=>C(e.target.value)}),L&&(0,bn.jsx)("button",{className:"clear-search",onClick:()=>{C("")},children:(0,bn.jsx)(qn,{})}),A&&(0,bn.jsx)("div",{className:"search-spinner"})]})}),(0,bn.jsx)("div",{className:"content-type-filters",children:Object.values(n.filterTypes).map(e=>(0,bn.jsx)(jr,{filter:e,isActive:k.includes(e.id),onClick:()=>z(e.id),onMultiSelect:()=>H(e.id)},e.id))})]}),!Q&&(0,bn.jsx)("div",{className:"category-tabs",children:Object.entries(n.categories).map(e=>{let[t,s]=e;return(0,bn.jsx)("button",{className:"category-tab ".concat(g===t?"active":""),onClick:()=>{var e;(e=t)===g||F||(v(e),b(1),r&&!["name","year"].includes(e)&&q(e,1))},disabled:F,children:s},t)})}),r&&F&&(0,bn.jsxs)("div",{className:"import-progress-bar",children:[(0,bn.jsxs)("div",{className:"import-progress-text",children:["Important ",n.emptyText,"... ",B.current,"/",B.total]}),(0,bn.jsx)("div",{className:"import-progress-track",children:(0,bn.jsx)("div",{className:"import-progress-fill",style:{width:"".concat(B.current/B.total*100,"%")}})})]}),Q?(0,bn.jsxs)(bn.Fragment,{children:[(0,bn.jsx)("div",{className:"library-grid",children:Y.map(e=>(0,bn.jsx)(Nr,{item:e,type:s,width:"100%",isTmdb:e.is_tmdb},e.id))}),!$&&(0,bn.jsxs)("div",{className:"empty-state",children:[(0,bn.jsx)("div",{className:"empty-icon",children:(0,bn.jsx)(On,{size:48})}),(0,bn.jsx)("h2",{children:"Sense resultats"}),(0,bn.jsxs)("p",{children:["No s'han trobat ",n.emptyText,' per "',L,'"']})]})]}):(0,bn.jsx)(bn.Fragment,{children:$?(0,bn.jsxs)(bn.Fragment,{children:[(0,bn.jsx)("div",{className:"library-grid",children:Y.map(e=>(0,bn.jsx)(Nr,{item:e,type:s,width:"100%"},"local-".concat(e.id)))}),x>1&&(0,bn.jsxs)("div",{className:"pagination-container",children:[(0,bn.jsxs)("div",{className:"pagination-info",children:["P\xe0gina ",y," de ",x," (",S," ",n.emptyText,")"]}),(0,bn.jsxs)("div",{className:"pagination-controls",children:[(0,bn.jsxs)("button",{className:"pagination-btn",onClick:()=>W(1),disabled:1===y,title:"Primera p\xe0gina",children:[(0,bn.jsx)(Fn,{}),(0,bn.jsx)(Fn,{})]}),(0,bn.jsx)("button",{className:"pagination-btn",onClick:()=>W(y-1),disabled:1===y,title:"P\xe0gina anterior",children:(0,bn.jsx)(Fn,{})}),(()=>{const e=[];let t=Math.max(1,y-Math.floor(2.5)),s=Math.min(x,t+5-1);s-t+1<5&&(t=Math.max(1,s-5+1));for(let n=t;n<=s;n++)e.push(n);return e})().map(e=>(0,bn.jsx)("button",{className:"pagination-btn page-number ".concat(e===y?"active":""),onClick:()=>W(e),children:e},e)),(0,bn.jsx)("button",{className:"pagination-btn",onClick:()=>W(y+1),disabled:y===x,title:"P\xe0gina seg\xfcent",children:(0,bn.jsx)(Un,{})}),(0,bn.jsxs)("button",{className:"pagination-btn",onClick:()=>W(x),disabled:y===x,title:"\xdaltima p\xe0gina",children:[(0,bn.jsx)(Un,{}),(0,bn.jsx)(Un,{})]})]})]})]}):r&&(M||F)?(0,bn.jsxs)("div",{className:"loading-inline",children:[(0,bn.jsx)("div",{className:"spinner"}),(0,bn.jsx)("span",{children:F?"Important ".concat(n.emptyText," ").concat((null===(t=n.categories[g])||void 0===t?void 0:t.toLowerCase())||"","..."):"Carregant ".concat(n.emptyText,"...")})]}):(0,bn.jsxs)("div",{className:"empty-state",children:[(0,bn.jsx)("div",{className:"empty-icon",children:(0,bn.jsx)(X,{size:48})}),(0,bn.jsxs)("h2",{children:["No hi ha ",n.emptyText]}),(0,bn.jsx)("p",{children:r?"Selecciona una categoria per importar contingut":"La biblioteca est\xe0 buida"})]})})]})};const Dr=function(){return(0,bn.jsx)(Pr,{type:"movies"})};const Mr=function(){return(0,bn.jsx)(Pr,{type:"series"})};fn.defaults.baseURL=mn;const Or=function(){const{id:e}=ie(),t=se(),s=re(),{isAdmin:n,isPremium:r,isAuthenticated:a}=Sn(),o=t.pathname.startsWith("/movies")?"movies":"series",l=e.startsWith("tmdb-"),c=l?parseInt(e.replace("tmdb-","")):null,[d,u]=(0,i.useState)(null),[h,f]=(0,i.useState)([]),[m,p]=(0,i.useState)([]),[g,v]=(0,i.useState)(1),[y,b]=(0,i.useState)(!0),[x,E]=(0,i.useState)(!1),[S,T]=(0,i.useState)(!1),[k,w]=(0,i.useState)(""),[L,C]=(0,i.useState)(!1),[A,R]=(0,i.useState)(null),[_,N]=(0,i.useState)(""),[I,j]=(0,i.useState)(!1),[P,D]=(0,i.useState)(null),[M,O]=(0,i.useState)(!1),[F,U]=(0,i.useState)(""),[B,G]=(0,i.useState)(!1),V=(0,i.useRef)(null),[z,H]=(0,i.useState)(!1),[K,W]=(0,i.useState)(!1),[q,Y]=(0,i.useState)(!1),[X,Q]=(0,i.useState)(!1),$=(0,i.useCallback)(()=>{const e=V.current;e&&(H(e.scrollLeft>0),W(e.scrollLeft<e.scrollWidth-e.clientWidth-5))},[]),J=e=>{const t=V.current;if(t){const s=200;t.scrollBy({left:"left"===e?-s:s,behavior:"smooth"})}};(0,i.useEffect)(()=>($(),window.addEventListener("resize",$),()=>window.removeEventListener("resize",$)),[$,h]);const Z=(0,i.useCallback)(async()=>{try{if(l&&c){if("series"===o){const[e,t]=await Promise.all([fn.get("/api/tmdb/tv/".concat(c)),fn.get("/api/tmdb/tv/".concat(c,"/seasons"))]);u(e.data);const s=(t.data.seasons||[]).filter(e=>e.season_number>0).map(e=>qt(qt({},e),{},{hasLocalEpisodes:!1}));f(s),s.length>0&&v(s[0].season_number),j(!0)}else{const e=await fn.get("/api/tmdb/movie/".concat(c));u(e.data)}return void b(!1)}if("series"===o){const[s,n]=await Promise.all([fn.get("/api/library/series/".concat(e)),fn.get("/api/library/series/".concat(e,"/seasons"))]),r=s.data;u(r);const i=n.data||[],a=new Set(i.map(e=>e.season_number));if(r.tmdb_id)try{const e=await fn.get("/api/tmdb/tv/".concat(r.tmdb_id,"/seasons"));if(e.data.seasons&&e.data.seasons.length>0){const t=e.data.seasons.filter(e=>e.season_number>0),s=new Set([...i.map(e=>e.season_number),...t.map(e=>e.season_number)]),n=Array.from(s).sort((e,t)=>e-t).map(e=>{const s=t.find(t=>t.season_number===e),n=i.find(t=>t.season_number===e);return qt(qt(qt({},s),n),{},{season_number:e,hasLocalEpisodes:a.has(e)})});f(n);const r=n.find(e=>e.hasLocalEpisodes);v(r?r.season_number:n[0].season_number),j(!0)}else i.length>0&&(f(i.map(e=>qt(qt({},e),{},{hasLocalEpisodes:!0}))),v(i[0].season_number),j(!1))}catch(t){console.error("Error carregant temporades TMDB:",t),i.length>0&&(f(i.map(e=>qt(qt({},e),{},{hasLocalEpisodes:!0}))),v(i[0].season_number),j(!1))}else i.length>0&&(f(i.map(e=>qt(qt({},e),{},{hasLocalEpisodes:!0}))),v(i[0].season_number),j(!1))}else{const t=await fn.get("/api/library/movies/".concat(e));u(t.data)}}catch(s){console.error("Error carregant detalls:",s)}finally{b(!1)}},[o,e,l,c]),ee=(0,i.useCallback)(async function(t){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;E(!0),p([]);try{const n=l?c:s;if(l&&c){const e=await fn.get("/api/tmdb/tv/".concat(c,"/season/").concat(t));if(e.data.episodes){const t=e.data.episodes.map(e=>qt(qt({},e),{},{isLocal:!1,duration:e.runtime?60*e.runtime:null}));p(t)}return}let r=[];try{r=(await fn.get("/api/library/series/".concat(e,"/seasons/").concat(t,"/episodes"))).data||[]}catch(Np){r=[]}const i={};if(r.forEach(e=>{i[e.episode_number]=e}),n)try{const e=await fn.get("/api/tmdb/tv/".concat(n,"/season/").concat(t));if(e.data.episodes){const t=e.data.episodes.map(e=>{const t=i[e.episode_number];return qt(qt({},e),{},{isLocal:!!t,localId:null===t||void 0===t?void 0:t.id,localData:t,audio_tracks:null===t||void 0===t?void 0:t.audio_tracks,subtitles:(null===t||void 0===t?void 0:t.subtitles)||(null===t||void 0===t?void 0:t.subtitle_tracks),duration:(null===t||void 0===t?void 0:t.duration)||(e.runtime?60*e.runtime:null),watch_progress:(null===t||void 0===t?void 0:t.watch_progress)||0})});return void p(t)}}catch(Np){console.error("Error carregant episodis TMDB:",Np)}p(r.map(e=>qt(qt({},e),{},{isLocal:!0,localId:e.id,localData:e})))}catch(n){console.error("Error carregant episodis:",n),p([])}finally{E(!1)}},[e,l,c]);(0,i.useEffect)(()=>{Z()},[Z]),(0,i.useEffect)(()=>{null!==d&&void 0!==d&&d.tmdb_id&&w(d.tmdb_id.toString())},[d]),(0,i.useEffect)(()=>{null!==d&&void 0!==d&&d.external_url&&U(d.external_url)},[d]),(0,i.useEffect)(()=>{(async()=>{const e=l?c:null===d||void 0===d?void 0:d.tmdb_id;if(e)try{const t="movies"===o?"movie":"series",s=await fn.get("/api/watch-providers/".concat(t,"/").concat(e));D(s.data)}catch(t){console.error("Error carregant prove\xefdors:",t)}})()},[null===d||void 0===d?void 0:d.tmdb_id,o,l,c]),(0,i.useEffect)(()=>{"series"===o&&h.length>0&&ee(g,I,null===d||void 0===d?void 0:d.tmdb_id)},[o,g,h,ee,I,null===d||void 0===d?void 0:d.tmdb_id]);const te=(0,i.useCallback)(async()=>{if(!a||!d)return;const e=l?c:d.tmdb_id;if(e)try{const t="movies"===o?"movie":"series",s=await fn.get("/api/user/watchlist/check/".concat(e,"?media_type=").concat(t));Y(s.data.in_watchlist)}catch(t){console.error("Error checking watchlist:",t)}},[a,d,l,c,o]);(0,i.useEffect)(()=>{d&&te()},[d,te]);const ne=e=>{if(!e)return null;const t=e.toLowerCase();return t.includes("youtube.com")||t.includes("youtu.be")?"YouTube":t.includes("vimeo.com")?"Vimeo":t.includes("archive.org")?"Internet Archive":t.includes("3cat.cat")||t.includes("ccma.cat")||t.includes("tv3.cat")?"3Cat":t.includes("dailymotion.com")||t.includes("dai.ly")?"Dailymotion":t.includes("twitch.tv")?"Twitch":t.includes("superembed")||t.includes("2embed")||t.includes("vidsrc")?"Embed API":t.endsWith(".m3u8")?"HLS Stream":t.endsWith(".mp4")||t.endsWith(".webm")?"V\xeddeo directe":"Extern"};return y?(0,bn.jsxs)("div",{className:"loading-screen",children:[(0,bn.jsx)("img",{src:"/img/hermes.png",alt:"Hermes",className:"loading-logo"}),(0,bn.jsx)("div",{className:"loading-text",children:"Carregant..."})]}):d?(0,bn.jsxs)("div",{className:"details-container",children:[(0,bn.jsxs)("div",{className:"details-hero",children:[(0,bn.jsx)("div",{className:"hero-backdrop",style:{backgroundImage:l?d.backdrop?"url(".concat(d.backdrop,")"):d.poster?"url(".concat(d.poster,")"):"none":d.backdrop?"url(".concat(vn(d.id,_),")"):d.poster?"url(".concat(gn(d.id,_),")"):"none"}}),(0,bn.jsx)("div",{className:"hero-gradient"}),(0,bn.jsx)("div",{className:"hero-content",children:(0,bn.jsxs)("div",{className:"details-info",children:[(0,bn.jsxs)("div",{className:"details-title-wrapper",children:[(0,bn.jsx)("h1",{className:"details-title",children:d.title||d.name}),(0,bn.jsx)(Ar,{title:d.title||d.name,size:"large"})]}),(0,bn.jsxs)("div",{className:"details-meta",children:[d.year&&(0,bn.jsx)("span",{className:"meta-item",children:d.year}),d.rating&&(0,bn.jsxs)("span",{className:"meta-item rating",children:[(0,bn.jsx)(Pn,{})," ",d.rating.toFixed(1)]}),"movies"===o&&(d.runtime||d.duration)&&(0,bn.jsx)("span",{className:"meta-item",children:yn(d.runtime?60*d.runtime:d.duration)}),"series"===o&&h.length>0&&(0,bn.jsxs)("span",{className:"meta-item",children:[h.length," temporades"]}),d.genres&&Array.isArray(d.genres)&&d.genres.length>0&&(0,bn.jsx)("span",{className:"meta-item genres",children:d.genres.map(e=>"object"===typeof e?e.name:e).filter(Boolean).join(", ")})]}),d.tagline&&(0,bn.jsxs)("p",{className:"details-tagline",children:['"',d.tagline,'"']}),d.overview&&(0,bn.jsx)("p",{className:"details-overview",children:d.overview}),(0,bn.jsxs)("div",{className:"details-credits",children:["movies"===o&&d.director&&(0,bn.jsxs)("div",{className:"credit-section",children:[(0,bn.jsx)("div",{className:"credit-section-title",children:"Director"}),(0,bn.jsx)("div",{className:"credit-section-value",children:d.director})]}),"series"===o&&d.creators&&d.creators.length>0&&(0,bn.jsxs)("div",{className:"credit-section",children:[(0,bn.jsx)("div",{className:"credit-section-title",children:"Creadors"}),(0,bn.jsx)("div",{className:"credit-section-value",children:d.creators.join(", ")})]}),d.cast&&d.cast.length>0&&(0,bn.jsxs)("div",{className:"credit-section",children:[(0,bn.jsx)("div",{className:"credit-section-title",children:"Repartiment"}),(0,bn.jsx)("div",{className:"cast-grid",children:d.cast.slice(0,6).map((e,t)=>(0,bn.jsxs)("div",{className:"cast-item",children:[(0,bn.jsx)("span",{className:"cast-name",children:e.name}),e.character&&(0,bn.jsx)("span",{className:"cast-character",children:e.character})]},t))})]})]}),P&&P.available&&(0,bn.jsxs)("div",{className:"watch-providers-section",children:[P.flatrate&&P.flatrate.length>0&&(0,bn.jsxs)("div",{className:"providers-row",children:[(0,bn.jsx)("span",{className:"providers-label",children:"Disponible a:"}),(0,bn.jsx)("div",{className:"providers-logos",children:P.flatrate.map(e=>(0,bn.jsx)("a",{href:e.deep_link||P.link,target:"_blank",rel:"noopener noreferrer",className:"provider-logo",title:"Veure a ".concat(e.name),children:e.logo?(0,bn.jsx)("img",{src:e.logo,alt:e.name}):(0,bn.jsx)("span",{className:"provider-name",children:e.name})},e.id))})]}),P.rent&&P.rent.length>0&&(0,bn.jsxs)("div",{className:"providers-row",children:[(0,bn.jsx)("span",{className:"providers-label",children:"Llogar a:"}),(0,bn.jsx)("div",{className:"providers-logos",children:P.rent.slice(0,5).map(e=>(0,bn.jsx)("a",{href:e.deep_link||P.link,target:"_blank",rel:"noopener noreferrer",className:"provider-logo",title:"Llogar a ".concat(e.name),children:e.logo?(0,bn.jsx)("img",{src:e.logo,alt:e.name}):(0,bn.jsx)("span",{className:"provider-name",children:e.name})},e.id))})]})]}),(0,bn.jsxs)("div",{className:"details-actions",children:[r&&(null===d||void 0===d?void 0:d.tmdb_id)&&(0,bn.jsxs)("button",{className:"play-btn",onClick:()=>{if("movies"===o)null!==d&&void 0!==d&&d.tmdb_id&&s("/debrid/movie/".concat(d.tmdb_id));else if(null!==d&&void 0!==d&&d.tmdb_id){var e,t;const n=(null===(e=h[0])||void 0===e?void 0:e.season_number)||1,r=(null===(t=m[0])||void 0===t?void 0:t.episode_number)||1;s("/debrid/tv/".concat(d.tmdb_id,"?s=").concat(n,"&e=").concat(r))}},children:[(0,bn.jsx)(In,{})," Reproduir"]}),(0,bn.jsxs)("button",{className:"watchlist-btn ".concat(q?"active":""),onClick:async()=>{if(!a)return void s("/login");const e=l?c:null===d||void 0===d?void 0:d.tmdb_id;if(!e)return;Q(!0);const t="movies"===o?"movie":"series";try{q?(await fn.delete("/api/user/watchlist/".concat(e,"?media_type=").concat(t)),Y(!1)):(await fn.post("/api/user/watchlist",{tmdb_id:e,media_type:t,title:(null===d||void 0===d?void 0:d.title)||(null===d||void 0===d?void 0:d.name),poster_path:(null===d||void 0===d?void 0:d.poster)||(null===d||void 0===d?void 0:d.poster_path),backdrop_path:(null===d||void 0===d?void 0:d.backdrop)||(null===d||void 0===d?void 0:d.backdrop_path),year:null===d||void 0===d?void 0:d.year,rating:null===d||void 0===d?void 0:d.rating}),Y(!0))}catch(n){console.error("Error toggling watchlist:",n)}finally{Q(!1)}},disabled:X,title:q?"Eliminar de la llista":"Afegir a la llista",children:[(0,bn.jsx)(Mn,{filled:q}),q?"A la llista":"Afegir a la llista"]}),n&&(0,bn.jsxs)(bn.Fragment,{children:[(0,bn.jsx)("button",{className:"secondary-btn edit-metadata-btn",onClick:()=>T(!S),title:"Corregir metadades amb TMDB ID",children:(0,bn.jsx)(Dn,{size:16})}),(0,bn.jsx)("button",{className:"secondary-btn external-url-btn",onClick:()=>O(!M),title:"Afegir URL externa per veure online",children:"\ud83d\udd17"})]})]}),n&&M&&(0,bn.jsxs)("div",{className:"external-url-form",children:[(0,bn.jsx)("label",{children:null!==d&&void 0!==d&&d.external_url?"URL externa actual (canvia per actualitzar):":"Introdueix una URL per veure online:"}),(0,bn.jsxs)("div",{className:"external-url-input-row",children:[(0,bn.jsx)("input",{type:"url",value:F,onChange:e=>U(e.target.value),placeholder:"https://youtube.com/watch?v=... o URL directa .mp4/.m3u8",disabled:B}),(0,bn.jsx)("button",{className:"external-url-submit-btn",onClick:async()=>{G(!0);try{const t=ne(F);await fn.patch("/api/series/".concat(e,"/external-url"),{external_url:F||null,external_source:t}),u(e=>qt(qt({},e),{},{external_url:F||null,external_source:t})),O(!1)}catch(t){console.error("Error guardant URL externa:",t)}finally{G(!1)}},disabled:B,children:B?"Guardant...":"Guardar"})]}),(0,bn.jsx)("small",{className:"external-url-help",children:"Suporta: YouTube, Vimeo, Dailymotion, Twitch, 3Cat, Internet Archive, URLs directes (.mp4, .m3u8)"}),F&&(0,bn.jsxs)("div",{className:"external-url-preview",children:["Font detectada: ",(0,bn.jsx)("strong",{children:ne(F)})]})]}),n&&S&&(0,bn.jsxs)("div",{className:"tmdb-input-form",children:[(0,bn.jsx)("label",{children:null!==d&&void 0!==d&&d.tmdb_id?"TMDB ID actual (canvia per actualitzar):":"Introdueix l'ID de TMDB:"}),(0,bn.jsxs)("div",{className:"tmdb-input-row",children:[(0,bn.jsx)("input",{type:"number",value:k,onChange:e=>w(e.target.value),placeholder:"Ex: 550 (Fight Club)",disabled:L}),(0,bn.jsx)("button",{className:"tmdb-submit-btn",onClick:async()=>{if(k.trim()){C(!0),R(null);try{const t=await fn.post("/api/metadata/series/".concat(e,"/update-by-tmdb"),{tmdb_id:parseInt(k),media_type:"movies"===o?"movie":"series"});if("success"===t.data.status){const e=t.data.metadata;u(s=>qt(qt({},s),{},{title:e.title||s.title,year:e.year||s.year,overview:e.overview||s.overview,rating:e.rating||s.rating,genres:e.genres||s.genres,runtime:e.runtime||s.runtime,tmdb_id:t.data.tmdb_id})),(t.data.poster_downloaded||t.data.backdrop_downloaded)&&N("?t=".concat(Date.now())),R({type:"success",text:"Metadades actualitzades: ".concat(e.title||d.name)}),T(!1),setTimeout(()=>{R(null)},3e3)}}catch(n){var t,s;const e=(null===(t=n.response)||void 0===t||null===(s=t.data)||void 0===s?void 0:s.detail)||"Error actualitzant metadades";R({type:"error",text:e})}finally{C(!1)}}else R({type:"error",text:"Introdueix un ID de TMDB"})},disabled:L,children:L?"Actualitzant...":"Actualitzar"})]}),(0,bn.jsxs)("small",{className:"tmdb-help",children:["Cerca a ",(0,bn.jsx)("a",{href:"https://www.themoviedb.org",target:"_blank",rel:"noopener noreferrer",children:"themoviedb.org"})," i copia l'ID de l'URL"]}),A&&(0,bn.jsx)("div",{className:"tmdb-message ".concat(A.type),children:A.text})]})]})})]}),"series"===o&&(0,bn.jsxs)("div",{className:"episodes-section",children:[(0,bn.jsx)("div",{className:"section-header",children:h.length>0&&(0,bn.jsxs)("div",{className:"seasons-tabs",children:[z&&(0,bn.jsx)("button",{className:"scroll-indicator left",onClick:()=>J("left"),"aria-label":"Scroll left",children:(0,bn.jsx)(Fn,{})}),(0,bn.jsx)("div",{className:"seasons-scroll-container",ref:V,onScroll:$,children:(0,bn.jsx)("div",{className:"seasons-list",children:h.map(e=>(0,bn.jsxs)("button",{className:"season-btn ".concat(g===e.season_number?"active":""),onClick:()=>v(e.season_number),children:["Temporada ",e.season_number]},e.id||"tmdb-season-".concat(e.season_number)))})}),K&&(0,bn.jsx)("button",{className:"scroll-indicator right",onClick:()=>J("right"),"aria-label":"Scroll right",children:(0,bn.jsx)(Un,{})})]})}),x?(0,bn.jsxs)("div",{className:"episodes-loading",children:[(0,bn.jsx)("div",{className:"episodes-loading-spinner"}),(0,bn.jsx)("span",{children:"Carregant episodis..."})]}):(0,bn.jsx)("div",{className:"episodes-grid",children:m.map(e=>(0,bn.jsxs)("div",{className:"episode-card",children:[(0,bn.jsxs)("div",{className:"episode-thumbnail",style:{cursor:r&&null!==d&&void 0!==d&&d.tmdb_id?"pointer":"default"},onClick:()=>{r&&null!==d&&void 0!==d&&d.tmdb_id&&s("/debrid/tv/".concat(d.tmdb_id,"?s=").concat(g,"&e=").concat(e.episode_number))},children:[e.still_path?(0,bn.jsx)("img",{src:e.still_path,alt:e.name,onError:e=>{e.target.style.display="none",e.target.nextSibling&&(e.target.nextSibling.style.display="flex")}}):null,(0,bn.jsx)("span",{className:"episode-number",style:{display:e.still_path?"none":"flex"},children:e.episode_number}),r&&(null===d||void 0===d?void 0:d.tmdb_id)&&(0,bn.jsx)("div",{className:"episode-play-icon",children:(0,bn.jsx)(In,{size:20})}),e.watch_progress>0&&(0,bn.jsx)("div",{className:"episode-progress",children:(0,bn.jsx)("div",{className:"episode-progress-bar",style:{width:"".concat(e.watch_progress,"%")}})})]}),(0,bn.jsxs)("div",{className:"episode-info",children:[(0,bn.jsxs)("div",{className:"episode-title",children:[e.episode_number,". ",e.name||"Episodi ".concat(e.episode_number)]}),(0,bn.jsxs)("div",{className:"episode-meta",children:[(e.duration||e.runtime)&&(0,bn.jsx)("span",{children:yn(60*(e.runtime||0)||e.duration)}),e.air_date&&(0,bn.jsx)("span",{children:new Date(e.air_date).toLocaleDateString("ca-ES")}),e.vote_average>0&&(0,bn.jsxs)("span",{className:"meta-item rating",children:[(0,bn.jsx)(Pn,{})," ",e.vote_average.toFixed(1)]})]}),e.overview&&(0,bn.jsxs)("div",{className:"episode-overview",children:[e.overview.slice(0,120),e.overview.length>120?"...":""]})]})]},e.id||e.episode_number))}),!x&&0===m.length&&(0,bn.jsx)("div",{className:"episodes-empty",children:"No hi ha episodis disponibles per aquesta temporada"})]})]}):(0,bn.jsx)("div",{className:"details-container",children:(0,bn.jsx)("div",{style:{padding:"100px 20px",textAlign:"center"},children:(0,bn.jsx)("h2",{children:"No s'ha trobat el contingut"})})})},Fr=()=>(0,bn.jsx)("svg",{viewBox:"0 0 24 24",fill:"currentColor",children:(0,bn.jsx)("path",{d:"M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z"})}),Ur=()=>(0,bn.jsx)("svg",{viewBox:"0 0 24 24",fill:"currentColor",children:(0,bn.jsx)("path",{d:"M8 5v14l11-7z"})}),Br=()=>(0,bn.jsx)("svg",{viewBox:"0 0 24 24",fill:"currentColor",children:(0,bn.jsx)("path",{d:"M6 19h4V5H6v14zm8-14v14h4V5h-4z"})}),Gr=()=>(0,bn.jsx)("svg",{viewBox:"0 0 24 24",fill:"currentColor",children:(0,bn.jsx)("path",{d:"M7 14H5v5h5v-2H7v-3zm-2-4h2V7h3V5H5v5zm12 7h-3v2h5v-5h-2v3zM14 5v2h3v3h2V5h-5z"})}),Vr=()=>(0,bn.jsx)("svg",{viewBox:"0 0 24 24",fill:"currentColor",children:(0,bn.jsx)("path",{d:"M5 16h3v3h2v-5H5v2zm3-8H5v2h5V5H8v3zm6 11h2v-3h3v-2h-5v5zm2-11V5h-2v5h5V8h-3z"})}),zr=()=>(0,bn.jsx)("svg",{viewBox:"0 0 24 24",fill:"currentColor",children:(0,bn.jsx)("path",{d:"M3 9v6h4l5 5V4L7 9H3zm13.5 3c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02zM14 3.23v2.06c2.89.86 5 3.54 5 6.71s-2.11 5.85-5 6.71v2.06c4.01-.91 7-4.49 7-8.77s-2.99-7.86-7-8.77z"})}),Hr=()=>(0,bn.jsx)("svg",{viewBox:"0 0 24 24",fill:"currentColor",children:(0,bn.jsx)("path",{d:"M16.5 12c0-1.77-1.02-3.29-2.5-4.03v2.21l2.45 2.45c.03-.2.05-.41.05-.63zm2.5 0c0 .94-.2 1.82-.54 2.64l1.51 1.51C20.63 14.91 21 13.5 21 12c0-4.28-2.99-7.86-7-8.77v2.06c2.89.86 5 3.54 5 6.71zM4.27 3L3 4.27 7.73 9H3v6h4l5 5v-6.73l4.25 4.25c-.67.52-1.42.93-2.25 1.18v2.06c1.38-.31 2.63-.95 3.69-1.81L19.73 21 21 19.73l-9-9L4.27 3zM12 4L9.91 6.09 12 8.18V4z"})}),Kr=()=>(0,bn.jsx)("svg",{viewBox:"0 0 24 24",fill:"currentColor",children:(0,bn.jsx)("path",{d:"M11 18V6l-8.5 6 8.5 6zm.5-6l8.5 6V6l-8.5 6z"})}),Wr=()=>(0,bn.jsx)("svg",{viewBox:"0 0 24 24",fill:"currentColor",children:(0,bn.jsx)("path",{d:"M4 18l8.5-6L4 6v12zm9-12v12l8.5-6L13 6z"})}),qr=()=>(0,bn.jsx)("svg",{viewBox:"0 0 24 24",fill:"currentColor",children:(0,bn.jsx)("path",{d:"M19.14 12.94c.04-.31.06-.63.06-.94 0-.31-.02-.63-.06-.94l2.03-1.58c.18-.14.23-.41.12-.61l-1.92-3.32c-.12-.22-.37-.29-.59-.22l-2.39.96c-.5-.38-1.03-.7-1.62-.94l-.36-2.54c-.04-.24-.24-.41-.48-.41h-3.84c-.24 0-.43.17-.47.41l-.36 2.54c-.59.24-1.13.57-1.62.94l-2.39-.96c-.22-.08-.47 0-.59.22L2.74 8.87c-.12.21-.08.47.12.61l2.03 1.58c-.04.31-.06.63-.06.94s.02.63.06.94l-2.03 1.58c-.18.14-.23.41-.12.61l1.92 3.32c.12.22.37.29.59.22l2.39-.96c.5.38 1.03.7 1.62.94l.36 2.54c.05.24.24.41.48.41h3.84c.24 0 .44-.17.47-.41l.36-2.54c.59-.24 1.13-.56 1.62-.94l2.39.96c.22.08.47 0 .59-.22l1.92-3.32c.12-.22.07-.47-.12-.61l-2.01-1.58zM12 15.6c-1.98 0-3.6-1.62-3.6-3.6s1.62-3.6 3.6-3.6 3.6 1.62 3.6 3.6-1.62 3.6-3.6 3.6z"})}),Yr=()=>(0,bn.jsx)("svg",{viewBox:"0 0 24 24",fill:"currentColor",children:(0,bn.jsx)("path",{d:"M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"})}),Xr=()=>(0,bn.jsx)("svg",{viewBox:"0 0 24 24",fill:"currentColor",children:(0,bn.jsx)("path",{d:"M12 3v10.55c-.59-.34-1.27-.55-2-.55-2.21 0-4 1.79-4 4s1.79 4 4 4 4-1.79 4-4V7h4V3h-6z"})}),Qr=()=>(0,bn.jsx)("svg",{viewBox:"0 0 24 24",fill:"currentColor",children:(0,bn.jsx)("path",{d:"M20 4H4c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zM4 12h4v2H4v-2zm10 6H4v-2h10v2zm6 0h-4v-2h4v2zm0-4H10v-2h10v2z"})}),$r=()=>(0,bn.jsx)("svg",{viewBox:"0 0 24 24",fill:"currentColor",children:(0,bn.jsx)("path",{d:"M6 18l8.5-6L6 6v12zM16 6v12h2V6h-2z"})}),Jr=()=>(0,bn.jsx)("svg",{viewBox:"0 0 24 24",fill:"currentColor",children:(0,bn.jsx)("path",{d:"M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z"})}),Zr=()=>(0,bn.jsx)("svg",{viewBox:"0 0 24 24",fill:"currentColor",children:(0,bn.jsx)("path",{d:"M10 6L8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z"})}),ei=()=>(0,bn.jsx)("svg",{viewBox:"0 0 24 24",fill:"currentColor",children:(0,bn.jsx)("path",{d:"M4 6h2v2H4V6zm0 5h2v2H4v-2zm0 5h2v2H4v-2zm16-8V6H8v2h12zm0 5v-2H8v2h12zm0 5v-2H8v2h12z"})}),ti=e=>{if(!e||isNaN(e))return"0:00";const t=Math.floor(e/3600),s=Math.floor(e%3600/60),n=Math.floor(e%60);return t>0?"".concat(t,":").concat(s.toString().padStart(2,"0"),":").concat(n.toString().padStart(2,"0")):"".concat(s,":").concat(n.toString().padStart(2,"0"))},si=e=>{if(!e)return"Desconeguda";const t=e.toLowerCase();return t.includes("2160p")||t.includes("4k")||t.includes("uhd")?"4K":t.includes("1080p")?"1080p":t.includes("720p")?"720p":t.includes("480p")?"480p":t.includes("hdtv")?"HDTV":t.includes("web")?"WEB":"SD"},ni=[{code:"ALL",label:"Tots",flag:"\ud83c\udf10"},{code:"VO",label:"VO",flag:"\ud83c\udfac"},{code:"ENG",label:"ENG",flag:"\ud83c\uddec\ud83c\udde7"},{code:"ESP",label:"ESP",flag:"\ud83c\uddea\ud83c\uddf8"},{code:"CAT",label:"CAT",flag:"\ud83c\udff3\ufe0f"},{code:"LAT",label:"LAT",flag:"\ud83c\uddf2\ud83c\uddfd"}],ri=(e,t)=>{const s="".concat(e," ").concat(t).toLowerCase(),n="".concat(e," ").concat(t);return s.includes("catala")||s.includes("catal\xe0")||s.includes("catalan")?"CAT":n.includes("\ud83c\uddf2\ud83c\uddfd")||n.includes("\ud83c\udde6\ud83c\uddf7")||n.includes("\ud83c\udde8\ud83c\uddf4")||n.includes("\ud83c\udde8\ud83c\uddf1")||s.includes("latino")||s.includes("lat ")||s.includes(" lat")||s.includes("latinoamerica")||s.includes("spanish lat")||s.includes("espa\xf1ol lat")?"LAT":n.includes("\ud83c\uddea\ud83c\uddf8")||s.includes("castellano")||s.includes("espa\xf1ol")||s.includes("spanish spain")||s.includes("spa ")||s.includes(" spa")||s.includes("spanish")||s.includes("esp")&&!s.includes("desperate")?"ESP":n.includes("\ud83c\uddec\ud83c\udde7")||n.includes("\ud83c\uddfa\ud83c\uddf8")||n.includes("\ud83c\udde6\ud83c\uddfa")||s.includes("english")||s.includes("eng ")||s.includes(" eng")||s.includes("engsub")||s.includes("subeng")||s.includes("multi")||s.includes("dual")?"ENG":n.includes("\ud83c\uddef\ud83c\uddf5")||n.includes("\ud83c\uddf0\ud83c\uddf7")||n.includes("\ud83c\uddeb\ud83c\uddf7")||n.includes("\ud83c\udde9\ud83c\uddea")||n.includes("\ud83c\uddee\ud83c\uddf9")||n.includes("\ud83c\udde8\ud83c\uddf3")||n.includes("\ud83c\uddf9\ud83c\uddfc")||n.includes("\ud83c\uddf7\ud83c\uddfa")||n.includes("\ud83c\uddf5\ud83c\uddf9")||n.includes("\ud83c\udde7\ud83c\uddf7")||s.includes("japanese")||s.includes("korean")||s.includes("french")||s.includes("german")||s.includes("italian")||s.includes("chinese")||s.includes("russian")||s.includes("portuguese")||s.includes("hindi")||s.includes("\u65e5\u672c\u8a9e")||s.includes("\ud55c\uad6d\uc5b4")||s.includes("fran\xe7ais")||s.includes("deutsch")||s.includes("italiano")?"VO":"ENG"};const ii=function(){var e;const{type:t,tmdbId:s}=ie(),n=se(),r=re();Sn();const a=(0,i.useRef)(null),o=(0,i.useRef)(null),l=(0,i.useRef)(null),c=(0,i.useRef)(null),d=(0,i.useRef)(0),u=(0,i.useRef)(0),h=(0,i.useRef)(null),f=(0,i.useRef)(null),m=new URLSearchParams(n.search),p=m.get("s")?parseInt(m.get("s")):null,g=m.get("e")?parseInt(m.get("e")):null,[v,y]=(0,i.useState)((null===(e=n.state)||void 0===e?void 0:e.mediaInfo)||null),[b,x]=(0,i.useState)([]),[E,S]=(0,i.useState)(p||1),[T,k]=(0,i.useState)(!1),[w,L]=(0,i.useState)([]),[C,A]=(0,i.useState)(null),[R,_]=(0,i.useState)(null),[N,I]=(0,i.useState)(!0),[j,P]=(0,i.useState)(!1),[D,M]=(0,i.useState)(null),[O,F]=(0,i.useState)(null),U=(0,i.useRef)(null),[B,G]=(0,i.useState)(!1),[V,z]=(0,i.useState)(0),[H,K]=(0,i.useState)(0),[W,q]=(0,i.useState)(0),[Y,X]=(0,i.useState)(1),[Q,$]=(0,i.useState)(!1),[J,Z]=(0,i.useState)(!1),[ee,te]=(0,i.useState)(!0),[ne,ae]=(0,i.useState)(!1),[oe,le]=(0,i.useState)(()=>localStorage.getItem("hermes_stream_lang")||"ALL"),[ce,de]=(0,i.useState)(!1),[ue,he]=(0,i.useState)([]),[fe,me]=(0,i.useState)(0),[pe,ge]=(0,i.useState)([]),[ve,ye]=(0,i.useState)(-1),[be,xe]=(0,i.useState)(!1),[Ee,Se]=(0,i.useState)(!1),[Te,ke]=(0,i.useState)([]),[we,Le]=(0,i.useState)(null),[Ce,Ae]=(0,i.useState)(!1),[Re,_e]=(0,i.useState)(null),[Ne,Ie]=(0,i.useState)(!1),[je,Pe]=(0,i.useState)(!1),De=(0,i.useRef)(null),Me=(0,i.useRef)({}),Oe="movie"===t?"movie":"tv",Fe=(0,i.useMemo)(()=>{if("movie"===t||!b.length||!g)return null;const e=b.findIndex(e=>e.episode_number===g);return e>=0&&e<b.length-1?b[e+1]:null},[t,b,g]),Ue=(0,i.useCallback)(async function(e){let n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];try{const r=b.find(e=>e.episode_number===g);await fn.post("".concat(mn,"/api/streaming/progress"),{tmdb_id:parseInt(s),media_type:"movie"===t?"movie":"series",season_number:"movie"!==t?p||1:null,episode_number:"movie"!==t?g||1:null,progress_percent:e,completed:n,title:(null===v||void 0===v?void 0:v.title)||(null===v||void 0===v?void 0:v.name)||"",poster_path:(null===v||void 0===v?void 0:v.poster_path)||null,backdrop_path:(null===v||void 0===v?void 0:v.backdrop_path)||null,still_path:(null===r||void 0===r?void 0:r.still_path)||null})}catch(r){console.error("Error guardant progr\xe9s:",r)}},[s,t,p,g,v,b]),Be=(0,i.useCallback)(async()=>{if(Fe){if(a.current&&H>0){const e=Math.round(a.current.currentTime/H*100);await Ue(e,e>=90)}Pe(!1),_(null),A(null),L([]),r("/debrid/tv/".concat(s,"?s=").concat(p,"&e=").concat(Fe.episode_number),{state:{mediaInfo:v},replace:!0})}},[Fe,r,s,p,v,H,Ue]),Ge=(0,i.useCallback)(async function(e){const t=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:null)||E;if(a.current&&H>0){const e=Math.round(a.current.currentTime/H*100);await Ue(e,e>=90)}Ie(!1),Pe(!1),_(null),A(null),L([]),r("/debrid/tv/".concat(s,"?s=").concat(t,"&e=").concat(e.episode_number),{state:{mediaInfo:v},replace:!0})},[r,s,E,v,H,Ue]),Ve=(0,i.useMemo)(()=>"ALL"===oe?w:w.filter(e=>ri(e.name,e.title)===oe),[w,oe]),ze=(0,i.useMemo)(()=>{const e=new Set;return w.forEach(t=>{e.add(ri(t.name,t.title))}),e},[w]),He=(0,i.useMemo)(()=>{const e={};Ve.forEach(t=>{const s=si(t.name),n=s;e[n]||(e[n]={quality:s,torrents:[],hasCached:!1}),e[n].torrents.push(t),t.cached&&(e[n].hasCached=!0)});const t={"4K":0,"1080p":1,"720p":2,WEB:3,HDTV:4,"480p":5,SD:6,Desconeguda:7};return Object.values(e).sort((e,s)=>{const n=(t[e.quality]||99)-(t[s.quality]||99);return 0!==n?n:e.hasCached&&!s.hasCached?-1:!e.hasCached&&s.hasCached?1:0})},[Ve]),Ke=C?si(C.name):null,We=(C&&ri(C.name,C.title),(0,i.useCallback)(async()=>{try{const e=await fn.get("".concat(mn,"/api/debrid/status"));return F(e.data.configured&&e.data.valid),e.data.configured&&e.data.valid}catch(e){return console.error("Error checking debrid status:",e),F(!1),!1}},[])),qe=(0,i.useCallback)(async()=>{try{const e="movie"===t?"/api/tmdb/movie/".concat(s):"/api/tmdb/tv/".concat(s),n=await fn.get("".concat(mn).concat(e));y(n.data)}catch(e){console.error("Error carregant info:",e)}},[t,s]),Ye=(0,i.useCallback)(async function(){const e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:null)||p;if("movie"===t||!e)return;const n="".concat(s,"_").concat(e);if(Me.current[n])x(Me.current[n]);else{k(!0);try{var r;const t=(null===(r=(await fn.get("".concat(mn,"/api/tmdb/tv/").concat(s,"/season/").concat(e))).data)||void 0===r?void 0:r.episodes)||[];Me.current[n]=t,x(t)}catch(i){console.error("Error carregant episodis:",i)}finally{k(!1)}}},[t,s,p]),Xe=(0,i.useCallback)(e=>{S(e),Ye(e)},[Ye]),Qe=(0,i.useCallback)(async()=>{I(!0),M(null);try{let e="".concat(mn,"/api/debrid/torrents/").concat(Oe,"/").concat(s);"tv"===Oe&&p&&g&&(e+="?season=".concat(p,"&episode=").concat(g));const t=(await fn.get(e)).data.streams||[];L(t);const n=localStorage.getItem("hermes_audio_lang")||"en",r=localStorage.getItem("hermes_quality")||"auto",i={ca:"Catal\xe0",es:"Castell\xe0",en:"Angl\xe8s",fr:"Franc\xe8s",de:"Alemany",it:"Itali\xe0",pt:"Portugu\xe8s",ja:"Japon\xe8s",ko:"Core\xe0",zh:"Xin\xe8s",ru:"Rus"}[n]||"Angl\xe8s",a={"4K":0,"2160p":0,"1080p":1,"720p":2,WEB:3,HDTV:4,"480p":5,SD:6},o=e=>{const t=ri(e.name,e.title);return t===i?0:"Multi"===t||"Dual"===t?1:"Angl\xe8s"===t?2:3},l=e=>{var t;const s=si(e.name);return"auto"!==r&&(s===r||"2160p"===r&&"4K"===s)?0:null!==(t=a[s])&&void 0!==t?t:99},c=(e,t)=>{const s=o(e),n=o(t);return s!==n?s-n:l(e)-l(t)},d=t.filter(e=>e.cached);if(d.length>0)d.sort(c),A(d[0]);else if(t.length>0){const e=[...t].sort(c);A(e[0])}}catch(n){var e,t;console.error("Error buscant torrents:",n),M((null===(e=n.response)||void 0===e||null===(t=e.data)||void 0===t?void 0:t.detail)||"Error buscant torrents")}finally{I(!1)}},[Oe,s,p,g]),$e=(0,i.useCallback)(async function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!e)return;U.current&&U.current.abort();const s=new AbortController;U.current=s,t&&a.current&&(d.current=a.current.currentTime),P(!0),M(null),ae(!1);try{const t={info_hash:e.info_hash,magnet:e.magnet};void 0!==e.file_idx&&null!==e.file_idx&&(t.file_idx=e.file_idx);const n=await fn.post("".concat(mn,"/api/debrid/stream"),null,{params:t,signal:s.signal,timeout:45e3});if(s.signal.aborted)return;"success"===n.data.status?_(n.data.url):M("No s'ha pogut obtenir el stream")}catch(o){var n,r,i;if(fn.isCancel(o)||"AbortError"===o.name||"ERR_CANCELED"===o.code)return void console.log("Petici\xf3 cancel\xb7lada");if(console.error("Error obtenint stream:",o),"ECONNABORTED"===o.code||null!==(n=o.message)&&void 0!==n&&n.includes("timeout"))M("Temps d'espera excedit. Prova amb una altra font.");else M((null===(r=o.response)||void 0===r||null===(i=r.data)||void 0===i?void 0:i.detail)||"Error obtenint stream")}finally{s.signal.aborted||P(!1)}},[]),Je=(0,i.useCallback)(e=>{const t=He.find(t=>t.quality===e);if(!t)return;const s=t.torrents.find(e=>e.cached)||t.torrents[0];s&&s.info_hash!==(null===C||void 0===C?void 0:C.info_hash)&&(A(s),_(null),$e(s,!0)),ae(!1)},[He,C,$e]),Ze=(0,i.useCallback)(e=>{le(e),localStorage.setItem("hermes_stream_lang",e),de(!1);const t="ALL"===e?w:w.filter(t=>ri(t.name,t.title)===e);if(t.length>0){const e=t.filter(e=>e.cached);if(e.length>0){const t={"4K":0,"1080p":1,"720p":2,WEB:3,HDTV:4,"480p":5,SD:6};e.sort((e,s)=>{var n,r;return(null!==(n=t[si(e.name)])&&void 0!==n?n:99)-(null!==(r=t[si(s.name)])&&void 0!==r?r:99)}),A(e[0]),_(null),$e(e[0],!0)}else A(t[0]),_(null),$e(t[0],!0)}},[w,$e]),et=(0,i.useCallback)(()=>{if(!a.current)return;const e=a.current;z(e.currentTime),e.buffered.length>0&&q(e.buffered.end(e.buffered.length-1)),c.current&&clearTimeout(c.current),c.current=setTimeout(()=>{const t=Math.round(e.currentTime/e.duration*100);Ue(t,!1)},3e4)},[Ue]),tt=(0,i.useCallback)(()=>{if(!a.current)return;const e=a.current;if(K(e.duration),e.muted=!1,e.volume=Y,d.current>0&&(e.currentTime=d.current,d.current=0),e.audioTracks&&e.audioTracks.length>0){const t=[];for(let s=0;s<e.audioTracks.length;s++){const n=e.audioTracks[s];t.push({id:s,label:n.label||n.language||"Pista ".concat(s+1),language:n.language||"",enabled:n.enabled}),n.enabled&&me(s)}he(t)}if(e.textTracks&&e.textTracks.length>0){const t=[];for(let s=0;s<e.textTracks.length;s++){const n=e.textTracks[s];t.push({id:s,label:n.label||n.language||"Subt\xedtols ".concat(s+1),language:n.language||"",mode:n.mode}),"showing"===n.mode&&ye(s)}ge(t)}},[Y]),st=(0,i.useCallback)(()=>{G(!0)},[]),nt=(0,i.useCallback)(()=>G(!1),[]),rt=(0,i.useCallback)(e=>{if(!a.current||!a.current.audioTracks)return;const t=a.current.audioTracks;for(let s=0;s<t.length;s++)t[s].enabled=s===e;me(e),xe(!1)},[]),it=(0,i.useCallback)(e=>{if(!a.current||!a.current.textTracks)return;const t=a.current.textTracks;for(let s=0;s<t.length;s++)t[s].mode=s===e?"showing":"hidden";ye(e),Se(!1)},[]),at=(0,i.useCallback)(async()=>{Ae(!0);try{let e="".concat(mn,"/api/subtitles/search/").concat(Oe,"/").concat(s);const t=new URLSearchParams;"tv"===Oe&&p&&g&&(t.append("season",p),t.append("episode",g)),t.append("languages","ca,es,en");const n=(await fn.get("".concat(e,"?").concat(t.toString()))).data.subtitles||[];ke(n)}catch(e){console.error("Error cercant subt\xedtols:",e)}finally{Ae(!1)}},[Oe,s,p,g]),ot=(0,i.useCallback)(async e=>{if(e){Le(e),Se(!1);try{const t="".concat(mn,"/api/subtitles/download/").concat(e.id);if(_e(t),a.current){const s=a.current;s.querySelectorAll("track").forEach(e=>e.remove());const n=document.createElement("track");n.kind="subtitles",n.label=e.language_name,n.srclang=e.language,n.src=t,n.default=!0,s.appendChild(n),setTimeout(()=>{s.textTracks&&s.textTracks.length>0&&(s.textTracks[0].mode="showing")},100)}}catch(t){console.error("Error carregant subt\xedtol:",t)}}},[]),lt=((0,i.useCallback)(()=>{if(ve>=0||we){if(a.current&&a.current.textTracks)for(let e=0;e<a.current.textTracks.length;e++)a.current.textTracks[e].mode="hidden";ye(-1),Le(null),_e(null)}else pe.length>0?it(0):Te.length>0&&ot(Te[0])},[ve,pe,it,Te,we,ot]),(0,i.useCallback)(()=>{G(!1),Ue(100,!0),Fe&&(Pe(!0),te(!0))},[Ue,Fe])),ct=(0,i.useCallback)(()=>{a.current&&(B?a.current.pause():a.current.play())},[B]),dt=(0,i.useCallback)(e=>{a.current&&(a.current.currentTime=Math.max(0,Math.min(e,H)))},[H]),ut=(0,i.useCallback)(e=>{const t=e.currentTarget.getBoundingClientRect(),s=(e.clientX-t.left)/t.width;dt(s*H)},[H,dt]),ht=(0,i.useCallback)(e=>{const t=parseFloat(e.target.value);X(t),a.current&&(a.current.volume=t),$(0===t)},[]),ft=(0,i.useCallback)(()=>{if(!a.current)return;const e=!Q;$(e),a.current.muted=e},[Q]),mt=(0,i.useCallback)(async()=>{o.current&&(document.fullscreenElement?(await document.exitFullscreen(),Z(!1)):(await o.current.requestFullscreen(),Z(!0)))},[]),pt=(0,i.useCallback)(()=>dt(V-10),[V,dt]),gt=(0,i.useCallback)(()=>dt(V+30),[V,dt]),vt=(0,i.useCallback)(async()=>{if(o.current)try{if(document.fullscreenElement||(await o.current.requestFullscreen(),Z(!0)),window.screen.orientation&&window.screen.orientation.lock)try{await window.screen.orientation.lock("landscape")}catch(Np){console.log("Orientation lock not supported")}}catch(Np){console.log("Fullscreen not supported:",Np)}},[]),yt=(0,i.useCallback)(e=>{var t,s;const n=null===(t=o.current)||void 0===t?void 0:t.getBoundingClientRect();if(!n)return"center";const r=(e.clientX||e.touches&&(null===(s=e.touches[0])||void 0===s?void 0:s.clientX)||0)-n.left,i=n.width;return r<.3*i?"left":r>.7*i?"right":"center"},[]),bt=(0,i.useCallback)(e=>{if(ne||ce||Ne||Ee||be||je)return;if(e.target.closest(".controls-container")||e.target.closest(".top-bar"))return;!J&&R&&vt();const t=Date.now(),s=yt(e);t-u.current<300&&f.current===s?(h.current&&(clearTimeout(h.current),h.current=null),"left"===s?(pt(),St("left")):"right"===s?(gt(),St("right")):R&&ct(),u.current=0,f.current=null):(u.current=t,f.current=s,h.current&&clearTimeout(h.current),h.current=setTimeout(()=>{ee?te(!1):(te(!0),B&&(l.current&&clearTimeout(l.current),l.current=setTimeout(()=>{te(!1)},3e3))),h.current=null},300))},[ne,ce,Ne,Ee,be,je,yt,pt,gt,ct,R,ee,B,J,vt]),[xt,Et]=(0,i.useState)(null),St=(0,i.useCallback)(e=>{Et(e),setTimeout(()=>Et(null),500)},[]),Tt=(0,i.useCallback)(()=>{te(!0),l.current&&clearTimeout(l.current),!B||ne||ce||(l.current=setTimeout(()=>{te(!1)},3e3))},[B,ne,ce]);(0,i.useEffect)(()=>{const e=e=>{if("Escape"===e.key)return ne?void ae(!1):ce?void de(!1):Ne?void Ie(!1):je?void Pe(!1):J?void document.exitFullscreen():void 0;if(!(ne||ce||Ne||je))switch(e.key){case" ":case"k":e.preventDefault(),ct();break;case"ArrowLeft":e.preventDefault(),pt();break;case"ArrowRight":e.preventDefault(),gt();break;case"f":e.preventDefault(),mt();break;case"m":e.preventDefault(),ft();break;case"n":Fe&&(e.preventDefault(),Be())}};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[ct,pt,gt,mt,ft,J,ne,ce,Ne,je,Fe,Be]),(0,i.useEffect)(()=>{(async()=>{v||qe(),Ye();await We()?Qe():I(!1),at()})()},[v,qe,Ye,Qe,We,at]),(0,i.useEffect)(()=>{!C||R||j||$e(C)},[C,R,j,$e]),(0,i.useEffect)(()=>{const e=()=>{const e=!!document.fullscreenElement;if(Z(e),!e&&window.screen.orientation&&window.screen.orientation.unlock)try{window.screen.orientation.unlock()}catch(Np){}};return document.addEventListener("fullscreenchange",e),()=>document.removeEventListener("fullscreenchange",e)},[]),(0,i.useEffect)(()=>{O&&"movie"!==t&&Qe()},[g]),(0,i.useEffect)(()=>{if(Ne&&De.current){const e=De.current.querySelector(".episode-item.current");e&&setTimeout(()=>{e.scrollIntoView({behavior:"smooth",block:"center"})},100)}},[Ne,b]),(0,i.useEffect)(()=>()=>{U.current&&U.current.abort()},[]),(0,i.useEffect)(()=>{const e=a.current;return()=>{if(e&&H>0){const n=Math.round(e.currentTime/H*100);if(n>5&&n<95){const e=JSON.stringify({tmdb_id:parseInt(s),media_type:"movie"===t?"movie":"series",season_number:"movie"!==t?p||1:null,episode_number:"movie"!==t?g||1:null,progress_percent:n,completed:!1,title:(null===v||void 0===v?void 0:v.title)||(null===v||void 0===v?void 0:v.name)||""}),r=new Blob([e],{type:"application/json"});navigator.sendBeacon("".concat(mn,"/api/streaming/progress"),r)}}}},[s,t,p,g,v,H]);const kt=(null===v||void 0===v?void 0:v.title)||(null===v||void 0===v?void 0:v.name)||"Carregant...",wt="movie"!==t&&p&&g?"T".concat(p," \xb7 E").concat(g):null;return(0,bn.jsxs)("div",{ref:o,className:"debrid-player ".concat(J?"fullscreen":""," ").concat(ee?"show-controls":""),onMouseMove:Tt,onClick:bt,onTouchEnd:bt,children:["left"===xt&&(0,bn.jsx)("div",{className:"double-tap-indicator left",children:(0,bn.jsxs)("div",{className:"double-tap-icon",children:[(0,bn.jsx)("svg",{viewBox:"0 0 24 24",fill:"currentColor",children:(0,bn.jsx)("path",{d:"M11 18V6l-8.5 6 8.5 6zm.5-6l8.5 6V6l-8.5 6z"})}),(0,bn.jsx)("span",{children:"-10s"})]})}),"right"===xt&&(0,bn.jsx)("div",{className:"double-tap-indicator right",children:(0,bn.jsxs)("div",{className:"double-tap-icon",children:[(0,bn.jsx)("svg",{viewBox:"0 0 24 24",fill:"currentColor",children:(0,bn.jsx)("path",{d:"M4 18l8.5-6L4 6v12zm9-12v12l8.5-6L13 6z"})}),(0,bn.jsx)("span",{children:"+30s"})]})}),R&&(0,bn.jsx)("video",{ref:a,className:"video-element",src:R,muted:Q,onTimeUpdate:et,onLoadedMetadata:tt,onPlay:st,onPause:nt,onEnded:lt,autoPlay:!0,playsInline:!0}),(N||j)&&(0,bn.jsxs)("div",{className:"loading-overlay",children:[(0,bn.jsx)("div",{className:"spinner"}),(0,bn.jsx)("p",{children:N?"Buscant fonts...":"Preparant stream..."})]}),!1===O&&!N&&(0,bn.jsxs)("div",{className:"error-overlay debrid-not-configured",children:[(0,bn.jsx)("div",{className:"config-icon",children:"\u2699\ufe0f"}),(0,bn.jsx)("h3",{children:"Real-Debrid no configurat"}),(0,bn.jsx)("p",{children:"Per reproduir en HD necessites configurar una clau API de Real-Debrid."}),(0,bn.jsxs)("div",{className:"config-steps",children:[(0,bn.jsxs)("p",{children:["1. Obt\xe9 una clau API a: ",(0,bn.jsx)("a",{href:"https://real-debrid.com/apitoken",target:"_blank",rel:"noopener noreferrer",children:"real-debrid.com/apitoken"})]}),(0,bn.jsx)("p",{children:"2. Configura-la a Administraci\xf3 \u2192 Real-Debrid"})]}),(0,bn.jsxs)("div",{className:"config-buttons",children:[(0,bn.jsx)("button",{onClick:()=>r("/admin"),children:"Anar a Administraci\xf3"}),(0,bn.jsx)("button",{className:"secondary",onClick:()=>r(-1),children:"Tornar enrere"})]})]}),D&&!1!==O&&(0,bn.jsxs)("div",{className:"error-overlay",children:[(0,bn.jsx)("p",{children:D}),(0,bn.jsx)("button",{onClick:()=>{M(null),Qe()},children:"Tornar a intentar"})]}),ne&&(0,bn.jsx)("div",{className:"quality-menu-overlay",onClick:e=>e.stopPropagation(),children:(0,bn.jsxs)("div",{className:"quality-menu",children:[(0,bn.jsxs)("div",{className:"quality-menu-header",children:[(0,bn.jsx)("h3",{children:"Qualitat"}),(0,bn.jsx)("button",{className:"close-btn",onClick:()=>ae(!1),children:(0,bn.jsx)(Yr,{})})]}),(0,bn.jsxs)("div",{className:"quality-menu-content",children:[He.map((e,t)=>(0,bn.jsxs)("div",{className:"quality-option ".concat(Ke===e.quality?"active":""," ").concat(e.hasCached?"cached":""),onClick:()=>Je(e.quality),children:[(0,bn.jsx)("span",{className:"quality-value",children:e.quality}),e.hasCached&&(0,bn.jsx)("span",{className:"cached-icon",children:"\u26a1"})]},t)),0===He.length&&!N&&(0,bn.jsx)("div",{className:"no-torrents",children:"No s'han trobat fonts disponibles"})]})]})}),(0,bn.jsxs)("div",{className:"top-bar",children:[(0,bn.jsx)("button",{className:"back-button",onClick:()=>r(-1),children:(0,bn.jsx)(Fr,{})}),(0,bn.jsxs)("div",{className:"title-info",children:[(0,bn.jsx)("h1",{children:kt}),wt&&(0,bn.jsx)("span",{children:wt})]})]}),R&&(0,bn.jsxs)("div",{className:"controls-container",children:[(0,bn.jsxs)("div",{className:"time-row",children:[(0,bn.jsx)("span",{className:"time-current",children:ti(V)}),(0,bn.jsx)("span",{className:"time-separator",children:"/"}),(0,bn.jsx)("span",{className:"time-duration",children:ti(H)})]}),(0,bn.jsx)("div",{className:"progress-container",onClick:ut,children:(0,bn.jsxs)("div",{className:"progress-bar",children:[(0,bn.jsx)("div",{className:"progress-buffered",style:{width:"".concat(W/H*100,"%")}}),(0,bn.jsx)("div",{className:"progress-played",style:{width:"".concat(V/H*100,"%")}})]})}),(0,bn.jsxs)("div",{className:"controls-row",children:[(0,bn.jsxs)("div",{className:"controls-left",children:[(0,bn.jsx)("button",{onClick:e=>{e.stopPropagation(),ct()},children:B?(0,bn.jsx)(Br,{}):(0,bn.jsx)(Ur,{})}),(0,bn.jsx)("button",{onClick:e=>{e.stopPropagation(),pt()},title:"-10s",children:(0,bn.jsx)(Kr,{})}),(0,bn.jsx)("button",{onClick:e=>{e.stopPropagation(),gt()},title:"+30s",children:(0,bn.jsx)(Wr,{})}),(0,bn.jsxs)("div",{className:"volume-control",onClick:e=>e.stopPropagation(),children:[(0,bn.jsx)("button",{onClick:ft,children:Q||0===Y?(0,bn.jsx)(Hr,{}):(0,bn.jsx)(zr,{})}),(0,bn.jsx)("input",{type:"range",min:"0",max:"1",step:"0.05",value:Q?0:Y,onChange:ht,className:"volume-slider"})]})]}),(0,bn.jsxs)("div",{className:"controls-right",children:[(0,bn.jsx)("button",{className:"control-btn ".concat(ue.length>0?"":"disabled"),onClick:e=>{e.stopPropagation(),ue.length>0&&xe(!be)},title:ue.length>0?"Canviar \xe0udio":"\xc0udio no disponible",children:(0,bn.jsx)(Xr,{})}),(0,bn.jsxs)("button",{className:"control-btn ".concat(ve>=0||we||"ALL"!==oe?"active":""),onClick:e=>{e.stopPropagation(),Se(!Ee)},title:"Subt\xedtols i Idioma",children:[(0,bn.jsx)(Qr,{}),"ALL"!==oe&&(0,bn.jsx)("span",{className:"lang-badge",children:oe})]}),"movie"!==t&&b.length>0&&(0,bn.jsx)("button",{className:"control-btn",onClick:e=>{e.stopPropagation(),Ie(!0)},title:"Llista d'episodis",children:(0,bn.jsx)(ei,{})}),(0,bn.jsx)("button",{className:"control-btn",onClick:e=>{e.stopPropagation(),ae(!0)},title:"Canviar qualitat",children:(0,bn.jsx)(qr,{})}),(0,bn.jsx)("button",{onClick:e=>{e.stopPropagation(),mt()},children:J?(0,bn.jsx)(Vr,{}):(0,bn.jsx)(Gr,{})})]})]})]}),be&&ue.length>0&&(0,bn.jsxs)("div",{className:"track-menu",onClick:e=>e.stopPropagation(),children:[(0,bn.jsxs)("div",{className:"track-menu-header",children:[(0,bn.jsx)("h4",{children:"Pista d'\xe0udio"}),(0,bn.jsx)("button",{onClick:()=>xe(!1),children:(0,bn.jsx)(Yr,{})})]}),ue.map(e=>(0,bn.jsx)("div",{className:"track-option ".concat(fe===e.id?"active":""),onClick:()=>rt(e.id),children:e.label},e.id))]}),Ee&&(0,bn.jsxs)("div",{className:"track-menu subtitle-menu-extended",onClick:e=>e.stopPropagation(),children:[(0,bn.jsxs)("div",{className:"track-menu-header",children:[(0,bn.jsx)("h4",{children:"Idioma i Subt\xedtols"}),(0,bn.jsx)("button",{onClick:()=>Se(!1),children:(0,bn.jsx)(Yr,{})})]}),(0,bn.jsx)("div",{className:"subtitle-section-header",children:"Idioma d'\xe0udio"}),(0,bn.jsx)("div",{className:"language-options-grid",children:ni.map(e=>{const t="ALL"===e.code||ze.has(e.code),s="ALL"===e.code?w.length:w.filter(t=>ri(t.name,t.title)===e.code).length;return(0,bn.jsxs)("div",{className:"language-option-compact ".concat(oe===e.code?"active":""," ").concat(t?"":"unavailable"),onClick:()=>t&&Ze(e.code),children:[(0,bn.jsx)("span",{className:"lang-flag",children:e.flag}),(0,bn.jsx)("span",{className:"lang-label",children:e.label}),s>0&&(0,bn.jsx)("span",{className:"lang-count",children:s})]},e.code)})}),(0,bn.jsx)("div",{className:"subtitle-section-header",children:"Subt\xedtols"}),(0,bn.jsx)("div",{className:"track-option ".concat(-1!==ve||we?"":"active"),onClick:()=>{if(a.current&&a.current.textTracks)for(let e=0;e<a.current.textTracks.length;e++)a.current.textTracks[e].mode="hidden";ye(-1),Le(null),_e(null)},children:"Desactivats"}),pe.length>0&&(0,bn.jsx)(bn.Fragment,{children:pe.map(e=>(0,bn.jsxs)("div",{className:"track-option ".concat(ve===e.id?"active":""),onClick:()=>{Le(null),it(e.id)},children:[e.label," ",(0,bn.jsx)("span",{className:"sub-source",children:"Embegut"})]},"embedded-".concat(e.id)))}),Te.length>0&&(0,bn.jsx)(bn.Fragment,{children:Te.slice(0,10).map(e=>(0,bn.jsxs)("div",{className:"track-option ".concat((null===we||void 0===we?void 0:we.id)===e.id?"active":""),onClick:()=>{ye(-1),ot(e)},children:[(0,bn.jsx)("span",{className:"sub-language",children:e.language_name}),e.hearing_impaired&&(0,bn.jsx)("span",{className:"sub-badge",children:"CC"})]},"os-".concat(e.id)))}),Ce&&(0,bn.jsx)("div",{className:"track-option loading",children:"Cercant subt\xedtols..."}),!Ce&&0===pe.length&&0===Te.length&&(0,bn.jsx)("div",{className:"track-option disabled",children:"No hi ha subt\xedtols disponibles"})]}),je&&Fe&&(0,bn.jsx)("div",{className:"ended-overlay",onClick:e=>e.stopPropagation(),children:(0,bn.jsxs)("div",{className:"ended-content",children:[(0,bn.jsx)("p",{className:"ended-label",children:"Seg\xfcent"}),(0,bn.jsx)("h3",{children:Fe.name||"Episodi ".concat(Fe.episode_number)}),(0,bn.jsx)("div",{className:"ended-buttons",children:(0,bn.jsxs)("button",{className:"next-episode-btn",onClick:Be,children:[(0,bn.jsx)($r,{}),(0,bn.jsx)("span",{children:"Reproduir"})]})})]})}),Ne&&(0,bn.jsx)("div",{className:"episodes-overlay",onClick:e=>e.stopPropagation(),children:(0,bn.jsxs)("div",{className:"episodes-modal",children:[(0,bn.jsxs)("div",{className:"episodes-header",children:[(0,bn.jsx)("div",{className:"episodes-header-info",children:((e,t)=>{const s=(null===v||void 0===v||null===(e=v.seasons)||void 0===e||null===(t=e.filter(e=>e.season_number>0))||void 0===t?void 0:t.length)||(null===v||void 0===v?void 0:v.number_of_seasons)||1,n=E>1,r=E<s;return(0,bn.jsxs)("div",{className:"season-nav",children:[(0,bn.jsx)("button",{className:"season-nav-btn",onClick:()=>n&&Xe(E-1),disabled:!n,children:(0,bn.jsx)(Jr,{})}),(0,bn.jsxs)("span",{className:"season-title",children:["Temporada ",E]}),(0,bn.jsx)("button",{className:"season-nav-btn",onClick:()=>r&&Xe(E+1),disabled:!r,children:(0,bn.jsx)(Zr,{})})]})})()}),(0,bn.jsx)("button",{className:"close-btn",onClick:()=>Ie(!1),children:(0,bn.jsx)(Yr,{})})]}),(0,bn.jsx)("div",{className:"episodes-list",ref:De,children:T?(0,bn.jsx)("div",{className:"episodes-loading",children:"Carregant..."}):b.map(e=>{const t=E===p&&e.episode_number===g;return(0,bn.jsxs)("div",{className:"episode-item ".concat(t?"current":""),onClick:()=>!t&&Ge(e,E),children:[(0,bn.jsx)("div",{className:"episode-number",children:e.episode_number}),(0,bn.jsxs)("div",{className:"episode-info",children:[(0,bn.jsx)("div",{className:"episode-name",children:e.name||"Episodi ".concat(e.episode_number)}),e.runtime&&(0,bn.jsxs)("span",{className:"episode-runtime",children:[e.runtime," min"]})]}),t&&(0,bn.jsx)("span",{className:"current-badge",children:"\u25b6"})]},e.id||e.episode_number)})})]})})]})};fn.defaults.baseURL=mn;const ai=function(){const[e]=Fe(),t=re(),s=e.get("q")||"",[n,r]=(0,i.useState)({series:[],movies:[]}),[a,o]=(0,i.useState)(!0),[l,c]=(0,i.useState)(s);(0,i.useEffect)(()=>{s?d(s):o(!1)},[s]);const d=async e=>{o(!0);try{const t=await fn.get("/api/tmdb/search?q=".concat(encodeURIComponent(e)));r({series:t.data.series||[],movies:t.data.movies||[]})}catch(t){console.error("Error cercant:",t),r({series:[],movies:[]})}finally{o(!1)}},u=n.series.length+n.movies.length;return a?(0,bn.jsxs)("div",{className:"loading-screen",children:[(0,bn.jsx)("img",{src:"/img/hermes.png",alt:"Hermes",className:"loading-logo"}),(0,bn.jsxs)("div",{className:"loading-text",children:['Cercant "',s,'"...']})]}):(0,bn.jsxs)("div",{className:"library-container",children:[(0,bn.jsxs)("div",{className:"library-header",children:[(0,bn.jsxs)("div",{className:"library-title",children:[(0,bn.jsx)("span",{className:"icon",children:(0,bn.jsx)(On,{})}),(0,bn.jsx)("h1",{children:"Resultats de cerca"}),(0,bn.jsxs)("span",{className:"library-count",children:["(",u,")"]})]}),(0,bn.jsxs)("form",{className:"search-form",onSubmit:e=>{e.preventDefault(),l.trim()&&t("/search?q=".concat(encodeURIComponent(l)))},children:[(0,bn.jsxs)("div",{className:"search-box",children:[(0,bn.jsx)(On,{}),(0,bn.jsx)("input",{type:"text",value:l,onChange:e=>c(e.target.value),placeholder:"Cercar pel\xb7l\xedcules, s\xe8ries...",autoFocus:!0}),l&&(0,bn.jsx)("button",{type:"button",className:"clear-search",onClick:()=>c(""),children:"\xd7"})]}),(0,bn.jsx)("button",{type:"submit",className:"filter-btn primary",children:"Cercar"})]})]}),s&&0===u?(0,bn.jsx)("div",{className:"library-grid",children:(0,bn.jsxs)("div",{className:"empty-state",children:[(0,bn.jsx)("div",{className:"empty-icon",children:(0,bn.jsx)(On,{})}),(0,bn.jsx)("h2",{children:"No s'han trobat resultats"}),(0,bn.jsxs)("p",{children:['No hi ha contingut que coincideixi amb "',s,'"']})]})}):(0,bn.jsxs)(bn.Fragment,{children:[n.series.length>0&&(0,bn.jsxs)("div",{className:"search-section",children:[(0,bn.jsxs)("h2",{className:"section-title",children:[(0,bn.jsx)(An,{})," S\xe8ries (",n.series.length,")"]}),(0,bn.jsx)("div",{className:"library-grid",children:n.series.map(e=>(0,bn.jsx)(Nr,{item:{id:"tmdb-".concat(e.tmdb_id),tmdb_id:e.tmdb_id,name:e.name,year:e.year,poster:e.poster,rating:e.rating,is_tmdb:!0},type:"series",width:"100%",isTmdb:!0},"series-".concat(e.tmdb_id)))})]}),n.movies.length>0&&(0,bn.jsxs)("div",{className:"search-section",children:[(0,bn.jsxs)("h2",{className:"section-title",children:[(0,bn.jsx)(Ln,{})," Pel\xb7l\xedcules (",n.movies.length,")"]}),(0,bn.jsx)("div",{className:"library-grid",children:n.movies.map(e=>(0,bn.jsx)(Nr,{item:{id:"tmdb-".concat(e.tmdb_id),tmdb_id:e.tmdb_id,name:e.name,year:e.year,poster:e.poster,rating:e.rating,is_tmdb:!0},type:"movies",width:"100%",isTmdb:!0},"movie-".concat(e.tmdb_id)))})]})]})]})};fn.defaults.baseURL=mn;const oi=function(){const[e,t]=(0,i.useState)(null),[s,n]=(0,i.useState)([]),[r,a]=(0,i.useState)(!0),[o,l]=(0,i.useState)(""),[c,d]=(0,i.useState)(!1),[u,h]=(0,i.useState)(""),[f,m]=(0,i.useState)(null),[p,g]=(0,i.useState)(null),[v,y]=(0,i.useState)(!1),[b,x]=(0,i.useState)([]),[E,S]=(0,i.useState)([]),[T,k]=(0,i.useState)(1),[w,L]=(0,i.useState)(7),[C,A]=(0,i.useState)(null),[R,_]=(0,i.useState)(null),N=(0,i.useCallback)(async()=>{try{const e=await fn.get("/api/library/stats");t(e.data)}catch(e){console.error("Error carregant estad\xedstiques:",e),O("error","Error carregant estad\xedstiques")}finally{a(!1)}},[]),I=(0,i.useCallback)(async()=>{try{const e=await fn.get("/api/sync/status");g(e.data)}catch(e){console.error("Error carregant estat sync:",e)}},[]);(0,i.useEffect)(()=>{N(),D(),M(),P(),I();const e=setInterval(I,3e4);return()=>clearInterval(e)},[N,I]);const j=function(e){_({text:e,type:arguments.length>1&&void 0!==arguments[1]?arguments[1]:"success"}),setTimeout(()=>_(null),3e3)},P=async()=>{try{const[e,t]=await Promise.all([fn.get("/api/admin/users"),fn.get("/api/invitations")]);x(e.data.users||[]),S(t.data.invitations||[])}catch(Np){console.error("Error loading user data:",Np)}},D=async()=>{try{const e=await fn.get("/api/metadata/tmdb-key");d(e.data.configured)}catch(e){console.error("Error checking TMDB key:",e)}},M=async()=>{try{const e=await fn.get("/api/debrid/status");m(e.data)}catch(e){console.error("Error checking RD status:",e),m({configured:!1,valid:!1})}},O=(e,t)=>{const s=(new Date).toLocaleTimeString();n(n=>[...n,{type:e,message:t,timestamp:s}].slice(-50))},F=e=>{if(!e)return"Mai";return new Date(e).toLocaleString("ca-ES",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"})};return r?(0,bn.jsxs)("div",{className:"loading-screen",children:[(0,bn.jsx)("img",{src:"/img/hermes.png",alt:"Hermes",className:"loading-logo"}),(0,bn.jsx)("div",{className:"loading-text",children:"Carregant administraci\xf3..."})]}):(0,bn.jsxs)("div",{className:"admin-container",children:[(0,bn.jsxs)("div",{className:"admin-header",children:[(0,bn.jsxs)("h1",{children:[(0,bn.jsx)(Bn,{})," Administraci\xf3"]}),(0,bn.jsx)("p",{children:"Gestiona la teva biblioteca de streaming Hermes"})]}),(0,bn.jsxs)("div",{className:"stats-grid",children:[(0,bn.jsxs)("div",{className:"stat-card",children:[(0,bn.jsx)("div",{className:"stat-icon",children:(0,bn.jsx)(Ln,{})}),(0,bn.jsxs)("div",{className:"stat-info",children:[(0,bn.jsx)("h3",{children:(null===e||void 0===e?void 0:e.movies)||0}),(0,bn.jsx)("p",{children:"Pel\xb7l\xedcules"})]})]}),(0,bn.jsxs)("div",{className:"stat-card",children:[(0,bn.jsx)("div",{className:"stat-icon",children:(0,bn.jsx)(An,{})}),(0,bn.jsxs)("div",{className:"stat-info",children:[(0,bn.jsx)("h3",{children:(null===e||void 0===e?void 0:e.series)||0}),(0,bn.jsx)("p",{children:"S\xe8ries"})]})]}),(0,bn.jsxs)("div",{className:"stat-card",children:[(0,bn.jsx)("div",{className:"stat-icon",children:(0,bn.jsx)(nr,{})}),(0,bn.jsxs)("div",{className:"stat-info",children:[(0,bn.jsx)("h3",{children:(null===e||void 0===e?void 0:e.files)||0}),(0,bn.jsx)("p",{children:"Fitxers"})]})]}),(0,bn.jsxs)("div",{className:"stat-card",children:[(0,bn.jsx)("div",{className:"stat-icon",children:(0,bn.jsx)(Qn,{})}),(0,bn.jsxs)("div",{className:"stat-info",children:[(0,bn.jsxs)("h3",{children:[(null===e||void 0===e?void 0:e.total_hours)||0,"h"]}),(0,bn.jsx)("p",{children:"Contingut"})]})]})]}),(0,bn.jsxs)("div",{className:"admin-section sync-section",children:[(0,bn.jsxs)("div",{className:"section-header",children:[(0,bn.jsxs)("h2",{children:[(0,bn.jsx)(rr,{})," Sincronitzaci\xf3 Autom\xe0tica"]}),(0,bn.jsx)("div",{className:"sync-badge ".concat(null!==p&&void 0!==p&&p.scheduler_running?"active":"inactive"),children:null!==p&&void 0!==p&&p.scheduler_running?"Actiu":"Inactiu"})]}),(0,bn.jsxs)("div",{className:"section-content",children:[(0,bn.jsxs)("div",{className:"sync-info-grid",children:[(0,bn.jsxs)("div",{className:"sync-info-item",children:[(0,bn.jsx)("div",{className:"sync-info-icon",children:(0,bn.jsx)(ar,{})}),(0,bn.jsxs)("div",{className:"sync-info-content",children:[(0,bn.jsx)("span",{className:"sync-info-label",children:"Hora programada"}),(0,bn.jsx)("span",{className:"sync-info-value",children:(null===p||void 0===p?void 0:p.sync_time)||"02:30"})]})]}),(0,bn.jsxs)("div",{className:"sync-info-item",children:[(0,bn.jsx)("div",{className:"sync-info-icon",children:(0,bn.jsx)(Qn,{})}),(0,bn.jsxs)("div",{className:"sync-info-content",children:[(0,bn.jsx)("span",{className:"sync-info-label",children:"\xdaltima sincronitzaci\xf3"}),(0,bn.jsx)("span",{className:"sync-info-value",children:F(null===p||void 0===p?void 0:p.last_sync)})]})]}),(0,bn.jsxs)("div",{className:"sync-info-item",children:[(0,bn.jsx)("div",{className:"sync-info-icon",children:(0,bn.jsx)(or,{})}),(0,bn.jsxs)("div",{className:"sync-info-content",children:[(0,bn.jsx)("span",{className:"sync-info-label",children:"Pr\xf2xima execuci\xf3"}),(0,bn.jsx)("span",{className:"sync-info-value",children:F(null===p||void 0===p?void 0:p.next_sync)})]})]})]}),(0,bn.jsxs)("div",{className:"sync-description",children:[(0,bn.jsxs)("p",{children:["La sincronitzaci\xf3 autom\xe0tica s'executa di\xe0riament a les ",(0,bn.jsx)("strong",{children:"2:30 AM"})," i importa contingut destacat."]}),(0,bn.jsxs)("p",{style:{marginTop:"0.5rem",fontSize:"0.9rem",opacity:.8},children:["\ud83d\udca1 ",(0,bn.jsx)("strong",{children:"Nota:"})," Pots cercar i veure qualsevol contingut de TMDB en temps real des de la cerca, sense necessitat de sincronitzar."]})]}),(0,bn.jsx)("button",{className:"action-btn sync-btn",onClick:async()=>{try{y(!0),await fn.post("/api/sync/run"),O("info","Sincronitzaci\xf3 iniciada en segon pla"),j("Sincronitzaci\xf3 iniciada");const e=setInterval(async()=>{await I();(await fn.get("/api/sync/status")).data.last_sync!==(null===p||void 0===p?void 0:p.last_sync)&&(clearInterval(e),y(!1),O("success","Sincronitzaci\xf3 completada"),N())},5e3);setTimeout(()=>{clearInterval(e),y(!1)},6e5)}catch(e){y(!1),O("error","Error iniciant sincronitzaci\xf3"),j("Error iniciant sincronitzaci\xf3","error")}},disabled:v,children:v?(0,bn.jsxs)(bn.Fragment,{children:[(0,bn.jsx)(Xn,{})," Sincronitzant..."]}):(0,bn.jsxs)(bn.Fragment,{children:[(0,bn.jsx)(rr,{})," Sincronitzar ara"]})})]})]}),(0,bn.jsxs)("div",{className:"admin-section",children:[(0,bn.jsx)("div",{className:"section-header",children:(0,bn.jsxs)("h2",{children:[(0,bn.jsx)($n,{})," Configuraci\xf3 TMDB"]})}),(0,bn.jsx)("div",{className:"section-content",children:c?(0,bn.jsxs)("div",{className:"tmdb-configured",children:[(0,bn.jsx)(Jn,{}),(0,bn.jsx)("span",{children:"Clau TMDB configurada correctament"})]}):(0,bn.jsxs)("div",{className:"tmdb-config",children:[(0,bn.jsxs)("p",{style:{color:"rgba(255,255,255,0.6)",marginBottom:"1rem"},children:["Per importar pel\xb7l\xedcules i s\xe8ries necessites una clau API de ",(0,bn.jsx)("a",{href:"https://www.themoviedb.org/settings/api",target:"_blank",rel:"noopener noreferrer",style:{color:"#328492"},children:"themoviedb.org"})," (gratu\xefta)"]}),(0,bn.jsxs)("div",{style:{display:"flex",gap:"0.5rem"},children:[(0,bn.jsx)("input",{type:"text",value:o,onChange:e=>l(e.target.value),placeholder:"Introdueix la clau API...",className:"admin-input"}),(0,bn.jsx)("button",{className:"action-btn",onClick:async()=>{if(o.trim())try{await fn.post("/api/metadata/tmdb-key?api_key=".concat(encodeURIComponent(o))),d(!0),O("success","Clau TMDB guardada correctament"),l("")}catch(e){O("error","Error guardant clau TMDB")}},disabled:!o.trim(),children:"Desar"})]})]})})]}),(0,bn.jsxs)("div",{className:"admin-section",children:[(0,bn.jsx)("div",{className:"section-header",children:(0,bn.jsxs)("h2",{children:[(0,bn.jsx)($n,{})," Real-Debrid (Streaming HD)"]})}),(0,bn.jsx)("div",{className:"section-content",children:null===f?(0,bn.jsx)("div",{style:{color:"rgba(255,255,255,0.6)"},children:"Comprovant..."}):f.configured&&f.valid?(0,bn.jsxs)("div",{className:"tmdb-configured",children:[(0,bn.jsx)(Jn,{}),(0,bn.jsx)("span",{children:"Real-Debrid configurat correctament"}),(0,bn.jsx)("button",{className:"action-btn secondary",onClick:()=>m(qt(qt({},f),{},{configured:!1})),style:{marginLeft:"1rem",padding:"6px 12px",fontSize:"13px"},children:"Canviar clau"})]}):(0,bn.jsxs)("div",{className:"tmdb-config",children:[(0,bn.jsxs)("p",{style:{color:"rgba(255,255,255,0.6)",marginBottom:"1rem"},children:["Per reproduir contingut en HD directament, necessites un compte de ",(0,bn.jsx)("a",{href:"https://real-debrid.com/?id=10857509",target:"_blank",rel:"noopener noreferrer",style:{color:"#328492"},children:"Real-Debrid"})," i la seva ",(0,bn.jsx)("a",{href:"https://real-debrid.com/apitoken",target:"_blank",rel:"noopener noreferrer",style:{color:"#328492"},children:"clau API"})]}),f.configured&&!f.valid&&(0,bn.jsx)("p",{style:{color:"#e50914",marginBottom:"1rem"},children:"La clau actual no \xe9s v\xe0lida. Si us plau, introdueix una nova clau."}),(0,bn.jsxs)("div",{style:{display:"flex",gap:"0.5rem"},children:[(0,bn.jsx)("input",{type:"password",value:u,onChange:e=>h(e.target.value),placeholder:"Introdueix la clau API de Real-Debrid...",className:"admin-input"}),(0,bn.jsx)("button",{className:"action-btn",onClick:async()=>{if(u.trim())try{await fn.post("/api/debrid/configure?api_key=".concat(encodeURIComponent(u))),j("Clau Real-Debrid guardada correctament"),O("success","Real-Debrid configurat correctament"),h(""),M()}catch(s){var e,t;const n=(null===(e=s.response)||void 0===e||null===(t=e.data)||void 0===t?void 0:t.detail)||"Error guardant clau Real-Debrid";j(n,"error"),O("error",n)}},disabled:!u.trim(),children:"Desar"})]})]})})]}),(0,bn.jsxs)("div",{className:"admin-section",children:[(0,bn.jsx)("div",{className:"section-header",children:(0,bn.jsxs)("h2",{children:[(0,bn.jsx)(Zn,{})," Usuaris (",b.length,")"]})}),(0,bn.jsx)("div",{className:"section-content",children:(0,bn.jsx)("div",{className:"users-list",children:b.map(e=>{var t,s;return(0,bn.jsxs)("div",{className:"user-item ".concat(e.is_active?"":"inactive"),children:[(0,bn.jsxs)("div",{className:"user-info",children:[(0,bn.jsx)("div",{className:"user-avatar",children:(null===(t=e.display_name)||void 0===t?void 0:t.charAt(0).toUpperCase())||(null===(s=e.username)||void 0===s?void 0:s.charAt(0).toUpperCase())}),(0,bn.jsxs)("div",{children:[(0,bn.jsx)("h4",{children:e.display_name||e.username}),(0,bn.jsxs)("p",{children:["@",e.username,e.is_admin&&(0,bn.jsx)("span",{className:"admin-badge",children:"Admin"}),e.is_premium&&(0,bn.jsx)("span",{className:"premium-badge",children:"Premium"})]})]})]}),!e.is_admin&&(0,bn.jsxs)("div",{className:"user-actions",children:[(0,bn.jsx)("button",{className:"user-action-btn ".concat(e.is_active?"warning":"success"),onClick:()=>(async(e,t)=>{try{await fn.put("/api/admin/users/".concat(e,"/toggle-active?active=").concat(t)),j("Usuari ".concat(t?"activat":"desactivat")),P()}catch(Np){var s,n;j((null===(s=Np.response)||void 0===s||null===(n=s.data)||void 0===n?void 0:n.detail)||"Error","error")}})(e.id,!e.is_active),children:e.is_active?"Desactivar":"Activar"}),(0,bn.jsx)("button",{className:"user-action-btn ".concat(e.is_premium?"warning":"premium"),onClick:()=>(async(e,t)=>{try{await fn.put("/api/admin/users/".concat(e,"/toggle-premium?is_premium=").concat(t)),j("Usuari ".concat(t?"ara \xe9s":"ja no \xe9s"," premium")),P()}catch(Np){var s,n;j((null===(s=Np.response)||void 0===s||null===(n=s.data)||void 0===n?void 0:n.detail)||"Error","error")}})(e.id,!e.is_premium),children:e.is_premium?"Treure premium":"Fer premium"}),(0,bn.jsx)("button",{className:"user-action-btn danger",onClick:()=>(async e=>{if(window.confirm("Segur que vols eliminar aquest usuari?"))try{await fn.delete("/api/admin/users/".concat(e)),j("Usuari eliminat"),P()}catch(Np){var t,s;j((null===(t=Np.response)||void 0===t||null===(s=t.data)||void 0===s?void 0:s.detail)||"Error","error")}})(e.id),children:"Eliminar"})]})]},e.id)})})})]}),(0,bn.jsxs)("div",{className:"admin-section",children:[(0,bn.jsx)("div",{className:"section-header",children:(0,bn.jsxs)("h2",{children:[(0,bn.jsx)(sr,{})," Invitacions"]})}),(0,bn.jsxs)("div",{className:"section-content",children:[(0,bn.jsx)("div",{className:"invite-create",children:(0,bn.jsxs)("div",{className:"invite-inputs",children:[(0,bn.jsxs)("div",{className:"invite-field",children:[(0,bn.jsx)("label",{children:"Usos m\xe0xims"}),(0,bn.jsx)("input",{type:"number",min:"1",max:"100",value:T,onChange:e=>k(parseInt(e.target.value))})]}),(0,bn.jsxs)("div",{className:"invite-field",children:[(0,bn.jsx)("label",{children:"Dies de validesa"}),(0,bn.jsx)("input",{type:"number",min:"1",max:"365",value:w,onChange:e=>L(parseInt(e.target.value))})]}),(0,bn.jsx)("button",{className:"action-btn",onClick:async()=>{try{await fn.post("/api/invitations",{max_uses:T,expires_days:w}),j("Invitaci\xf3 creada"),O("success","Nova invitaci\xf3 creada"),P()}catch(Np){var e,t;j((null===(e=Np.response)||void 0===e||null===(t=e.data)||void 0===t?void 0:t.detail)||"Error creant invitaci\xf3","error")}},children:"Crear invitaci\xf3"})]})}),E.length>0&&(0,bn.jsx)("div",{className:"invite-list",children:E.map(e=>(0,bn.jsxs)("div",{className:"invite-item",children:[(0,bn.jsxs)("div",{className:"invite-code",children:[(0,bn.jsx)("code",{children:e.code}),(0,bn.jsx)("button",{className:"copy-btn",onClick:()=>(e=>{const t="".concat(window.location.origin,"/login?invite=").concat(e);navigator.clipboard.writeText(t),A(e),setTimeout(()=>A(null),2e3)})(e.code),title:"Copiar enlla\xe7 d'invitaci\xf3",children:C===e.code?(0,bn.jsx)(Jn,{}):(0,bn.jsx)(er,{})})]}),(0,bn.jsxs)("div",{className:"invite-meta",children:[(0,bn.jsxs)("span",{children:[e.uses,"/",e.max_uses," usos"]}),(0,bn.jsxs)("span",{children:["Caduca: ",new Date(e.expires_at).toLocaleDateString("ca")]})]}),(0,bn.jsx)("button",{className:"delete-btn",onClick:()=>(async e=>{try{await fn.delete("/api/invitations/".concat(e)),j("Invitaci\xf3 eliminada"),P()}catch(Np){j("Error eliminant invitaci\xf3","error")}})(e.id),children:(0,bn.jsx)(tr,{})})]},e.id))}),0===E.length&&(0,bn.jsx)("div",{className:"empty-state",children:"No hi ha invitacions actives"})]})]}),(0,bn.jsxs)("div",{className:"admin-section",children:[(0,bn.jsxs)("div",{className:"section-header",children:[(0,bn.jsxs)("h2",{children:[(0,bn.jsx)(lr,{})," Registre d'Activitat"]}),(0,bn.jsx)("button",{className:"action-btn secondary",onClick:()=>n([]),style:{padding:"8px 15px",fontSize:"14px"},children:"Netejar"})]}),(0,bn.jsx)("div",{className:"section-content",children:(0,bn.jsx)("div",{className:"logs-container",children:0===s.length?(0,bn.jsx)("div",{className:"empty-state",children:"No hi ha activitat recent"}):s.map((e,t)=>(0,bn.jsxs)("div",{className:"log-entry ".concat(e.type),children:[(0,bn.jsxs)("span",{className:"log-time",children:["[",e.timestamp,"]"]}),(0,bn.jsx)("span",{className:"log-message",children:e.message})]},t))})})]}),(0,bn.jsxs)("div",{className:"admin-section",children:[(0,bn.jsx)("div",{className:"section-header",children:(0,bn.jsxs)("h2",{children:[(0,bn.jsx)(ir,{})," Informaci\xf3 del Sistema"]})}),(0,bn.jsx)("div",{className:"section-content",children:(0,bn.jsxs)("div",{className:"system-info-grid",children:[(0,bn.jsxs)("div",{className:"system-info-item",children:[(0,bn.jsx)("span",{className:"system-label",children:"Versi\xf3"}),(0,bn.jsx)("span",{className:"system-value",children:"Hermes 1.0.0"})]}),(0,bn.jsxs)("div",{className:"system-info-item",children:[(0,bn.jsx)("span",{className:"system-label",children:"API TMDB"}),(0,bn.jsx)("span",{className:"system-value ".concat(c?"status-ok":"status-error"),children:c?"Configurada":"No configurada"})]}),(0,bn.jsxs)("div",{className:"system-info-item",children:[(0,bn.jsx)("span",{className:"system-label",children:"Real-Debrid"}),(0,bn.jsx)("span",{className:"system-value ".concat(null!==f&&void 0!==f&&f.configured&&null!==f&&void 0!==f&&f.valid?"status-ok":"status-error"),children:null!==f&&void 0!==f&&f.configured&&null!==f&&void 0!==f&&f.valid?"Actiu":"No configurat"})]}),(0,bn.jsxs)("div",{className:"system-info-item",children:[(0,bn.jsx)("span",{className:"system-label",children:"Scheduler"}),(0,bn.jsx)("span",{className:"system-value ".concat(null!==p&&void 0!==p&&p.scheduler_running?"status-ok":"status-error"),children:null!==p&&void 0!==p&&p.scheduler_running?"Actiu":"Inactiu"})]}),(0,bn.jsxs)("div",{className:"system-info-item",children:[(0,bn.jsx)("span",{className:"system-label",children:"Usuaris"}),(0,bn.jsx)("span",{className:"system-value",children:b.length})]})]})})]}),R&&(0,bn.jsx)("div",{className:"admin-toast ".concat(R.type),children:R.text})]})};fn.defaults.baseURL=mn;const li={book:"Llibres",manga:"Mangas",comic:"C\xf2mics"};const ci=function(){const[e,t]=(0,i.useState)([]),[s,n]=(0,i.useState)([]),[r,a]=(0,i.useState)(null),[o,l]=(0,i.useState)(!0),[c,d]=(0,i.useState)("authors"),u=re(),{isAdmin:h}=Sn(),{getBooks:f,booksCache:m,invalidateCache:p}=wn(),[g,v]=(0,i.useState)(["book"]),[y,b]=(0,i.useState)(""),[x,E]=(0,i.useState)([]),[S,T]=(0,i.useState)(!1),[k,w]=(0,i.useState)({}),[L,C]=(0,i.useState)({}),[A,R]=(0,i.useState)(!1),[_,N]=(0,i.useState)(null),[I,j]=(0,i.useState)("isbn"),[P,D]=(0,i.useState)(""),[M,O]=(0,i.useState)(""),[F,U]=(0,i.useState)(""),[B,G]=(0,i.useState)([]),[V,z]=(0,i.useState)(!1),[H,K]=(0,i.useState)(null),[W,q]=(0,i.useState)(null);(0,i.useEffect)(()=>{if(m.data){const e=m.data.filter(e=>g.includes(e.content_type||"book"));n(e),l(!1)}X(),Q()},[]),(0,i.useEffect)(()=>{Q()},[g]);const Y=(0,i.useCallback)(async e=>{if(e.trim()){T(!0);try{const t=await fn.post("/api/import/search",{query:e.trim(),media_type:"book"}),n=s.map(e=>{var t;return null===(t=e.title)||void 0===t?void 0:t.toLowerCase()}),r=t.data.results.filter(e=>{var t;return!n.includes(null===(t=e.title)||void 0===t?void 0:t.toLowerCase())});E(r)}catch(t){console.error("Error cercant externament:",t),E([])}finally{T(!1)}}},[s]);(0,i.useEffect)(()=>{if(!y.trim())return void E([]);const e=setTimeout(()=>{Y(y)},500);return()=>clearTimeout(e)},[y,Y]);const X=async()=>{try{const e=await fn.get("/api/books/authors");t(e.data)}catch(e){console.error("Error carregant autors:",e)}finally{l(!1)}},Q=async()=>{try{const e=g.length>0?g.join(","):null,t=e?{content_type:e}:{},s=await fn.get("/api/books",{params:t});n(s.data)}catch(e){console.error("Error carregant llibres:",e)}},$=async e=>{try{const t=await fn.get("/api/books/authors/".concat(e));a(t.data)}catch(t){console.error("Error carregant llibres de l'autor:",t)}},J=async(e,t)=>{null===t||void 0===t||t.stopPropagation();const s=e.id||e.title;w(e=>qt(qt({},e),{},{[s]:!0}));try{var n;await fn.post("/api/import/book",{title:e.title,author:e.author,olid:null===(n=e.id)||void 0===n?void 0:n.replace("/works/","")}),C(e=>qt(qt({},e),{},{[s]:!0})),E(e=>e.filter(e=>(e.id||e.title)!==s)),p("books"),X(),Q()}catch(r){console.error("Error important:",r)}finally{w(e=>qt(qt({},e),{},{[s]:!1}))}},Z=async()=>{if(0===x.length)return;R(!0);const e=[...x];for(const n of e){const e=n.id||n.title;w(t=>qt(qt({},t),{},{[e]:!0}));try{var t;await fn.post("/api/import/book",{title:n.title,author:n.author,olid:null===(t=n.id)||void 0===t?void 0:t.replace("/works/","")}),C(t=>qt(qt({},t),{},{[e]:!0})),E(t=>t.filter(t=>(t.id||t.title)!==e))}catch(s){console.error("Error important ".concat(n.title,":"),s)}finally{w(t=>qt(qt({},t),{},{[e]:!1}))}}p("books"),X(),Q(),R(!1)},ee=()=>{a(null)},te=e=>{u("/read/".concat(e.id))},se=e=>{d(e),a(null)},ne=y.trim()?e.filter(e=>{var t;return null===(t=e.name)||void 0===t?void 0:t.toLowerCase().includes(y.toLowerCase())}):e,ie=y.trim()?s.filter(e=>{var t,s;return(null===(t=e.title)||void 0===t?void 0:t.toLowerCase().includes(y.toLowerCase()))||(null===(s=e.author_name)||void 0===s?void 0:s.toLowerCase().includes(y.toLowerCase()))}):s,ae=(e,t)=>{e.stopPropagation(),N(t),j("isbn"),D(""),O(""),U(""),G([]),K(null)},oe=()=>{N(null),K(null)},le=async()=>{if(F.trim()){z(!0),K(null),G([]);try{const e=await fn.post("/api/metadata/books/search",{title:F});e.data.results&&e.data.results.length>0?G(e.data.results):K({type:"error",text:"No s'han trobat resultats"})}catch(e){K({type:"error",text:"Error cercant llibres"})}finally{z(!1)}}else K({type:"error",text:"Introdueix un t\xedtol per cercar"})},ce=e=>e.cover?"".concat(mn,"/api/books/").concat(e.id,"/cover"):null,de=e=>{switch(null===e||void 0===e?void 0:e.toLowerCase()){case"epub":return(0,bn.jsx)(vr,{});case"pdf":return(0,bn.jsx)(yr,{});case"mobi":case"azw":case"azw3":return(0,bn.jsx)(br,{});default:return(0,bn.jsx)(Rn,{})}};if(o)return(0,bn.jsxs)("div",{className:"loading-screen",children:[(0,bn.jsx)("img",{src:"/img/hermes.png",alt:"Hermes",className:"loading-logo"}),(0,bn.jsx)("div",{className:"loading-text",children:"Carregant biblioteca..."})]});var ue,he;if(r)return(0,bn.jsxs)("div",{className:"library-container",children:[(0,bn.jsx)("div",{className:"library-header",children:(0,bn.jsxs)("div",{className:"library-title",children:[(0,bn.jsxs)("button",{className:"back-btn",onClick:ee,children:[(0,bn.jsx)(pr,{})," Tornar"]}),(0,bn.jsx)("span",{className:"icon",children:(0,bn.jsx)(gr,{})}),(0,bn.jsx)("h1",{children:r.name}),(0,bn.jsxs)("span",{className:"library-count",children:["(",(null===(ue=r.books)||void 0===ue?void 0:ue.length)||0," llibres)"]})]})}),(0,bn.jsx)("div",{className:"books-grid",children:null===(he=r.books)||void 0===he?void 0:he.map(e=>{var t;return(0,bn.jsxs)("div",{className:"book-card",onClick:()=>te(e),children:[(0,bn.jsxs)("div",{className:"book-cover",children:[ce(e)?(0,bn.jsx)("img",{src:ce(e),alt:e.title}):(0,bn.jsx)("div",{className:"book-cover-placeholder",children:(0,bn.jsx)("span",{className:"format-icon",children:de(e.format)})}),(0,bn.jsx)("div",{className:"book-format-badge",children:(null===(t=e.format)||void 0===t?void 0:t.toUpperCase())||"BOOK"}),h&&(0,bn.jsx)("button",{className:"book-edit-btn",onClick:t=>ae(t,e),title:"Editar metadades",children:(0,bn.jsx)(Dn,{size:14})})]}),(0,bn.jsxs)("div",{className:"book-info",children:[(0,bn.jsx)("h3",{className:"book-title",children:e.title}),e.reading_progress&&e.reading_progress.percentage>0&&(0,bn.jsx)("div",{className:"reading-progress-bar",children:(0,bn.jsx)("div",{className:"progress-fill",style:{width:"".concat(e.reading_progress.percentage,"%")}})})]})]},e.id)})})]});const fe=("authors"===c?ne.length>0:ie.length>0)||x.length>0;return(0,bn.jsxs)("div",{className:"library-container",children:[(0,bn.jsxs)("div",{className:"library-header",children:[(0,bn.jsxs)("div",{className:"library-title-row",children:[(0,bn.jsxs)("div",{className:"library-title",children:[(0,bn.jsx)("span",{className:"icon",children:(0,bn.jsx)(Rn,{})}),(0,bn.jsx)("h1",{children:"Biblioteca"}),(0,bn.jsxs)("span",{className:"library-count",children:["(","authors"===c?e.length+" autors":s.length+" llibres",")"]})]}),(0,bn.jsx)("div",{className:"content-type-toggles",children:Object.entries(li).map(e=>{let[t,s]=e;return(0,bn.jsx)("button",{className:"content-type-toggle ".concat(g.includes(t)?"active":""),onClick:()=>{return e=t,void v(t=>t.includes(e)?1===t.length?t:t.filter(t=>t!==e):[...t,e]);var e},children:s},t)})})]}),(0,bn.jsxs)("div",{className:"library-filters",children:[(0,bn.jsxs)("div",{className:"search-box",children:[(0,bn.jsx)(On,{}),(0,bn.jsx)("input",{type:"text",placeholder:"Cerca llibres...",value:y,onChange:e=>b(e.target.value)}),y&&(0,bn.jsx)("button",{className:"clear-search",onClick:()=>{b(""),E([])},children:(0,bn.jsx)(qn,{})}),S&&(0,bn.jsx)("div",{className:"search-spinner"})]}),(0,bn.jsxs)("div",{className:"view-toggle",children:[(0,bn.jsx)("button",{className:"authors"===c?"active":"",onClick:()=>se("authors"),children:"Per Autor"}),(0,bn.jsx)("button",{className:"all"===c?"active":"",onClick:()=>se("all"),children:"Tots els Llibres"})]})]})]}),fe||y?!fe&&y?(0,bn.jsxs)("div",{className:"empty-state",children:[(0,bn.jsx)("div",{className:"empty-icon",children:(0,bn.jsx)(On,{})}),(0,bn.jsx)("h2",{children:"Sense resultats"}),(0,bn.jsxs)("p",{children:["No s'han trobat llibres per \"",y,'"']})]}):"authors"===c?(0,bn.jsxs)(bn.Fragment,{children:[ne.length>0&&(0,bn.jsx)("div",{className:"authors-grid",children:ne.map(e=>(0,bn.jsxs)("div",{className:"author-card",onClick:()=>(e=>{$(e.id)})(e),children:[(0,bn.jsx)("div",{className:"author-avatar",children:e.photo?(0,bn.jsx)("img",{src:e.photo,alt:e.name}):(0,bn.jsx)(gr,{})}),(0,bn.jsxs)("div",{className:"author-info",children:[(0,bn.jsx)("h3",{children:e.name}),(0,bn.jsxs)("span",{className:"book-count",children:[e.book_count," llibres"]})]})]},e.id))}),x.length>0&&(0,bn.jsxs)(bn.Fragment,{children:[(0,bn.jsxs)("div",{className:"add-all-bar",children:[(0,bn.jsxs)("span",{children:[x.length," resultats d'OpenLibrary"]}),(0,bn.jsx)("button",{className:"add-all-btn",onClick:Z,disabled:A,children:A?(0,bn.jsxs)(bn.Fragment,{children:[(0,bn.jsx)("div",{className:"btn-spinner"}),"Important..."]}):(0,bn.jsxs)(bn.Fragment,{children:[(0,bn.jsx)(ur,{}),"Afegir tots"]})})]}),(0,bn.jsx)("div",{className:"library-grid",children:x.map(e=>{const t=e.id||e.title;return(0,bn.jsxs)("div",{className:"media-card external-card",onClick:()=>e.id&&window.open("https://openlibrary.org".concat(e.id),"_blank"),children:[(0,bn.jsxs)("div",{className:"media-poster",children:[e.poster?(0,bn.jsx)("img",{src:e.poster,alt:e.title}):(0,bn.jsx)("div",{className:"no-poster-placeholder",children:(0,bn.jsx)(Rn,{})}),(0,bn.jsx)("div",{className:"external-badge",children:"OpenLibrary"}),(0,bn.jsx)("button",{className:"add-btn ".concat(L[t]?"added":""),onClick:t=>J(e,t),disabled:k[t]||L[t],title:"Afegir a la biblioteca",children:k[t]?(0,bn.jsx)("div",{className:"btn-spinner"}):L[t]?(0,bn.jsx)(Jn,{}):(0,bn.jsx)(ur,{})})]}),(0,bn.jsxs)("div",{className:"media-info",children:[(0,bn.jsx)("h3",{className:"media-title",children:e.title}),(0,bn.jsxs)("div",{className:"media-meta",children:[e.author&&(0,bn.jsx)("span",{children:e.author}),e.year&&(0,bn.jsxs)("span",{children:["(",e.year,")"]})]})]})]},"ol-".concat(t))})})]})]}):(0,bn.jsxs)(bn.Fragment,{children:[x.length>0&&(0,bn.jsxs)("div",{className:"add-all-bar",children:[(0,bn.jsxs)("span",{children:[x.length," resultats d'OpenLibrary"]}),(0,bn.jsx)("button",{className:"add-all-btn",onClick:Z,disabled:A,children:A?(0,bn.jsxs)(bn.Fragment,{children:[(0,bn.jsx)("div",{className:"btn-spinner"}),"Important..."]}):(0,bn.jsxs)(bn.Fragment,{children:[(0,bn.jsx)(ur,{}),"Afegir tots"]})})]}),(0,bn.jsxs)("div",{className:"library-grid",children:[ie.map(e=>{var t;return(0,bn.jsxs)("div",{className:"book-card",onClick:()=>te(e),children:[(0,bn.jsxs)("div",{className:"book-cover",children:[ce(e)?(0,bn.jsx)("img",{src:ce(e),alt:e.title}):(0,bn.jsx)("div",{className:"book-cover-placeholder",children:(0,bn.jsx)("span",{className:"format-icon",children:de(e.format)})}),(0,bn.jsx)("div",{className:"book-format-badge",children:(null===(t=e.format)||void 0===t?void 0:t.toUpperCase())||"BOOK"}),h&&(0,bn.jsx)("button",{className:"book-edit-btn",onClick:t=>ae(t,e),title:"Editar metadades",children:(0,bn.jsx)(Dn,{size:14})})]}),(0,bn.jsxs)("div",{className:"book-info",children:[(0,bn.jsx)("h3",{className:"book-title",children:e.title}),(0,bn.jsx)("p",{className:"book-author",children:e.author_name})]})]},e.id)}),x.map(e=>{const t=e.id||e.title;return(0,bn.jsxs)("div",{className:"media-card external-card",onClick:()=>e.id&&window.open("https://openlibrary.org".concat(e.id),"_blank"),children:[(0,bn.jsxs)("div",{className:"media-poster",children:[e.poster?(0,bn.jsx)("img",{src:e.poster,alt:e.title}):(0,bn.jsx)("div",{className:"no-poster-placeholder",children:(0,bn.jsx)(Rn,{})}),(0,bn.jsx)("div",{className:"external-badge",children:"OpenLibrary"}),(0,bn.jsx)("button",{className:"add-btn ".concat(L[t]?"added":""),onClick:t=>J(e,t),disabled:k[t]||L[t],title:"Afegir a la biblioteca",children:k[t]?(0,bn.jsx)("div",{className:"btn-spinner"}):L[t]?(0,bn.jsx)(Jn,{}):(0,bn.jsx)(ur,{})})]}),(0,bn.jsxs)("div",{className:"media-info",children:[(0,bn.jsx)("h3",{className:"media-title",children:e.title}),(0,bn.jsxs)("div",{className:"media-meta",children:[e.author&&(0,bn.jsx)("span",{children:e.author}),e.year&&(0,bn.jsxs)("span",{children:["(",e.year,")"]})]})]})]},"ol-".concat(t))})]})]}):(0,bn.jsxs)("div",{className:"empty-state",children:[(0,bn.jsx)("div",{className:"empty-icon",children:(0,bn.jsx)(Rn,{})}),(0,bn.jsx)("h2",{children:"No hi ha llibres"}),(0,bn.jsx)("p",{children:"Cerca llibres per afegir-los a la biblioteca"})]}),_&&h&&(0,bn.jsx)("div",{className:"metadata-modal-overlay",onClick:oe,children:(0,bn.jsxs)("div",{className:"metadata-modal",onClick:e=>e.stopPropagation(),children:[(0,bn.jsxs)("div",{className:"metadata-modal-header",children:[(0,bn.jsx)("h2",{children:"Editar metadades"}),(0,bn.jsx)("button",{className:"close-btn",onClick:oe,"aria-label":"Tancar",children:(0,bn.jsx)(qn,{})})]}),(0,bn.jsx)("p",{className:"metadata-book-title",children:_.title}),(0,bn.jsxs)("div",{className:"metadata-tabs",children:[(0,bn.jsx)("button",{className:"isbn"===I?"active":"",onClick:()=>j("isbn"),children:"ISBN"}),(0,bn.jsx)("button",{className:"olid"===I?"active":"",onClick:()=>j("olid"),children:"Open Library ID"}),(0,bn.jsx)("button",{className:"search"===I?"active":"",onClick:()=>j("search"),children:"Cercar"}),(0,bn.jsx)("button",{className:"upload"===I?"active":"",onClick:()=>{j("upload"),q(null)},children:"Pujar"})]}),(0,bn.jsxs)("div",{className:"metadata-content",children:["isbn"===I&&(0,bn.jsxs)("div",{className:"metadata-form",children:[(0,bn.jsx)("label",{children:"Introdueix l'ISBN del llibre:"}),(0,bn.jsxs)("div",{className:"input-row",children:[(0,bn.jsx)("input",{type:"text",value:P,onChange:e=>D(e.target.value),placeholder:"Ex: 978-84-376-0494-7",disabled:V}),(0,bn.jsx)("button",{onClick:async()=>{if(P.trim()){z(!0),K(null);try{const e=await fn.post("/api/metadata/books/".concat(_.id,"/update-by-isbn"),{isbn:P});"success"===e.data.status&&(K({type:"success",text:'Portada actualitzada per "'.concat(e.data.title||_.title,'"')}),r&&$(r.id),p("books"),Q(),setTimeout(()=>oe(),1500))}catch(s){var e,t;K({type:"error",text:(null===(e=s.response)||void 0===e||null===(t=e.data)||void 0===t?void 0:t.detail)||"Error actualitzant metadades"})}finally{z(!1)}}else K({type:"error",text:"Introdueix un ISBN"})},disabled:V,children:V?"Actualitzant...":"Actualitzar"})]}),(0,bn.jsx)("small",{children:"Pots trobar l'ISBN a la contraportada del llibre o a la p\xe0gina de cr\xe8dits"})]}),"olid"===I&&(0,bn.jsxs)("div",{className:"metadata-form",children:[(0,bn.jsx)("label",{children:"Introdueix l'Open Library Work ID:"}),(0,bn.jsxs)("div",{className:"input-row",children:[(0,bn.jsx)("input",{type:"text",value:M,onChange:e=>O(e.target.value),placeholder:"Ex: OL45804W",disabled:V}),(0,bn.jsx)("button",{onClick:async()=>{if(M.trim()){z(!0),K(null);try{const e=await fn.post("/api/metadata/books/".concat(_.id,"/update-by-olid"),{olid:M});"success"===e.data.status&&(K({type:"success",text:'Portada actualitzada per "'.concat(e.data.title||_.title,'"')}),r&&$(r.id),p("books"),Q(),setTimeout(()=>oe(),1500))}catch(s){var e,t;K({type:"error",text:(null===(e=s.response)||void 0===e||null===(t=e.data)||void 0===t?void 0:t.detail)||"Error actualitzant metadades"})}finally{z(!1)}}else K({type:"error",text:"Introdueix un Open Library ID"})},disabled:V,children:V?"Actualitzant...":"Actualitzar"})]}),(0,bn.jsxs)("small",{children:["Cerca a ",(0,bn.jsx)("a",{href:"https://openlibrary.org",target:"_blank",rel:"noopener noreferrer",children:"openlibrary.org"})," i copia l'ID de l'URL"]})]}),"search"===I&&(0,bn.jsxs)("div",{className:"metadata-form",children:[(0,bn.jsx)("label",{children:"Cerca per t\xedtol:"}),(0,bn.jsxs)("div",{className:"input-row",children:[(0,bn.jsx)("input",{type:"text",value:F,onChange:e=>U(e.target.value),placeholder:"T\xedtol del llibre...",disabled:V,onKeyPress:e=>"Enter"===e.key&&le()}),(0,bn.jsxs)("button",{onClick:le,disabled:V,children:[(0,bn.jsx)(On,{})," Cercar"]})]}),B.length>0&&(0,bn.jsx)("div",{className:"search-results",children:B.map((e,t)=>(0,bn.jsxs)("div",{className:"search-result ".concat(e.cover_id?"":"no-cover"),onClick:()=>(async e=>{if(e.cover_id){z(!0),K(null);try{"success"===(await fn.post("/api/metadata/books/".concat(_.id,"/update-by-search-result?cover_id=").concat(e.cover_id))).data.status&&(K({type:"success",text:"Portada actualitzada!"}),r&&$(r.id),p("books"),Q(),setTimeout(()=>oe(),1500))}catch(n){var t,s;K({type:"error",text:(null===(t=n.response)||void 0===t||null===(s=t.data)||void 0===s?void 0:s.detail)||"Error actualitzant portada"})}finally{z(!1)}}else K({type:"error",text:"Aquest llibre no t\xe9 portada disponible"})})(e),children:[(0,bn.jsx)("div",{className:"result-cover",children:e.cover_id?(0,bn.jsx)("img",{src:"https://covers.openlibrary.org/b/id/".concat(e.cover_id,"-S.jpg"),alt:e.title}):(0,bn.jsx)("div",{className:"no-cover-placeholder",children:(0,bn.jsx)(Rn,{})})}),(0,bn.jsxs)("div",{className:"result-info",children:[(0,bn.jsx)("strong",{children:e.title}),e.author&&(0,bn.jsx)("span",{children:e.author}),e.year&&(0,bn.jsxs)("span",{children:["(",e.year,")"]})]})]},e.key||e.cover_id||"result-".concat(t)))})]}),"upload"===I&&(0,bn.jsxs)("div",{className:"metadata-form",children:[(0,bn.jsx)("label",{children:"Puja una imatge de portada:"}),(0,bn.jsxs)("div",{className:"upload-area",children:[(0,bn.jsx)("input",{type:"file",accept:"image/*",onChange:e=>{const t=e.target.files[0];if(t){if(!t.type.startsWith("image/"))return void K({type:"error",text:"El fitxer ha de ser una imatge"});const e=new FileReader;e.onload=e=>{q({file:t,preview:e.target.result})},e.readAsDataURL(t)}},disabled:V,id:"cover-upload",style:{display:"none"}}),(0,bn.jsx)("label",{htmlFor:"cover-upload",className:"upload-btn",children:"Seleccionar imatge"}),W&&(0,bn.jsxs)("div",{className:"upload-preview",children:[(0,bn.jsx)("img",{src:W.preview,alt:"Preview"}),(0,bn.jsx)("button",{onClick:async()=>{if(null!==W&&void 0!==W&&W.file){z(!0),K(null);try{const e=new FormData;e.append("file",W.file);"success"===(await fn.post("/api/metadata/books/".concat(_.id,"/upload-cover"),e,{headers:{"Content-Type":"multipart/form-data"}})).data.status&&(K({type:"success",text:"Portada pujada correctament!"}),r&&$(r.id),p("books"),Q(),q(null),setTimeout(()=>oe(),1500))}catch(s){var e,t;K({type:"error",text:(null===(e=s.response)||void 0===e||null===(t=e.data)||void 0===t?void 0:t.detail)||"Error pujant portada"})}finally{z(!1)}}},disabled:V,children:V?"Pujant...":"Pujar portada"})]})]}),(0,bn.jsx)("small",{children:"Formats suportats: JPG, PNG, WebP. La imatge es guardar\xe0 a la carpeta del llibre."})]}),H&&(0,bn.jsx)("div",{className:"metadata-message ".concat(H.type),children:H.text})]})]})})]})};fn.defaults.baseURL=mn;const di=()=>(0,bn.jsx)("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:(0,bn.jsx)("polyline",{points:"15 18 9 12 15 6"})}),ui=()=>(0,bn.jsxs)("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[(0,bn.jsx)("line",{x1:"3",y1:"12",x2:"21",y2:"12"}),(0,bn.jsx)("line",{x1:"3",y1:"6",x2:"21",y2:"6"}),(0,bn.jsx)("line",{x1:"3",y1:"18",x2:"21",y2:"18"})]}),hi=()=>(0,bn.jsxs)("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[(0,bn.jsx)("circle",{cx:"12",cy:"12",r:"3"}),(0,bn.jsx)("path",{d:"M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"})]}),fi=e=>{let{filled:t}=e;return(0,bn.jsx)("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:t?"currentColor":"none",stroke:"currentColor",strokeWidth:"2",children:(0,bn.jsx)("path",{d:"M19 21l-7-5-7 5V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2z"})})},mi=()=>(0,bn.jsx)("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:(0,bn.jsx)("polyline",{points:"15 18 9 12 15 6"})}),pi=()=>(0,bn.jsx)("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:(0,bn.jsx)("polyline",{points:"9 18 15 12 9 6"})}),gi=()=>(0,bn.jsxs)("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[(0,bn.jsx)("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),(0,bn.jsx)("line",{x1:"6",y1:"6",x2:"18",y2:"18"})]}),vi={light:{name:"Clar",bg:"#ffffff",text:"#1a1a1a",accent:"#0066cc"},sepia:{name:"Sepia",bg:"#f4ecd8",text:"#5c4b37",accent:"#8b6914"},dark:{name:"Fosc",bg:"#1a1a1a",text:"#e0e0e0",accent:"#6eb5ff"},black:{name:"Negre",bg:"#000000",text:"#cccccc",accent:"#6eb5ff"}},yi={serif:{name:"Serif",family:'Georgia, "Times New Roman", serif'},sansSerif:{name:"Sans Serif",family:'-apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif'},bookerly:{name:"Bookerly",family:'"Bookerly", Georgia, serif'},openDyslexic:{name:"OpenDyslexic",family:'"OpenDyslexic", sans-serif'}};const bi=function(){var e,t,s,n,r,a,o,l,c,d;const{id:u}=ie(),h=re(),[f,m]=(0,i.useState)(null),[p,g]=(0,i.useState)(null),[v,y]=(0,i.useState)(!0),[b,x]=(0,i.useState)(null),[E,S]=(0,i.useState)(!0),[T,k]=(0,i.useState)(!1),[w,L]=(0,i.useState)(!1),[C,A]=(0,i.useState)(0),[R,_]=(0,i.useState)(""),[N,I]=(0,i.useState)(()=>localStorage.getItem("reader_theme")||"sepia"),[j,P]=(0,i.useState)(()=>parseInt(localStorage.getItem("reader_fontSize"))||18),[D,M]=(0,i.useState)(()=>localStorage.getItem("reader_fontFamily")||"serif"),[O,F]=(0,i.useState)(()=>parseFloat(localStorage.getItem("reader_lineHeight"))||1.8),[U,B]=(0,i.useState)(()=>localStorage.getItem("reader_textAlign")||"justify"),[G,V]=(0,i.useState)(()=>parseInt(localStorage.getItem("reader_margins"))||60),[z,H]=(0,i.useState)([]),[K,W]=(0,i.useState)(!1),[q,Y]=(0,i.useState)(null),X=(0,i.useRef)(null);(0,i.useRef)(null),(0,i.useEffect)(()=>{localStorage.setItem("reader_theme",N),localStorage.setItem("reader_fontSize",j.toString()),localStorage.setItem("reader_fontFamily",D),localStorage.setItem("reader_lineHeight",O.toString()),localStorage.setItem("reader_textAlign",U),localStorage.setItem("reader_margins",G.toString())},[N,j,D,O,U,G]);const Q=(0,i.useCallback)(async()=>{try{const e=localStorage.getItem("bookmarks_".concat(u));e&&H(JSON.parse(e))}catch(e){H([])}},[u]),$=(0,i.useCallback)(()=>{const e=[...z],t=e.findIndex(e=>e.chapter===C);var s,n,r;t>=0?(e.splice(t,1),W(!1)):(e.push({chapter:C,chapterTitle:(null===p||void 0===p||null===(s=p.content)||void 0===s||null===(n=s.spine)||void 0===n||null===(r=n[C])||void 0===r?void 0:r.title)||"Capitol ".concat(C+1),date:(new Date).toISOString()}),W(!0));H(e),localStorage.setItem("bookmarks_".concat(u),JSON.stringify(e))},[z,C,p,u]),J=(0,i.useCallback)(e=>{if(!e)return null;const t=document.createElement("div");t.innerHTML=e;const s=(t.textContent||t.innerText).trim().split(/\s+/).length;return Math.ceil(s/200)},[]),Z=(0,i.useCallback)(async()=>{try{y(!0);const t=await fn.get("/api/books/".concat(u));m(t.data);const s=await fn.get("/api/books/".concat(u,"/content"));g(s.data),"epub"===s.data.type&&ee(0,s.data.content);try{const e=await fn.get("/api/books/".concat(u,"/progress"));e.data.current_page&&A(e.data.current_page)}catch(e){}Q()}catch(t){console.error("Error carregant llibre:",t),x("Error carregant el llibre")}finally{y(!1)}},[u,Q]);(0,i.useEffect)(()=>{Z()},[Z]);const ee=(0,i.useCallback)(async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null===p||void 0===p?void 0:p.content;if(t&&t.spine&&t.spine[e])try{const s=t.spine[e].href;let n=(await fn.get("/api/books/".concat(u,"/resource/").concat(s),{responseType:"text"})).data;n=n.replace(/src="([^"]+)"/g,(e,t)=>t.startsWith("http")?e:'src="'.concat(mn,"/api/books/").concat(u,"/resource/").concat(t,'"')),n=n.replace(/href="([^"]+\.css)"/g,(e,t)=>'href="'.concat(mn,"/api/books/").concat(u,"/resource/").concat(t,'"')),_(n),A(e),Y(J(n)),W(z.some(t=>t.chapter===e)),te(e),X.current&&(X.current.scrollTop=0)}catch(s){console.error("Error carregant cap\xedtol:",s)}},[u,p,J,z]),te=async e=>{try{var t,s;await fn.post("/api/books/".concat(u,"/progress"),{position:"chapter:".concat(e),page:e,total_pages:(null===p||void 0===p||null===(t=p.content)||void 0===t||null===(s=t.spine)||void 0===s?void 0:s.length)||0})}catch(n){console.error("Error guardant progr\xe9s:",n)}},se=(0,i.useCallback)(()=>{var e;null!==p&&void 0!==p&&null!==(e=p.content)&&void 0!==e&&e.spine&&C<p.content.spine.length-1&&ee(C+1)},[p,C,ee]),ne=(0,i.useCallback)(()=>{C>0&&ee(C-1)},[C,ee]),ae=(0,i.useCallback)(e=>{switch(e.key){case"ArrowRight":case"PageDown":se();break;case"ArrowLeft":case"PageUp":ne();break;case"Escape":h("/books");break;case"t":k(e=>!e)}},[se,ne,h]);(0,i.useEffect)(()=>(window.addEventListener("keydown",ae),()=>window.removeEventListener("keydown",ae)),[ae]);const oe=(0,i.useRef)({x:0,y:0}),le=vi[N]||vi.sepia,ce=yi[D]||yi.serif;return"pdf"===(null===p||void 0===p?void 0:p.type)?(0,bn.jsxs)("div",{className:"book-reader",style:{backgroundColor:le.bg},children:[(0,bn.jsxs)("div",{className:"reader-header visible",style:{backgroundColor:le.bg,color:le.text},children:[(0,bn.jsx)("button",{className:"icon-btn",onClick:()=>h("/books"),children:(0,bn.jsx)(di,{})}),(0,bn.jsx)("h1",{children:null===f||void 0===f?void 0:f.title})]}),(0,bn.jsx)("iframe",{src:"".concat(mn,"/api/books/").concat(u,"/file#view=FitH"),title:null===f||void 0===f?void 0:f.title,className:"pdf-viewer"})]}):v?(0,bn.jsxs)("div",{className:"loading-screen",style:{backgroundColor:le.bg,color:le.text},children:[(0,bn.jsx)("div",{className:"loading-spinner"}),(0,bn.jsx)("div",{className:"loading-text",children:"Carregant llibre..."})]}):b?(0,bn.jsxs)("div",{className:"error-screen",style:{backgroundColor:le.bg,color:le.text},children:[(0,bn.jsx)("div",{className:"error-text",children:b}),(0,bn.jsx)("button",{onClick:()=>h("/books"),children:"Tornar a la biblioteca"})]}):(0,bn.jsxs)("div",{className:"book-reader theme-".concat(N),style:{"--reader-bg":le.bg,"--reader-text":le.text,"--reader-accent":le.accent,"--reader-font":ce.family,"--reader-line-height":O,"--reader-margins":"".concat(G,"px")},children:[(0,bn.jsxs)("div",{className:"reader-header ".concat(E?"visible":""),children:[(0,bn.jsx)("div",{className:"header-left",children:(0,bn.jsx)("button",{className:"icon-btn",onClick:()=>h("/books"),title:"Tornar",children:(0,bn.jsx)(di,{})})}),(0,bn.jsxs)("div",{className:"header-center",children:[(0,bn.jsx)("h1",{className:"book-title",children:null===f||void 0===f?void 0:f.title}),(0,bn.jsxs)("span",{className:"chapter-indicator",children:["Capitol ",C+1," de ",(null===p||void 0===p||null===(e=p.content)||void 0===e||null===(t=e.spine)||void 0===t?void 0:t.length)||0,q&&" - ".concat(q," min lectura")]})]}),(0,bn.jsxs)("div",{className:"header-right",children:[(0,bn.jsx)("button",{className:"icon-btn ".concat(K?"active":""),onClick:$,title:"Marcador",children:(0,bn.jsx)(fi,{filled:K})}),(0,bn.jsx)("button",{className:"icon-btn ".concat(T?"active":""),onClick:()=>{k(!T),L(!1)},title:"Taula de continguts (T)",children:(0,bn.jsx)(ui,{})}),(0,bn.jsx)("button",{className:"icon-btn ".concat(w?"active":""),onClick:()=>{L(!w),k(!1)},title:"Configuracio",children:(0,bn.jsx)(hi,{})})]})]}),(0,bn.jsxs)("div",{className:"sidebar toc-sidebar ".concat(T?"open":""),children:[(0,bn.jsxs)("div",{className:"sidebar-header",children:[(0,bn.jsx)("h2",{children:"Index"}),(0,bn.jsx)("button",{className:"icon-btn",onClick:()=>k(!1),children:(0,bn.jsx)(gi,{})})]}),z.length>0&&(0,bn.jsxs)("div",{className:"bookmarks-section",children:[(0,bn.jsx)("h3",{children:"Marcadors"}),(0,bn.jsx)("div",{className:"bookmark-list",children:z.map((e,t)=>(0,bn.jsxs)("div",{className:"bookmark-item",onClick:()=>{ee(e.chapter),k(!1)},children:[(0,bn.jsx)(fi,{filled:!0}),(0,bn.jsx)("span",{children:e.chapterTitle})]},t))})]}),(0,bn.jsxs)("div",{className:"chapters-section",children:[(0,bn.jsx)("h3",{children:"Capitols"}),(0,bn.jsx)("div",{className:"toc-list",children:null===p||void 0===p||null===(s=p.content)||void 0===s||null===(n=s.chapters)||void 0===n?void 0:n.map((e,t)=>(0,bn.jsx)("div",{className:"toc-item ".concat(C===t?"active":""),onClick:()=>{const t=p.content.spine.findIndex(t=>{var s;return t.href.includes(null===(s=e.href)||void 0===s?void 0:s.split("#")[0])});-1!==t&&(ee(t),k(!1))},children:e.title},t))})]})]}),(0,bn.jsxs)("div",{className:"sidebar settings-sidebar ".concat(w?"open":""),children:[(0,bn.jsxs)("div",{className:"sidebar-header",children:[(0,bn.jsx)("h2",{children:"Configuracio"}),(0,bn.jsx)("button",{className:"icon-btn",onClick:()=>L(!1),children:(0,bn.jsx)(gi,{})})]}),(0,bn.jsxs)("div",{className:"settings-content",children:[(0,bn.jsxs)("div",{className:"settings-group",children:[(0,bn.jsx)("label",{children:"Tema"}),(0,bn.jsx)("div",{className:"theme-options",children:Object.entries(vi).map(e=>{let[t,s]=e;return(0,bn.jsx)("button",{className:"theme-option ".concat(N===t?"active":""),style:{backgroundColor:s.bg,color:s.text,borderColor:N===t?s.accent:"transparent"},onClick:()=>I(t),children:"Aa"},t)})})]}),(0,bn.jsxs)("div",{className:"settings-group",children:[(0,bn.jsx)("label",{children:"Tipografia"}),(0,bn.jsx)("div",{className:"font-options",children:Object.entries(yi).map(e=>{let[t,s]=e;return(0,bn.jsx)("button",{className:"font-option ".concat(D===t?"active":""),style:{fontFamily:s.family},onClick:()=>M(t),children:s.name},t)})})]}),(0,bn.jsxs)("div",{className:"settings-group",children:[(0,bn.jsxs)("label",{children:["Mida de lletra: ",j,"px"]}),(0,bn.jsxs)("div",{className:"slider-control",children:[(0,bn.jsx)("button",{onClick:()=>P(e=>Math.max(12,e-2)),children:"A-"}),(0,bn.jsx)("input",{type:"range",min:"12",max:"32",value:j,onChange:e=>P(parseInt(e.target.value))}),(0,bn.jsx)("button",{onClick:()=>P(e=>Math.min(32,e+2)),children:"A+"})]})]}),(0,bn.jsxs)("div",{className:"settings-group",children:[(0,bn.jsxs)("label",{children:["Espaiat de linia: ",O.toFixed(1)]}),(0,bn.jsx)("div",{className:"slider-control",children:(0,bn.jsx)("input",{type:"range",min:"1.2",max:"2.5",step:"0.1",value:O,onChange:e=>F(parseFloat(e.target.value))})})]}),(0,bn.jsxs)("div",{className:"settings-group",children:[(0,bn.jsxs)("label",{children:["Marges: ",G,"px"]}),(0,bn.jsx)("div",{className:"slider-control",children:(0,bn.jsx)("input",{type:"range",min:"20",max:"120",step:"10",value:G,onChange:e=>V(parseInt(e.target.value))})})]}),(0,bn.jsxs)("div",{className:"settings-group",children:[(0,bn.jsx)("label",{children:"Alineacio del text"}),(0,bn.jsxs)("div",{className:"align-options",children:[(0,bn.jsx)("button",{className:"left"===U?"active":"",onClick:()=>B("left"),children:"Esquerra"}),(0,bn.jsx)("button",{className:"justify"===U?"active":"",onClick:()=>B("justify"),children:"Justificat"})]})]})]})]}),(T||w)&&(0,bn.jsx)("div",{className:"sidebar-overlay",onClick:()=>{k(!1),L(!1)}}),(0,bn.jsx)("div",{ref:X,className:"reader-content",onClick:e=>{var t;const s=null===(t=X.current)||void 0===t?void 0:t.getBoundingClientRect();if(!s)return;const n=e.clientX-s.left,r=s.width;n<.3*r?ne():n>.7*r?se():S(e=>!e)},onTouchStart:e=>{oe.current={x:e.touches[0].clientX,y:e.touches[0].clientY}},onTouchEnd:e=>{const t=e.changedTouches[0].clientX-oe.current.x,s=e.changedTouches[0].clientY-oe.current.y;Math.abs(t)>Math.abs(s)&&Math.abs(t)>50&&(t>0?ne():se())},style:{fontSize:"".concat(j,"px"),fontFamily:ce.family,lineHeight:O,textAlign:U},children:(0,bn.jsx)("div",{className:"chapter-content",dangerouslySetInnerHTML:{__html:R}})}),(0,bn.jsx)("button",{className:"nav-arrow nav-arrow-left ".concat(E?"visible":""),onClick:ne,disabled:0===C,children:(0,bn.jsx)(mi,{})}),(0,bn.jsx)("button",{className:"nav-arrow nav-arrow-right ".concat(E?"visible":""),onClick:se,disabled:C>=((null===p||void 0===p||null===(r=p.content)||void 0===r||null===(a=r.spine)||void 0===a?void 0:a.length)||1)-1,children:(0,bn.jsx)(pi,{})}),(0,bn.jsxs)("div",{className:"reader-footer ".concat(E?"visible":""),children:[(0,bn.jsx)("div",{className:"progress-info",children:(0,bn.jsxs)("span",{children:[Math.round((C+1)/((null===p||void 0===p||null===(o=p.content)||void 0===o||null===(l=o.spine)||void 0===l?void 0:l.length)||1)*100),"% llegit"]})}),(0,bn.jsx)("div",{className:"reading-progress",children:(0,bn.jsx)("div",{className:"progress-bar",style:{width:"".concat((C+1)/((null===p||void 0===p||null===(c=p.content)||void 0===c||null===(d=c.spine)||void 0===d?void 0:d.length)||1)*100,"%")}})})]})]})};fn.defaults.baseURL=mn;const xi=function(){const[e,t]=(0,i.useState)([]),[s,n]=(0,i.useState)([]),[r,a]=(0,i.useState)(null),[o,l]=(0,i.useState)(!0),[c,d]=(0,i.useState)("authors"),u=re(),{isAdmin:h}=Sn(),{getAudiobooks:f,audiobooksCache:m,invalidateCache:p}=wn(),[g,v]=(0,i.useState)(null),[y,b]=(0,i.useState)("isbn"),[x,E]=(0,i.useState)(""),[S,T]=(0,i.useState)(""),[k,w]=(0,i.useState)(""),[L,C]=(0,i.useState)([]),[A,R]=(0,i.useState)(!1),[_,N]=(0,i.useState)(null),[I,j]=(0,i.useState)(null);(0,i.useEffect)(()=>{m.data&&n(m.data),P()},[]);const P=async()=>{try{const e=await fn.get("/api/audiobooks/authors");t(e.data)}catch(e){console.error("Error carregant autors:",e)}finally{l(!1)}},D=async()=>{try{const e=await f();n(e)}catch(e){console.error("Error carregant audiollibres:",e)}},M=async e=>{try{const t=await fn.get("/api/audiobooks/authors/".concat(e));a(t.data)}catch(t){console.error("Error carregant audiollibres de l'autor:",t)}},O=()=>{a(null)},F=e=>{u("/listen/".concat(e.id))},U=e=>{d(e),a(null),"all"===e&&0===s.length&&D()},B=(e,t)=>{e.stopPropagation(),v(t),b("isbn"),E(""),T(""),w(""),C([]),N(null)},G=()=>{v(null),N(null)},V=async()=>{if(k.trim()){R(!0),N(null),C([]);try{const e=await fn.post("/api/metadata/books/search",{title:k});e.data.results&&e.data.results.length>0?C(e.data.results):N({type:"error",text:"No s'han trobat resultats"})}catch(e){N({type:"error",text:"Error cercant llibres"})}finally{R(!1)}}else N({type:"error",text:"Introdueix un t\xedtol per cercar"})},z=e=>e.cover?"".concat(mn,"/api/audiobooks/").concat(e.id,"/cover"):null;return o?(0,bn.jsxs)("div",{className:"loading-screen",children:[(0,bn.jsx)("img",{src:"/img/hermes.png",alt:"Hermes",className:"loading-logo"}),(0,bn.jsx)("div",{className:"loading-text",children:"Carregant audiollibres..."})]}):r?(0,bn.jsxs)("div",{className:"library-container",children:[(0,bn.jsx)("div",{className:"library-header",children:(0,bn.jsxs)("div",{className:"library-title",children:[(0,bn.jsxs)("button",{className:"back-btn",onClick:O,children:[(0,bn.jsx)(pr,{})," Tornar"]}),(0,bn.jsx)("span",{className:"icon",children:(0,bn.jsx)(gr,{})}),(0,bn.jsx)("h1",{children:r.name}),(0,bn.jsxs)("span",{className:"library-count",children:["(",(null===(H=r.audiobooks)||void 0===H?void 0:H.length)||0," audiollibres)"]})]})}),(0,bn.jsx)("div",{className:"books-grid",children:null===(K=r.audiobooks)||void 0===K?void 0:K.map(e=>(0,bn.jsxs)("div",{className:"book-card",onClick:()=>F(e),children:[(0,bn.jsxs)("div",{className:"book-cover",children:[z(e)?(0,bn.jsx)("img",{src:z(e),alt:e.title}):(0,bn.jsx)("div",{className:"book-cover-placeholder audiobook-placeholder",children:(0,bn.jsx)("span",{className:"format-icon",children:(0,bn.jsx)(_n,{})})}),(0,bn.jsxs)("div",{className:"book-format-badge audiobook-badge",children:[(0,bn.jsx)(Qn,{})," ",yn(e.total_duration)]}),h&&(0,bn.jsx)("button",{className:"book-edit-btn",onClick:t=>B(t,e),title:"Editar metadades",children:(0,bn.jsx)(Dn,{size:14})})]}),(0,bn.jsxs)("div",{className:"book-info",children:[(0,bn.jsx)("h3",{className:"book-title",children:e.title}),(0,bn.jsxs)("p",{className:"audiobook-meta",children:[(0,bn.jsx)(hr,{})," ",e.total_files," fitxers"]})]})]},e.id))})]}):(0,bn.jsxs)("div",{className:"library-container",children:[(0,bn.jsxs)("div",{className:"library-header",children:[(0,bn.jsxs)("div",{className:"library-title",children:[(0,bn.jsx)("span",{className:"icon",children:(0,bn.jsx)(_n,{})}),(0,bn.jsx)("h1",{children:"Audiollibres"}),(0,bn.jsxs)("span",{className:"library-count",children:["(","authors"===c?e.length+" autors":s.length+" audiollibres",")"]})]}),(0,bn.jsx)("div",{className:"library-filters",children:(0,bn.jsxs)("div",{className:"view-toggle",children:[(0,bn.jsx)("button",{className:"authors"===c?"active":"",onClick:()=>U("authors"),children:"Per Autor"}),(0,bn.jsx)("button",{className:"all"===c?"active":"",onClick:()=>U("all"),children:"Tots"})]})})]}),"authors"===c?0===e.length?(0,bn.jsxs)("div",{className:"empty-state",children:[(0,bn.jsx)("div",{className:"empty-icon",children:(0,bn.jsx)(_n,{})}),(0,bn.jsx)("h2",{children:"No hi ha audiollibres"}),(0,bn.jsx)("p",{children:"Ves al panell d'administraci\xf3 per escanejar la biblioteca"})]}):(0,bn.jsx)("div",{className:"authors-grid",children:e.map(e=>(0,bn.jsxs)("div",{className:"author-card",onClick:()=>(e=>{M(e.id)})(e),children:[(0,bn.jsx)("div",{className:"author-avatar",children:e.photo?(0,bn.jsx)("img",{src:e.photo,alt:e.name}):(0,bn.jsx)(gr,{})}),(0,bn.jsxs)("div",{className:"author-info",children:[(0,bn.jsx)("h3",{children:e.name}),(0,bn.jsxs)("span",{className:"book-count",children:[e.audiobook_count," audiollibres"]})]})]},e.id))}):(0,bn.jsx)("div",{className:"books-grid",children:s.map(e=>(0,bn.jsxs)("div",{className:"book-card",onClick:()=>F(e),children:[(0,bn.jsxs)("div",{className:"book-cover",children:[z(e)?(0,bn.jsx)("img",{src:z(e),alt:e.title}):(0,bn.jsx)("div",{className:"book-cover-placeholder audiobook-placeholder",children:(0,bn.jsx)("span",{className:"format-icon",children:(0,bn.jsx)(_n,{})})}),(0,bn.jsxs)("div",{className:"book-format-badge audiobook-badge",children:[(0,bn.jsx)(Qn,{})," ",yn(e.total_duration)]}),h&&(0,bn.jsx)("button",{className:"book-edit-btn",onClick:t=>B(t,e),title:"Editar metadades",children:(0,bn.jsx)(Dn,{size:14})})]}),(0,bn.jsxs)("div",{className:"book-info",children:[(0,bn.jsx)("h3",{className:"book-title",children:e.title}),(0,bn.jsx)("p",{className:"book-author",children:e.author_name}),(0,bn.jsxs)("p",{className:"audiobook-meta",children:[(0,bn.jsx)(hr,{})," ",e.total_files," fitxers"]})]})]},e.id))}),g&&h&&(0,bn.jsx)("div",{className:"metadata-modal-overlay",onClick:G,children:(0,bn.jsxs)("div",{className:"metadata-modal",onClick:e=>e.stopPropagation(),children:[(0,bn.jsxs)("div",{className:"metadata-modal-header",children:[(0,bn.jsx)("h2",{children:"Editar metadades"}),(0,bn.jsx)("button",{className:"close-btn",onClick:G,"aria-label":"Tancar",children:(0,bn.jsx)(qn,{})})]}),(0,bn.jsx)("p",{className:"metadata-book-title",children:g.title}),(0,bn.jsxs)("div",{className:"metadata-tabs",children:[(0,bn.jsx)("button",{className:"isbn"===y?"active":"",onClick:()=>b("isbn"),children:"ISBN"}),(0,bn.jsx)("button",{className:"olid"===y?"active":"",onClick:()=>b("olid"),children:"Open Library ID"}),(0,bn.jsx)("button",{className:"search"===y?"active":"",onClick:()=>b("search"),children:"Cercar"}),(0,bn.jsx)("button",{className:"upload"===y?"active":"",onClick:()=>{b("upload"),j(null)},children:"Pujar"})]}),(0,bn.jsxs)("div",{className:"metadata-content",children:["isbn"===y&&(0,bn.jsxs)("div",{className:"metadata-form",children:[(0,bn.jsx)("label",{children:"Introdueix l'ISBN del llibre:"}),(0,bn.jsxs)("div",{className:"input-row",children:[(0,bn.jsx)("input",{type:"text",value:x,onChange:e=>E(e.target.value),placeholder:"Ex: 978-84-376-0494-7",disabled:A}),(0,bn.jsx)("button",{onClick:async()=>{if(x.trim()){R(!0),N(null);try{const e=await fn.post("/api/metadata/audiobooks/".concat(g.id,"/update-by-isbn"),{isbn:x});"success"===e.data.status&&(N({type:"success",text:'Portada actualitzada per "'.concat(e.data.title||g.title,'"')}),p("audiobooks"),r?M(r.id):"all"===c&&D(),setTimeout(()=>G(),1500))}catch(s){var e,t;N({type:"error",text:(null===(e=s.response)||void 0===e||null===(t=e.data)||void 0===t?void 0:t.detail)||"Error actualitzant metadades"})}finally{R(!1)}}else N({type:"error",text:"Introdueix un ISBN"})},disabled:A,children:A?"Actualitzant...":"Actualitzar"})]}),(0,bn.jsx)("small",{children:"Pots trobar l'ISBN a la contraportada del llibre o a la p\xe0gina de cr\xe8dits"})]}),"olid"===y&&(0,bn.jsxs)("div",{className:"metadata-form",children:[(0,bn.jsx)("label",{children:"Introdueix l'Open Library Work ID:"}),(0,bn.jsxs)("div",{className:"input-row",children:[(0,bn.jsx)("input",{type:"text",value:S,onChange:e=>T(e.target.value),placeholder:"Ex: OL45804W",disabled:A}),(0,bn.jsx)("button",{onClick:async()=>{if(S.trim()){R(!0),N(null);try{const e=await fn.post("/api/metadata/audiobooks/".concat(g.id,"/update-by-olid"),{olid:S});"success"===e.data.status&&(N({type:"success",text:'Portada actualitzada per "'.concat(e.data.title||g.title,'"')}),p("audiobooks"),r?M(r.id):"all"===c&&D(),setTimeout(()=>G(),1500))}catch(s){var e,t;N({type:"error",text:(null===(e=s.response)||void 0===e||null===(t=e.data)||void 0===t?void 0:t.detail)||"Error actualitzant metadades"})}finally{R(!1)}}else N({type:"error",text:"Introdueix un Open Library ID"})},disabled:A,children:A?"Actualitzant...":"Actualitzar"})]}),(0,bn.jsxs)("small",{children:["Cerca a ",(0,bn.jsx)("a",{href:"https://openlibrary.org",target:"_blank",rel:"noopener noreferrer",children:"openlibrary.org"})," i copia l'ID de l'URL"]})]}),"search"===y&&(0,bn.jsxs)("div",{className:"metadata-form",children:[(0,bn.jsx)("label",{children:"Cerca per t\xedtol:"}),(0,bn.jsxs)("div",{className:"input-row",children:[(0,bn.jsx)("input",{type:"text",value:k,onChange:e=>w(e.target.value),placeholder:"T\xedtol del llibre...",disabled:A,onKeyPress:e=>"Enter"===e.key&&V()}),(0,bn.jsxs)("button",{onClick:V,disabled:A,children:[(0,bn.jsx)(On,{})," Cercar"]})]}),L.length>0&&(0,bn.jsx)("div",{className:"search-results",children:L.map((e,t)=>(0,bn.jsxs)("div",{className:"search-result ".concat(e.cover_id?"":"no-cover"),onClick:()=>(async e=>{if(e.cover_id){R(!0),N(null);try{"success"===(await fn.post("/api/metadata/audiobooks/".concat(g.id,"/update-by-search-result?cover_id=").concat(e.cover_id))).data.status&&(N({type:"success",text:"Portada actualitzada!"}),p("audiobooks"),r?M(r.id):"all"===c&&D(),setTimeout(()=>G(),1500))}catch(n){var t,s;N({type:"error",text:(null===(t=n.response)||void 0===t||null===(s=t.data)||void 0===s?void 0:s.detail)||"Error actualitzant portada"})}finally{R(!1)}}else N({type:"error",text:"Aquest llibre no t\xe9 portada disponible"})})(e),children:[(0,bn.jsx)("div",{className:"result-cover",children:e.cover_id?(0,bn.jsx)("img",{src:"https://covers.openlibrary.org/b/id/".concat(e.cover_id,"-S.jpg"),alt:e.title}):(0,bn.jsx)("div",{className:"no-cover-placeholder",children:(0,bn.jsx)(Rn,{})})}),(0,bn.jsxs)("div",{className:"result-info",children:[(0,bn.jsx)("strong",{children:e.title}),e.author&&(0,bn.jsx)("span",{children:e.author}),e.year&&(0,bn.jsxs)("span",{children:["(",e.year,")"]})]})]},e.key||e.cover_id||"result-".concat(t)))})]}),"upload"===y&&(0,bn.jsxs)("div",{className:"metadata-form",children:[(0,bn.jsx)("label",{children:"Puja una imatge de portada:"}),(0,bn.jsxs)("div",{className:"upload-area",children:[(0,bn.jsx)("input",{type:"file",accept:"image/*",onChange:e=>{const t=e.target.files[0];if(t){if(!t.type.startsWith("image/"))return void N({type:"error",text:"El fitxer ha de ser una imatge"});const e=new FileReader;e.onload=e=>{j({file:t,preview:e.target.result})},e.readAsDataURL(t)}},disabled:A,id:"cover-upload-audiobook",style:{display:"none"}}),(0,bn.jsx)("label",{htmlFor:"cover-upload-audiobook",className:"upload-btn",children:"Seleccionar imatge"}),I&&(0,bn.jsxs)("div",{className:"upload-preview",children:[(0,bn.jsx)("img",{src:I.preview,alt:"Preview"}),(0,bn.jsx)("button",{onClick:async()=>{if(null!==I&&void 0!==I&&I.file){R(!0),N(null);try{const e=new FormData;e.append("file",I.file);"success"===(await fn.post("/api/metadata/audiobooks/".concat(g.id,"/upload-cover"),e,{headers:{"Content-Type":"multipart/form-data"}})).data.status&&(N({type:"success",text:"Portada pujada correctament!"}),p("audiobooks"),r?M(r.id):"all"===c&&D(),j(null),setTimeout(()=>G(),1500))}catch(s){var e,t;N({type:"error",text:(null===(e=s.response)||void 0===e||null===(t=e.data)||void 0===t?void 0:t.detail)||"Error pujant portada"})}finally{R(!1)}}},disabled:A,children:A?"Pujant...":"Pujar portada"})]})]}),(0,bn.jsx)("small",{children:"Formats suportats: JPG, PNG, WebP. La imatge es guardar\xe0 a la carpeta de l'audiollibres."})]}),_&&(0,bn.jsx)("div",{className:"metadata-message ".concat(_.type),children:_.text})]})]})})]});var H,K},Ei=()=>(0,bn.jsx)("svg",{width:"32",height:"32",viewBox:"0 0 24 24",fill:"currentColor",children:(0,bn.jsx)("polygon",{points:"5 3 19 12 5 21 5 3"})}),Si=()=>(0,bn.jsxs)("svg",{width:"32",height:"32",viewBox:"0 0 24 24",fill:"currentColor",children:[(0,bn.jsx)("rect",{x:"6",y:"4",width:"4",height:"16"}),(0,bn.jsx)("rect",{x:"14",y:"4",width:"4",height:"16"})]}),Ti=()=>(0,bn.jsxs)("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[(0,bn.jsx)("polygon",{points:"19 20 9 12 19 4 19 20"}),(0,bn.jsx)("line",{x1:"5",y1:"19",x2:"5",y2:"5"})]}),ki=()=>(0,bn.jsxs)("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[(0,bn.jsx)("polygon",{points:"5 4 15 12 5 20 5 4"}),(0,bn.jsx)("line",{x1:"19",y1:"5",x2:"19",y2:"19"})]}),wi=()=>(0,bn.jsxs)("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[(0,bn.jsx)("path",{d:"M2.5 2v6h6M2.66 15.57a10 10 0 1 0 .57-8.38"}),(0,bn.jsx)("text",{x:"8",y:"16",fontSize:"8",fill:"currentColor",stroke:"none",children:"10"})]}),Li=()=>(0,bn.jsxs)("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[(0,bn.jsx)("path",{d:"M21.5 2v6h-6M21.34 15.57a10 10 0 1 1-.57-8.38"}),(0,bn.jsx)("text",{x:"7",y:"16",fontSize:"8",fill:"currentColor",stroke:"none",children:"30"})]}),Ci=()=>(0,bn.jsxs)("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[(0,bn.jsx)("line",{x1:"19",y1:"12",x2:"5",y2:"12"}),(0,bn.jsx)("polyline",{points:"12 19 5 12 12 5"})]}),Ai=()=>(0,bn.jsxs)("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[(0,bn.jsx)("line",{x1:"8",y1:"6",x2:"21",y2:"6"}),(0,bn.jsx)("line",{x1:"8",y1:"12",x2:"21",y2:"12"}),(0,bn.jsx)("line",{x1:"8",y1:"18",x2:"21",y2:"18"}),(0,bn.jsx)("line",{x1:"3",y1:"6",x2:"3.01",y2:"6"}),(0,bn.jsx)("line",{x1:"3",y1:"12",x2:"3.01",y2:"12"}),(0,bn.jsx)("line",{x1:"3",y1:"18",x2:"3.01",y2:"18"})]}),Ri=e=>{let{muted:t}=e;return t?(0,bn.jsxs)("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[(0,bn.jsx)("polygon",{points:"11 5 6 9 2 9 2 15 6 15 11 19 11 5"}),(0,bn.jsx)("line",{x1:"23",y1:"9",x2:"17",y2:"15"}),(0,bn.jsx)("line",{x1:"17",y1:"9",x2:"23",y2:"15"})]}):(0,bn.jsxs)("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[(0,bn.jsx)("polygon",{points:"11 5 6 9 2 9 2 15 6 15 11 19 11 5"}),(0,bn.jsx)("path",{d:"M19.07 4.93a10 10 0 0 1 0 14.14M15.54 8.46a5 5 0 0 1 0 7.07"})]})},_i=()=>(0,bn.jsxs)("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[(0,bn.jsx)("circle",{cx:"12",cy:"12",r:"10"}),(0,bn.jsx)("polyline",{points:"12 6 12 12 16 14"})]}),Ni=()=>(0,bn.jsx)("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:(0,bn.jsx)("path",{d:"M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"})}),Ii=e=>{let{filled:t}=e;return(0,bn.jsx)("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:t?"currentColor":"none",stroke:"currentColor",strokeWidth:"2",children:(0,bn.jsx)("path",{d:"M19 21l-7-5-7 5V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2z"})})},ji=()=>(0,bn.jsxs)("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[(0,bn.jsx)("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),(0,bn.jsx)("line",{x1:"6",y1:"6",x2:"18",y2:"18"})]}),Pi=[{value:0,label:"Off"},{value:5,label:"5 min"},{value:10,label:"10 min"},{value:15,label:"15 min"},{value:30,label:"30 min"},{value:45,label:"45 min"},{value:60,label:"1 hora"},{value:-1,label:"Fi capitol"}],Di=[.5,.75,1,1.25,1.5,1.75,2,2.5,3],Mi=()=>(0,bn.jsxs)("svg",{width:"48",height:"48",viewBox:"0 0 24 24",fill:"currentColor",children:[(0,bn.jsx)("polygon",{points:"11 19 2 12 11 5 11 19"}),(0,bn.jsx)("polygon",{points:"22 19 13 12 22 5 22 19"})]}),Oi=()=>(0,bn.jsxs)("svg",{width:"48",height:"48",viewBox:"0 0 24 24",fill:"currentColor",children:[(0,bn.jsx)("polygon",{points:"13 19 22 12 13 5 13 19"}),(0,bn.jsx)("polygon",{points:"2 19 11 12 2 5 2 19"})]});const Fi=function(){const{id:e}=ie(),t=re(),s=(0,i.useRef)(null),n=(0,i.useRef)(null),r=(0,i.useRef)(null),a=(0,i.useRef)(null),o=(0,i.useRef)({time:0,side:null}),l=(0,i.useRef)(null),c=(0,i.useRef)(null),[d,u]=(0,i.useState)(null),[h,f]=(0,i.useState)(0),[m,p]=(0,i.useState)(!1),[g,v]=(0,i.useState)(0),[y,b]=(0,i.useState)(0),[x,E]=(0,i.useState)(1),[S,T]=(0,i.useState)(!1),[k,w]=(0,i.useState)(()=>parseFloat(localStorage.getItem("audiobook_speed"))||1),[L,C]=(0,i.useState)(!1),[A,R]=(0,i.useState)(!1),[_,N]=(0,i.useState)(!0),[I,j]=(0,i.useState)(null),[P,D]=(0,i.useState)(null),[M,O]=(0,i.useState)(0),[F,U]=(0,i.useState)(0),[B,G]=(0,i.useState)(null),[V,z]=(0,i.useState)([]),[H,K]=(0,i.useState)(!1);(0,i.useEffect)(()=>{(async()=>{try{var t;const s=await fn.get("".concat(mn,"/api/audiobooks/").concat(e));if(u(s.data),null!==(t=s.data.progress)&&void 0!==t&&t.current_file_id){const e=s.data.files.findIndex(e=>e.id===s.data.progress.current_file_id);-1!==e&&(f(e),v(s.data.progress.current_position||0))}}catch(I){console.error("Error carregant audiollibres:",I),j("No s'ha pogut carregar l'audiollibre")}finally{N(!1)}})();const t=localStorage.getItem("audiobook_bookmarks_".concat(e));if(t)try{z(JSON.parse(t))}catch(s){z([])}return()=>{n.current&&clearInterval(n.current),r.current&&clearInterval(r.current)}},[e]),(0,i.useEffect)(()=>(r.current&&clearInterval(r.current),F>0&&B&&(r.current=setInterval(()=>{const e=Math.max(0,Math.ceil((B-Date.now())/6e4));O(e),e<=0&&(s.current&&s.current.pause(),p(!1),U(0),G(null),clearInterval(r.current))},1e3)),()=>{r.current&&clearInterval(r.current)}),[F,B]),(0,i.useEffect)(()=>{L&&c.current&&l.current&&requestAnimationFrame(()=>{setTimeout(()=>{if(c.current&&l.current){const e=l.current,t=c.current,s=e.getBoundingClientRect(),n=t.offsetTop-s.height/2+t.offsetHeight/2;e.scrollTo({top:Math.max(0,n),behavior:"smooth"})}},150)})},[L]),(0,i.useEffect)(()=>{localStorage.setItem("audiobook_speed",k.toString()),s.current&&(s.current.playbackRate=k)},[k]);const W=(0,i.useCallback)(async()=>{if(!d||!s.current)return;const t=d.files[h];if(t)try{await fn.post("".concat(mn,"/api/audiobooks/").concat(e,"/progress"),{file_id:t.id,position:Math.floor(s.current.currentTime)})}catch(I){console.error("Error guardant progr\xe9s:",I)}},[d,h,e]);(0,i.useEffect)(()=>(m?n.current=setInterval(W,3e4):n.current&&clearInterval(n.current),()=>{n.current&&clearInterval(n.current)}),[m,W]);const q=(0,i.useCallback)(()=>{if(!d||!s.current)return;const t=d.files[h],n={id:Date.now(),fileIndex:h,fileId:t.id,fileTitle:t.title||t.file_name,position:Math.floor(s.current.currentTime),createdAt:(new Date).toISOString()},r=[...V,n];z(r),localStorage.setItem("audiobook_bookmarks_".concat(e),JSON.stringify(r))},[d,h,V,e]),Y=(0,i.useCallback)(t=>{const s=V.filter(e=>e.id!==t);z(s),localStorage.setItem("audiobook_bookmarks_".concat(e),JSON.stringify(s))},[V,e]),X=(0,i.useCallback)(e=>{e.fileIndex!==h&&(W(),f(e.fileIndex)),setTimeout(()=>{s.current&&(s.current.currentTime=e.position)},100),K(!1),p(!0)},[h,W]),Q=()=>{s.current&&(m?(s.current.pause(),W()):s.current.play(),p(!m))},$=()=>{s.current&&(s.current.muted=!S,T(!S))},J=(0,i.useCallback)((e,t)=>{D({side:e,seconds:t}),setTimeout(()=>D(null),500)},[]),Z=(0,i.useCallback)(e=>{"left"===e?s.current&&(s.current.currentTime=Math.max(0,s.current.currentTime-10),J("left",10)):s.current&&(s.current.currentTime=Math.min(y,s.current.currentTime+30),J("right",30))},[y,J]),ee=(0,i.useCallback)(e=>{var t;if(e.target.closest("button")||e.target.closest("input")||e.target.closest(".audiobook-controls")||e.target.closest(".audiobook-extra-controls")||e.target.closest(".audiobook-progress")||e.target.closest(".chapters-panel")||e.target.closest(".audiobook-header"))return;const s=Date.now(),n=null===(t=a.current)||void 0===t?void 0:t.getBoundingClientRect();if(!n)return;const r=e.clientX-n.left<n.width/2?"left":"right";s-o.current.time<300&&o.current.side===r?(Z(r),o.current={time:0,side:null}):o.current={time:s,side:r}},[Z]);(0,i.useEffect)(()=>{const e=e=>{if("INPUT"!==e.target.tagName&&"TEXTAREA"!==e.target.tagName)switch(e.code){case"Space":e.preventDefault(),Q();break;case"ArrowLeft":e.preventDefault(),s.current&&(s.current.currentTime=Math.max(0,s.current.currentTime-10),J("left",10));break;case"ArrowRight":e.preventDefault(),s.current&&(s.current.currentTime=Math.min(y,s.current.currentTime+30),J("right",30));break;case"ArrowUp":e.preventDefault(),E(e=>{const t=Math.min(1,e+.1);return s.current&&(s.current.volume=t),t});break;case"ArrowDown":e.preventDefault(),E(e=>{const t=Math.max(0,e-.1);return s.current&&(s.current.volume=t),t});break;case"KeyM":$()}};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[y,J]);const te=e=>{if(!e||isNaN(e))return"0:00";const t=Math.floor(e/3600),s=Math.floor(e%3600/60),n=Math.floor(e%60);return t>0?"".concat(t,":").concat(s.toString().padStart(2,"0"),":").concat(n.toString().padStart(2,"0")):"".concat(s,":").concat(n.toString().padStart(2,"0"))};if(_)return(0,bn.jsxs)("div",{className:"loading-screen",children:[(0,bn.jsx)("img",{src:"/img/hermes.png",alt:"Hermes",className:"loading-logo"}),(0,bn.jsx)("div",{className:"loading-text",children:"Carregant audiollibres..."})]});if(I)return(0,bn.jsx)("div",{className:"audiobook-player-container",children:(0,bn.jsxs)("div",{className:"audiobook-error",children:[(0,bn.jsx)("svg",{viewBox:"0 0 24 24",fill:"currentColor",width:"48",height:"48",style:{color:"#ef4444",marginBottom:"10px"},children:(0,bn.jsx)("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h2v6z"})}),(0,bn.jsx)("h2",{children:I}),(0,bn.jsxs)("button",{onClick:()=>t("/audiobooks"),children:[(0,bn.jsx)(Ci,{})," Tornar a la biblioteca"]})]})});if(!d)return(0,bn.jsx)("div",{className:"audiobook-player-container",children:(0,bn.jsxs)("div",{className:"audiobook-error",children:[(0,bn.jsx)("h2",{children:"Audiollibres no trobat"}),(0,bn.jsxs)("button",{onClick:()=>t("/audiobooks"),children:[(0,bn.jsx)(Ci,{})," Tornar a la biblioteca"]})]})});const se=d.files[h],ne=se?"".concat(mn,"/api/audiobooks/").concat(e,"/files/").concat(se.id,"/stream"):null,ae=d.cover?"".concat(mn,"/api/audiobooks/").concat(e,"/cover"):null;return(0,bn.jsxs)("div",{className:"audiobook-player-container",ref:a,onClick:ee,children:[P&&(0,bn.jsxs)("div",{className:"skip-indicator ".concat(P.side),children:["left"===P.side?(0,bn.jsx)(Mi,{}):(0,bn.jsx)(Oi,{}),(0,bn.jsxs)("span",{children:[P.seconds,"s"]})]}),(0,bn.jsxs)("div",{className:"audiobook-bg",children:[ae&&(0,bn.jsx)("img",{src:ae,alt:"",className:"audiobook-bg-image"}),(0,bn.jsx)("div",{className:"audiobook-bg-overlay"})]}),(0,bn.jsxs)("header",{className:"audiobook-header",children:[(0,bn.jsx)("button",{className:"back-btn",onClick:()=>{W(),t("/audiobooks")},children:(0,bn.jsx)(Ci,{})}),(0,bn.jsxs)("div",{className:"audiobook-title-header",children:[(0,bn.jsx)("h1",{children:d.title}),(0,bn.jsx)("span",{className:"author",children:d.author_name})]}),(0,bn.jsxs)("div",{className:"header-actions",children:[(0,bn.jsx)("button",{className:"header-btn ".concat(H?"active":""),onClick:()=>{K(!H),C(!1),R(!1)},title:"Marcadors",children:(0,bn.jsx)(Ii,{filled:V.length>0})}),(0,bn.jsx)("button",{className:"header-btn ".concat(L?"active":""),onClick:()=>{C(!L),K(!1),R(!1)},title:"Capitols",children:(0,bn.jsx)(Ai,{})}),(0,bn.jsxs)("button",{className:"header-btn ".concat(A?"active":""),onClick:()=>{R(!A),C(!1),K(!1)},title:"Configuracio",children:[(0,bn.jsx)(Ni,{}),0!==F&&(0,bn.jsx)("span",{className:"sleep-badge",children:-1===F?"Fi":M})]})]})]}),(0,bn.jsxs)("main",{className:"audiobook-main",children:[(0,bn.jsx)("div",{className:"audiobook-cover-container",children:ae?(0,bn.jsx)("img",{src:ae,alt:d.title,className:"audiobook-cover"}):(0,bn.jsx)("div",{className:"audiobook-cover-placeholder",children:(0,bn.jsxs)("svg",{width:"80",height:"80",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",children:[(0,bn.jsx)("path",{d:"M3 18v-6a9 9 0 0 1 18 0v6"}),(0,bn.jsx)("path",{d:"M21 19a2 2 0 0 1-2 2h-1a2 2 0 0 1-2-2v-3a2 2 0 0 1 2-2h3zM3 19a2 2 0 0 0 2 2h1a2 2 0 0 0 2-2v-3a2 2 0 0 0-2-2H3z"})]})})}),(0,bn.jsxs)("div",{className:"current-track-info",children:[(0,bn.jsx)("h2",{className:"track-title",children:(null===se||void 0===se?void 0:se.title)||(null===se||void 0===se?void 0:se.file_name)}),(0,bn.jsxs)("div",{className:"track-meta",children:[(0,bn.jsxs)("p",{className:"track-number",children:["Capitol ",h+1," de ",d.files.length]}),(0,bn.jsx)("button",{className:"bookmark-current-btn",onClick:q,title:"Afegir marcador",children:(0,bn.jsx)(Ii,{filled:!1})})]})]}),0!==F&&(0,bn.jsxs)("div",{className:"sleep-indicator",children:[(0,bn.jsx)(Ni,{}),(0,bn.jsx)("span",{children:-1===F?"Aturaras al final del capitol":"Aturara en ".concat(M," min")})]}),(0,bn.jsxs)("div",{className:"audiobook-progress",children:[(0,bn.jsx)("div",{className:"progress-bar",onClick:e=>{const t=e.currentTarget.getBoundingClientRect(),n=(e.clientX-t.left)/t.width*y;s.current&&(s.current.currentTime=n,v(n))},children:(0,bn.jsx)("div",{className:"progress-fill",style:{width:"".concat(g/y*100||0,"%")}})}),(0,bn.jsxs)("div",{className:"progress-times",children:[(0,bn.jsx)("span",{children:te(g)}),(0,bn.jsx)("span",{children:te(y)})]})]}),(0,bn.jsxs)("div",{className:"audiobook-controls",children:[(0,bn.jsx)("button",{className:"control-btn secondary",onClick:()=>{s.current&&(s.current.currentTime=Math.max(0,s.current.currentTime-10))},title:"Retrocedir 10s",children:(0,bn.jsx)(wi,{})}),(0,bn.jsx)("button",{className:"control-btn secondary",onClick:()=>{h>0&&(W(),f(e=>e-1),v(0))},disabled:0===h,children:(0,bn.jsx)(Ti,{})}),(0,bn.jsx)("button",{className:"control-btn primary",onClick:Q,children:m?(0,bn.jsx)(Si,{}):(0,bn.jsx)(Ei,{})}),(0,bn.jsx)("button",{className:"control-btn secondary",onClick:()=>{h<d.files.length-1&&(W(),f(e=>e+1),v(0))},disabled:h===d.files.length-1,children:(0,bn.jsx)(ki,{})}),(0,bn.jsx)("button",{className:"control-btn secondary",onClick:()=>{s.current&&(s.current.currentTime=Math.min(y,s.current.currentTime+30))},title:"Avan\xe7ar 30s",children:(0,bn.jsx)(Li,{})})]}),(0,bn.jsxs)("div",{className:"audiobook-extra-controls",children:[(0,bn.jsxs)("div",{className:"volume-control",children:[(0,bn.jsx)("button",{className:"control-btn small",onClick:$,children:(0,bn.jsx)(Ri,{muted:S})}),(0,bn.jsx)("input",{type:"range",min:"0",max:"1",step:"0.1",value:x,onChange:e=>{const t=parseFloat(e.target.value);E(t),s.current&&(s.current.volume=t),0===t?T(!0):S&&T(!1)},className:"volume-slider"})]}),(0,bn.jsxs)("button",{className:"speed-btn",onClick:()=>{const e=Di.indexOf(k),t=e>=0?(e+1)%Di.length:0,s=Di[t];w(s)},children:[(0,bn.jsx)(_i,{}),(0,bn.jsxs)("span",{children:[k,"x"]})]})]})]}),(0,bn.jsxs)("div",{className:"sidebar-panel ".concat(L?"open":""),children:[(0,bn.jsxs)("div",{className:"panel-header",children:[(0,bn.jsx)("h3",{children:"Capitols"}),(0,bn.jsx)("button",{onClick:()=>C(!1),"aria-label":"Tancar",children:(0,bn.jsx)(ji,{})})]}),(0,bn.jsx)("div",{className:"panel-content",ref:l,children:d.files.map((e,t)=>{const s=t===h;return(0,bn.jsxs)("div",{ref:s?c:null,className:"chapter-item ".concat(s?"active":""),onClick:()=>(e=>{W(),f(e),v(0),C(!1),p(!0)})(t),children:[(0,bn.jsx)("span",{className:"chapter-number",children:t+1}),(0,bn.jsxs)("div",{className:"chapter-info",children:[(0,bn.jsx)("span",{className:"chapter-title",children:e.title||e.file_name}),(0,bn.jsx)("span",{className:"chapter-duration",children:te(e.duration)})]})]},e.id)})})]}),(0,bn.jsxs)("div",{className:"sidebar-panel ".concat(H?"open":""),children:[(0,bn.jsxs)("div",{className:"panel-header",children:[(0,bn.jsx)("h3",{children:"Marcadors"}),(0,bn.jsx)("button",{onClick:()=>K(!1),"aria-label":"Tancar",children:(0,bn.jsx)(ji,{})})]}),(0,bn.jsx)("div",{className:"panel-content",children:0===V.length?(0,bn.jsxs)("div",{className:"empty-panel",children:[(0,bn.jsx)(Ii,{filled:!1}),(0,bn.jsx)("p",{children:"Cap marcador encara"}),(0,bn.jsx)("span",{children:"Prem el boto de marcador per desar la posicio actual"})]}):V.map(e=>(0,bn.jsxs)("div",{className:"bookmark-item",children:[(0,bn.jsxs)("div",{className:"bookmark-info",onClick:()=>X(e),children:[(0,bn.jsx)("span",{className:"bookmark-file",children:e.fileTitle}),(0,bn.jsx)("span",{className:"bookmark-position",children:te(e.position)})]}),(0,bn.jsx)("button",{className:"delete-bookmark",onClick:()=>Y(e.id),"aria-label":"Eliminar marcador",children:(0,bn.jsx)(ji,{})})]},e.id))})]}),(0,bn.jsxs)("div",{className:"sidebar-panel ".concat(A?"open":""),children:[(0,bn.jsxs)("div",{className:"panel-header",children:[(0,bn.jsx)("h3",{children:"Configuracio"}),(0,bn.jsx)("button",{onClick:()=>R(!1),"aria-label":"Tancar",children:(0,bn.jsx)(ji,{})})]}),(0,bn.jsxs)("div",{className:"panel-content",children:[(0,bn.jsxs)("div",{className:"settings-section",children:[(0,bn.jsx)("h4",{children:"Temporitzador de son"}),(0,bn.jsx)("div",{className:"sleep-options",children:Pi.map(e=>(0,bn.jsx)("button",{className:"sleep-option ".concat(F===e.value?"active":""),onClick:()=>{return 0===(t=e.value)?(U(0),G(null),O(0)):-1===t?(U(-1),O(-1)):(U(t),G(Date.now()+60*t*1e3),O(t)),void R(!1);var t},children:e.label},e.value))})]}),(0,bn.jsxs)("div",{className:"settings-section",children:[(0,bn.jsx)("h4",{children:"Velocitat de reproduccio"}),(0,bn.jsx)("div",{className:"speed-options",children:Di.map(e=>(0,bn.jsxs)("button",{className:"speed-option ".concat(k===e?"active":""),onClick:()=>(e=>{w(e),R(!1)})(e),children:[e,"x"]},e))})]})]})]}),(L||H||A)&&(0,bn.jsx)("div",{className:"panel-overlay",onClick:()=>{C(!1),K(!1),R(!1)}}),ne&&(0,bn.jsx)("audio",{ref:s,src:ne,onTimeUpdate:()=>{s.current&&v(s.current.currentTime)},onLoadedMetadata:()=>{s.current&&(b(s.current.duration),g>0&&0===s.current.currentTime&&(s.current.currentTime=g))},onEnded:()=>{if(-1===F)return p(!1),U(0),void W();h<d.files.length-1?(f(e=>e+1),p(!0)):(p(!1),W())},onPlay:()=>p(!0),onPause:()=>p(!1),autoPlay:m})]})},Ui=Number.isFinite||function(e){return"number"===typeof e&&isFinite(e)},Bi=Number.isSafeInteger||function(e){return"number"===typeof e&&Math.abs(e)<=Gi},Gi=Number.MAX_SAFE_INTEGER||9007199254740991;let Vi=function(e){return e.NETWORK_ERROR="networkError",e.MEDIA_ERROR="mediaError",e.KEY_SYSTEM_ERROR="keySystemError",e.MUX_ERROR="muxError",e.OTHER_ERROR="otherError",e}({}),zi=function(e){return e.KEY_SYSTEM_NO_KEYS="keySystemNoKeys",e.KEY_SYSTEM_NO_ACCESS="keySystemNoAccess",e.KEY_SYSTEM_NO_SESSION="keySystemNoSession",e.KEY_SYSTEM_NO_CONFIGURED_LICENSE="keySystemNoConfiguredLicense",e.KEY_SYSTEM_LICENSE_REQUEST_FAILED="keySystemLicenseRequestFailed",e.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED="keySystemServerCertificateRequestFailed",e.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED="keySystemServerCertificateUpdateFailed",e.KEY_SYSTEM_SESSION_UPDATE_FAILED="keySystemSessionUpdateFailed",e.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED="keySystemStatusOutputRestricted",e.KEY_SYSTEM_STATUS_INTERNAL_ERROR="keySystemStatusInternalError",e.KEY_SYSTEM_DESTROY_MEDIA_KEYS_ERROR="keySystemDestroyMediaKeysError",e.KEY_SYSTEM_DESTROY_CLOSE_SESSION_ERROR="keySystemDestroyCloseSessionError",e.KEY_SYSTEM_DESTROY_REMOVE_SESSION_ERROR="keySystemDestroyRemoveSessionError",e.MANIFEST_LOAD_ERROR="manifestLoadError",e.MANIFEST_LOAD_TIMEOUT="manifestLoadTimeOut",e.MANIFEST_PARSING_ERROR="manifestParsingError",e.MANIFEST_INCOMPATIBLE_CODECS_ERROR="manifestIncompatibleCodecsError",e.LEVEL_EMPTY_ERROR="levelEmptyError",e.LEVEL_LOAD_ERROR="levelLoadError",e.LEVEL_LOAD_TIMEOUT="levelLoadTimeOut",e.LEVEL_PARSING_ERROR="levelParsingError",e.LEVEL_SWITCH_ERROR="levelSwitchError",e.AUDIO_TRACK_LOAD_ERROR="audioTrackLoadError",e.AUDIO_TRACK_LOAD_TIMEOUT="audioTrackLoadTimeOut",e.SUBTITLE_LOAD_ERROR="subtitleTrackLoadError",e.SUBTITLE_TRACK_LOAD_TIMEOUT="subtitleTrackLoadTimeOut",e.FRAG_LOAD_ERROR="fragLoadError",e.FRAG_LOAD_TIMEOUT="fragLoadTimeOut",e.FRAG_DECRYPT_ERROR="fragDecryptError",e.FRAG_PARSING_ERROR="fragParsingError",e.FRAG_GAP="fragGap",e.REMUX_ALLOC_ERROR="remuxAllocError",e.KEY_LOAD_ERROR="keyLoadError",e.KEY_LOAD_TIMEOUT="keyLoadTimeOut",e.BUFFER_ADD_CODEC_ERROR="bufferAddCodecError",e.BUFFER_INCOMPATIBLE_CODECS_ERROR="bufferIncompatibleCodecsError",e.BUFFER_APPEND_ERROR="bufferAppendError",e.BUFFER_APPENDING_ERROR="bufferAppendingError",e.BUFFER_STALLED_ERROR="bufferStalledError",e.BUFFER_FULL_ERROR="bufferFullError",e.BUFFER_SEEK_OVER_HOLE="bufferSeekOverHole",e.BUFFER_NUDGE_ON_STALL="bufferNudgeOnStall",e.ASSET_LIST_LOAD_ERROR="assetListLoadError",e.ASSET_LIST_LOAD_TIMEOUT="assetListLoadTimeout",e.ASSET_LIST_PARSING_ERROR="assetListParsingError",e.INTERSTITIAL_ASSET_ITEM_ERROR="interstitialAssetItemError",e.INTERNAL_EXCEPTION="internalException",e.INTERNAL_ABORTED="aborted",e.ATTACH_MEDIA_ERROR="attachMediaError",e.UNKNOWN="unknown",e}({}),Hi=function(e){return e.MEDIA_ATTACHING="hlsMediaAttaching",e.MEDIA_ATTACHED="hlsMediaAttached",e.MEDIA_DETACHING="hlsMediaDetaching",e.MEDIA_DETACHED="hlsMediaDetached",e.MEDIA_ENDED="hlsMediaEnded",e.STALL_RESOLVED="hlsStallResolved",e.BUFFER_RESET="hlsBufferReset",e.BUFFER_CODECS="hlsBufferCodecs",e.BUFFER_CREATED="hlsBufferCreated",e.BUFFER_APPENDING="hlsBufferAppending",e.BUFFER_APPENDED="hlsBufferAppended",e.BUFFER_EOS="hlsBufferEos",e.BUFFERED_TO_END="hlsBufferedToEnd",e.BUFFER_FLUSHING="hlsBufferFlushing",e.BUFFER_FLUSHED="hlsBufferFlushed",e.MANIFEST_LOADING="hlsManifestLoading",e.MANIFEST_LOADED="hlsManifestLoaded",e.MANIFEST_PARSED="hlsManifestParsed",e.LEVEL_SWITCHING="hlsLevelSwitching",e.LEVEL_SWITCHED="hlsLevelSwitched",e.LEVEL_LOADING="hlsLevelLoading",e.LEVEL_LOADED="hlsLevelLoaded",e.LEVEL_UPDATED="hlsLevelUpdated",e.LEVEL_PTS_UPDATED="hlsLevelPtsUpdated",e.LEVELS_UPDATED="hlsLevelsUpdated",e.AUDIO_TRACKS_UPDATED="hlsAudioTracksUpdated",e.AUDIO_TRACK_SWITCHING="hlsAudioTrackSwitching",e.AUDIO_TRACK_SWITCHED="hlsAudioTrackSwitched",e.AUDIO_TRACK_LOADING="hlsAudioTrackLoading",e.AUDIO_TRACK_LOADED="hlsAudioTrackLoaded",e.AUDIO_TRACK_UPDATED="hlsAudioTrackUpdated",e.SUBTITLE_TRACKS_UPDATED="hlsSubtitleTracksUpdated",e.SUBTITLE_TRACKS_CLEARED="hlsSubtitleTracksCleared",e.SUBTITLE_TRACK_SWITCH="hlsSubtitleTrackSwitch",e.SUBTITLE_TRACK_LOADING="hlsSubtitleTrackLoading",e.SUBTITLE_TRACK_LOADED="hlsSubtitleTrackLoaded",e.SUBTITLE_TRACK_UPDATED="hlsSubtitleTrackUpdated",e.SUBTITLE_FRAG_PROCESSED="hlsSubtitleFragProcessed",e.CUES_PARSED="hlsCuesParsed",e.NON_NATIVE_TEXT_TRACKS_FOUND="hlsNonNativeTextTracksFound",e.INIT_PTS_FOUND="hlsInitPtsFound",e.FRAG_LOADING="hlsFragLoading",e.FRAG_LOAD_EMERGENCY_ABORTED="hlsFragLoadEmergencyAborted",e.FRAG_LOADED="hlsFragLoaded",e.FRAG_DECRYPTED="hlsFragDecrypted",e.FRAG_PARSING_INIT_SEGMENT="hlsFragParsingInitSegment",e.FRAG_PARSING_USERDATA="hlsFragParsingUserdata",e.FRAG_PARSING_METADATA="hlsFragParsingMetadata",e.FRAG_PARSED="hlsFragParsed",e.FRAG_BUFFERED="hlsFragBuffered",e.FRAG_CHANGED="hlsFragChanged",e.FPS_DROP="hlsFpsDrop",e.FPS_DROP_LEVEL_CAPPING="hlsFpsDropLevelCapping",e.MAX_AUTO_LEVEL_UPDATED="hlsMaxAutoLevelUpdated",e.ERROR="hlsError",e.DESTROYING="hlsDestroying",e.KEY_LOADING="hlsKeyLoading",e.KEY_LOADED="hlsKeyLoaded",e.LIVE_BACK_BUFFER_REACHED="hlsLiveBackBufferReached",e.BACK_BUFFER_REACHED="hlsBackBufferReached",e.STEERING_MANIFEST_LOADED="hlsSteeringManifestLoaded",e.ASSET_LIST_LOADING="hlsAssetListLoading",e.ASSET_LIST_LOADED="hlsAssetListLoaded",e.INTERSTITIALS_UPDATED="hlsInterstitialsUpdated",e.INTERSTITIALS_BUFFERED_TO_BOUNDARY="hlsInterstitialsBufferedToBoundary",e.INTERSTITIAL_ASSET_PLAYER_CREATED="hlsInterstitialAssetPlayerCreated",e.INTERSTITIAL_STARTED="hlsInterstitialStarted",e.INTERSTITIAL_ASSET_STARTED="hlsInterstitialAssetStarted",e.INTERSTITIAL_ASSET_ENDED="hlsInterstitialAssetEnded",e.INTERSTITIAL_ASSET_ERROR="hlsInterstitialAssetError",e.INTERSTITIAL_ENDED="hlsInterstitialEnded",e.INTERSTITIALS_PRIMARY_RESUMED="hlsInterstitialsPrimaryResumed",e.PLAYOUT_LIMIT_REACHED="hlsPlayoutLimitReached",e.EVENT_CUE_ENTER="hlsEventCueEnter",e}({});var Ki="manifest",Wi="level",qi="audioTrack",Yi="subtitleTrack",Xi="main",Qi="audio",$i="subtitle";class Ji{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.halfLife=void 0,this.alpha_=void 0,this.estimate_=void 0,this.totalWeight_=void 0,this.halfLife=e,this.alpha_=e?Math.exp(Math.log(.5)/e):0,this.estimate_=t,this.totalWeight_=s}sample(e,t){const s=Math.pow(this.alpha_,e);this.estimate_=t*(1-s)+s*this.estimate_,this.totalWeight_+=e}getTotalWeight(){return this.totalWeight_}getEstimate(){if(this.alpha_){const e=1-Math.pow(this.alpha_,this.totalWeight_);if(e)return this.estimate_/e}return this.estimate_}}class Zi{constructor(e,t,s){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:100;this.defaultEstimate_=void 0,this.minWeight_=void 0,this.minDelayMs_=void 0,this.slow_=void 0,this.fast_=void 0,this.defaultTTFB_=void 0,this.ttfb_=void 0,this.defaultEstimate_=s,this.minWeight_=.001,this.minDelayMs_=50,this.slow_=new Ji(e),this.fast_=new Ji(t),this.defaultTTFB_=n,this.ttfb_=new Ji(e)}update(e,t){const{slow_:s,fast_:n,ttfb_:r}=this;s.halfLife!==e&&(this.slow_=new Ji(e,s.getEstimate(),s.getTotalWeight())),n.halfLife!==t&&(this.fast_=new Ji(t,n.getEstimate(),n.getTotalWeight())),r.halfLife!==e&&(this.ttfb_=new Ji(e,r.getEstimate(),r.getTotalWeight()))}sample(e,t){const s=(e=Math.max(e,this.minDelayMs_))/1e3,n=8*t/s;this.fast_.sample(s,n),this.slow_.sample(s,n)}sampleTTFB(e){const t=e/1e3,s=Math.sqrt(2)*Math.exp(-Math.pow(t,2)/2);this.ttfb_.sample(s,Math.max(e,5))}canEstimate(){return this.fast_.getTotalWeight()>=this.minWeight_}getEstimate(){return this.canEstimate()?Math.min(this.fast_.getEstimate(),this.slow_.getEstimate()):this.defaultEstimate_}getEstimateTTFB(){return this.ttfb_.getTotalWeight()>=this.minWeight_?this.ttfb_.getEstimate():this.defaultTTFB_}get defaultEstimate(){return this.defaultEstimate_}destroy(){}}function ea(e,t,s){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var s=e[Symbol.toPrimitive];if(void 0!==s){var n=s.call(e,t);if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}function ta(){return ta=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var s=arguments[t];for(var n in s)({}).hasOwnProperty.call(s,n)&&(e[n]=s[n])}return e},ta.apply(null,arguments)}function sa(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),s.push.apply(s,n)}return s}function na(e){for(var t=1;t<arguments.length;t++){var s=null!=arguments[t]?arguments[t]:{};t%2?sa(Object(s),!0).forEach(function(t){ea(e,t,s[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):sa(Object(s)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(s,t))})}return e}class ra{constructor(e,t){this.trace=void 0,this.debug=void 0,this.log=void 0,this.warn=void 0,this.info=void 0,this.error=void 0;const s="[".concat(e,"]:");this.trace=ia,this.debug=t.debug.bind(null,s),this.log=t.log.bind(null,s),this.warn=t.warn.bind(null,s),this.info=t.info.bind(null,s),this.error=t.error.bind(null,s)}}const ia=function(){},aa={trace:ia,debug:ia,log:ia,warn:ia,info:ia,error:ia};function oa(){return ta({},aa)}function la(e,t,s){return t[e]?t[e].bind(t):function(e,t){const s=self.console[e];return s?s.bind(self.console,"".concat(t?"["+t+"] ":"","[").concat(e,"] >")):ia}(e,s)}const ca=oa();const da=ca;function ua(){if("undefined"===typeof self)return;return(!(arguments.length>0&&void 0!==arguments[0])||arguments[0]||!self.MediaSource)&&self.ManagedMediaSource||self.MediaSource||self.WebKitMediaSource}function ha(e,t){const s=Object.keys(e),n=Object.keys(t),r=s.length,i=n.length;return!r||!i||r===i&&!s.some(e=>-1===n.indexOf(e))}function fa(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if("undefined"!==typeof TextDecoder){const s=new TextDecoder("utf-8").decode(e);if(t){const e=s.indexOf("\0");return-1!==e?s.substring(0,e):s}return s.replace(/\0/g,"")}const s=e.length;let n,r,i,a="",o=0;for(;o<s;){if(n=e[o++],0===n&&t)return a;if(0!==n&&3!==n)switch(n>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:a+=String.fromCharCode(n);break;case 12:case 13:r=e[o++],a+=String.fromCharCode((31&n)<<6|63&r);break;case 14:r=e[o++],i=e[o++],a+=String.fromCharCode((15&n)<<12|(63&r)<<6|63&i)}}return a}function ma(e){let t="";for(let s=0;s<e.length;s++){let n=e[s].toString(16);n.length<2&&(n="0"+n),t+=n}return t}function pa(e){return Uint8Array.from(e.replace(/^0x/,"").replace(/([\da-fA-F]{2}) ?/g,"0x$1 ").replace(/ +$/,"").split(" ")).buffer}function ga(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var va,ya={exports:{}};var ba=function(){return va||(va=1,e=ya,function(){var t=/^(?=((?:[a-zA-Z0-9+\-.]+:)?))\1(?=((?:\/\/[^\/?#]*)?))\2(?=((?:(?:[^?#\/]*\/)*[^;?#\/]*)?))\3((?:;[^?#]*)?)(\?[^#]*)?(#[^]*)?$/,s=/^(?=([^\/?#]*))\1([^]*)$/,n=/(?:\/|^)\.(?=\/)/g,r=/(?:\/|^)\.\.\/(?!\.\.\/)[^\/]*(?=\/)/g,i={buildAbsoluteURL:function(e,t,n){if(n=n||{},e=e.trim(),!(t=t.trim())){if(!n.alwaysNormalize)return e;var r=i.parseURL(e);if(!r)throw new Error("Error trying to parse base URL.");return r.path=i.normalizePath(r.path),i.buildURLFromParts(r)}var a=i.parseURL(t);if(!a)throw new Error("Error trying to parse relative URL.");if(a.scheme)return n.alwaysNormalize?(a.path=i.normalizePath(a.path),i.buildURLFromParts(a)):t;var o=i.parseURL(e);if(!o)throw new Error("Error trying to parse base URL.");if(!o.netLoc&&o.path&&"/"!==o.path[0]){var l=s.exec(o.path);o.netLoc=l[1],o.path=l[2]}o.netLoc&&!o.path&&(o.path="/");var c={scheme:o.scheme,netLoc:a.netLoc,path:null,params:a.params,query:a.query,fragment:a.fragment};if(!a.netLoc&&(c.netLoc=o.netLoc,"/"!==a.path[0]))if(a.path){var d=o.path,u=d.substring(0,d.lastIndexOf("/")+1)+a.path;c.path=i.normalizePath(u)}else c.path=o.path,a.params||(c.params=o.params,a.query||(c.query=o.query));return null===c.path&&(c.path=n.alwaysNormalize?i.normalizePath(a.path):a.path),i.buildURLFromParts(c)},parseURL:function(e){var s=t.exec(e);return s?{scheme:s[1]||"",netLoc:s[2]||"",path:s[3]||"",params:s[4]||"",query:s[5]||"",fragment:s[6]||""}:null},normalizePath:function(e){for(e=e.split("").reverse().join("").replace(n,"");e.length!==(e=e.replace(r,"")).length;);return e.split("").reverse().join("")},buildURLFromParts:function(e){return e.scheme+e.netLoc+e.path+e.params+e.query+e.fragment}};e.exports=i}()),ya.exports;var e}();class xa{constructor(){this.aborted=!1,this.loaded=0,this.retry=0,this.total=0,this.chunkCount=0,this.bwEstimate=0,this.loading={start:0,first:0,end:0},this.parsing={start:0,end:0},this.buffering={start:0,first:0,end:0}}}var Ea="audio",Sa="video",Ta="audiovideo";class ka{constructor(e){this._byteRange=null,this._url=null,this._stats=null,this._streams=null,this.base=void 0,this.relurl=void 0,"string"===typeof e&&(e={url:e}),this.base=e,function(e,t){const s=Aa(e,t);s&&(s.enumerable=!0,Object.defineProperty(e,t,s))}(this,"stats")}setByteRange(e,t){const s=e.split("@",2);let n;n=1===s.length?(null==t?void 0:t.byteRangeEndOffset)||0:parseInt(s[1]),this._byteRange=[n,parseInt(s[0])+n]}get baseurl(){return this.base.url}get byteRange(){return null===this._byteRange?[]:this._byteRange}get byteRangeStartOffset(){return this.byteRange[0]}get byteRangeEndOffset(){return this.byteRange[1]}get elementaryStreams(){return null===this._streams&&(this._streams={[Ea]:null,[Sa]:null,[Ta]:null}),this._streams}set elementaryStreams(e){this._streams=e}get hasStats(){return null!==this._stats}get hasStreams(){return null!==this._streams}get stats(){return null===this._stats&&(this._stats=new xa),this._stats}set stats(e){this._stats=e}get url(){return!this._url&&this.baseurl&&this.relurl&&(this._url=ba.buildAbsoluteURL(this.baseurl,this.relurl,{alwaysNormalize:!0})),this._url||""}set url(e){this._url=e}clearElementaryStreamInfo(){const{elementaryStreams:e}=this;e[Ea]=null,e[Sa]=null,e[Ta]=null}}function wa(e){return"initSegment"!==e.sn}class La extends ka{constructor(e,t){super(t),this._decryptdata=null,this._programDateTime=null,this._ref=null,this._bitrate=void 0,this.rawProgramDateTime=null,this.tagList=[],this.duration=0,this.sn=0,this.levelkeys=void 0,this.type=void 0,this.loader=null,this.keyLoader=null,this.level=-1,this.cc=0,this.startPTS=void 0,this.endPTS=void 0,this.startDTS=void 0,this.endDTS=void 0,this.start=0,this.playlistOffset=0,this.deltaPTS=void 0,this.maxStartPTS=void 0,this.minEndPTS=void 0,this.data=void 0,this.bitrateTest=!1,this.title=null,this.initSegment=null,this.endList=void 0,this.gap=void 0,this.urlId=0,this.type=e}get byteLength(){if(this.hasStats){const e=this.stats.total;if(e)return e}if(this.byteRange.length){const e=this.byteRange[0],t=this.byteRange[1];if(Ui(e)&&Ui(t))return t-e}return null}get bitrate(){return this.byteLength?8*this.byteLength/this.duration:this._bitrate?this._bitrate:null}set bitrate(e){this._bitrate=e}get decryptdata(){var e;const{levelkeys:t}=this;if(!t||t.NONE)return null;if(t.identity)this._decryptdata||(this._decryptdata=t.identity.getDecryptData(this.sn));else if(null==(e=this._decryptdata)||!e.keyId){const e=Object.keys(t);if(1===e.length){const s=this._decryptdata=t[e[0]]||null;s&&(this._decryptdata=s.getDecryptData(this.sn,t))}}return this._decryptdata}get end(){return this.start+this.duration}get endProgramDateTime(){if(null===this.programDateTime)return null;const e=Ui(this.duration)?this.duration:0;return this.programDateTime+1e3*e}get encrypted(){var e;if(null!=(e=this._decryptdata)&&e.encrypted)return!0;if(this.levelkeys){var t;const e=Object.keys(this.levelkeys),s=e.length;if(s>1||1===s&&null!=(t=this.levelkeys[e[0]])&&t.encrypted)return!0}return!1}get programDateTime(){return null===this._programDateTime&&this.rawProgramDateTime&&(this.programDateTime=Date.parse(this.rawProgramDateTime)),this._programDateTime}set programDateTime(e){Ui(e)?this._programDateTime=e:this._programDateTime=this.rawProgramDateTime=null}get ref(){return wa(this)?(this._ref||(this._ref={base:this.base,start:this.start,duration:this.duration,sn:this.sn,programDateTime:this.programDateTime}),this._ref):null}addStart(e){this.setStart(this.start+e)}setStart(e){this.start=e,this._ref&&(this._ref.start=e)}setDuration(e){this.duration=e,this._ref&&(this._ref.duration=e)}setKeyFormat(e){const t=this.levelkeys;if(t){var s;const n=t[e];!n||null!=(s=this._decryptdata)&&s.keyId||(this._decryptdata=n.getDecryptData(this.sn,t))}}abortRequests(){var e,t;null==(e=this.loader)||e.abort(),null==(t=this.keyLoader)||t.abort()}setElementaryStreamInfo(e,t,s,n,r){let i=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const{elementaryStreams:a}=this,o=a[e];o?(o.startPTS=Math.min(o.startPTS,t),o.endPTS=Math.max(o.endPTS,s),o.startDTS=Math.min(o.startDTS,n),o.endDTS=Math.max(o.endDTS,r)):a[e]={startPTS:t,endPTS:s,startDTS:n,endDTS:r,partial:i}}}class Ca extends ka{constructor(e,t,s,n,r){super(s),this.fragOffset=0,this.duration=0,this.gap=!1,this.independent=!1,this.relurl=void 0,this.fragment=void 0,this.index=void 0,this.duration=e.decimalFloatingPoint("DURATION"),this.gap=e.bool("GAP"),this.independent=e.bool("INDEPENDENT"),this.relurl=e.enumeratedString("URI"),this.fragment=t,this.index=n;const i=e.enumeratedString("BYTERANGE");i&&this.setByteRange(i,r),r&&(this.fragOffset=r.fragOffset+r.duration)}get start(){return this.fragment.start+this.fragOffset}get end(){return this.start+this.duration}get loaded(){const{elementaryStreams:e}=this;return!!(e.audio||e.video||e.audiovideo)}}function Aa(e,t){const s=Object.getPrototypeOf(e);if(s){const e=Object.getOwnPropertyDescriptor(s,t);return e||Aa(s,t)}}const Ra=Math.pow(2,32)-1,_a=[].push,Na={video:1,audio:2,id3:3,text:4};function Ia(e){return String.fromCharCode.apply(null,e)}function ja(e,t){const s=e[t]<<8|e[t+1];return s<0?65536+s:s}function Pa(e,t){const s=Ma(e,t);return s<0?4294967296+s:s}function Da(e,t){let s=Pa(e,t);return s*=Math.pow(2,32),s+=Pa(e,t+4),s}function Ma(e,t){return e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3]}function Oa(e,t){const s=[];if(!t.length)return s;const n=e.byteLength;for(let r=0;r<n;){const i=Pa(e,r),a=i>1?r+i:n;if(Ia(e.subarray(r+4,r+8))===t[0])if(1===t.length)s.push(e.subarray(r+8,a));else{const n=Oa(e.subarray(r+8,a),t.slice(1));n.length&&_a.apply(s,n)}r=a}return s}function Fa(e){const t=[],s=e[0];let n=8;const r=Pa(e,n);n+=4;let i=0,a=0;0===s?(i=Pa(e,n),a=Pa(e,n+4),n+=8):(i=Da(e,n),a=Da(e,n+8),n+=16),n+=2;let o=e.length+a;const l=ja(e,n);n+=2;for(let c=0;c<l;c++){let s=n;const i=Pa(e,s);s+=4;const a=2147483647&i;if(1===(2147483648&i)>>>31)return da.warn("SIDX has hierarchical references (not supported)"),null;const l=Pa(e,s);s+=4,t.push({referenceSize:a,subsegmentDuration:l,info:{duration:l/r,start:o,end:o+a-1}}),o+=a,s+=4,n=s}return{earliestPresentationTime:i,timescale:r,version:s,referencesCount:l,references:t}}function Ua(e){const t=[],s=Oa(e,["moov","trak"]);for(let n=0;n<s.length;n++){const e=s[n],r=Oa(e,["tkhd"])[0];if(r){let s=r[0];const n=Pa(r,0===s?12:20),i=Oa(e,["mdia","mdhd"])[0];if(i){s=i[0];const r=Pa(i,0===s?12:20),a=Oa(e,["mdia","hdlr"])[0];if(a){const s=Ia(a.subarray(8,12)),i={soun:Ea,vide:Sa}[s],o=Ba(Oa(e,["mdia","minf","stbl","stsd"])[0]);i?(t[n]={timescale:r,type:i,stsd:o},t[i]=na({timescale:r,id:n},o)):t[n]={timescale:r,type:s,stsd:o}}}}}return Oa(e,["moov","mvex","trex"]).forEach(e=>{const s=Pa(e,4),n=t[s];n&&(n.default={duration:Pa(e,12),flags:Pa(e,20)})}),t}function Ba(e){const t=e.subarray(8),s=t.subarray(86),n=Ia(t.subarray(4,8));let r,i=n;const a="enca"===n||"encv"===n;if(a){const e=Oa(t,[n])[0];Oa(e.subarray("enca"===n?28:78),["sinf"]).forEach(e=>{const t=Oa(e,["schm"])[0];if(t){const s=Ia(t.subarray(4,8));if("cbcs"===s||"cenc"===s){const t=Oa(e,["frma"])[0];t&&(i=Ia(t))}}})}const o=i;switch(i){case"avc1":case"avc2":case"avc3":case"avc4":{const e=Oa(s,["avcC"])[0];e&&e.length>3&&(i+="."+za(e[1])+za(e[2])+za(e[3]),r=Ga("avc1"===o?"dva1":"dvav",s));break}case"mp4a":{const e=Oa(t,[n])[0],s=Oa(e.subarray(28),["esds"])[0];if(s&&s.length>7){let e=4;if(3!==s[e++])break;e=Va(s,e),e+=2;const t=s[e++];if(128&t&&(e+=2),64&t&&(e+=s[e++]),4!==s[e++])break;e=Va(s,e);const n=s[e++];if(64!==n)break;if(i+="."+za(n),e+=12,5!==s[e++])break;e=Va(s,e);const r=s[e++];let a=(248&r)>>3;31===a&&(a+=1+((7&r)<<3)+((224&s[e])>>5)),i+="."+a}break}case"hvc1":case"hev1":{const e=Oa(s,["hvcC"])[0];if(e&&e.length>12){const t=e[1],s=["","A","B","C"][t>>6],n=31&t,r=Pa(e,2),a=(32&t)>>5?"H":"L",o=e[12],l=e.subarray(6,12);i+="."+s+n,i+="."+function(e){let t=0;for(let s=0;s<32;s++)t|=(e>>s&1)<<31-s;return t>>>0}(r).toString(16).toUpperCase(),i+="."+a+o;let c="";for(let e=l.length;e--;){const t=l[e];if(t||c){c="."+t.toString(16).toUpperCase()+c}}i+=c}r=Ga("hev1"==o?"dvhe":"dvh1",s);break}case"dvh1":case"dvhe":case"dvav":case"dva1":case"dav1":i=Ga(i,s)||i;break;case"vp09":{const e=Oa(s,["vpcC"])[0];if(e&&e.length>6){const t=e[4],s=e[5],n=e[6]>>4&15;i+="."+Ha(t)+"."+Ha(s)+"."+Ha(n)}break}case"av01":{const e=Oa(s,["av1C"])[0];if(e&&e.length>2){const t=e[1]>>>5,n=31&e[1],a=e[2]>>>7?"H":"M",o=(64&e[2])>>6,l=(32&e[2])>>5,c=2===t&&o?l?12:10:o?10:8,d=(16&e[2])>>4,u=(8&e[2])>>3,h=(4&e[2])>>2,f=3&e[2],m=1,p=1,g=1,v=0;i+="."+t+"."+Ha(n)+a+"."+Ha(c)+"."+d+"."+u+h+f+"."+Ha(m)+"."+Ha(p)+"."+Ha(g)+"."+v,r=Ga("dav1",s)}break}}return{codec:i,encrypted:a,supplemental:r}}function Ga(e,t){const s=Oa(t,["dvvC"]),n=s.length?s[0]:Oa(t,["dvcC"])[0];if(n){const t=n[2]>>1&127,s=n[2]<<5&32|n[3]>>3&31;return e+"."+Ha(t)+"."+Ha(s)}}function Va(e,t){const s=t+5;for(;128&e[t++]&&t<s;);return t}function za(e){return("0"+e.toString(16).toUpperCase()).slice(-2)}function Ha(e){return(e<10?"0":"")+e}function Ka(e,t){Oa(e,["moov","trak"]).forEach(e=>{const s=Oa(e,["mdia","minf","stbl","stsd"])[0];if(!s)return;const n=s.subarray(8);let r=Oa(n,["enca"]);const i=r.length>0;i||(r=Oa(n,["encv"])),r.forEach(e=>{Oa(i?e.subarray(28):e.subarray(78),["sinf"]).forEach(e=>{const s=Wa(e);s&&t(s,i)})})})}function Wa(e){const t=Oa(e,["schm"])[0];if(t){const s=Ia(t.subarray(4,8));if("cbcs"===s||"cenc"===s){const t=Oa(e,["schi","tenc"])[0];if(t)return t}}}function qa(e,t){const s=new Uint8Array(e.length+t.length);return s.set(e),s.set(t,e.length),s}function Ya(e,t){const s=[],n=t.samples,r=t.timescale,i=t.id;let a=!1;return Oa(n,["moof"]).map(o=>{const l=o.byteOffset-8;Oa(o,["traf"]).map(o=>{const c=Oa(o,["tfdt"]).map(e=>{const t=e[0];let s=Pa(e,4);return 1===t&&(s*=Math.pow(2,32),s+=Pa(e,8)),s/r})[0];return void 0!==c&&(e=c),Oa(o,["tfhd"]).map(c=>{const d=Pa(c,4),u=16777215&Pa(c,0);let h=0;const f=0!==(16&u);let m=0;const p=0!==(32&u);let g=8;d===i&&(0!==(1&u)&&(g+=8),0!==(2&u)&&(g+=4),0!==(8&u)&&(h=Pa(c,g),g+=4),f&&(m=Pa(c,g),g+=4),p&&(g+=4),"video"===t.type&&(a=Xa(t.codec)),Oa(o,["trun"]).map(i=>{const o=i[0],c=16777215&Pa(i,0),d=0!==(1&c);let u=0;const f=0!==(4&c),p=0!==(256&c);let g=0;const v=0!==(512&c);let y=0;const b=0!==(1024&c),x=0!==(2048&c);let E=0;const S=Pa(i,4);let T=8;d&&(u=Pa(i,T),T+=4),f&&(T+=4);let k=u+l;for(let l=0;l<S;l++){if(p?(g=Pa(i,T),T+=4):g=h,v?(y=Pa(i,T),T+=4):y=m,b&&(T+=4),x&&(E=0===o?Pa(i,T):Ma(i,T),T+=4),t.type===Sa){let t=0;for(;t<y;){const i=Pa(n,k);if(k+=4,Qa(a,n[k])){$a(n.subarray(k,k+i),a?2:1,e+E/r,s)}k+=i,t+=i+4}}e+=g/r}}))})})}),s}function Xa(e){if(!e)return!1;const t=e.substring(0,4);return"hvc1"===t||"hev1"===t||"dvh1"===t||"dvhe"===t}function Qa(e,t){if(e){const e=t>>1&63;return 39===e||40===e}return 6===(31&t)}function $a(e,t,s,n){const r=Ja(e);let i=0;i+=t;let a=0,o=0,l=0;for(;i<r.length;){a=0;do{if(i>=r.length)break;l=r[i++],a+=l}while(255===l);o=0;do{if(i>=r.length)break;l=r[i++],o+=l}while(255===l);const e=r.length-i;let t=i;if(o<e)i+=o;else if(o>e){da.error("Malformed SEI payload. ".concat(o," is too small, only ").concat(e," bytes left to parse."));break}if(4===a){if(181===r[t++]){const e=ja(r,t);if(t+=2,49===e){const e=Pa(r,t);if(t+=4,1195456820===e){const e=r[t++];if(3===e){const i=r[t++],o=64&i,l=o?2+3*(31&i):0,c=new Uint8Array(l);if(o){c[0]=i;for(let e=1;e<l;e++)c[e]=r[t++]}n.push({type:e,payloadType:a,pts:s,bytes:c})}}}}}else if(5===a&&o>16){const e=[];for(let s=0;s<16;s++){const n=r[t++].toString(16);e.push(1==n.length?"0"+n:n),3!==s&&5!==s&&7!==s&&9!==s||e.push("-")}const i=o-16,l=new Uint8Array(i);for(let s=0;s<i;s++)l[s]=r[t++];n.push({payloadType:a,pts:s,uuid:e.join(""),userData:fa(l),userDataBytes:l})}}}function Ja(e){const t=e.byteLength,s=[];let n=1;for(;n<t-2;)0===e[n]&&0===e[n+1]&&3===e[n+2]?(s.push(n+2),n+=2):n++;if(0===s.length)return e;const r=t-s.length,i=new Uint8Array(r);let a=0;for(n=0;n<r;a++,n++)a===s[0]&&(a++,s.shift()),i[n]=e[a];return i}function Za(e,t,s){if(16!==e.byteLength)throw new RangeError("Invalid system id");let n,r,i;n=0,r=new Uint8Array,i=new Uint8Array;const a=new Uint8Array(4);return s.byteLength>0&&new DataView(a.buffer).setUint32(0,s.byteLength,!1),function(e){for(var t=arguments.length,s=new Array(t>1?t-1:0),n=1;n<t;n++)s[n-1]=arguments[n];const r=s.length;let i=8,a=r;for(;a--;)i+=s[a].byteLength;const o=new Uint8Array(i);for(o[0]=i>>24&255,o[1]=i>>16&255,o[2]=i>>8&255,o[3]=255&i,o.set(e,4),a=0,i=8;a<r;a++)o.set(s[a],i),i+=s[a].byteLength;return o}([112,115,115,104],new Uint8Array([0,0,0,0]),e,i,r,a,s)}function eo(e){const t=e.getUint32(0),s=e.byteOffset,n=e.byteLength;if(n<t)return{offset:s,size:n};if(1886614376!==e.getUint32(4))return{offset:s,size:t};const r=e.getUint32(8)>>>24;if(0!==r&&1!==r)return{offset:s,size:t};const i=e.buffer,a=ma(new Uint8Array(i,s+12,16));let o=null,l=null,c=0;if(0===r)c=28;else{const r=e.getUint32(28);if(!r||n<32+16*r)return{offset:s,size:t};o=[];for(let e=0;e<r;e++)o.push(new Uint8Array(i,s+32+16*e,16));c=32+16*r}if(!c)return{offset:s,size:t};const d=e.getUint32(c);return t-32<d?{offset:s,size:t}:(l=new Uint8Array(i,s+c+4,d),{version:r,systemId:a,kids:o,data:l,offset:s,size:t})}const to=()=>/\(Windows.+Firefox\//i.test(navigator.userAgent),so={audio:{a3ds:1,"ac-3":.95,"ac-4":1,alac:.9,alaw:1,dra1:1,"dts+":1,"dts-":1,dtsc:1,dtse:1,dtsh:1,"ec-3":.9,enca:1,fLaC:.9,flac:.9,FLAC:.9,g719:1,g726:1,m4ae:1,mha1:1,mha2:1,mhm1:1,mhm2:1,mlpa:1,mp4a:1,"raw ":1,Opus:1,opus:1,samr:1,sawb:1,sawp:1,sevc:1,sqcp:1,ssmv:1,twos:1,ulaw:1},video:{avc1:1,avc2:1,avc3:1,avc4:1,avcp:1,av01:.8,dav1:.8,drac:1,dva1:1,dvav:1,dvh1:.7,dvhe:.7,encv:1,hev1:.75,hvc1:.75,mjp2:1,mp4v:1,mvc1:1,mvc2:1,mvc3:1,mvc4:1,resv:1,rv60:1,s263:1,svc1:1,svc2:1,"vc-1":1,vp08:1,vp09:.9},text:{stpp:1,wvtt:1}};function no(e,t){const s=so[t];return!!s&&!!s[e.slice(0,4)]}function ro(e,t){let s=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return!e.split(",").some(e=>!io(e,t,s))}function io(e,t){var s;const n=ua(!(arguments.length>2&&void 0!==arguments[2])||arguments[2]);return null!=(s=null==n?void 0:n.isTypeSupported(ao(e,t)))&&s}function ao(e,t){return"".concat(t,"/mp4;codecs=").concat(e)}function oo(e){if(e){const t=e.substring(0,4);return so.video[t]}return 2}function lo(e){const t=to();return e.split(",").reduce((e,s)=>{const n=t&&Xa(s)?9:so.video[s];return n?(2*n+e)/(e?3:2):(so.audio[s]+e)/(e?2:1)},0)}const co={};const uo=/flac|opus|mp4a\.40\.34/i;function ho(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return e.replace(uo,e=>function(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(co[e])return co[e];const s={flac:["flac","fLaC","FLAC"],opus:["opus","Opus"],"mp4a.40.34":["mp3"]}[e];for(let r=0;r<s.length;r++){var n;if(io(s[r],"audio",t))return co[e]=s[r],s[r];if("mp3"===s[r]&&null!=(n=ua(t))&&n.isTypeSupported("audio/mpeg"))return""}return e}(e.toLowerCase(),t))}function fo(e,t){if(e&&(e.length>4||-1!==["ac-3","ec-3","alac","fLaC","Opus"].indexOf(e))&&(mo(e,"audio")||mo(e,"video")))return e;if(t){const s=t.split(",");if(s.length>1){if(e)for(let t=s.length;t--;)if(s[t].substring(0,4)===e.substring(0,4))return s[t];return s[0]}}return t||e}function mo(e,t){return no(e,t)&&io(e,t)}function po(e){if(e.startsWith("av01.")){const t=e.split("."),s=["0","111","01","01","01","0"];for(let e=t.length;e>4&&e<10;e++)t[e]=s[e-4];return t.join(".")}return e}function go(e){const t=ua(e)||{isTypeSupported:()=>!1};return{mpeg:t.isTypeSupported("audio/mpeg"),mp3:t.isTypeSupported('audio/mp4; codecs="mp3"'),ac3:t.isTypeSupported('audio/mp4; codecs="ac-3"')}}function vo(e){return e.replace(/^.+codecs=["']?([^"']+).*$/,"$1")}const yo={supported:!1,smooth:!1,powerEfficient:!1},bo={supported:!0,configurations:[],decodingInfoResults:[{supported:!0,powerEfficient:!0,smooth:!0}]};function xo(e,t){return{supported:!1,configurations:t,decodingInfoResults:[yo],error:e}}function Eo(e,t,s,n,r,i){const a=e.videoCodec,o=e.audioCodec?e.audioGroups:null,l=null==i?void 0:i.audioCodec,c=null==i?void 0:i.channels,d=c?parseInt(c):l?1/0:2;let u=null;if(null!=o&&o.length)try{u=1===o.length&&o[0]?t.groups[o[0]].channels:o.reduce((e,s)=>{if(s){const n=t.groups[s];if(!n)throw new Error("Audio track group ".concat(s," not found"));Object.keys(n.channels).forEach(t=>{e[t]=(e[t]||0)+n.channels[t]})}return e},{2:0})}catch(h){return!0}return void 0!==a&&(a.split(",").some(e=>Xa(e))||e.width>1920&&e.height>1088||e.height>1920&&e.width>1088||e.frameRate>Math.max(n,30)||"SDR"!==e.videoRange&&e.videoRange!==s||e.bitrate>Math.max(r,8e6))||!!u&&Ui(d)&&Object.keys(u).some(e=>parseInt(e)>d)}function So(e,t,s){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};const r=e.videoCodec;if(!r&&!e.audioCodec||!s)return Promise.resolve(bo);const i=[],a=function(e){var t;const s=null==(t=e.videoCodec)?void 0:t.split(","),n=ko(e),r=e.width||640,i=e.height||480,a=e.frameRate||30,o=e.videoRange.toLowerCase();return s?s.map(e=>{const t={contentType:ao(po(e),"video"),width:r,height:i,bitrate:n,framerate:a};return"sdr"!==o&&(t.transferFunction=o),t}):[]}(e),o=a.length,l=function(e,t,s){var n;const r=null==(n=e.audioCodec)?void 0:n.split(","),i=ko(e);if(r&&e.audioGroups)return e.audioGroups.reduce((e,n)=>{var a;const o=n?null==(a=t.groups[n])?void 0:a.tracks:null;return o?o.reduce((e,t)=>{if(t.groupId===n){const n=parseFloat(t.channels||"");r.forEach(t=>{const r={contentType:ao(t,"audio"),bitrate:s?To(t,i):i};n&&(r.channels=""+n),e.push(r)})}return e},e):e},[]);return[]}(e,t,o>0),c=l.length;for(let d=o||1*c||1;d--;){const e={type:"media-source"};if(o&&(e.video=a[d%o]),c){e.audio=l[d%c];const t=e.audio.bitrate;e.video&&t&&(e.video.bitrate-=t)}i.push(e)}if(r){const e=navigator.userAgent;if(r.split(",").some(e=>Xa(e))&&to())return Promise.resolve(xo(new Error("Overriding Windows Firefox HEVC MediaCapabilities result based on user-agent string: (".concat(e,")")),i))}return Promise.all(i.map(e=>{const t=function(e){let t="";const{audio:s,video:n}=e;if(n){const e=vo(n.contentType);t+="".concat(e,"_r").concat(n.height,"x").concat(n.width,"f").concat(Math.ceil(n.framerate)).concat(n.transferFunction||"sd","_").concat(Math.ceil(n.bitrate/1e5))}if(s){const e=vo(s.contentType);t+="".concat(n?"_":"").concat(e,"_c").concat(s.channels)}return t}(e);return n[t]||(n[t]=s.decodingInfo(e))})).then(e=>({supported:!e.some(e=>!e.supported),configurations:i,decodingInfoResults:e})).catch(e=>({supported:!1,configurations:i,decodingInfoResults:[],error:e}))}function To(e,t){if(t<=1)return 1;let s=128e3;return"ec-3"===e?s=768e3:"ac-3"===e&&(s=64e4),Math.min(t/2,s)}function ko(e){return 1e3*Math.ceil(Math.max(.9*e.bitrate,e.averageBitrate)/1e3)||1}const wo=["NONE","TYPE-0","TYPE-1",null];const Lo=["SDR","PQ","HLG"];var Co="",Ao="YES",Ro="v2";function _o(e){const{canSkipUntil:t,canSkipDateRanges:s,age:n}=e;return t&&n<t/2?s?Ro:Ao:Co}class No{constructor(e,t,s){this.msn=void 0,this.part=void 0,this.skip=void 0,this.msn=e,this.part=t,this.skip=s}addDirectives(e){const t=new self.URL(e);return void 0!==this.msn&&t.searchParams.set("_HLS_msn",this.msn.toString()),void 0!==this.part&&t.searchParams.set("_HLS_part",this.part.toString()),this.skip&&t.searchParams.set("_HLS_skip",this.skip),t.href}}class Io{constructor(e){if(this._attrs=void 0,this.audioCodec=void 0,this.bitrate=void 0,this.codecSet=void 0,this.url=void 0,this.frameRate=void 0,this.height=void 0,this.id=void 0,this.name=void 0,this.supplemental=void 0,this.videoCodec=void 0,this.width=void 0,this.details=void 0,this.fragmentError=0,this.loadError=0,this.loaded=void 0,this.realBitrate=0,this.supportedPromise=void 0,this.supportedResult=void 0,this._avgBitrate=0,this._audioGroups=void 0,this._subtitleGroups=void 0,this._urlId=0,this.url=[e.url],this._attrs=[e.attrs],this.bitrate=e.bitrate,e.details&&(this.details=e.details),this.id=e.id||0,this.name=e.name,this.width=e.width||0,this.height=e.height||0,this.frameRate=e.attrs.optionalFloat("FRAME-RATE",0),this._avgBitrate=e.attrs.decimalInteger("AVERAGE-BANDWIDTH"),this.audioCodec=e.audioCodec,this.videoCodec=e.videoCodec,this.codecSet=[e.videoCodec,e.audioCodec].filter(e=>!!e).map(e=>e.substring(0,4)).join(","),"supplemental"in e){var t;this.supplemental=e.supplemental;const s=null==(t=e.supplemental)?void 0:t.videoCodec;s&&s!==e.videoCodec&&(this.codecSet+=",".concat(s.substring(0,4)))}this.addGroupId("audio",e.attrs.AUDIO),this.addGroupId("text",e.attrs.SUBTITLES)}get maxBitrate(){return Math.max(this.realBitrate,this.bitrate)}get averageBitrate(){return this._avgBitrate||this.realBitrate||this.bitrate}get attrs(){return this._attrs[0]}get codecs(){return this.attrs.CODECS||""}get pathwayId(){return this.attrs["PATHWAY-ID"]||"."}get videoRange(){return this.attrs["VIDEO-RANGE"]||"SDR"}get score(){return this.attrs.optionalFloat("SCORE",0)}get uri(){return this.url[0]||""}hasAudioGroup(e){return jo(this._audioGroups,e)}hasSubtitleGroup(e){return jo(this._subtitleGroups,e)}get audioGroups(){return this._audioGroups}get subtitleGroups(){return this._subtitleGroups}addGroupId(e,t){if(t)if("audio"===e){let e=this._audioGroups;e||(e=this._audioGroups=[]),-1===e.indexOf(t)&&e.push(t)}else if("text"===e){let e=this._subtitleGroups;e||(e=this._subtitleGroups=[]),-1===e.indexOf(t)&&e.push(t)}}get urlId(){return 0}set urlId(e){}get audioGroupIds(){return this.audioGroups?[this.audioGroupId]:void 0}get textGroupIds(){return this.subtitleGroups?[this.textGroupId]:void 0}get audioGroupId(){var e;return null==(e=this.audioGroups)?void 0:e[0]}get textGroupId(){var e;return null==(e=this.subtitleGroups)?void 0:e[0]}addFallback(){}}function jo(e,t){return!(!t||!e)&&-1!==e.indexOf(t)}function Po(e,t){let s=!1,n=[];if(e&&(s="SDR"!==e,n=[e]),t){n=t.allowedVideoRanges||Lo.slice(0);const e="SDR"!==n.join("")&&!t.videoCodec;s=void 0!==t.preferHDR?t.preferHDR:e&&function(){if("function"===typeof matchMedia){const e=matchMedia("(dynamic-range: high)"),t=matchMedia("bad query");if(e.media!==t.media)return!0===e.matches}return!1}(),s||(n=["SDR"])}return{preferHDR:s,allowedVideoRanges:n}}const Do=(e,t)=>JSON.stringify(e,(e=>{const t=new WeakSet;return(s,n)=>{if(e&&(n=e(s,n)),"object"===typeof n&&null!==n){if(t.has(n))return;t.add(n)}return n}})(t));function Mo(e,t){da.log('[abr] start candidates with "'.concat(e,'" ignored because ').concat(t))}function Oo(e){return e.reduce((e,t)=>{let s=e.groups[t.groupId];s||(s=e.groups[t.groupId]={tracks:[],channels:{2:0},hasDefault:!1,hasAutoSelect:!1}),s.tracks.push(t);const n=t.channels||"2";return s.channels[n]=(s.channels[n]||0)+1,s.hasDefault=s.hasDefault||t.default,s.hasAutoSelect=s.hasAutoSelect||t.autoselect,s.hasDefault&&(e.hasDefaultAudio=!0),s.hasAutoSelect&&(e.hasAutoSelectAudio=!0),e},{hasDefaultAudio:!1,hasAutoSelectAudio:!1,groups:{}})}function Fo(e){if(!e)return e;const{lang:t,assocLang:s,characteristics:n,channels:r,audioCodec:i}=e;return{lang:t,assocLang:s,characteristics:n,channels:r,audioCodec:i}}function Uo(e,t,s){if("attrs"in e){const s=t.indexOf(e);if(-1!==s)return s}for(let n=0;n<t.length;n++){if(Bo(e,t[n],s))return n}return-1}function Bo(e,t,s){const{groupId:n,name:r,lang:i,assocLang:a,default:o}=e,l=e.forced;return(void 0===n||t.groupId===n)&&(void 0===r||t.name===r)&&(void 0===i||function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"--";if(e.length===t.length)return e===t;return e.startsWith(t)||t.startsWith(e)}(i,t.lang))&&(void 0===i||t.assocLang===a)&&(void 0===o||t.default===o)&&(void 0===l||t.forced===l)&&(!("characteristics"in e)||function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";const s=e.split(","),n=t.split(",");return s.length===n.length&&!s.some(e=>-1===n.indexOf(e))}(e.characteristics||"",t.characteristics))&&(void 0===s||s(e,t))}function Go(e,t){const{audioCodec:s,channels:n}=e;return(void 0===s||(t.audioCodec||"").substring(0,4)===s.substring(0,4))&&(void 0===n||n===(t.channels||"2"))}function Vo(e,t,s){for(let n=t;n>-1;n--)if(s(e[n]))return n;for(let n=t+1;n<e.length;n++)if(s(e[n]))return n;return-1}function zo(e,t){var s;return!!e&&e!==(null==(s=t.loadLevelObj)?void 0:s.uri)}const Ho=function(e,t){let s=0,n=e.length-1,r=null,i=null;for(;s<=n;){r=(s+n)/2|0,i=e[r];const a=t(i);if(a>0)s=r+1;else{if(!(a<0))return i;n=r-1}}return null};function Ko(e,t){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:.005,i=null;if(e){i=t[1+e.sn-t[0].sn]||null;const n=e.endDTS-s;n>0&&n<15e-7&&(s+=15e-7),i&&e.level!==i.level&&i.end<=e.end&&(i=t[2+e.sn-t[0].sn]||null)}else 0===s&&0===t[0].start&&(i=t[0]);if(i&&((!e||e.level===i.level)&&0===Wo(s,n,i)||function(e,t,s){if(t&&0===t.start&&t.level<e.level&&(t.endPTS||0)>0){const n=t.tagList.reduce((e,t)=>("INF"===t[0]&&(e+=parseFloat(t[1])),e),s);return e.start<=n}return!1}(i,e,Math.min(r,n))))return i;const a=Ho(t,Wo.bind(null,s,n));return!a||a===e&&i?i:a}function Wo(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,s=arguments.length>2?arguments[2]:void 0;if(s.start<=e&&s.start+s.duration>e)return 0;const n=Math.min(t,s.duration+(s.deltaPTS?s.deltaPTS:0));return s.start+s.duration-n<=e?1:s.start-n>e&&s.start?-1:0}function qo(e,t,s){const n=1e3*Math.min(t,s.duration+(s.deltaPTS?s.deltaPTS:0));return(s.endProgramDateTime||0)-n>e}function Yo(e,t,s){if(e&&e.startCC<=t&&e.endCC>=t){let n=e.fragments;const{fragmentHint:r}=e;let i;return r&&(n=n.concat(r)),Ho(n,e=>e.cc<t?1:e.cc>t?-1:(i=e,e.end<=s?1:e.start>s?-1:0)),i||null}return null}function Xo(e){switch(e.details){case zi.FRAG_LOAD_TIMEOUT:case zi.KEY_LOAD_TIMEOUT:case zi.LEVEL_LOAD_TIMEOUT:case zi.MANIFEST_LOAD_TIMEOUT:return!0}return!1}function Qo(e){return e.details.startsWith("key")}function $o(e){return Qo(e)&&!!e.frag&&!e.frag.decryptdata}function Jo(e,t){const s=Xo(t);return e.default["".concat(s?"timeout":"error","Retry")]}function Zo(e,t){const s="linear"===e.backoff?1:Math.pow(2,t);return Math.min(s*e.retryDelayMs,e.maxRetryDelayMs)}function el(e){return na(na({},e),{errorRetry:null,timeoutRetry:null})}function tl(e,t,s,n){if(!e)return!1;const r=null==n?void 0:n.code,i=t<e.maxNumRetry&&(function(e){return sl(e)||!!e&&(e<400||e>499)}(r)||!!s);return e.shouldRetry?e.shouldRetry(e,t,s,n,i):i}function sl(e){return 0===e&&!1===navigator.onLine}var nl=0,rl=2,il=3,al=5,ol=0,ll=1,cl=2,dl=4;function ul(e){const t={action:nl,flags:ol};return e&&(t.resolved=!0),t}var hl="NOT_LOADED",fl="APPENDING",ml="PARTIAL",pl="OK";class gl{constructor(e){this.activePartLists=Object.create(null),this.endListFragments=Object.create(null),this.fragments=Object.create(null),this.timeRanges=Object.create(null),this.bufferPadding=.2,this.hls=void 0,this.hasGaps=!1,this.hls=e,this._registerListeners()}_registerListeners(){const{hls:e}=this;e&&(e.on(Hi.MANIFEST_LOADING,this.onManifestLoading,this),e.on(Hi.BUFFER_APPENDED,this.onBufferAppended,this),e.on(Hi.FRAG_BUFFERED,this.onFragBuffered,this),e.on(Hi.FRAG_LOADED,this.onFragLoaded,this))}_unregisterListeners(){const{hls:e}=this;e&&(e.off(Hi.MANIFEST_LOADING,this.onManifestLoading,this),e.off(Hi.BUFFER_APPENDED,this.onBufferAppended,this),e.off(Hi.FRAG_BUFFERED,this.onFragBuffered,this),e.off(Hi.FRAG_LOADED,this.onFragLoaded,this))}destroy(){this._unregisterListeners(),this.hls=this.fragments=this.activePartLists=this.endListFragments=this.timeRanges=null}getAppendedFrag(e,t){const s=this.activePartLists[t];if(s)for(let n=s.length;n--;){const t=s[n];if(!t)break;if(t.start<=e&&e<=t.end&&t.loaded)return t}return this.getBufferedFrag(e,t)}getBufferedFrag(e,t){return this.getFragAtPos(e,t,!0)}getFragAtPos(e,t,s){const{fragments:n}=this,r=Object.keys(n);for(let i=r.length;i--;){const a=n[r[i]];if((null==a?void 0:a.body.type)===t&&(!s||a.buffered)){const t=a.body;if(t.start<=e&&e<=t.end)return t}}return null}detectEvictedFragments(e,t,s,n,r){this.timeRanges&&(this.timeRanges[e]=t);const i=(null==n?void 0:n.fragment.sn)||-1;Object.keys(this.fragments).forEach(n=>{const a=this.fragments[n];if(!a)return;if(i>=a.body.sn)return;if(!a.buffered&&(!a.loaded||r))return void(a.body.type===s&&this.removeFragment(a.body));const o=a.range[e];o&&(0!==o.time.length?o.time.some(e=>{const s=!this.isTimeBuffered(e.startPTS,e.endPTS,t);return s&&this.removeFragment(a.body),s}):this.removeFragment(a.body))})}detectPartialFragments(e){const t=this.timeRanges;if(!t||"initSegment"===e.frag.sn)return;const s=e.frag,n=yl(s),r=this.fragments[n];if(!r||r.buffered&&s.gap)return;const i=!s.relurl;Object.keys(t).forEach(n=>{const a=s.elementaryStreams[n];if(!a)return;const o=t[n],l=i||!0===a.partial;r.range[n]=this.getBufferedTimes(s,e.part,l,o)}),r.loaded=null,Object.keys(r.range).length?(this.bufferedEnd(r,s),vl(r)||this.removeParts(s.sn-1,s.type)):this.removeFragment(r.body)}bufferedEnd(e,t){e.buffered=!0;(e.body.endList=t.endList||e.body.endList)&&(this.endListFragments[e.body.type]=e)}removeParts(e,t){const s=this.activePartLists[t];s&&(this.activePartLists[t]=bl(s,t=>t.fragment.sn>=e))}fragBuffered(e,t){const s=yl(e);let n=this.fragments[s];!n&&t&&(n=this.fragments[s]={body:e,appendedPTS:null,loaded:null,buffered:!1,range:Object.create(null)},e.gap&&(this.hasGaps=!0)),n&&(n.loaded=null,this.bufferedEnd(n,e))}getBufferedTimes(e,t,s,n){const r={time:[],partial:s},i=e.start,a=e.end,o=e.minEndPTS||a,l=e.maxStartPTS||i;for(let c=0;c<n.length;c++){const e=n.start(c)-this.bufferPadding,t=n.end(c)+this.bufferPadding;if(l>=e&&o<=t){r.time.push({startPTS:Math.max(i,n.start(c)),endPTS:Math.min(a,n.end(c))});break}if(i<t&&a>e){const e=Math.max(i,n.start(c)),t=Math.min(a,n.end(c));t>e&&(r.partial=!0,r.time.push({startPTS:e,endPTS:t}))}else if(a<=e)break}return r}getPartialFragment(e){let t,s,n,r=null,i=0;const{bufferPadding:a,fragments:o}=this;return Object.keys(o).forEach(l=>{const c=o[l];c&&vl(c)&&(s=c.body.start-a,n=c.body.end+a,e>=s&&e<=n&&(t=Math.min(e-s,n-e),i<=t&&(r=c.body,i=t)))}),r}isEndListAppended(e){const t=this.endListFragments[e];return void 0!==t&&(t.buffered||vl(t))}getState(e){const t=yl(e),s=this.fragments[t];return s?s.buffered?vl(s)?ml:pl:fl:hl}isTimeBuffered(e,t,s){let n,r;for(let i=0;i<s.length;i++){if(n=s.start(i)-this.bufferPadding,r=s.end(i)+this.bufferPadding,e>=n&&t<=r)return!0;if(t<=n)return!1}return!1}onManifestLoading(){this.removeAllFragments()}onFragLoaded(e,t){if("initSegment"===t.frag.sn||t.frag.bitrateTest)return;const s=t.frag,n=t.part?null:t,r=yl(s);this.fragments[r]={body:s,appendedPTS:null,loaded:n,buffered:!1,range:Object.create(null)}}onBufferAppended(e,t){const{frag:s,part:n,timeRanges:r,type:i}=t;if("initSegment"===s.sn)return;const a=s.type;if(n){let e=this.activePartLists[a];e||(this.activePartLists[a]=e=[]),e.push(n)}this.timeRanges=r;const o=r[i];this.detectEvictedFragments(i,o,a,n)}onFragBuffered(e,t){this.detectPartialFragments(t)}hasFragment(e){const t=yl(e);return!!this.fragments[t]}hasFragments(e){const{fragments:t}=this,s=Object.keys(t);if(!e)return s.length>0;for(let n=s.length;n--;){const r=t[s[n]];if((null==r?void 0:r.body.type)===e)return!0}return!1}hasParts(e){var t;return!(null==(t=this.activePartLists[e])||!t.length)}removeFragmentsInRange(e,t,s,n,r){n&&!this.hasGaps||Object.keys(this.fragments).forEach(i=>{const a=this.fragments[i];if(!a)return;const o=a.body;o.type!==s||n&&!o.gap||o.start<t&&o.end>e&&(a.buffered||r)&&this.removeFragment(o)})}removeFragment(e){const t=yl(e);e.clearElementaryStreamInfo();const s=this.activePartLists[e.type];if(s){const t=e.sn;this.activePartLists[e.type]=bl(s,e=>e.fragment.sn!==t)}delete this.fragments[t],e.endList&&delete this.endListFragments[e.type]}removeAllFragments(){var e;this.fragments=Object.create(null),this.endListFragments=Object.create(null),this.activePartLists=Object.create(null),this.hasGaps=!1;const t=null==(e=this.hls)||null==(e=e.latestLevelDetails)?void 0:e.partList;t&&t.forEach(e=>e.clearElementaryStreamInfo())}}function vl(e){var t,s,n;return e.buffered&&!!(e.body.gap||null!=(t=e.range.video)&&t.partial||null!=(s=e.range.audio)&&s.partial||null!=(n=e.range.audiovideo)&&n.partial)}function yl(e){return"".concat(e.type,"_").concat(e.level,"_").concat(e.sn)}function bl(e,t){return e.filter(e=>{const s=t(e);return s||e.clearElementaryStreamInfo(),s})}var xl=0,El=1;class Sl{constructor(e,t,s){this.subtle=void 0,this.aesIV=void 0,this.aesMode=void 0,this.subtle=e,this.aesIV=t,this.aesMode=s}decrypt(e,t){switch(this.aesMode){case xl:return this.subtle.decrypt({name:"AES-CBC",iv:this.aesIV},t,e);case El:return this.subtle.decrypt({name:"AES-CTR",counter:this.aesIV,length:64},t,e);default:throw new Error("[AESCrypto] invalid aes mode ".concat(this.aesMode))}}}class Tl{constructor(){this.rcon=[0,1,2,4,8,16,32,64,128,27,54],this.subMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.invSubMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.sBox=new Uint32Array(256),this.invSBox=new Uint32Array(256),this.key=new Uint32Array(0),this.ksRows=0,this.keySize=0,this.keySchedule=void 0,this.invKeySchedule=void 0,this.initTable()}uint8ArrayToUint32Array_(e){const t=new DataView(e),s=new Uint32Array(4);for(let n=0;n<4;n++)s[n]=t.getUint32(4*n);return s}initTable(){const e=this.sBox,t=this.invSBox,s=this.subMix,n=s[0],r=s[1],i=s[2],a=s[3],o=this.invSubMix,l=o[0],c=o[1],d=o[2],u=o[3],h=new Uint32Array(256);let f=0,m=0,p=0;for(p=0;p<256;p++)h[p]=p<128?p<<1:p<<1^283;for(p=0;p<256;p++){let s=m^m<<1^m<<2^m<<3^m<<4;s=s>>>8^255&s^99,e[f]=s,t[s]=f;const o=h[f],p=h[o],g=h[p];let v=257*h[s]^16843008*s;n[f]=v<<24|v>>>8,r[f]=v<<16|v>>>16,i[f]=v<<8|v>>>24,a[f]=v,v=16843009*g^65537*p^257*o^16843008*f,l[s]=v<<24|v>>>8,c[s]=v<<16|v>>>16,d[s]=v<<8|v>>>24,u[s]=v,f?(f=o^h[h[h[g^o]]],m^=h[h[m]]):f=m=1}}expandKey(e){const t=this.uint8ArrayToUint32Array_(e);let s=!0,n=0;for(;n<t.length&&s;)s=t[n]===this.key[n],n++;if(s)return;this.key=t;const r=this.keySize=t.length;if(4!==r&&6!==r&&8!==r)throw new Error("Invalid aes key size="+r);const i=this.ksRows=4*(r+6+1);let a,o;const l=this.keySchedule=new Uint32Array(i),c=this.invKeySchedule=new Uint32Array(i),d=this.sBox,u=this.rcon,h=this.invSubMix,f=h[0],m=h[1],p=h[2],g=h[3];let v,y;for(a=0;a<i;a++)a<r?v=l[a]=t[a]:(y=v,a%r===0?(y=y<<8|y>>>24,y=d[y>>>24]<<24|d[y>>>16&255]<<16|d[y>>>8&255]<<8|d[255&y],y^=u[a/r|0]<<24):r>6&&a%r===4&&(y=d[y>>>24]<<24|d[y>>>16&255]<<16|d[y>>>8&255]<<8|d[255&y]),l[a]=v=(l[a-r]^y)>>>0);for(o=0;o<i;o++)a=i-o,y=3&o?l[a]:l[a-4],c[o]=o<4||a<=4?y:f[d[y>>>24]]^m[d[y>>>16&255]]^p[d[y>>>8&255]]^g[d[255&y]],c[o]=c[o]>>>0}networkToHostOrderSwap(e){return e<<24|(65280&e)<<8|(16711680&e)>>8|e>>>24}decrypt(e,t,s){const n=this.keySize+6,r=this.invKeySchedule,i=this.invSBox,a=this.invSubMix,o=a[0],l=a[1],c=a[2],d=a[3],u=this.uint8ArrayToUint32Array_(s);let h=u[0],f=u[1],m=u[2],p=u[3];const g=new Int32Array(e),v=new Int32Array(g.length);let y,b,x,E,S,T,k,w,L,C,A,R,_,N;const I=this.networkToHostOrderSwap;for(;t<g.length;){for(L=I(g[t]),C=I(g[t+1]),A=I(g[t+2]),R=I(g[t+3]),S=L^r[0],T=R^r[1],k=A^r[2],w=C^r[3],_=4,N=1;N<n;N++)y=o[S>>>24]^l[T>>16&255]^c[k>>8&255]^d[255&w]^r[_],b=o[T>>>24]^l[k>>16&255]^c[w>>8&255]^d[255&S]^r[_+1],x=o[k>>>24]^l[w>>16&255]^c[S>>8&255]^d[255&T]^r[_+2],E=o[w>>>24]^l[S>>16&255]^c[T>>8&255]^d[255&k]^r[_+3],S=y,T=b,k=x,w=E,_+=4;y=i[S>>>24]<<24^i[T>>16&255]<<16^i[k>>8&255]<<8^i[255&w]^r[_],b=i[T>>>24]<<24^i[k>>16&255]<<16^i[w>>8&255]<<8^i[255&S]^r[_+1],x=i[k>>>24]<<24^i[w>>16&255]<<16^i[S>>8&255]<<8^i[255&T]^r[_+2],E=i[w>>>24]<<24^i[S>>16&255]<<16^i[T>>8&255]<<8^i[255&k]^r[_+3],v[t]=I(y^h),v[t+1]=I(E^f),v[t+2]=I(x^m),v[t+3]=I(b^p),h=L,f=C,m=A,p=R,t+=4}return v.buffer}}class kl{constructor(e,t,s){this.subtle=void 0,this.key=void 0,this.aesMode=void 0,this.subtle=e,this.key=t,this.aesMode=s}expandKey(){const e=function(e){switch(e){case xl:return"AES-CBC";case El:return"AES-CTR";default:throw new Error("[FastAESKey] invalid aes mode ".concat(e))}}(this.aesMode);return this.subtle.importKey("raw",this.key,{name:e},!1,["encrypt","decrypt"])}}class wl{constructor(e){let{removePKCS7Padding:t=!0}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(this.logEnabled=!0,this.removePKCS7Padding=void 0,this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null,this.useSoftware=void 0,this.enableSoftwareAES=void 0,this.enableSoftwareAES=e.enableSoftwareAES,this.removePKCS7Padding=t,t)try{const e=self.crypto;e&&(this.subtle=e.subtle||e.webkitSubtle)}catch(Np){}this.useSoftware=!this.subtle}destroy(){this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null}isSync(){return this.useSoftware}flush(){const{currentResult:e,remainderData:t}=this;if(!e||t)return this.reset(),null;const s=new Uint8Array(e);return this.reset(),this.removePKCS7Padding?function(e){const t=e.byteLength,s=t&&new DataView(e.buffer).getUint8(t-1);return s?e.slice(0,t-s):e}(s):s}reset(){this.currentResult=null,this.currentIV=null,this.remainderData=null,this.softwareDecrypter&&(this.softwareDecrypter=null)}decrypt(e,t,s,n){return this.useSoftware?new Promise((r,i)=>{const a=ArrayBuffer.isView(e)?e:new Uint8Array(e);this.softwareDecrypt(a,t,s,n);const o=this.flush();o?r(o.buffer):i(new Error("[softwareDecrypt] Failed to decrypt data"))}):this.webCryptoDecrypt(new Uint8Array(e),t,s,n)}softwareDecrypt(e,t,s,n){const{currentIV:r,currentResult:i,remainderData:a}=this;if(n!==xl||16!==t.byteLength)return da.warn("SoftwareDecrypt: can only handle AES-128-CBC"),null;this.logOnce("JS AES decrypt"),a&&(e=qa(a,e),this.remainderData=null);const o=this.getValidChunk(e);if(!o.length)return null;r&&(s=r);let l=this.softwareDecrypter;l||(l=this.softwareDecrypter=new Tl),l.expandKey(t);const c=i;return this.currentResult=l.decrypt(o.buffer,0,s),this.currentIV=o.slice(-16).buffer,c||null}webCryptoDecrypt(e,t,s,n){if(this.key!==t||!this.fastAesKey){if(!this.subtle)return Promise.resolve(this.onWebCryptoError(e,t,s,n));this.key=t,this.fastAesKey=new kl(this.subtle,t,n)}return this.fastAesKey.expandKey().then(t=>{if(!this.subtle)return Promise.reject(new Error("web crypto not initialized"));this.logOnce("WebCrypto AES decrypt");return new Sl(this.subtle,new Uint8Array(s),n).decrypt(e.buffer,t)}).catch(r=>(da.warn("[decrypter]: WebCrypto Error, disable WebCrypto API, ".concat(r.name,": ").concat(r.message)),this.onWebCryptoError(e,t,s,n)))}onWebCryptoError(e,t,s,n){const r=this.enableSoftwareAES;if(r){this.useSoftware=!0,this.logEnabled=!0,this.softwareDecrypt(e,t,s,n);const r=this.flush();if(r)return r.buffer}throw new Error("WebCrypto"+(r?" and softwareDecrypt":"")+": failed to decrypt data")}getValidChunk(e){let t=e;const s=e.length-e.length%16;return s!==e.length&&(t=e.slice(0,s),this.remainderData=e.slice(s)),t}logOnce(e){this.logEnabled&&(da.log("[decrypter]: ".concat(e)),this.logEnabled=!1)}}const Ll=Math.pow(2,17);class Cl{constructor(e){this.config=void 0,this.loader=null,this.partLoadTimeout=-1,this.config=e}destroy(){this.loader&&(this.loader.destroy(),this.loader=null)}abort(){this.loader&&this.loader.abort()}load(e,t){const s=e.url;if(!s)return Promise.reject(new _l({type:Vi.NETWORK_ERROR,details:zi.FRAG_LOAD_ERROR,fatal:!1,frag:e,error:new Error("Fragment does not have a ".concat(s?"part list":"url")),networkDetails:null}));this.abort();const n=this.config,r=n.fLoader,i=n.loader;return new Promise((a,o)=>{if(this.loader&&this.loader.destroy(),e.gap){if(e.tagList.some(e=>"GAP"===e[0]))return void o(Rl(e));e.gap=!1}const l=this.loader=r?new r(n):new i(n),c=Al(e);e.loader=l;const d=el(n.fragLoadPolicy.default),u={loadPolicy:d,timeout:d.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0,highWaterMark:"initSegment"===e.sn?1/0:Ll};e.stats=l.stats;const h={onSuccess:(t,s,n,r)=>{this.resetLoader(e,l);let i=t.data;n.resetIV&&e.decryptdata&&(e.decryptdata.iv=new Uint8Array(i.slice(0,16)),i=i.slice(16)),a({frag:e,part:null,payload:i,networkDetails:r})},onError:(t,n,r,i)=>{this.resetLoader(e,l),o(new _l({type:Vi.NETWORK_ERROR,details:zi.FRAG_LOAD_ERROR,fatal:!1,frag:e,response:na({url:s,data:void 0},t),error:new Error("HTTP Error ".concat(t.code," ").concat(t.text)),networkDetails:r,stats:i}))},onAbort:(t,s,n)=>{this.resetLoader(e,l),o(new _l({type:Vi.NETWORK_ERROR,details:zi.INTERNAL_ABORTED,fatal:!1,frag:e,error:new Error("Aborted"),networkDetails:n,stats:t}))},onTimeout:(t,s,n)=>{this.resetLoader(e,l),o(new _l({type:Vi.NETWORK_ERROR,details:zi.FRAG_LOAD_TIMEOUT,fatal:!1,frag:e,error:new Error("Timeout after ".concat(u.timeout,"ms")),networkDetails:n,stats:t}))}};t&&(h.onProgress=(s,n,r,i)=>t({frag:e,part:null,payload:r,networkDetails:i})),l.load(c,u,h)})}loadPart(e,t,s){this.abort();const n=this.config,r=n.fLoader,i=n.loader;return new Promise((a,o)=>{if(this.loader&&this.loader.destroy(),e.gap||t.gap)return void o(Rl(e,t));const l=this.loader=r?new r(n):new i(n),c=Al(e,t);e.loader=l;const d=el(n.fragLoadPolicy.default),u={loadPolicy:d,timeout:d.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0,highWaterMark:Ll};t.stats=l.stats,l.load(c,u,{onSuccess:(n,r,i,o)=>{this.resetLoader(e,l),this.updateStatsFromPart(e,t);const c={frag:e,part:t,payload:n.data,networkDetails:o};s(c),a(c)},onError:(s,n,r,i)=>{this.resetLoader(e,l),o(new _l({type:Vi.NETWORK_ERROR,details:zi.FRAG_LOAD_ERROR,fatal:!1,frag:e,part:t,response:na({url:c.url,data:void 0},s),error:new Error("HTTP Error ".concat(s.code," ").concat(s.text)),networkDetails:r,stats:i}))},onAbort:(s,n,r)=>{e.stats.aborted=t.stats.aborted,this.resetLoader(e,l),o(new _l({type:Vi.NETWORK_ERROR,details:zi.INTERNAL_ABORTED,fatal:!1,frag:e,part:t,error:new Error("Aborted"),networkDetails:r,stats:s}))},onTimeout:(s,n,r)=>{this.resetLoader(e,l),o(new _l({type:Vi.NETWORK_ERROR,details:zi.FRAG_LOAD_TIMEOUT,fatal:!1,frag:e,part:t,error:new Error("Timeout after ".concat(u.timeout,"ms")),networkDetails:r,stats:s}))}})})}updateStatsFromPart(e,t){const s=e.stats,n=t.stats,r=n.total;if(s.loaded+=n.loaded,r){const n=Math.round(e.duration/t.duration),i=Math.min(Math.round(s.loaded/r),n),a=(n-i)*Math.round(s.loaded/i);s.total=s.loaded+a}else s.total=Math.max(s.loaded,s.total);const i=s.loading,a=n.loading;i.start?i.first+=a.first-a.start:(i.start=a.start,i.first=a.first),i.end=a.end}resetLoader(e,t){e.loader=null,this.loader===t&&(self.clearTimeout(this.partLoadTimeout),this.loader=null),t.destroy()}}function Al(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const s=t||e,n={frag:e,part:t,responseType:"arraybuffer",url:s.url,headers:{},rangeStart:0,rangeEnd:0},r=s.byteRangeStartOffset,i=s.byteRangeEndOffset;if(Ui(r)&&Ui(i)){var a;let t=r,s=i;if("initSegment"===e.sn&&("AES-128"===(o=null==(a=e.decryptdata)?void 0:a.method)||"AES-256"===o)){const e=i-r;e%16&&(s=i+(16-e%16)),0!==r&&(n.resetIV=!0,t=r-16)}n.rangeStart=t,n.rangeEnd=s}var o;return n}function Rl(e,t){const s=new Error("GAP ".concat(e.gap?"tag":"attribute"," found")),n={type:Vi.MEDIA_ERROR,details:zi.FRAG_GAP,fatal:!1,frag:e,error:s,networkDetails:null};return t&&(n.part=t),(t||e).stats.aborted=!0,new _l(n)}class _l extends Error{constructor(e){super(e.error.message),this.data=void 0,this.data=e}}class Nl extends ra{constructor(e,t){super(e,t),this._boundTick=void 0,this._tickTimer=null,this._tickInterval=null,this._tickCallCount=0,this._boundTick=this.tick.bind(this)}destroy(){this.onHandlerDestroying(),this.onHandlerDestroyed()}onHandlerDestroying(){this.clearNextTick(),this.clearInterval()}onHandlerDestroyed(){}hasInterval(){return!!this._tickInterval}hasNextTick(){return!!this._tickTimer}setInterval(e){return!this._tickInterval&&(this._tickCallCount=0,this._tickInterval=self.setInterval(this._boundTick,e),!0)}clearInterval(){return!!this._tickInterval&&(self.clearInterval(this._tickInterval),this._tickInterval=null,!0)}clearNextTick(){return!!this._tickTimer&&(self.clearTimeout(this._tickTimer),this._tickTimer=null,!0)}tick(){this._tickCallCount++,1===this._tickCallCount&&(this.doTick(),this._tickCallCount>1&&this.tickImmediate(),this._tickCallCount=0)}tickImmediate(){this.clearNextTick(),this._tickTimer=self.setTimeout(this._boundTick,0)}doTick(){}}class Il{constructor(e,t,s){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:-1,i=arguments.length>5&&void 0!==arguments[5]&&arguments[5];this.level=void 0,this.sn=void 0,this.part=void 0,this.id=void 0,this.size=void 0,this.partial=void 0,this.transmuxing={start:0,executeStart:0,executeEnd:0,end:0},this.buffering={audio:{start:0,executeStart:0,executeEnd:0,end:0},video:{start:0,executeStart:0,executeEnd:0,end:0},audiovideo:{start:0,executeStart:0,executeEnd:0,end:0}},this.level=e,this.sn=t,this.id=s,this.size=n,this.part=r,this.partial=i}}const jl={length:0,start:()=>0,end:()=>0};class Pl{static isBuffered(e,t){if(e){const s=Pl.getBuffered(e);for(let e=s.length;e--;)if(t>=s.start(e)&&t<=s.end(e))return!0}return!1}static bufferedRanges(e){if(e){const t=Pl.getBuffered(e);return Pl.timeRangesToArray(t)}return[]}static timeRangesToArray(e){const t=[];for(let s=0;s<e.length;s++)t.push({start:e.start(s),end:e.end(s)});return t}static bufferInfo(e,t,s){if(e){const n=Pl.bufferedRanges(e);if(n.length)return Pl.bufferedInfo(n,t,s)}return{len:0,start:t,end:t,bufferedIndex:-1}}static bufferedInfo(e,t,s){t=Math.max(0,t),e.length>1&&e.sort((e,t)=>e.start-t.start||t.end-e.end);let n=-1,r=[];if(s)for(let c=0;c<e.length;c++){t>=e[c].start&&t<=e[c].end&&(n=c);const i=r.length;if(i){const t=r[i-1].end;e[c].start-t<s?e[c].end>t&&(r[i-1].end=e[c].end):r.push(e[c])}else r.push(e[c])}else r=e;let i,a=0,o=t,l=t;for(let c=0;c<r.length;c++){const e=r[c].start,d=r[c].end;if(-1===n&&t>=e&&t<=d&&(n=c),t+s>=e&&t<d)o=e,l=d,a=l-t;else if(t+s<e){i=e;break}}return{len:a,start:o||0,end:l||0,nextStart:i,buffered:e,bufferedIndex:n}}static getBuffered(e){try{return e.buffered||jl}catch(Np){return da.log("failed to get media.buffered",Np),jl}}}const Dl=/\{\$([a-zA-Z0-9-_]+)\}/g;function Ml(e){return Dl.test(e)}function Ol(e,t){if(null!==e.variableList||e.hasVariableRefs){const s=e.variableList;return t.replace(Dl,t=>{const n=t.substring(2,t.length-1),r=null==s?void 0:s[n];return void 0===r?(e.playlistParsingError||(e.playlistParsingError=new Error('Missing preceding EXT-X-DEFINE tag for Variable Reference: "'.concat(n,'"'))),t):r})}return t}function Fl(e,t,s){let n,r,i=e.variableList;if(i||(e.variableList=i={}),"QUERYPARAM"in t){n=t.QUERYPARAM;try{const e=new self.URL(s).searchParams;if(!e.has(n))throw new Error('"'.concat(n,'" does not match any query parameter in URI: "').concat(s,'"'));r=e.get(n)}catch(a){e.playlistParsingError||(e.playlistParsingError=new Error("EXT-X-DEFINE QUERYPARAM: ".concat(a.message)))}}else n=t.NAME,r=t.VALUE;n in i?e.playlistParsingError||(e.playlistParsingError=new Error('EXT-X-DEFINE duplicate Variable Name declarations: "'.concat(n,'"'))):i[n]=r||""}function Ul(e,t,s){const n=t.IMPORT;if(s&&n in s){let t=e.variableList;t||(e.variableList=t={}),t[n]=s[n]}else e.playlistParsingError||(e.playlistParsingError=new Error('EXT-X-DEFINE IMPORT attribute not found in Multivariant Playlist: "'.concat(n,'"')))}const Bl=/^(\d+)x(\d+)$/,Gl=/(.+?)=(".*?"|.*?)(?:,|$)/g;class Vl{constructor(e,t){"string"===typeof e&&(e=Vl.parseAttrList(e,t)),ta(this,e)}get clientAttrs(){return Object.keys(this).filter(e=>"X-"===e.substring(0,2))}decimalInteger(e){const t=parseInt(this[e],10);return t>Number.MAX_SAFE_INTEGER?1/0:t}hexadecimalInteger(e){if(this[e]){let t=(this[e]||"0x").slice(2);t=(1&t.length?"0":"")+t;const s=new Uint8Array(t.length/2);for(let e=0;e<t.length/2;e++)s[e]=parseInt(t.slice(2*e,2*e+2),16);return s}return null}hexadecimalIntegerAsNumber(e){const t=parseInt(this[e],16);return t>Number.MAX_SAFE_INTEGER?1/0:t}decimalFloatingPoint(e){return parseFloat(this[e])}optionalFloat(e,t){const s=this[e];return s?parseFloat(s):t}enumeratedString(e){return this[e]}enumeratedStringList(e,t){const s=this[e];return(s?s.split(/[ ,]+/):[]).reduce((e,t)=>(e[t.toLowerCase()]=!0,e),t)}bool(e){return"YES"===this[e]}decimalResolution(e){const t=Bl.exec(this[e]);if(null!==t)return{width:parseInt(t[1],10),height:parseInt(t[2],10)}}static parseAttrList(e,t){let s;const n={};for(Gl.lastIndex=0;null!==(s=Gl.exec(e));){const r=s[1].trim();let i=s[2];const a=0===i.indexOf('"')&&i.lastIndexOf('"')===i.length-1;let o=!1;if(a)i=i.slice(1,-1);else switch(r){case"IV":case"SCTE35-CMD":case"SCTE35-IN":case"SCTE35-OUT":o=!0}if(t&&(a||o))i=Ol(t,i);else if(!o&&!a)switch(r){case"CLOSED-CAPTIONS":if("NONE"===i)break;case"ALLOWED-CPC":case"CLASS":case"ASSOC-LANGUAGE":case"AUDIO":case"BYTERANGE":case"CHANNELS":case"CHARACTERISTICS":case"CODECS":case"DATA-ID":case"END-DATE":case"GROUP-ID":case"ID":case"IMPORT":case"INSTREAM-ID":case"KEYFORMAT":case"KEYFORMATVERSIONS":case"LANGUAGE":case"NAME":case"PATHWAY-ID":case"QUERYPARAM":case"RECENTLY-REMOVED-DATERANGES":case"SERVER-URI":case"STABLE-RENDITION-ID":case"STABLE-VARIANT-ID":case"START-DATE":case"SUBTITLES":case"SUPPLEMENTAL-CODECS":case"URI":case"VALUE":case"VIDEO":case"X-ASSET-LIST":case"X-ASSET-URI":da.warn("".concat(e,": attribute ").concat(r," is missing quotes"))}n[r]=i}return n}}function zl(e){return"ID"!==e&&"CLASS"!==e&&"CUE"!==e&&"START-DATE"!==e&&"DURATION"!==e&&"END-DATE"!==e&&"END-ON-NEXT"!==e}function Hl(e){return"SCTE35-OUT"===e||"SCTE35-IN"===e||"SCTE35-CMD"===e}class Kl{constructor(e,t){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;var n;if(this.attr=void 0,this.tagAnchor=void 0,this.tagOrder=void 0,this._startDate=void 0,this._endDate=void 0,this._dateAtEnd=void 0,this._cue=void 0,this._badValueForSameId=void 0,this.tagAnchor=(null==t?void 0:t.tagAnchor)||null,this.tagOrder=null!=(n=null==t?void 0:t.tagOrder)?n:s,t){const s=t.attr;for(const t in s)if(Object.prototype.hasOwnProperty.call(e,t)&&e[t]!==s[t]){da.warn('DATERANGE tag attribute: "'.concat(t,'" does not match for tags with ID: "').concat(e.ID,'"')),this._badValueForSameId=t;break}e=ta(new Vl({}),s,e)}if(this.attr=e,t?(this._startDate=t._startDate,this._cue=t._cue,this._endDate=t._endDate,this._dateAtEnd=t._dateAtEnd):this._startDate=new Date(e["START-DATE"]),"END-DATE"in this.attr){const e=(null==t?void 0:t.endDate)||new Date(this.attr["END-DATE"]);Ui(e.getTime())&&(this._endDate=e)}}get id(){return this.attr.ID}get class(){return this.attr.CLASS}get cue(){const e=this._cue;return void 0===e?this._cue=this.attr.enumeratedStringList(this.attr.CUE?"CUE":"X-CUE",{pre:!1,post:!1,once:!1}):e}get startTime(){const{tagAnchor:e}=this;return null===e||null===e.programDateTime?(da.warn('Expected tagAnchor Fragment with PDT set for DateRange "'.concat(this.id,'": ').concat(e)),NaN):e.start+(this.startDate.getTime()-e.programDateTime)/1e3}get startDate(){return this._startDate}get endDate(){const e=this._endDate||this._dateAtEnd;if(e)return e;const t=this.duration;return null!==t?this._dateAtEnd=new Date(this._startDate.getTime()+1e3*t):null}get duration(){if("DURATION"in this.attr){const e=this.attr.decimalFloatingPoint("DURATION");if(Ui(e))return e}else if(this._endDate)return(this._endDate.getTime()-this._startDate.getTime())/1e3;return null}get plannedDuration(){return"PLANNED-DURATION"in this.attr?this.attr.decimalFloatingPoint("PLANNED-DURATION"):null}get endOnNext(){return this.attr.bool("END-ON-NEXT")}get isInterstitial(){return"com.apple.hls.interstitial"===this.class}get isValid(){return!!this.id&&!this._badValueForSameId&&Ui(this.startDate.getTime())&&(null===this.duration||this.duration>=0)&&(!this.endOnNext||!!this.class)&&(!this.attr.CUE||!this.cue.pre&&!this.cue.post||this.cue.pre!==this.cue.post)&&(!this.isInterstitial||"X-ASSET-URI"in this.attr||"X-ASSET-LIST"in this.attr)}}class Wl{constructor(e){this.PTSKnown=!1,this.alignedSliding=!1,this.averagetargetduration=void 0,this.endCC=0,this.endSN=0,this.fragments=void 0,this.fragmentHint=void 0,this.partList=null,this.dateRanges=void 0,this.dateRangeTagCount=0,this.live=!0,this.requestScheduled=-1,this.ageHeader=0,this.advancedDateTime=void 0,this.updated=!0,this.advanced=!0,this.misses=0,this.startCC=0,this.startSN=0,this.startTimeOffset=null,this.targetduration=0,this.totalduration=0,this.type=null,this.url=void 0,this.m3u8="",this.version=null,this.canBlockReload=!1,this.canSkipUntil=0,this.canSkipDateRanges=!1,this.skippedSegments=0,this.recentlyRemovedDateranges=void 0,this.partHoldBack=0,this.holdBack=0,this.partTarget=0,this.preloadHint=void 0,this.renditionReports=void 0,this.tuneInGoal=0,this.deltaUpdateFailed=void 0,this.driftStartTime=0,this.driftEndTime=0,this.driftStart=0,this.driftEnd=0,this.encryptedFragments=void 0,this.playlistParsingError=null,this.variableList=null,this.hasVariableRefs=!1,this.appliedTimelineOffset=void 0,this.fragments=[],this.encryptedFragments=[],this.dateRanges={},this.url=e}reloaded(e){if(!e)return this.advanced=!0,void(this.updated=!0);const t=this.lastPartSn-e.lastPartSn,s=this.lastPartIndex-e.lastPartIndex;this.updated=this.endSN!==e.endSN||!!s||!!t||!this.live,this.advanced=this.endSN>e.endSN||t>0||0===t&&s>0,this.updated||this.advanced?this.misses=Math.floor(.6*e.misses):this.misses=e.misses+1}hasKey(e){return this.encryptedFragments.some(t=>{let s=t.decryptdata;return s||(t.setKeyFormat(e.keyFormat),s=t.decryptdata),!!s&&e.matches(s)})}get hasProgramDateTime(){return!!this.fragments.length&&Ui(this.fragments[this.fragments.length-1].programDateTime)}get levelTargetDuration(){return this.averagetargetduration||this.targetduration||10}get drift(){const e=this.driftEndTime-this.driftStartTime;if(e>0){return 1e3*(this.driftEnd-this.driftStart)/e}return 1}get edge(){return this.partEnd||this.fragmentEnd}get partEnd(){var e;return null!=(e=this.partList)&&e.length?this.partList[this.partList.length-1].end:this.fragmentEnd}get fragmentEnd(){return this.fragments.length?this.fragments[this.fragments.length-1].end:0}get fragmentStart(){return this.fragments.length?this.fragments[0].start:0}get age(){return this.advancedDateTime?Math.max(Date.now()-this.advancedDateTime,0)/1e3:0}get lastPartIndex(){var e;return null!=(e=this.partList)&&e.length?this.partList[this.partList.length-1].index:-1}get maxPartIndex(){const e=this.partList;if(e){const t=this.lastPartIndex;if(-1!==t){for(let s=e.length;s--;)if(e[s].index>t)return e[s].index;return t}}return 0}get lastPartSn(){var e;return null!=(e=this.partList)&&e.length?this.partList[this.partList.length-1].fragment.sn:this.endSN}get expired(){if(this.live&&this.age&&this.misses<3){const e=this.partEnd-this.fragmentStart;return this.age>Math.max(e,this.totalduration)+this.levelTargetDuration}return!1}}function ql(e,t){return e.length===t.length&&!e.some((e,s)=>e!==t[s])}function Yl(e,t){return!e&&!t||!(!e||!t)&&ql(e,t)}function Xl(e){return"AES-128"===e||"AES-256"===e||"AES-256-CTR"===e}function Ql(e){switch(e){case"AES-128":case"AES-256":return xl;case"AES-256-CTR":return El;default:throw new Error("invalid full segment method ".concat(e))}}function $l(e){return Uint8Array.from(atob(e),e=>e.charCodeAt(0))}function Jl(e){return Uint8Array.from(unescape(encodeURIComponent(e)),e=>e.charCodeAt(0))}function Zl(e){const t=function(e,t,s){const n=e[t];e[t]=e[s],e[s]=n};t(e,0,3),t(e,1,2),t(e,4,5),t(e,6,7)}function ec(e){const t=e.split(":");let s=null;if("data"===t[0]&&2===t.length){const e=t[1].split(";"),n=e[e.length-1].split(",");if(2===n.length){const t="base64"===n[0],r=n[1];t?(e.splice(-1,1),s=$l(r)):s=function(e){const t=Jl(e).subarray(0,16),s=new Uint8Array(16);return s.set(t,16-t.length),s}(r)}}return s}const tc="undefined"!==typeof self?self:void 0;var sc={CLEARKEY:"org.w3.clearkey",FAIRPLAY:"com.apple.fps",PLAYREADY:"com.microsoft.playready",WIDEVINE:"com.widevine.alpha"},nc="org.w3.clearkey",rc="com.apple.streamingkeydelivery",ic="com.microsoft.playready",ac="urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed";function oc(e){switch(e){case rc:return sc.FAIRPLAY;case ic:return sc.PLAYREADY;case ac:return sc.WIDEVINE;case nc:return sc.CLEARKEY}}function lc(e){switch(e){case sc.FAIRPLAY:return rc;case sc.PLAYREADY:return ic;case sc.WIDEVINE:return ac;case sc.CLEARKEY:return nc}}function cc(e){const{drmSystems:t,widevineLicenseUrl:s}=e,n=t?[sc.FAIRPLAY,sc.WIDEVINE,sc.PLAYREADY,sc.CLEARKEY].filter(e=>!!t[e]):[];return!n[sc.WIDEVINE]&&s&&n.push(sc.WIDEVINE),n}const dc=null!=tc&&null!=(uc=tc.navigator)&&uc.requestMediaKeySystemAccess?self.navigator.requestMediaKeySystemAccess.bind(self.navigator):null;var uc;function hc(e){const t=new Uint16Array(e.buffer,e.byteOffset,e.byteLength/2),s=String.fromCharCode.apply(null,Array.from(t)),n=s.substring(s.indexOf("<"),s.length),r=(new DOMParser).parseFromString(n,"text/xml").getElementsByTagName("KID")[0];if(r){const e=r.childNodes[0]?r.childNodes[0].nodeValue:r.getAttribute("VALUE");if(e){const t=$l(e).subarray(0,16);return Zl(t),t}}return null}let fc={};class mc{static clearKeyUriToKeyIdMap(){fc={}}static setKeyIdForUri(e,t){fc[e]=t}static addKeyIdForUri(e){const t=Object.keys(fc).length%Number.MAX_SAFE_INTEGER,s=new Uint8Array(16);return new DataView(s.buffer,12,4).setUint32(0,t),fc[e]=s,s}constructor(e,t,s){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[1],r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,i=arguments.length>5?arguments[5]:void 0;this.uri=void 0,this.method=void 0,this.keyFormat=void 0,this.keyFormatVersions=void 0,this.encrypted=void 0,this.isCommonEncryption=void 0,this.iv=null,this.key=null,this.keyId=null,this.pssh=null,this.method=e,this.uri=t,this.keyFormat=s,this.keyFormatVersions=n,this.iv=r,this.encrypted=!!e&&"NONE"!==e,this.isCommonEncryption=this.encrypted&&!Xl(e),null!=i&&i.startsWith("0x")&&(this.keyId=new Uint8Array(pa(i)))}matches(e){return e.uri===this.uri&&e.method===this.method&&e.encrypted===this.encrypted&&e.keyFormat===this.keyFormat&&ql(e.keyFormatVersions,this.keyFormatVersions)&&Yl(e.iv,this.iv)&&Yl(e.keyId,this.keyId)}isSupported(){if(this.method){if(Xl(this.method)||"NONE"===this.method)return!0;if("identity"===this.keyFormat)return"SAMPLE-AES"===this.method;switch(this.keyFormat){case rc:case ac:case ic:case nc:return-1!==["SAMPLE-AES","SAMPLE-AES-CENC","SAMPLE-AES-CTR"].indexOf(this.method)}}return!1}getDecryptData(e,t){if(!this.encrypted||!this.uri)return null;if(Xl(this.method)){let t=this.iv;t||("number"!==typeof e&&(da.warn('missing IV for initialization segment with method="'.concat(this.method,'" - compliance issue')),e=0),t=function(e){const t=new Uint8Array(16);for(let s=12;s<16;s++)t[s]=e>>8*(15-s)&255;return t}(e));return new mc(this.method,this.uri,"identity",this.keyFormatVersions,t)}if(this.keyId){const e=fc[this.uri];if(e&&!ql(this.keyId,e)&&mc.setKeyIdForUri(this.uri,this.keyId),this.pssh)return this}const s=ec(this.uri);if(s)switch(this.keyFormat){case ac:if(this.pssh=s,!this.keyId){const e=function(e){const t=[];if(e instanceof ArrayBuffer){const s=e.byteLength;let n=0;for(;n+32<s;){const s=eo(new DataView(e,n));t.push(s),n+=s.size}}return t}(s.buffer);if(e.length){var n;const t=e[0];this.keyId=null!=(n=t.kids)&&n.length?t.kids[0]:null}}this.keyId||(this.keyId=pc(t));break;case ic:{const e=new Uint8Array([154,4,240,121,152,64,66,134,171,146,230,91,224,136,95,149]);this.pssh=Za(e,0,s),this.keyId=hc(s);break}default:{let e=s.subarray(0,16);if(16!==e.length){const t=new Uint8Array(16);t.set(e,16-e.length),e=t}this.keyId=e;break}}if(!this.keyId||16!==this.keyId.byteLength){let e;e=function(e){const t=null==e?void 0:e[ac];if(t)return t.keyId;return null}(t),e||(e=pc(t),e||(e=fc[this.uri])),e&&(this.keyId=e,mc.setKeyIdForUri(this.uri,e))}return this}}function pc(e){const t=null==e?void 0:e[ic];if(t){const e=ec(t.uri);if(e)return hc(e)}return null}const gc=/#EXT-X-STREAM-INF:([^\r\n]*)(?:[\r\n](?:#[^\r\n]*)?)*([^\r\n]+)|#EXT-X-(SESSION-DATA|SESSION-KEY|DEFINE|CONTENT-STEERING|START):([^\r\n]*)[\r\n]+/g,vc=/#EXT-X-MEDIA:(.*)/g,yc=/^#EXT(?:INF|-X-TARGETDURATION):/m,bc=new RegExp([/#EXTINF:\s*(\d*(?:\.\d+)?)(?:,(.*)\s+)?/.source,/(?!#) *(\S[^\r\n]*)/.source,/#.*/.source].join("|"),"g"),xc=new RegExp([/#EXT-X-(PROGRAM-DATE-TIME|BYTERANGE|DATERANGE|DEFINE|KEY|MAP|PART|PART-INF|PLAYLIST-TYPE|PRELOAD-HINT|RENDITION-REPORT|SERVER-CONTROL|SKIP|START):(.+)/.source,/#EXT-X-(BITRATE|DISCONTINUITY-SEQUENCE|MEDIA-SEQUENCE|TARGETDURATION|VERSION): *(\d+)/.source,/#EXT-X-(DISCONTINUITY|ENDLIST|GAP|INDEPENDENT-SEGMENTS)/.source,/(#)([^:]*):(.*)/.source,/(#)(.*)(?:.*)\r?\n?/.source].join("|"));class Ec{static findGroup(e,t){for(let s=0;s<e.length;s++){const n=e[s];if(n.id===t)return n}}static resolve(e,t){return ba.buildAbsoluteURL(t,e,{alwaysNormalize:!0})}static isMediaPlaylist(e){return yc.test(e)}static parseMasterPlaylist(e,t){const s={contentSteering:null,levels:[],playlistParsingError:null,sessionData:null,sessionKeys:null,startTimeOffset:null,variableList:null,hasVariableRefs:Ml(e)},n=[];if(gc.lastIndex=0,!e.startsWith("#EXTM3U"))return s.playlistParsingError=new Error("no EXTM3U delimiter"),s;let r;for(;null!=(r=gc.exec(e));)if(r[1]){var i;const e=new Vl(r[1],s),a=Ol(s,r[2]),o={attrs:e,bitrate:e.decimalInteger("BANDWIDTH")||e.decimalInteger("AVERAGE-BANDWIDTH"),name:e.NAME,url:Ec.resolve(a,t)},l=e.decimalResolution("RESOLUTION");l&&(o.width=l.width,o.height=l.height),Lc(e.CODECS,o);const c=e["SUPPLEMENTAL-CODECS"];c&&(o.supplemental={},Lc(c,o.supplemental)),null!=(i=o.unknownCodecs)&&i.length||n.push(o),s.levels.push(o)}else if(r[3]){const e=r[3],n=r[4];switch(e){case"SESSION-DATA":{const e=new Vl(n,s),t=e["DATA-ID"];t&&(null===s.sessionData&&(s.sessionData={}),s.sessionData[t]=e);break}case"SESSION-KEY":{const e=kc(n,t,s);e.encrypted&&e.isSupported()?(null===s.sessionKeys&&(s.sessionKeys=[]),s.sessionKeys.push(e)):da.warn('[Keys] Ignoring invalid EXT-X-SESSION-KEY tag: "'.concat(n,'"'));break}case"DEFINE":Fl(s,new Vl(n,s),t);break;case"CONTENT-STEERING":{const e=new Vl(n,s);s.contentSteering={uri:Ec.resolve(e["SERVER-URI"],t),pathwayId:e["PATHWAY-ID"]||"."};break}case"START":s.startTimeOffset=wc(n)}}const a=n.length>0&&n.length<s.levels.length;return s.levels=a?n:s.levels,0===s.levels.length&&(s.playlistParsingError=new Error("no levels found in manifest")),s}static parseMasterPlaylistMedia(e,t,s){let n;const r={},i=s.levels,a={AUDIO:i.map(e=>({id:e.attrs.AUDIO,audioCodec:e.audioCodec})),SUBTITLES:i.map(e=>({id:e.attrs.SUBTITLES,textCodec:e.textCodec})),"CLOSED-CAPTIONS":[]};let o=0;for(vc.lastIndex=0;null!==(n=vc.exec(e));){const e=new Vl(n[1],s),i=e.TYPE;if(i){const s=a[i],n=r[i]||[];r[i]=n;const l=e.LANGUAGE,c=e["ASSOC-LANGUAGE"],d=e.CHANNELS,u=e.CHARACTERISTICS,h=e["INSTREAM-ID"],f={attrs:e,bitrate:0,id:o++,groupId:e["GROUP-ID"]||"",name:e.NAME||l||"",type:i,default:e.bool("DEFAULT"),autoselect:e.bool("AUTOSELECT"),forced:e.bool("FORCED"),lang:l,url:e.URI?Ec.resolve(e.URI,t):""};if(c&&(f.assocLang=c),d&&(f.channels=d),u&&(f.characteristics=u),h&&(f.instreamId=h),null!=s&&s.length){const e=Ec.findGroup(s,f.groupId)||s[0];Cc(f,e,"audioCodec"),Cc(f,e,"textCodec")}n.push(f)}}return r}static parseLevelPlaylist(e,t,s,n,r,i){var a;const o={url:t},l=new Wl(t),c=l.fragments,d=[];let u,h,f,m,p=null,g=0,v=0,y=0,b=0,x=0,E=null,S=new La(n,o),T=-1,k=!1,w=null;if(bc.lastIndex=0,l.m3u8=e,l.hasVariableRefs=Ml(e),"#EXTM3U"!==(null==(a=bc.exec(e))?void 0:a[0]))return l.playlistParsingError=new Error("Missing format identifier #EXTM3U"),l;for(;null!==(u=bc.exec(e));){k&&(k=!1,S=new La(n,o),S.playlistOffset=y,S.setStart(y),S.sn=g,S.cc=b,x&&(S.bitrate=x),S.level=s,p&&(S.initSegment=p,p.rawProgramDateTime&&(S.rawProgramDateTime=p.rawProgramDateTime,p.rawProgramDateTime=null),w&&(S.setByteRange(w),w=null)));const e=u[1];if(e){S.duration=parseFloat(e);const t=(" "+u[2]).slice(1);S.title=t||null,S.tagList.push(t?["INF",e,t]:["INF",e])}else if(u[3]){if(Ui(S.duration)){S.playlistOffset=y,S.setStart(y),f&&_c(S,f,l),S.sn=g,S.level=s,S.cc=b,c.push(S);const e=(" "+u[3]).slice(1);S.relurl=Ol(l,e),Ac(S,E,d),E=S,y+=S.duration,g++,v=0,k=!0}}else{if(u=u[0].match(xc),!u){da.warn("No matches on slow regex match for level playlist!");continue}for(h=1;h<u.length&&void 0===u[h];h++);const e=(" "+u[h]).slice(1),r=(" "+u[h+1]).slice(1),a=u[h+2]?(" "+u[h+2]).slice(1):null;switch(e){case"BYTERANGE":E?S.setByteRange(r,E):S.setByteRange(r);break;case"PROGRAM-DATE-TIME":S.rawProgramDateTime=r,S.tagList.push(["PROGRAM-DATE-TIME",r]),-1===T&&(T=c.length);break;case"PLAYLIST-TYPE":l.type&&Nc(l,e,u),l.type=r.toUpperCase();break;case"MEDIA-SEQUENCE":0!==l.startSN?Nc(l,e,u):c.length>0&&Ic(l,e,u),g=l.startSN=parseInt(r);break;case"SKIP":{l.skippedSegments&&Nc(l,e,u);const t=new Vl(r,l),s=t.decimalInteger("SKIPPED-SEGMENTS");if(Ui(s)){l.skippedSegments+=s;for(let e=s;e--;)c.push(null);g+=s}const n=t.enumeratedString("RECENTLY-REMOVED-DATERANGES");n&&(l.recentlyRemovedDateranges=(l.recentlyRemovedDateranges||[]).concat(n.split("\t")));break}case"TARGETDURATION":0!==l.targetduration&&Nc(l,e,u),l.targetduration=Math.max(parseInt(r),1);break;case"VERSION":null!==l.version&&Nc(l,e,u),l.version=parseInt(r);break;case"INDEPENDENT-SEGMENTS":break;case"ENDLIST":l.live||Nc(l,e,u),l.live=!1;break;case"#":(r||a)&&S.tagList.push(a?[r,a]:[r]);break;case"DISCONTINUITY":b++,S.tagList.push(["DIS"]);break;case"GAP":S.gap=!0,S.tagList.push([e]);break;case"BITRATE":S.tagList.push([e,r]),x=1e3*parseInt(r),Ui(x)?S.bitrate=x:x=0;break;case"DATERANGE":{const e=new Vl(r,l),t=new Kl(e,l.dateRanges[e.ID],l.dateRangeTagCount);l.dateRangeTagCount++,t.isValid||l.skippedSegments?l.dateRanges[t.id]=t:da.warn('Ignoring invalid DATERANGE tag: "'.concat(r,'"')),S.tagList.push(["EXT-X-DATERANGE",r]);break}case"DEFINE":{const e=new Vl(r,l);"IMPORT"in e?Ul(l,e,i):Fl(l,e,t)}break;case"DISCONTINUITY-SEQUENCE":0!==l.startCC?Nc(l,e,u):c.length>0&&Ic(l,e,u),l.startCC=b=parseInt(r);break;case"KEY":{const e=kc(r,t,l);if(e.isSupported()){if("NONE"===e.method){f=void 0;break}f||(f={});const t=f[e.keyFormat];null!=t&&t.matches(e)||(t&&(f=ta({},f)),f[e.keyFormat]=e)}else da.warn('[Keys] Ignoring unsupported EXT-X-KEY tag: "'.concat(r,'"'));break}case"START":l.startTimeOffset=wc(r);break;case"MAP":{const e=new Vl(r,l);if(S.duration){const t=new La(n,o);Rc(t,e,s,f),p=t,S.initSegment=p,p.rawProgramDateTime&&!S.rawProgramDateTime&&(S.rawProgramDateTime=p.rawProgramDateTime)}else{const t=S.byteRangeEndOffset;if(t){const e=S.byteRangeStartOffset;w="".concat(t-e,"@").concat(e)}else w=null;Rc(S,e,s,f),p=S,k=!0}p.cc=b;break}case"SERVER-CONTROL":m&&Nc(l,e,u),m=new Vl(r),l.canBlockReload=m.bool("CAN-BLOCK-RELOAD"),l.canSkipUntil=m.optionalFloat("CAN-SKIP-UNTIL",0),l.canSkipDateRanges=l.canSkipUntil>0&&m.bool("CAN-SKIP-DATERANGES"),l.partHoldBack=m.optionalFloat("PART-HOLD-BACK",0),l.holdBack=m.optionalFloat("HOLD-BACK",0);break;case"PART-INF":{l.partTarget&&Nc(l,e,u);const t=new Vl(r);l.partTarget=t.decimalFloatingPoint("PART-TARGET");break}case"PART":{let e=l.partList;e||(e=l.partList=[]);const t=v>0?e[e.length-1]:void 0,s=v++,n=new Vl(r,l),i=new Ca(n,S,o,s,t);e.push(i),S.duration+=i.duration;break}case"PRELOAD-HINT":{const e=new Vl(r,l);l.preloadHint=e;break}case"RENDITION-REPORT":{const e=new Vl(r,l);l.renditionReports=l.renditionReports||[],l.renditionReports.push(e);break}default:da.warn("line parsed but not handled: ".concat(u))}}}E&&!E.relurl?(c.pop(),y-=E.duration,l.partList&&(l.fragmentHint=E)):l.partList&&(Ac(S,E,d),S.cc=b,l.fragmentHint=S,f&&_c(S,f,l)),l.targetduration||(l.playlistParsingError=new Error("Missing Target Duration"));const L=c.length,C=c[0],A=c[L-1];if(y+=l.skippedSegments*l.targetduration,y>0&&L&&A){l.averagetargetduration=y/L;const e=A.sn;l.endSN="initSegment"!==e?e:0,l.live||(A.endList=!0),T>0&&(!function(e,t){let s=e[t];for(let n=t;n--;){const t=e[n];if(!t)return;t.programDateTime=s.programDateTime-1e3*t.duration,s=t}}(c,T),C&&d.unshift(C))}return l.fragmentHint&&(y+=l.fragmentHint.duration),l.totalduration=y,d.length&&l.dateRangeTagCount&&C&&Sc(d,l),l.endCC=b,l}}function Sc(e,t){let s=e.length;if(!s){if(!t.hasProgramDateTime)return;{const n=t.fragments[t.fragments.length-1];e.push(n),s++}}const n=e[s-1],r=t.live?1/0:t.totalduration,i=Object.keys(t.dateRanges);for(let o=i.length;o--;){const l=t.dateRanges[i[o]],c=l.startDate.getTime();l.tagAnchor=n.ref;for(let n=s;n--;){var a;if((null==(a=e[n])?void 0:a.sn)<t.startSN)break;const s=Tc(t,c,e,n,r);if(-1!==s){l.tagAnchor=t.fragments[s].ref;break}}}}function Tc(e,t,s,n,r){const i=s[n];if(i){const o=i.programDateTime;if(t>=o||0===n){var a;if(t<=o+1e3*(((null==(a=s[n+1])?void 0:a.start)||r)-i.start)){const r=s[n].sn-e.startSN;if(r<0)return-1;const i=e.fragments;if(i.length>s.length){for(let a=(s[n+1]||i[i.length-1]).sn-e.startSN;a>r;a--){const e=i[a].programDateTime;if(t>=e&&t<e+1e3*i[a].duration)return a}}return r}}}return-1}function kc(e,t,s){var n,r;const i=new Vl(e,s),a=null!=(n=i.METHOD)?n:"",o=i.URI,l=i.hexadecimalInteger("IV"),c=i.KEYFORMATVERSIONS,d=null!=(r=i.KEYFORMAT)?r:"identity";o&&i.IV&&!l&&da.error("Invalid IV: ".concat(i.IV));const u=o?Ec.resolve(o,t):"",h=(c||"1").split("/").map(Number).filter(Number.isFinite);return new mc(a,u,d,h,l,i.KEYID)}function wc(e){const t=new Vl(e).decimalFloatingPoint("TIME-OFFSET");return Ui(t)?t:null}function Lc(e,t){let s=(e||"").split(/[ ,]+/).filter(e=>e);["video","audio","text"].forEach(e=>{const n=s.filter(t=>no(t,e));n.length&&(t["".concat(e,"Codec")]=n.map(e=>e.split("/")[0]).join(","),s=s.filter(e=>-1===n.indexOf(e)))}),t.unknownCodecs=s}function Cc(e,t,s){const n=t[s];n&&(e[s]=n)}function Ac(e,t,s){e.rawProgramDateTime?s.push(e):null!=t&&t.programDateTime&&(e.programDateTime=t.endProgramDateTime)}function Rc(e,t,s,n){e.relurl=t.URI,t.BYTERANGE&&e.setByteRange(t.BYTERANGE),e.level=s,e.sn="initSegment",n&&(e.levelkeys=n),e.initSegment=null}function _c(e,t,s){e.levelkeys=t;const{encryptedFragments:n}=s;n.length&&n[n.length-1].levelkeys===t||!Object.keys(t).some(e=>t[e].isCommonEncryption)||n.push(e)}function Nc(e,t,s){e.playlistParsingError=new Error("#EXT-X-".concat(t," must not appear more than once (").concat(s[0],")"))}function Ic(e,t,s){e.playlistParsingError=new Error("#EXT-X-".concat(t," must appear before the first Media Segment (").concat(s[0],")"))}function jc(e,t){const s=t.startPTS;if(Ui(s)){let n,r=0;t.sn>e.sn?(r=s-e.start,n=e):(r=e.start-s,n=t),n.duration!==r&&n.setDuration(r)}else if(t.sn>e.sn){e.cc===t.cc&&e.minEndPTS?t.setStart(e.start+(e.minEndPTS-e.start)):t.setStart(e.start+e.duration)}else t.setStart(Math.max(e.start-t.duration,0))}function Pc(e,t,s,n,r,i,a){n-s<=0&&(a.warn("Fragment should have a positive duration",t),n=s+t.duration,i=r+t.duration);let o=s,l=n;const c=t.startPTS,d=t.endPTS;if(Ui(c)){const u=Math.abs(c-s);e&&u>e.totalduration?a.warn("media timestamps and playlist times differ by ".concat(u,"s for level ").concat(t.level," ").concat(e.url)):Ui(t.deltaPTS)?t.deltaPTS=Math.max(u,t.deltaPTS):t.deltaPTS=u,o=Math.max(s,c),s=Math.min(s,c),r=void 0!==t.startDTS?Math.min(r,t.startDTS):r,l=Math.min(n,d),n=Math.max(n,d),i=void 0!==t.endDTS?Math.max(i,t.endDTS):i}const u=s-t.start;0!==t.start&&t.setStart(s),t.setDuration(n-t.start),t.startPTS=s,t.maxStartPTS=o,t.startDTS=r,t.endPTS=n,t.minEndPTS=l,t.endDTS=i;const h=t.sn;if(!e||h<e.startSN||h>e.endSN)return 0;let f;const m=h-e.startSN,p=e.fragments;for(p[m]=t,f=m;f>0;f--)jc(p[f],p[f-1]);for(f=m;f<p.length-1;f++)jc(p[f],p[f+1]);return e.fragmentHint&&jc(p[p.length-1],e.fragmentHint),e.PTSKnown=e.alignedSliding=!0,u}function Dc(e,t,s){if(e===t)return;let n=null;const r=e.fragments;for(let d=r.length-1;d>=0;d--){const e=r[d].initSegment;if(e){n=e;break}}let i;e.fragmentHint&&delete e.fragmentHint.endPTS,function(e,t,s){const n=t.skippedSegments,r=Math.max(e.startSN,t.startSN)-t.startSN,i=(e.fragmentHint?1:0)+(n?t.endSN:Math.min(e.endSN,t.endSN))-t.startSN,a=t.startSN-e.startSN,o=t.fragmentHint?t.fragments.concat(t.fragmentHint):t.fragments,l=e.fragmentHint?e.fragments.concat(e.fragmentHint):e.fragments;for(let c=r;c<=i;c++){const r=l[a+c];let i=o[c];if(n&&!i&&r&&(i=t.fragments[c]=r),r&&i){s(r,i,c,o);const n=r.relurl,a=i.relurl;if(n&&Hc(n,a))return void(t.playlistParsingError=Mc("media sequence mismatch ".concat(i.sn,":"),e,t,r,i));if(r.cc!==i.cc)return void(t.playlistParsingError=Mc("discontinuity sequence mismatch (".concat(r.cc,"!=").concat(i.cc,")"),e,t,r,i))}}}(e,t,(e,s,r,a)=>{if((!t.startCC||t.skippedSegments)&&s.cc!==e.cc){const n=e.cc-s.cc;for(let e=r;e<a.length;e++)a[e].cc+=n;t.endCC=a[a.length-1].cc}Ui(e.startPTS)&&Ui(e.endPTS)&&(s.setStart(s.startPTS=e.startPTS),s.startDTS=e.startDTS,s.maxStartPTS=e.maxStartPTS,s.endPTS=e.endPTS,s.endDTS=e.endDTS,s.minEndPTS=e.minEndPTS,s.setDuration(e.endPTS-e.startPTS),s.duration&&(i=s),t.PTSKnown=t.alignedSliding=!0),e.hasStreams&&(s.elementaryStreams=e.elementaryStreams),s.loader=e.loader,e.hasStats&&(s.stats=e.stats),e.initSegment&&(s.initSegment=e.initSegment,n=e.initSegment)});const a=t.fragments,o=t.fragmentHint?a.concat(t.fragmentHint):a;if(n&&o.forEach(e=>{var t;!e||e.initSegment&&e.initSegment.relurl!==(null==(t=n)?void 0:t.relurl)||(e.initSegment=n)}),t.skippedSegments){if(t.deltaUpdateFailed=a.some(e=>!e),t.deltaUpdateFailed){s.warn("[level-helper] Previous playlist missing segments skipped in delta playlist");for(let e=t.skippedSegments;e--;)a.shift();t.startSN=a[0].sn}else{t.canSkipDateRanges&&(t.dateRanges=function(e,t,s){const{dateRanges:n,recentlyRemovedDateranges:r}=t,i=ta({},e);r&&r.forEach(e=>{delete i[e]});const a=Object.keys(i).length;if(!a)return n;return Object.keys(n).forEach(e=>{const t=i[e],r=new Kl(n[e].attr,t);r.isValid?(i[e]=r,t||(r.tagOrder+=a)):s.warn('Ignoring invalid Playlist Delta Update DATERANGE tag: "'.concat(Do(n[e].attr),'"'))}),i}(e.dateRanges,t,s));const n=e.fragments.filter(e=>e.rawProgramDateTime);if(e.hasProgramDateTime&&!t.hasProgramDateTime)for(let e=1;e<o.length;e++)null===o[e].programDateTime&&Ac(o[e],o[e-1],n);Sc(n,t)}t.endCC=a[a.length-1].cc}if(!t.startCC){var l;const s=Bc(e,t.startSN-1);t.startCC=null!=(l=null==s?void 0:s.cc)?l:a[0].cc}!function(e,t,s){if(e&&t){let n=0;for(let r=0,i=e.length;r<=i;r++){const i=e[r],a=t[r+n];i&&a&&i.index===a.index&&i.fragment.sn===a.fragment.sn?s(i,a):n--}}}(e.partList,t.partList,(e,t)=>{t.elementaryStreams=e.elementaryStreams,t.stats=e.stats}),i?Pc(t,i,i.startPTS,i.endPTS,i.startDTS,i.endDTS,s):Oc(e,t),a.length&&(t.totalduration=t.edge-a[0].start),t.driftStartTime=e.driftStartTime,t.driftStart=e.driftStart;const c=t.advancedDateTime;if(t.advanced&&c){const e=t.edge;t.driftStart||(t.driftStartTime=c,t.driftStart=e),t.driftEndTime=c,t.driftEnd=e}else t.driftEndTime=e.driftEndTime,t.driftEnd=e.driftEnd,t.advancedDateTime=e.advancedDateTime;-1===t.requestScheduled&&(t.requestScheduled=e.requestScheduled)}function Mc(e,t,s,n,r){return new Error("".concat(e," ").concat(r.url,"\nPlaylist starting @").concat(t.startSN,"\n").concat(t.m3u8,"\n\nPlaylist starting @").concat(s.startSN,"\n").concat(s.m3u8))}function Oc(e,t){let s=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const n=t.startSN+t.skippedSegments-e.startSN,r=e.fragments,i=n>=0;let a=0;if(i&&n<r.length)a=r[n].start;else if(i&&t.startSN===e.endSN+1)a=e.fragmentEnd;else if(i&&s)a=e.fragmentStart+n*t.levelTargetDuration;else{if(t.skippedSegments||0!==t.fragmentStart)return;a=e.fragmentStart}Fc(t,a)}function Fc(e,t){if(t){const s=e.fragments;for(let n=e.skippedSegments;n<s.length;n++)s[n].addStart(t);e.fragmentHint&&e.fragmentHint.addStart(t)}}function Uc(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1/0,s=1e3*e.targetduration;if(e.updated){const n=e.fragments,r=4;if(n.length&&s*r>t){const e=1e3*n[n.length-1].duration;e<s&&(s=e)}}else s/=2;return Math.round(s)}function Bc(e,t,s){if(!e)return null;let n=e.fragments[t-e.startSN];return n||(n=e.fragmentHint,n&&n.sn===t?n:t<e.startSN&&s&&s.sn===t?s:null)}function Gc(e,t,s){return e?Vc(e.partList,t,s):null}function Vc(e,t,s){if(e)for(let n=e.length;n--;){const r=e[n];if(r.index===s&&r.fragment.sn===t)return r}return null}function zc(e){e.forEach((e,t)=>{var s;null==(s=e.details)||s.fragments.forEach(e=>{e.level=t,e.initSegment&&(e.initSegment.level=t)})})}function Hc(e,t){return!(e===t||!t)&&Kc(e)!==Kc(t)}function Kc(e){return e.replace(/\?[^?]*$/,"")}function Wc(e,t){for(let n=0,r=e.length;n<r;n++){var s;if((null==(s=e[n])?void 0:s.cc)===t)return e[n]}return null}function qc(e,t){const s=e.start+t;e.startPTS=s,e.setStart(s),e.endPTS=s+e.duration}function Yc(e,t){const s=t.fragments;for(let n=0,r=s.length;n<r;n++)qc(s[n],e);t.fragmentHint&&qc(t.fragmentHint,e),t.alignedSliding=!0}function Xc(e,t){if(!function(e,t){return!!(e&&t.startCC<e.endCC&&t.endCC>e.startCC)}(t,e))return;const s=Math.min(t.endCC,e.endCC),n=Wc(t.fragments,s),r=Wc(e.fragments,s);if(!n||!r)return;da.log("Aligning playlist at start of dicontinuity sequence ".concat(s));Yc(n.start-r.start,e)}function Qc(e,t){if(!e.hasProgramDateTime||!t.hasProgramDateTime)return;const s=e.fragments,n=t.fragments;if(!s.length||!n.length)return;let r,i;const a=Math.min(t.endCC,e.endCC);t.startCC<a&&e.startCC<a&&(r=Wc(n,a),i=Wc(s,a)),r&&i||(r=n[Math.floor(n.length/2)],i=Wc(s,r.cc)||s[Math.floor(s.length/2)]);const o=r.programDateTime,l=i.programDateTime;if(!o||!l)return;Yc((l-o)/1e3-(i.start-r.start),e)}function $c(e,t,s){Jc(e,t,s),e.addEventListener(t,s)}function Jc(e,t,s){e.removeEventListener(t,s)}const Zc=function(e){let t="";const s=e.length;for(let n=0;n<s;n++)t+="[".concat(e.start(n).toFixed(3),"-").concat(e.end(n).toFixed(3),"]");return t},ed="STOPPED",td="IDLE",sd="KEY_LOADING",nd="FRAG_LOADING",rd="FRAG_LOADING_WAITING_RETRY",id="WAITING_TRACK",ad="PARSING",od="PARSED",ld="ENDED",cd="ERROR",dd="WAITING_INIT_PTS",ud="WAITING_LEVEL";class hd extends Nl{constructor(e,t,s,n,r){super(n,e.logger),this.hls=void 0,this.fragPrevious=null,this.fragCurrent=null,this.fragmentTracker=void 0,this.transmuxer=null,this._state=ed,this.playlistType=void 0,this.media=null,this.mediaBuffer=null,this.config=void 0,this.bitrateTest=!1,this.lastCurrentTime=0,this.nextLoadPosition=0,this.startPosition=0,this.startTimeOffset=null,this.retryDate=0,this.levels=null,this.fragmentLoader=void 0,this.keyLoader=void 0,this.levelLastLoaded=null,this.startFragRequested=!1,this.decrypter=void 0,this.initPTS=[],this.buffering=!0,this.loadingParts=!1,this.loopSn=void 0,this.onMediaSeeking=()=>{const{config:e,fragCurrent:t,media:s,mediaBuffer:n,state:r}=this,i=s?s.currentTime:0,a=Pl.bufferInfo(n||s,i,e.maxBufferHole),o=!a.len;if(this.log("Media seeking to ".concat(Ui(i)?i.toFixed(3):i,", state: ").concat(r,", ").concat(o?"out of":"in"," buffer")),this.state===ld)this.resetLoadingState();else if(t){const s=e.maxFragLookUpTolerance,n=t.start-s,r=t.start+t.duration+s;if(o||r<a.start||n>a.end){const e=i>r;(i<n||e)&&(e&&t.loader&&(this.log("Cancelling fragment load for seek (sn: ".concat(t.sn,")")),t.abortRequests(),this.resetLoadingState()),this.fragPrevious=null)}}if(s){this.fragmentTracker.removeFragmentsInRange(i,1/0,this.playlistType,!0);if(i>this.lastCurrentTime&&(this.lastCurrentTime=i),!this.loadingParts){const e=Math.max(a.end,i),t=this.shouldLoadParts(this.getLevelDetails(),e);t&&(this.log("LL-Part loading ON after seeking to ".concat(i.toFixed(2)," with buffer @").concat(e.toFixed(2))),this.loadingParts=t)}}this.hls.hasEnoughToStart||(this.log("Setting ".concat(o?"startPosition":"nextLoadPosition"," to ").concat(i," for seek without enough to start")),this.nextLoadPosition=i,o&&(this.startPosition=i)),o&&this.state===td&&this.tickImmediate()},this.onMediaEnded=()=>{this.log("setting startPosition to 0 because media ended"),this.startPosition=this.lastCurrentTime=0},this.playlistType=r,this.hls=e,this.fragmentLoader=new Cl(e.config),this.keyLoader=s,this.fragmentTracker=t,this.config=e.config,this.decrypter=new wl(e.config)}registerListeners(){const{hls:e}=this;e.on(Hi.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(Hi.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(Hi.MANIFEST_LOADING,this.onManifestLoading,this),e.on(Hi.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(Hi.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(Hi.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(Hi.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(Hi.MANIFEST_LOADING,this.onManifestLoading,this),e.off(Hi.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(Hi.ERROR,this.onError,this)}doTick(){this.onTickEnd()}onTickEnd(){}startLoad(e){}stopLoad(){if(this.state===ed)return;this.fragmentLoader.abort(),this.keyLoader.abort(this.playlistType);const e=this.fragCurrent;null!=e&&e.loader&&(e.abortRequests(),this.fragmentTracker.removeFragment(e)),this.resetTransmuxer(),this.fragCurrent=null,this.fragPrevious=null,this.clearInterval(),this.clearNextTick(),this.state=ed}get startPositionValue(){const{nextLoadPosition:e,startPosition:t}=this;return-1===t&&e?e:t}get bufferingEnabled(){return this.buffering}pauseBuffering(){this.buffering=!1}resumeBuffering(){this.buffering=!0}get inFlightFrag(){return{frag:this.fragCurrent,state:this.state}}_streamEnded(e,t){if(t.live||!this.media)return!1;const s=e.end||0,n=this.config.timelineOffset||0;if(s<=n)return!1;const r=e.buffered;this.config.maxBufferHole&&r&&r.length>1&&(e=Pl.bufferedInfo(r,e.start,0));const i=e.nextStart;if(i&&i>n&&i<t.edge)return!1;if(this.media.currentTime<e.start)return!1;const a=t.partList;if(null!=a&&a.length){const e=a[a.length-1];return Pl.isBuffered(this.media,e.start+e.duration/2)}const o=t.fragments[t.fragments.length-1].type;return this.fragmentTracker.isEndListAppended(o)}getLevelDetails(){if(this.levels&&null!==this.levelLastLoaded)return this.levelLastLoaded.details}get timelineOffset(){const e=this.config.timelineOffset;var t;return e?(null==(t=this.getLevelDetails())?void 0:t.appliedTimelineOffset)||e:0}onMediaAttached(e,t){const s=this.media=this.mediaBuffer=t.media;$c(s,"seeking",this.onMediaSeeking),$c(s,"ended",this.onMediaEnded);const n=this.config;this.levels&&n.autoStartLoad&&this.state===ed&&this.startLoad(n.startPosition)}onMediaDetaching(e,t){const s=!!t.transferMedia,n=this.media;if(null!==n){if(n.ended&&(this.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0),Jc(n,"seeking",this.onMediaSeeking),Jc(n,"ended",this.onMediaEnded),this.keyLoader&&!s&&this.keyLoader.detach(),this.media=this.mediaBuffer=null,this.loopSn=void 0,s)return this.resetLoadingState(),void this.resetTransmuxer();this.loadingParts=!1,this.fragmentTracker.removeAllFragments(),this.stopLoad()}}onManifestLoading(){this.initPTS=[],this.levels=this.levelLastLoaded=this.fragCurrent=null,this.lastCurrentTime=this.startPosition=0,this.startFragRequested=!1}onError(e,t){}onManifestLoaded(e,t){this.startTimeOffset=t.startTimeOffset}onHandlerDestroying(){this.stopLoad(),this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null),super.onHandlerDestroying(),this.hls=this.onMediaSeeking=this.onMediaEnded=null}onHandlerDestroyed(){this.state=ed,this.fragmentLoader&&this.fragmentLoader.destroy(),this.keyLoader&&this.keyLoader.destroy(),this.decrypter&&this.decrypter.destroy(),this.hls=this.log=this.warn=this.decrypter=this.keyLoader=this.fragmentLoader=this.fragmentTracker=null,super.onHandlerDestroyed()}loadFragment(e,t,s){this.startFragRequested=!0,this._loadFragForPlayback(e,t,s)}_loadFragForPlayback(e,t,s){this._doFragLoad(e,t,s,e=>{const t=e.frag;if(this.fragContextChanged(t))return this.warn("".concat(t.type," sn: ").concat(t.sn).concat(e.part?" part: "+e.part.index:""," of ").concat(this.fragInfo(t,!1,e.part),") was dropped during download.")),void this.fragmentTracker.removeFragment(t);t.stats.chunkCount++,this._handleFragmentLoadProgress(e)}).then(e=>{if(!e)return;const t=this.state,s=e.frag;this.fragContextChanged(s)?(t===nd||!this.fragCurrent&&t===ad)&&(this.fragmentTracker.removeFragment(s),this.state=td):("payload"in e&&(this.log("Loaded ".concat(s.type," sn: ").concat(s.sn," of ").concat(this.playlistLabel()," ").concat(s.level)),this.hls.trigger(Hi.FRAG_LOADED,e)),this._handleFragmentLoadComplete(e))}).catch(t=>{this.state!==ed&&this.state!==cd&&(this.warn("Frag error: ".concat((null==t?void 0:t.message)||t)),this.resetFragmentLoading(e))})}clearTrackerIfNeeded(e){var t;const{fragmentTracker:s}=this;if(s.getState(e)===fl){const t=e.type,n=this.getFwdBufferInfo(this.mediaBuffer,t),r=Math.max(e.duration,n?n.len:this.config.maxBufferLength),i=this.backtrackFragment;(1===(i?e.sn-i.sn:0)||this.reduceMaxBufferLength(r,e.duration))&&s.removeFragment(e)}else 0===(null==(t=this.mediaBuffer)?void 0:t.buffered.length)?s.removeAllFragments():s.hasParts(e.type)&&(s.detectPartialFragments({frag:e,part:null,stats:e.stats,id:e.type}),s.getState(e)===ml&&s.removeFragment(e))}checkLiveUpdate(e){if(e.updated&&!e.live){const t=e.fragments[e.fragments.length-1];this.fragmentTracker.detectPartialFragments({frag:t,part:null,stats:t.stats,id:t.type})}e.fragments[0]||(e.deltaUpdateFailed=!0)}waitForLive(e){const t=e.details;return(null==t?void 0:t.live)&&"EVENT"!==t.type&&(this.levelLastLoaded!==e||t.expired)}flushMainBuffer(e,t){if(!(e-t))return;const s={startOffset:e,endOffset:t,type:arguments.length>2&&void 0!==arguments[2]?arguments[2]:null};this.hls.trigger(Hi.BUFFER_FLUSHING,s)}_loadInitSegment(e,t){this._doFragLoad(e,t).then(e=>{const t=null==e?void 0:e.frag;if(!t||this.fragContextChanged(t)||!this.levels)throw new Error("init load aborted");return e}).then(e=>{const{hls:t}=this,{frag:s,payload:n}=e,r=s.decryptdata;if(n&&n.byteLength>0&&null!=r&&r.key&&r.iv&&Xl(r.method)){const i=self.performance.now();return this.decrypter.decrypt(new Uint8Array(n),r.key.buffer,r.iv.buffer,Ql(r.method)).catch(e=>{throw t.trigger(Hi.ERROR,{type:Vi.MEDIA_ERROR,details:zi.FRAG_DECRYPT_ERROR,fatal:!1,error:e,reason:e.message,frag:s}),e}).then(n=>{const r=self.performance.now();return t.trigger(Hi.FRAG_DECRYPTED,{frag:s,payload:n,stats:{tstart:i,tdecrypt:r}}),e.payload=n,this.completeInitSegmentLoad(e)})}return this.completeInitSegmentLoad(e)}).catch(t=>{this.state!==ed&&this.state!==cd&&(this.warn(t),this.resetFragmentLoading(e))})}completeInitSegmentLoad(e){const{levels:t}=this;if(!t)throw new Error("init load aborted, missing levels");const s=e.frag.stats;this.state!==ed&&(this.state=td),e.frag.data=new Uint8Array(e.payload),s.parsing.start=s.buffering.start=self.performance.now(),s.parsing.end=s.buffering.end=self.performance.now(),this.tick()}unhandledEncryptionError(e,t){var s,n;const r=e.tracks;if(r&&!t.encrypted&&(null!=(s=r.audio)&&s.encrypted||null!=(n=r.video)&&n.encrypted)&&(!this.config.emeEnabled||!this.keyLoader.emeController)){const e=this.media,s=new Error("Encrypted track with no key in ".concat(this.fragInfo(t)," (media ").concat(e?"attached mediaKeys: "+e.mediaKeys:"detached",")"));return this.warn(s.message),!e||e.mediaKeys?!1:(this.hls.trigger(Hi.ERROR,{type:Vi.KEY_SYSTEM_ERROR,details:zi.KEY_SYSTEM_NO_KEYS,fatal:!1,error:s,frag:t}),this.resetTransmuxer(),!0)}return!1}fragContextChanged(e){const{fragCurrent:t}=this;return!e||!t||e.sn!==t.sn||e.level!==t.level}fragBufferedComplete(e,t){const s=this.mediaBuffer?this.mediaBuffer:this.media;if(this.log("Buffered ".concat(e.type," sn: ").concat(e.sn).concat(t?" part: "+t.index:""," of ").concat(this.fragInfo(e,!1,t)," > buffer:").concat(s?Zc(Pl.getBuffered(s)):"(detached)",")")),wa(e)){var n;if(e.type!==$i){const t=e.elementaryStreams;if(!Object.keys(t).some(e=>!!t[e]))return void(this.state=td)}const t=null==(n=this.levels)?void 0:n[e.level];null!=t&&t.fragmentError&&(this.log("Resetting level fragment error count of ".concat(t.fragmentError," on frag buffered")),t.fragmentError=0)}this.state=td}_handleFragmentLoadComplete(e){const{transmuxer:t}=this;if(!t)return;const{frag:s,part:n,partsLoaded:r}=e,i=!r||0===r.length||r.some(e=>!e),a=new Il(s.level,s.sn,s.stats.chunkCount+1,0,n?n.index:-1,!i);t.flush(a)}_handleFragmentLoadProgress(e){}_doFragLoad(e,t){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,n=arguments.length>3?arguments[3]:void 0;var r;this.fragCurrent=e;const i=t.details;if(!this.levels||!i)throw new Error("frag load aborted, missing level".concat(i?"":" detail","s"));let a=null;if(!e.encrypted||null!=(r=e.decryptdata)&&r.key)e.encrypted||(a=this.keyLoader.loadClear(e,i.encryptedFragments,this.startFragRequested),a&&this.log("[eme] blocking frag load until media-keys acquired"));else if(this.log("Loading key for ".concat(e.sn," of [").concat(i.startSN,"-").concat(i.endSN,"], ").concat(this.playlistLabel()," ").concat(e.level)),this.state=sd,this.fragCurrent=e,a=this.keyLoader.load(e).then(e=>{if(!this.fragContextChanged(e.frag))return this.hls.trigger(Hi.KEY_LOADED,e),this.state===sd&&(this.state=td),e}),this.hls.trigger(Hi.KEY_LOADING,{frag:e}),null===this.fragCurrent)return this.log("context changed in KEY_LOADING"),Promise.resolve(null);const o=this.fragPrevious;if(wa(e)&&(!o||e.sn!==o.sn)){const s=this.shouldLoadParts(t.details,e.end);s!==this.loadingParts&&(this.log("LL-Part loading ".concat(s?"ON":"OFF"," loading sn ").concat(null==o?void 0:o.sn,"->").concat(e.sn)),this.loadingParts=s)}if(s=Math.max(e.start,s||0),this.loadingParts&&wa(e)){const r=i.partList;if(r&&n){s>i.fragmentEnd&&i.fragmentHint&&(e=i.fragmentHint);const o=this.getNextPart(r,e,s);if(o>-1){const l=r[o];let c;return e=this.fragCurrent=l.fragment,this.log("Loading ".concat(e.type," sn: ").concat(e.sn," part: ").concat(l.index," (").concat(o,"/").concat(r.length-1,") of ").concat(this.fragInfo(e,!1,l),") cc: ").concat(e.cc," [").concat(i.startSN,"-").concat(i.endSN,"], target: ").concat(parseFloat(s.toFixed(3)))),this.nextLoadPosition=l.start+l.duration,this.state=nd,c=a?a.then(s=>!s||this.fragContextChanged(s.frag)?null:this.doFragPartsLoad(e,l,t,n)).catch(e=>this.handleFragLoadError(e)):this.doFragPartsLoad(e,l,t,n).catch(e=>this.handleFragLoadError(e)),this.hls.trigger(Hi.FRAG_LOADING,{frag:e,part:l,targetBufferTime:s}),null===this.fragCurrent?Promise.reject(new Error("frag load aborted, context changed in FRAG_LOADING parts")):c}if(!e.url||this.loadedEndOfParts(r,s))return Promise.resolve(null)}}var l;if(wa(e)&&this.loadingParts)this.log("LL-Part loading OFF after next part miss @".concat(s.toFixed(2)," Check buffer at sn: ").concat(e.sn," loaded parts: ").concat(null==(l=i.partList)?void 0:l.filter(e=>e.loaded).map(e=>"[".concat(e.start,"-").concat(e.end,"]")))),this.loadingParts=!1;else if(!e.url)return Promise.resolve(null);this.log("Loading ".concat(e.type," sn: ").concat(e.sn," of ").concat(this.fragInfo(e,!1),") cc: ").concat(e.cc," ").concat("["+i.startSN+"-"+i.endSN+"]",", target: ").concat(parseFloat(s.toFixed(3)))),Ui(e.sn)&&!this.bitrateTest&&(this.nextLoadPosition=e.start+e.duration),this.state=nd;const c=this.config.progressive&&e.type!==$i;let d;return d=c&&a?a.then(t=>!t||this.fragContextChanged(t.frag)?null:this.fragmentLoader.load(e,n)).catch(e=>this.handleFragLoadError(e)):Promise.all([this.fragmentLoader.load(e,c?n:void 0),a]).then(e=>{let[t]=e;return!c&&n&&n(t),t}).catch(e=>this.handleFragLoadError(e)),this.hls.trigger(Hi.FRAG_LOADING,{frag:e,targetBufferTime:s}),null===this.fragCurrent?Promise.reject(new Error("frag load aborted, context changed in FRAG_LOADING")):d}doFragPartsLoad(e,t,s,n){return new Promise((r,i)=>{var a;const o=[],l=null==(a=s.details)?void 0:a.partList,c=t=>{this.fragmentLoader.loadPart(e,t,n).then(n=>{o[t.index]=n;const i=n.part;this.hls.trigger(Hi.FRAG_LOADED,n);const a=Gc(s.details,e.sn,t.index+1)||Vc(l,e.sn,t.index+1);if(!a)return r({frag:e,part:i,partsLoaded:o});c(a)}).catch(i)};c(t)})}handleFragLoadError(e){if("data"in e){const t=e.data;t.frag&&t.details===zi.INTERNAL_ABORTED?this.handleFragLoadAborted(t.frag,t.part):t.frag&&t.type===Vi.KEY_SYSTEM_ERROR?(t.frag.abortRequests(),this.resetStartWhenNotLoaded(),this.resetFragmentLoading(t.frag)):this.hls.trigger(Hi.ERROR,t)}else this.hls.trigger(Hi.ERROR,{type:Vi.OTHER_ERROR,details:zi.INTERNAL_EXCEPTION,err:e,error:e,fatal:!0});return null}_handleTransmuxerFlush(e){const t=this.getCurrentContext(e);if(!t||this.state!==ad)return void(this.fragCurrent||this.state===ed||this.state===cd||(this.state=td));const{frag:s,part:n,level:r}=t,i=self.performance.now();s.stats.parsing.end=i,n&&(n.stats.parsing.end=i);const a=this.getLevelDetails(),o=a&&s.sn>a.endSN||this.shouldLoadParts(a,s.end);o!==this.loadingParts&&(this.log("LL-Part loading ".concat(o?"ON":"OFF"," after parsing segment ending @").concat(s.end.toFixed(2))),this.loadingParts=o),this.updateLevelTiming(s,n,r,e.partial)}shouldLoadParts(e,t){if(this.config.lowLatencyMode){if(!e)return this.loadingParts;if(e.partList){var s;const r=e.partList[0];if(r.fragment.type===$i)return!1;if(t>=r.end+((null==(s=e.fragmentHint)?void 0:s.duration)||0)){var n;if((this.hls.hasEnoughToStart?(null==(n=this.media)?void 0:n.currentTime)||this.lastCurrentTime:this.getLoadPosition())>r.start-r.fragment.duration)return!0}}}return!1}getCurrentContext(e){const{levels:t,fragCurrent:s}=this,{level:n,sn:r,part:i}=e;if(null==t||!t[n])return this.warn("Levels object was unset while buffering fragment ".concat(r," of ").concat(this.playlistLabel()," ").concat(n,". The current chunk will not be buffered.")),null;const a=t[n],o=a.details,l=i>-1?Gc(o,r,i):null,c=l?l.fragment:Bc(o,r,s);return c?(s&&s!==c&&(c.stats=s.stats),{frag:c,part:l,level:a}):null}bufferFragmentData(e,t,s,n,r){if(this.state!==ad)return;const{data1:i,data2:a}=e;let o=i;if(a&&(o=qa(i,a)),!o.length)return;const l=this.initPTS[t.cc],c=l?-l.baseTime/l.timescale:void 0,d={type:e.type,frag:t,part:s,chunkMeta:n,offset:c,parent:t.type,data:o};if(this.hls.trigger(Hi.BUFFER_APPENDING,d),e.dropped&&e.independent&&!s){if(r)return;this.flushBufferGap(t)}}flushBufferGap(e){const t=this.media;if(!t)return;if(!Pl.isBuffered(t,t.currentTime))return void this.flushMainBuffer(0,e.start);const s=t.currentTime,n=Pl.bufferInfo(t,s,0),r=e.duration,i=Math.min(2*this.config.maxFragLookUpTolerance,.25*r),a=Math.max(Math.min(e.start-i,n.end-i),s+i);e.start-a>i&&this.flushMainBuffer(a,e.start)}getFwdBufferInfo(e,t){var s;const n=this.getLoadPosition();if(!Ui(n))return null;const r=this.lastCurrentTime>n||null!=(s=this.media)&&s.paused?0:this.config.maxBufferHole;return this.getFwdBufferInfoAtPos(e,n,t,r)}getFwdBufferInfoAtPos(e,t,s,n){const r=Pl.bufferInfo(e,t,n);if(0===r.len&&void 0!==r.nextStart){const i=this.fragmentTracker.getBufferedFrag(t,s);if(i&&(r.nextStart<=i.end||i.gap)){const s=Math.max(Math.min(r.nextStart,i.end)-t,n);return Pl.bufferInfo(e,t,s)}}return r}getMaxBufferLength(e){const{config:t}=this;let s;return s=e?Math.max(8*t.maxBufferSize/e,t.maxBufferLength):t.maxBufferLength,Math.min(s,t.maxMaxBufferLength)}reduceMaxBufferLength(e,t){const s=this.config,n=Math.max(Math.min(e-t,s.maxBufferLength),t),r=Math.max(e-3*t,s.maxMaxBufferLength/2,n);return r>=n&&(s.maxMaxBufferLength=r,this.warn("Reduce max buffer length to ".concat(r,"s")),!0)}getAppendedFrag(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Xi;const s=this.fragmentTracker?this.fragmentTracker.getAppendedFrag(e,t):null;return s&&"fragment"in s?s.fragment:s}getNextFragment(e,t){const s=t.fragments,n=s.length;if(!n)return null;const{config:r}=this,i=s[0].start,a=r.lowLatencyMode&&!!t.partList;let o=null;if(t.live){const s=r.initialLiveManifestSize;if(n<s)return this.warn("Not enough fragments to start playback (have: ".concat(n,", need: ").concat(s,")")),null;if(!t.PTSKnown&&!this.startFragRequested&&-1===this.startPosition||e<i){var l;a&&!this.loadingParts&&(this.log("LL-Part loading ON for initial live fragment"),this.loadingParts=!0),o=this.getInitialLiveFragment(t);const s=this.hls.startPosition,n=this.hls.liveSyncPosition,r=o?(-1!==s&&s>=i?s:n)||o.start:e;this.log("Setting startPosition to ".concat(r," to match start frag at live edge. mainStart: ").concat(s," liveSyncPosition: ").concat(n," frag.start: ").concat(null==(l=o)?void 0:l.start)),this.startPosition=this.nextLoadPosition=r}}else e<=i&&(o=s[0]);if(!o){const s=this.loadingParts?t.partEnd:t.fragmentEnd;o=this.getFragmentAtPosition(e,s,t)}let c=this.filterReplacedPrimary(o,t);if(!c&&o){const e=o.sn-t.startSN;c=this.filterReplacedPrimary(s[e+1]||null,t)}return this.mapToInitFragWhenRequired(c)}isLoopLoading(e,t){const s=this.fragmentTracker.getState(e);return(s===pl||s===ml&&!!e.gap)&&this.nextLoadPosition>t}getNextFragmentLoopLoading(e,t,s,n,r){let i=null;if(e.gap&&(i=this.getNextFragment(this.nextLoadPosition,t),i&&!i.gap&&s.nextStart)){const e=this.getFwdBufferInfoAtPos(this.mediaBuffer?this.mediaBuffer:this.media,s.nextStart,n,0);if(null!==e&&s.len+e.len>=r){const e=i.sn;return this.loopSn!==e&&(this.log('buffer full after gaps in "'.concat(n,'" playlist starting at sn: ').concat(e)),this.loopSn=e),null}}return this.loopSn=void 0,i}get primaryPrefetch(){if(fd(this.config)){var e;if(null==(e=this.hls.interstitialsManager)||null==(e=e.playingItem)?void 0:e.event)return!0}return!1}filterReplacedPrimary(e,t){if(!e)return e;if(fd(this.config)&&e.type!==$i){const s=this.hls.interstitialsManager,n=null==s?void 0:s.bufferingItem;if(n){const s=n.event;if(s){if(s.appendInPlace||Math.abs(e.start-n.start)>1||0===n.start)return null}else{if(e.end<=n.start&&!1===(null==t?void 0:t.live))return null;if(e.start>n.end&&n.nextEvent&&(n.nextEvent.appendInPlace||e.start-n.end>1))return null}}const r=null==s?void 0:s.playerQueue;if(r)for(let t=r.length;t--;){const s=r[t].interstitial;if(s.appendInPlace&&e.start>=s.startTime&&e.end<=s.resumeTime)return null}}return e}mapToInitFragWhenRequired(e){return null==e||!e.initSegment||e.initSegment.data||this.bitrateTest?e:e.initSegment}getNextPart(e,t,s){let n=-1,r=!1,i=!0;for(let a=0,o=e.length;a<o;a++){const o=e[a];if(i=i&&!o.independent,n>-1&&s<o.start)break;const l=o.loaded;l?n=-1:(r||(o.independent||i)&&o.fragment===t)&&(o.fragment!==t&&this.warn("Need buffer at ".concat(s," but next unloaded part starts at ").concat(o.start)),n=a),r=l}return n}loadedEndOfParts(e,t){let s;for(let n=e.length;n--;){if(s=e[n],!s.loaded)return!1;if(t>s.start)return!0}return!1}getInitialLiveFragment(e){const t=e.fragments,s=this.fragPrevious;let n=null;if(s){if(e.hasProgramDateTime&&(this.log("Live playlist, switching playlist, load frag with same PDT: ".concat(s.programDateTime)),n=function(e,t,s){if(null===t||!Array.isArray(e)||!e.length||!Ui(t))return null;if(t<(e[0].programDateTime||0))return null;if(t>=(e[e.length-1].endProgramDateTime||0))return null;for(let n=0;n<e.length;++n){const r=e[n];if(qo(t,s,r))return r}return null}(t,s.endProgramDateTime,this.config.maxFragLookUpTolerance)),!n){const r=s.sn+1;if(r>=e.startSN&&r<=e.endSN){const i=t[r-e.startSN];s.cc===i.cc&&(n=i,this.log("Live playlist, switching playlist, load frag with next SN: ".concat(n.sn)))}n||(n=Yo(e,s.cc,s.end),n&&this.log("Live playlist, switching playlist, load frag with same CC: ".concat(n.sn)))}}else{const t=this.hls.liveSyncPosition;null!==t&&(n=this.getFragmentAtPosition(t,this.bitrateTest?e.fragmentEnd:e.edge,e))}return n}getFragmentAtPosition(e,t,s){const{config:n}=this;let{fragPrevious:r}=this,{fragments:i,endSN:a}=s;const{fragmentHint:o}=s,{maxFragLookUpTolerance:l}=n,c=s.partList,d=!!(this.loadingParts&&null!=c&&c.length&&o);let u;if(d&&!this.bitrateTest&&c[c.length-1].fragment.sn===o.sn&&(i=i.concat(o),a=o.sn),e<t){var h;u=Ko(r,i,e,e<this.lastCurrentTime||e>t-l||null!=(h=this.media)&&h.paused||!this.startFragRequested?0:l)}else u=i[i.length-1];if(u){const e=u.sn-s.startSN,t=this.fragmentTracker.getState(u);if((t===pl||t===ml&&u.gap)&&(r=u),r&&u.sn===r.sn&&(!d||c[0].fragment.sn>u.sn||!s.live)){if(u.level===r.level){const t=i[e+1];u=u.sn<a&&this.fragmentTracker.getState(t)!==pl?t:null}}}return u}alignPlaylists(e,t,s){const n=e.fragments.length;if(!n)return this.warn("No fragments in live playlist"),0;const r=e.fragmentStart,i=!t,a=e.alignedSliding&&Ui(r);if(i||!a&&!r){!function(e,t){e&&(Xc(t,e),t.alignedSliding||Qc(t,e),t.alignedSliding||t.skippedSegments||Oc(e,t,!1))}(s,e);const r=e.fragmentStart;return this.log("Live playlist sliding: ".concat(r.toFixed(2)," start-sn: ").concat(t?t.startSN:"na","->").concat(e.startSN," fragments: ").concat(n)),r}return r}waitForCdnTuneIn(e){return e.live&&e.canBlockReload&&e.partTarget&&e.tuneInGoal>Math.max(e.partHoldBack,3*e.partTarget)}setStartPosition(e,t){let s=this.startPosition;s<t&&(s=-1);const n=this.timelineOffset;if(-1===s){const r=null!==this.startTimeOffset,i=r?this.startTimeOffset:e.startTimeOffset;null!==i&&Ui(i)?(s=t+i,i<0&&(s+=e.edge),s=Math.min(Math.max(t,s),t+e.totalduration),this.log("Setting startPosition to ".concat(s," for start time offset ").concat(i," found in ").concat(r?"multivariant":"media"," playlist")),this.startPosition=s):e.live?(s=this.hls.liveSyncPosition||t,this.log("Setting startPosition to -1 to start at live edge ".concat(s)),this.startPosition=-1):(this.log("setting startPosition to 0 by default"),this.startPosition=s=0),this.lastCurrentTime=s+n}this.nextLoadPosition=s+n}getLoadPosition(){var e;const{media:t}=this;let s=0;return null!=(e=this.hls)&&e.hasEnoughToStart&&t?s=t.currentTime:this.nextLoadPosition>=0&&(s=this.nextLoadPosition),s}handleFragLoadAborted(e,t){this.transmuxer&&e.type===this.playlistType&&wa(e)&&e.stats.aborted&&(this.log("Fragment ".concat(e.sn).concat(t?" part "+t.index:""," of ").concat(this.playlistLabel()," ").concat(e.level," was aborted")),this.resetFragmentLoading(e))}resetFragmentLoading(e){this.fragCurrent&&(this.fragContextChanged(e)||this.state===rd)||(this.state=td)}onFragmentOrKeyLoadError(e,t){var s;if(t.chunkMeta&&!t.frag){const e=this.getCurrentContext(t.chunkMeta);e&&(t.frag=e.frag)}const n=t.frag;if(!n||n.type!==e||!this.levels)return;var r;if(this.fragContextChanged(n))return void this.warn("Frag load error must match current frag to retry ".concat(n.url," > ").concat(null==(r=this.fragCurrent)?void 0:r.url));const i=t.details===zi.FRAG_GAP;i&&this.fragmentTracker.fragBuffered(n,!0);const a=t.errorAction;if(!a)return void(this.state=cd);const{action:o,flags:l,retryCount:c=0,retryConfig:d}=a,u=!!d,h=u&&o===al,f=u&&!a.resolved&&l===ll,m=null==(s=this.hls.latestLevelDetails)?void 0:s.live;if(!h&&f&&wa(n)&&!n.endList&&m&&!$o(t))this.resetFragmentErrors(e),this.treatAsGap(n),a.resolved=!0;else if((h||f)&&c<d.maxNumRetry){var p;const s=sl(null==(p=t.response)?void 0:p.code),r=Zo(d,c);if(this.resetStartWhenNotLoaded(),this.retryDate=self.performance.now()+r,this.state=rd,a.resolved=!0,s)return this.log("Waiting for connection (offline)"),this.retryDate=1/0,void(t.reason="offline");this.warn("Fragment ".concat(n.sn," of ").concat(e," ").concat(n.level," errored with ").concat(t.details,", retrying loading ").concat(c+1,"/").concat(d.maxNumRetry," in ").concat(r,"ms"))}else if(d){if(this.resetFragmentErrors(e),!(c<d.maxNumRetry))return void this.warn("".concat(t.details," reached or exceeded max retry (").concat(c,")"));i||o===il||(a.resolved=!0)}else this.state=o===rl?ud:cd;this.tickImmediate()}checkRetryDate(){const e=self.performance.now(),t=this.retryDate,s=t===1/0;(!t||e>=t||s&&!sl(0))&&(s&&this.log("Connection restored (online)"),this.resetStartWhenNotLoaded(),this.state=td)}reduceLengthAndFlushBuffer(e){if(this.state===ad||this.state===od){const t=e.frag,s=e.parent,n=this.getFwdBufferInfo(this.mediaBuffer,s),r=n&&n.len>.5;r&&this.reduceMaxBufferLength(n.len,(null==t?void 0:t.duration)||10);const i=!r;return i&&this.warn("Buffer full error while media.currentTime (".concat(this.getLoadPosition(),") is not buffered, flush ").concat(s," buffer")),t&&(this.fragmentTracker.removeFragment(t),this.nextLoadPosition=t.start),this.resetLoadingState(),i}return!1}resetFragmentErrors(e){e===Qi&&(this.fragCurrent=null),this.hls.hasEnoughToStart||(this.startFragRequested=!1),this.state!==ed&&(this.state=td)}afterBufferFlushed(e,t,s){if(!e)return;const n=Pl.getBuffered(e);this.fragmentTracker.detectEvictedFragments(t,n,s),this.state===ld&&this.resetLoadingState()}resetLoadingState(){this.log("Reset loading state"),this.fragCurrent=null,this.fragPrevious=null,this.state!==ed&&(this.state=td)}resetStartWhenNotLoaded(){if(!this.hls.hasEnoughToStart){this.startFragRequested=!1;const e=this.levelLastLoaded,t=e?e.details:null;null!=t&&t.live?(this.log("resetting startPosition for live start"),this.startPosition=-1,this.setStartPosition(t,t.fragmentStart),this.resetLoadingState()):this.nextLoadPosition=this.startPosition}}resetWhenMissingContext(e){this.log("Loading context changed while buffering sn ".concat(e.sn," of ").concat(this.playlistLabel()," ").concat(-1===e.level?"<removed>":e.level,". This chunk will not be buffered.")),this.removeUnbufferedFrags(),this.resetStartWhenNotLoaded(),this.resetLoadingState()}removeUnbufferedFrags(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;this.fragmentTracker.removeFragmentsInRange(e,1/0,this.playlistType,!1,!0)}updateLevelTiming(e,t,s,n){const r=s.details;if(!r)return void this.warn("level.details undefined");if(!Object.keys(e.elementaryStreams).reduce((t,i)=>{const a=e.elementaryStreams[i];if(a){const o=a.endPTS-a.startPTS;if(o<=0)return this.warn("Could not parse fragment ".concat(e.sn," ").concat(i," duration reliably (").concat(o,")")),t||!1;const l=n?0:Pc(r,e,a.startPTS,a.endPTS,a.startDTS,a.endDTS,this);return this.hls.trigger(Hi.LEVEL_PTS_UPDATED,{details:r,level:s,drift:l,type:i,frag:e,start:a.startPTS,end:a.endPTS}),!0}return t},!1)){var i;const t=null===(null==(i=this.transmuxer)?void 0:i.error);if((0===s.fragmentError||t&&(s.fragmentError<2||e.endList))&&this.treatAsGap(e,s),t){const t=new Error("Found no media in fragment ".concat(e.sn," of ").concat(this.playlistLabel()," ").concat(e.level," resetting transmuxer to fallback to playlist timing"));if(this.warn(t.message),this.hls.trigger(Hi.ERROR,{type:Vi.MEDIA_ERROR,details:zi.FRAG_PARSING_ERROR,fatal:!1,error:t,frag:e,reason:"Found no media in msn ".concat(e.sn," of ").concat(this.playlistLabel(),' "').concat(s.url,'"')}),!this.hls)return;this.resetTransmuxer()}}this.state=od,this.log("Parsed ".concat(e.type," sn: ").concat(e.sn).concat(t?" part: "+t.index:""," of ").concat(this.fragInfo(e,!1,t),")")),this.hls.trigger(Hi.FRAG_PARSED,{frag:e,part:t})}playlistLabel(){return this.playlistType===Xi?"level":"track"}fragInfo(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],s=arguments.length>2?arguments[2]:void 0;var n,r;return"".concat(this.playlistLabel()," ").concat(e.level," (").concat(s?"part":"frag",":[").concat((null!=(n=t&&!s?e.startPTS:(s||e).start)?n:NaN).toFixed(3),"-").concat((null!=(r=t&&!s?e.endPTS:(s||e).end)?r:NaN).toFixed(3),"]").concat(s&&"main"===e.type?"INDEPENDENT="+(s.independent?"YES":"NO"):"")}treatAsGap(e,t){t&&t.fragmentError++,e.gap=!0,this.fragmentTracker.removeFragment(e),this.fragmentTracker.fragBuffered(e,!0)}resetTransmuxer(){var e;null==(e=this.transmuxer)||e.reset()}recoverWorkerError(e){"demuxerWorker"===e.event&&(this.fragmentTracker.removeAllFragments(),this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null),this.resetStartWhenNotLoaded(),this.resetLoadingState())}set state(e){const t=this._state;t!==e&&(this._state=e,this.log("".concat(t,"->").concat(e)))}get state(){return this._state}}function fd(e){return!!e.interstitialsController&&!1!==e.enableInterstitialPlayback}class md{constructor(){this.chunks=[],this.dataLength=0}push(e){this.chunks.push(e),this.dataLength+=e.length}flush(){const{chunks:e,dataLength:t}=this;let s;return e.length?(s=1===e.length?e[0]:function(e,t){const s=new Uint8Array(t);let n=0;for(let r=0;r<e.length;r++){const t=e[r];s.set(t,n),n+=t.length}return s}(e,t),this.reset(),s):new Uint8Array(0)}reset(){this.chunks.length=0,this.dataLength=0}}var pd,gd={exports:{}};var vd=(pd||(pd=1,function(e){var t=Object.prototype.hasOwnProperty,s="~";function n(){}function r(e,t,s){this.fn=e,this.context=t,this.once=s||!1}function i(e,t,n,i,a){if("function"!==typeof n)throw new TypeError("The listener must be a function");var o=new r(n,i||e,a),l=s?s+t:t;return e._events[l]?e._events[l].fn?e._events[l]=[e._events[l],o]:e._events[l].push(o):(e._events[l]=o,e._eventsCount++),e}function a(e,t){0===--e._eventsCount?e._events=new n:delete e._events[t]}function o(){this._events=new n,this._eventsCount=0}Object.create&&(n.prototype=Object.create(null),(new n).__proto__||(s=!1)),o.prototype.eventNames=function(){var e,n,r=[];if(0===this._eventsCount)return r;for(n in e=this._events)t.call(e,n)&&r.push(s?n.slice(1):n);return Object.getOwnPropertySymbols?r.concat(Object.getOwnPropertySymbols(e)):r},o.prototype.listeners=function(e){var t=s?s+e:e,n=this._events[t];if(!n)return[];if(n.fn)return[n.fn];for(var r=0,i=n.length,a=new Array(i);r<i;r++)a[r]=n[r].fn;return a},o.prototype.listenerCount=function(e){var t=s?s+e:e,n=this._events[t];return n?n.fn?1:n.length:0},o.prototype.emit=function(e,t,n,r,i,a){var o=s?s+e:e;if(!this._events[o])return!1;var l,c,d=this._events[o],u=arguments.length;if(d.fn){switch(d.once&&this.removeListener(e,d.fn,void 0,!0),u){case 1:return d.fn.call(d.context),!0;case 2:return d.fn.call(d.context,t),!0;case 3:return d.fn.call(d.context,t,n),!0;case 4:return d.fn.call(d.context,t,n,r),!0;case 5:return d.fn.call(d.context,t,n,r,i),!0;case 6:return d.fn.call(d.context,t,n,r,i,a),!0}for(c=1,l=new Array(u-1);c<u;c++)l[c-1]=arguments[c];d.fn.apply(d.context,l)}else{var h,f=d.length;for(c=0;c<f;c++)switch(d[c].once&&this.removeListener(e,d[c].fn,void 0,!0),u){case 1:d[c].fn.call(d[c].context);break;case 2:d[c].fn.call(d[c].context,t);break;case 3:d[c].fn.call(d[c].context,t,n);break;case 4:d[c].fn.call(d[c].context,t,n,r);break;default:if(!l)for(h=1,l=new Array(u-1);h<u;h++)l[h-1]=arguments[h];d[c].fn.apply(d[c].context,l)}}return!0},o.prototype.on=function(e,t,s){return i(this,e,t,s,!1)},o.prototype.once=function(e,t,s){return i(this,e,t,s,!0)},o.prototype.removeListener=function(e,t,n,r){var i=s?s+e:e;if(!this._events[i])return this;if(!t)return a(this,i),this;var o=this._events[i];if(o.fn)o.fn!==t||r&&!o.once||n&&o.context!==n||a(this,i);else{for(var l=0,c=[],d=o.length;l<d;l++)(o[l].fn!==t||r&&!o[l].once||n&&o[l].context!==n)&&c.push(o[l]);c.length?this._events[i]=1===c.length?c[0]:c:a(this,i)}return this},o.prototype.removeAllListeners=function(e){var t;return e?(t=s?s+e:e,this._events[t]&&a(this,t)):(this._events=new n,this._eventsCount=0),this},o.prototype.off=o.prototype.removeListener,o.prototype.addListener=o.prototype.on,o.prefixed=s,o.EventEmitter=o,e.exports=o}(gd)),gd.exports),yd=ga(vd);const bd="1.6.15",xd={};function Ed(e,t){return t+10<=e.length&&51===e[t]&&68===e[t+1]&&73===e[t+2]&&e[t+3]<255&&e[t+4]<255&&e[t+6]<128&&e[t+7]<128&&e[t+8]<128&&e[t+9]<128}function Sd(e,t){return t+10<=e.length&&73===e[t]&&68===e[t+1]&&51===e[t+2]&&e[t+3]<255&&e[t+4]<255&&e[t+6]<128&&e[t+7]<128&&e[t+8]<128&&e[t+9]<128}function Td(e,t){let s=0;return s=(127&e[t])<<21,s|=(127&e[t+1])<<14,s|=(127&e[t+2])<<7,s|=127&e[t+3],s}function kd(e,t){const s=t;let n=0;for(;Sd(e,t);){n+=10;n+=Td(e,t+6),Ed(e,t+10)&&(n+=10),t+=n}if(n>0)return e.subarray(s,s+n)}function wd(e,t){return 255===e[t]&&240===(246&e[t+1])}function Ld(e,t){return 1&e[t+1]?7:9}function Cd(e,t){return(3&e[t+3])<<11|e[t+4]<<3|(224&e[t+5])>>>5}function Ad(e,t){return t+1<e.length&&wd(e,t)}function Rd(e,t){if(Ad(e,t)){const s=Ld(e,t);if(t+s>=e.length)return!1;const n=Cd(e,t);if(n<=s)return!1;const r=t+n;return r===e.length||Ad(e,r)}return!1}function _d(e,t,s,n,r){if(!e.samplerate){const i=function(e,t,s,n){const r=t[s+2],i=r>>2&15;if(i>12){const t=new Error("invalid ADTS sampling index:".concat(i));return void e.emit(Hi.ERROR,Hi.ERROR,{type:Vi.MEDIA_ERROR,details:zi.FRAG_PARSING_ERROR,fatal:!0,error:t,reason:t.message})}const a=1+(r>>6&3),o=t[s+3]>>6&3|(1&r)<<2,l="mp4a.40."+a,c=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350][i];let d=i;5!==a&&29!==a||(d-=3);const u=[a<<3|(14&d)>>1,(1&d)<<7|o<<3];return da.log("manifest codec:".concat(n,", parsed codec:").concat(l,", channels:").concat(o,", rate:").concat(c," (ADTS object type:").concat(a," sampling index:").concat(i,")")),{config:u,samplerate:c,channelCount:o,codec:l,parsedCodec:l,manifestCodec:n}}(t,s,n,r);if(!i)return;ta(e,i)}}function Nd(e){return 9216e4/e}function Id(e,t,s,n,r){const i=n+r*Nd(e.samplerate),a=function(e,t){const s=Ld(e,t);if(t+s<=e.length){const n=Cd(e,t)-s;if(n>0)return{headerLength:s,frameLength:n}}}(t,s);let o;if(a){const{frameLength:n,headerLength:r}=a,l=r+n,c=Math.max(0,s+l-t.length);c?(o=new Uint8Array(l-r),o.set(t.subarray(s+r,t.length),0)):o=t.subarray(s+r,s+l);const d={unit:o,pts:i};return c||e.samples.push(d),{sample:d,length:l,missing:c}}const l=t.length-s;o=new Uint8Array(l),o.set(t.subarray(s,t.length),0);return{sample:{unit:o,pts:i},length:l,missing:-1}}function jd(e,t){return Sd(e,t)&&Td(e,t+6)+10<=e.length-t}function Pd(e){return function(e,t,s,n){const r=function(e){return e instanceof ArrayBuffer?e:e.buffer}(e);let i=1;"BYTES_PER_ELEMENT"in n&&(i=n.BYTES_PER_ELEMENT);const a=(u=e,u&&u.buffer instanceof ArrayBuffer&&void 0!==u.byteLength&&void 0!==u.byteOffset?e.byteOffset:0),o=(a+e.byteLength)/i,l=(a+t)/i,c=Math.floor(Math.max(0,Math.min(l,o))),d=Math.floor(Math.min(c+Math.max(s,0),o));var u;return new n(r,c,d-c)}(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1/0,Uint8Array)}function Dd(e){const t={key:e.type,description:"",data:"",mimeType:null,pictureType:null};if(e.size<2)return;if(3!==e.data[0])return void console.log("Ignore frame with unrecognized character encoding");const s=e.data.subarray(1).indexOf(0);if(-1===s)return;const n=fa(Pd(e.data,1,s)),r=e.data[2+s],i=e.data.subarray(3+s).indexOf(0);if(-1===i)return;const a=fa(Pd(e.data,3+s,i));let o;return o="--\x3e"===n?fa(Pd(e.data,4+s+i)):function(e){return e instanceof ArrayBuffer?e:0==e.byteOffset&&e.byteLength==e.buffer.byteLength?e.buffer:new Uint8Array(e).buffer}(e.data.subarray(4+s+i)),t.mimeType=n,t.pictureType=r,t.description=a,t.data=o,t}function Md(e){return"PRIV"===e.type?function(e){if(e.size<2)return;const t=fa(e.data,!0),s=new Uint8Array(e.data.subarray(t.length+1));return{key:e.type,info:t,data:s.buffer}}(e):"W"===e.type[0]?function(e){if("WXXX"===e.type){if(e.size<2)return;let t=1;const s=fa(e.data.subarray(t),!0);t+=s.length+1;const n=fa(e.data.subarray(t));return{key:e.type,info:s,data:n}}const t=fa(e.data);return{key:e.type,info:"",data:t}}(e):"APIC"===e.type?Dd(e):function(e){if(e.size<2)return;if("TXXX"===e.type){let t=1;const s=fa(e.data.subarray(t),!0);t+=s.length+1;const n=fa(e.data.subarray(t));return{key:e.type,info:s,data:n}}const t=fa(e.data.subarray(1));return{key:e.type,info:"",data:t}}(e)}function Od(e){const t=String.fromCharCode(e[0],e[1],e[2],e[3]),s=Td(e,4);return{type:t,size:s,data:e.subarray(10,10+s)}}function Fd(e){let t=0;const s=[];for(;Sd(e,t);){const n=Td(e,t+6);e[t+5]>>6&1&&(t+=10),t+=10;const r=t+n;for(;t+10<r;){const n=Od(e.subarray(t)),r=Md(n);r&&s.push(r),t+=n.size+10}Ed(e,t)&&(t+=10)}return s}function Ud(e){return e&&"PRIV"===e.key&&"com.apple.streaming.transportStreamTimestamp"===e.info}function Bd(e){if(8===e.data.byteLength){const t=new Uint8Array(e.data),s=1&t[3];let n=(t[4]<<23)+(t[5]<<15)+(t[6]<<7)+t[7];return n/=45,s&&(n+=47721858.84),Math.round(n)}}function Gd(e){const t=Fd(e);for(let s=0;s<t.length;s++){const e=t[s];if(Ud(e))return Bd(e)}}let Vd=function(e){return e.audioId3="org.id3",e.dateRange="com.apple.quicktime.HLS",e.emsg="https://aomedia.org/emsg/ID3",e.misbklv="urn:misb:KLV:bin:1910.1",e}({});function zd(){return{type:arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",id:-1,pid:-1,inputTimeScale:arguments.length>1&&void 0!==arguments[1]?arguments[1]:9e4,sequenceNumber:-1,samples:[],dropped:0}}class Hd{constructor(){this._audioTrack=void 0,this._id3Track=void 0,this.frameIndex=0,this.cachedData=null,this.basePTS=null,this.initPTS=null,this.lastPTS=null}resetInitSegment(e,t,s,n){this._id3Track={type:"id3",id:3,pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0}}resetTimeStamp(e){this.initPTS=e,this.resetContiguity()}resetContiguity(){this.basePTS=null,this.lastPTS=null,this.frameIndex=0}canParse(e,t){return!1}appendFrame(e,t,s){}demux(e,t){this.cachedData&&(e=qa(this.cachedData,e),this.cachedData=null);let s,n=kd(e,0),r=n?n.length:0;const i=this._audioTrack,a=this._id3Track,o=n?Gd(n):void 0,l=e.length;for((null===this.basePTS||0===this.frameIndex&&Ui(o))&&(this.basePTS=Kd(o,t,this.initPTS),this.lastPTS=this.basePTS),null===this.lastPTS&&(this.lastPTS=this.basePTS),n&&n.length>0&&a.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:n,type:Vd.audioId3,duration:Number.POSITIVE_INFINITY});r<l;){if(this.canParse(e,r)){const t=this.appendFrame(i,e,r);t?(this.frameIndex++,this.lastPTS=t.sample.pts,r+=t.length,s=r):r=l}else jd(e,r)?(n=kd(e,r),a.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:n,type:Vd.audioId3,duration:Number.POSITIVE_INFINITY}),r+=n.length,s=r):r++;if(r===l&&s!==l){const t=e.slice(s);this.cachedData?this.cachedData=qa(this.cachedData,t):this.cachedData=t}}return{audioTrack:i,videoTrack:zd(),id3Track:a,textTrack:zd()}}demuxSampleAes(e,t,s){return Promise.reject(new Error("[".concat(this,"] This demuxer does not support Sample-AES decryption")))}flush(e){const t=this.cachedData;return t&&(this.cachedData=null,this.demux(t,0)),{audioTrack:this._audioTrack,videoTrack:zd(),id3Track:this._id3Track,textTrack:zd()}}destroy(){this.cachedData=null,this._audioTrack=this._id3Track=void 0}}const Kd=(e,t,s)=>{if(Ui(e))return 90*e;return 9e4*t+(s?9e4*s.baseTime/s.timescale:0)};let Wd=null;const qd=[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],Yd=[44100,48e3,32e3,22050,24e3,16e3,11025,12e3,8e3],Xd=[[0,72,144,12],[0,0,0,0],[0,72,144,12],[0,144,144,12]],Qd=[0,1,1,4];function $d(e,t,s,n,r){if(s+24>t.length)return;const i=Jd(t,s);if(i&&s+i.frameLength<=t.length){const a=n+r*(9e4*i.samplesPerFrame/i.sampleRate),o={unit:t.subarray(s,s+i.frameLength),pts:a,dts:a};return e.config=[],e.channelCount=i.channelCount,e.samplerate=i.sampleRate,e.samples.push(o),{sample:o,length:i.frameLength,missing:0}}}function Jd(e,t){const s=e[t+1]>>3&3,n=e[t+1]>>1&3,r=e[t+2]>>4&15,i=e[t+2]>>2&3;if(1!==s&&0!==r&&15!==r&&3!==i){const a=e[t+2]>>1&1,o=e[t+3]>>6,l=1e3*qd[14*(3===s?3-n:3===n?3:4)+r-1],c=Yd[3*(3===s?0:2===s?1:2)+i],d=3===o?1:2,u=Xd[s][n],h=Qd[n],f=8*u*h,m=Math.floor(u*l/c+a)*h;if(null===Wd){const e=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);Wd=e?parseInt(e[1]):0}return!!Wd&&Wd<=87&&2===n&&l>=224e3&&0===o&&(e[t+3]=128|e[t+3]),{sampleRate:c,channelCount:d,frameLength:m,samplesPerFrame:f}}}function Zd(e,t){return 255===e[t]&&224===(224&e[t+1])&&0!==(6&e[t+1])}function eu(e,t){return t+1<e.length&&Zd(e,t)}function tu(e,t){if(t+1<e.length&&Zd(e,t)){const s=4,n=Jd(e,t);let r=s;null!=n&&n.frameLength&&(r=n.frameLength);const i=t+r;return i===e.length||eu(e,i)}return!1}const su=(e,t)=>{let s=0,n=5;t+=n;const r=new Uint32Array(1),i=new Uint32Array(1),a=new Uint8Array(1);for(;n>0;){a[0]=e[t];const o=Math.min(n,8),l=8-o;i[0]=4278190080>>>24+l<<l,r[0]=(a[0]&i[0])>>l,s=s?s<<o|r[0]:r[0],t+=1,n-=o}return s};class nu extends Hd{constructor(e){super(),this.observer=void 0,this.observer=e}resetInitSegment(e,t,s,n){super.resetInitSegment(e,t,s,n),this._audioTrack={container:"audio/ac-3",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"ac3",samples:[],manifestCodec:t,duration:n,inputTimeScale:9e4,dropped:0}}canParse(e,t){return t+64<e.length}appendFrame(e,t,s){const n=ru(e,t,s,this.basePTS,this.frameIndex);if(-1!==n){return{sample:e.samples[e.samples.length-1],length:n,missing:0}}}static probe(e){if(!e)return!1;const t=kd(e,0);if(!t)return!1;const s=t.length;return 11===e[s]&&119===e[s+1]&&void 0!==Gd(t)&&su(e,s)<16}}function ru(e,t,s,n,r){if(s+8>t.length)return-1;if(11!==t[s]||119!==t[s+1])return-1;const i=t[s+4]>>6;if(i>=3)return-1;const a=[48e3,44100,32e3][i],o=63&t[s+4],l=2*[64,69,96,64,70,96,80,87,120,80,88,120,96,104,144,96,105,144,112,121,168,112,122,168,128,139,192,128,140,192,160,174,240,160,175,240,192,208,288,192,209,288,224,243,336,224,244,336,256,278,384,256,279,384,320,348,480,320,349,480,384,417,576,384,418,576,448,487,672,448,488,672,512,557,768,512,558,768,640,696,960,640,697,960,768,835,1152,768,836,1152,896,975,1344,896,976,1344,1024,1114,1536,1024,1115,1536,1152,1253,1728,1152,1254,1728,1280,1393,1920,1280,1394,1920][3*o+i];if(s+l>t.length)return-1;const c=t[s+6]>>5;let d=0;2===c?d+=2:(1&c&&1!==c&&(d+=2),4&c&&(d+=2));const u=(t[s+6]<<8|t[s+7])>>12-d&1,h=[2,1,2,3,3,4,4,5][c]+u,f=t[s+5]>>3,m=7&t[s+5],p=new Uint8Array([i<<6|f<<1|m>>2,(3&m)<<6|c<<3|u<<2|o>>4,o<<4&224]),g=n+r*(1536/a*9e4),v=t.subarray(s,s+l);return e.config=p,e.channelCount=h,e.samplerate=a,e.samples.push({unit:v,pts:g}),l}const iu=/\/emsg[-/]ID3/i;function au(e,t){return Ui(e.presentationTime)?e.presentationTime/e.timeScale:t+e.presentationTimeDelta/e.timeScale}class ou{constructor(e,t,s){this.keyData=void 0,this.decrypter=void 0,this.keyData=s,this.decrypter=new wl(t,{removePKCS7Padding:!1})}decryptBuffer(e){return this.decrypter.decrypt(e,this.keyData.key.buffer,this.keyData.iv.buffer,xl)}decryptAacSample(e,t,s){const n=e[t].unit;if(n.length<=16)return;const r=n.subarray(16,n.length-n.length%16),i=r.buffer.slice(r.byteOffset,r.byteOffset+r.length);this.decryptBuffer(i).then(r=>{const i=new Uint8Array(r);n.set(i,16),this.decrypter.isSync()||this.decryptAacSamples(e,t+1,s)}).catch(s)}decryptAacSamples(e,t,s){for(;;t++){if(t>=e.length)return void s();if(!(e[t].unit.length<32)&&(this.decryptAacSample(e,t,s),!this.decrypter.isSync()))return}}getAvcEncryptedData(e){const t=16*Math.floor((e.length-48)/160)+16,s=new Int8Array(t);let n=0;for(let r=32;r<e.length-16;r+=160,n+=16)s.set(e.subarray(r,r+16),n);return s}getAvcDecryptedUnit(e,t){const s=new Uint8Array(t);let n=0;for(let r=32;r<e.length-16;r+=160,n+=16)e.set(s.subarray(n,n+16),r);return e}decryptAvcSample(e,t,s,n,r){const i=Ja(r.data),a=this.getAvcEncryptedData(i);this.decryptBuffer(a.buffer).then(a=>{r.data=this.getAvcDecryptedUnit(i,a),this.decrypter.isSync()||this.decryptAvcSamples(e,t,s+1,n)}).catch(n)}decryptAvcSamples(e,t,s,n){if(e instanceof Uint8Array)throw new Error("Cannot decrypt samples of type Uint8Array");for(;;t++,s=0){if(t>=e.length)return void n();const r=e[t].units;for(;!(s>=r.length);s++){const i=r[s];if(!(i.data.length<=48||1!==i.type&&5!==i.type)&&(this.decryptAvcSample(e,t,s,n,i),!this.decrypter.isSync()))return}}}}class lu{constructor(){this.VideoSample=null}createVideoSample(e,t,s){return{key:e,frame:!1,pts:t,dts:s,units:[],length:0}}getLastNalUnit(e){var t;let s,n=this.VideoSample;if(n&&0!==n.units.length||(n=e[e.length-1]),null!=(t=n)&&t.units){const e=n.units;s=e[e.length-1]}return s}pushAccessUnit(e,t){if(e.units.length&&e.frame){if(void 0===e.pts){const s=t.samples,n=s.length;if(!n)return void t.dropped++;{const t=s[n-1];e.pts=t.pts,e.dts=t.dts}}t.samples.push(e)}}parseNALu(e,t,s){const n=t.byteLength;let r=e.naluState||0;const i=r,a=[];let o,l,c,d=0,u=-1,h=0;for(-1===r&&(u=0,h=this.getNALuType(t,0),r=0,d=1);d<n;)if(o=t[d++],r)if(1!==r)if(o)if(1===o){if(l=d-r-1,u>=0){const e={data:t.subarray(u,l),type:h};a.push(e)}else{const s=this.getLastNalUnit(e.samples);s&&(i&&d<=4-i&&s.state&&(s.data=s.data.subarray(0,s.data.byteLength-i)),l>0&&(s.data=qa(s.data,t.subarray(0,l)),s.state=0))}d<n?(c=this.getNALuType(t,d),u=d,h=c,r=0):r=-1}else r=0;else r=3;else r=o?0:2;else r=o?0:1;if(u>=0&&r>=0){const e={data:t.subarray(u,n),type:h,state:r};a.push(e)}if(0===a.length){const s=this.getLastNalUnit(e.samples);s&&(s.data=qa(s.data,t))}return e.naluState=r,a}}class cu{constructor(e){this.data=void 0,this.bytesAvailable=void 0,this.word=void 0,this.bitsAvailable=void 0,this.data=e,this.bytesAvailable=e.byteLength,this.word=0,this.bitsAvailable=0}loadWord(){const e=this.data,t=this.bytesAvailable,s=e.byteLength-t,n=new Uint8Array(4),r=Math.min(4,t);if(0===r)throw new Error("no bytes available");n.set(e.subarray(s,s+r)),this.word=new DataView(n.buffer).getUint32(0),this.bitsAvailable=8*r,this.bytesAvailable-=r}skipBits(e){let t;e=Math.min(e,8*this.bytesAvailable+this.bitsAvailable),this.bitsAvailable>e?(this.word<<=e,this.bitsAvailable-=e):(t=(e-=this.bitsAvailable)>>3,e-=t<<3,this.bytesAvailable-=t,this.loadWord(),this.word<<=e,this.bitsAvailable-=e)}readBits(e){let t=Math.min(this.bitsAvailable,e);const s=this.word>>>32-t;if(e>32&&da.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=t,this.bitsAvailable>0)this.word<<=t;else{if(!(this.bytesAvailable>0))throw new Error("no bits available");this.loadWord()}return t=e-t,t>0&&this.bitsAvailable?s<<t|this.readBits(t):s}skipLZ(){let e;for(e=0;e<this.bitsAvailable;++e)if(0!==(this.word&2147483648>>>e))return this.word<<=e,this.bitsAvailable-=e,e;return this.loadWord(),e+this.skipLZ()}skipUEG(){this.skipBits(1+this.skipLZ())}skipEG(){this.skipBits(1+this.skipLZ())}readUEG(){const e=this.skipLZ();return this.readBits(e+1)-1}readEG(){const e=this.readUEG();return 1&e?1+e>>>1:-1*(e>>>1)}readBoolean(){return 1===this.readBits(1)}readUByte(){return this.readBits(8)}readUShort(){return this.readBits(16)}readUInt(){return this.readBits(32)}}class du extends lu{parsePES(e,t,s,n){const r=this.parseNALu(e,s.data,n);let i,a=this.VideoSample,o=!1;s.data=null,a&&r.length&&!e.audFound&&(this.pushAccessUnit(a,e),a=this.VideoSample=this.createVideoSample(!1,s.pts,s.dts)),r.forEach(n=>{var r,l;switch(n.type){case 1:{let t=!1;i=!0;const r=n.data;if(o&&r.length>4){const e=this.readSliceType(r);2!==e&&4!==e&&7!==e&&9!==e||(t=!0)}var c;if(t)null!=(c=a)&&c.frame&&!a.key&&(this.pushAccessUnit(a,e),a=this.VideoSample=null);a||(a=this.VideoSample=this.createVideoSample(!0,s.pts,s.dts)),a.frame=!0,a.key=t;break}case 5:i=!0,null!=(r=a)&&r.frame&&!a.key&&(this.pushAccessUnit(a,e),a=this.VideoSample=null),a||(a=this.VideoSample=this.createVideoSample(!0,s.pts,s.dts)),a.key=!0,a.frame=!0;break;case 6:i=!0,$a(n.data,1,s.pts,t.samples);break;case 7:{var d,u;i=!0,o=!0;const t=n.data,s=this.readSPS(t);if(!e.sps||e.width!==s.width||e.height!==s.height||(null==(d=e.pixelRatio)?void 0:d[0])!==s.pixelRatio[0]||(null==(u=e.pixelRatio)?void 0:u[1])!==s.pixelRatio[1]){e.width=s.width,e.height=s.height,e.pixelRatio=s.pixelRatio,e.sps=[t];const n=t.subarray(1,4);let r="avc1.";for(let e=0;e<3;e++){let t=n[e].toString(16);t.length<2&&(t="0"+t),r+=t}e.codec=r}break}case 8:i=!0,e.pps=[n.data];break;case 9:i=!0,e.audFound=!0,null!=(l=a)&&l.frame&&(this.pushAccessUnit(a,e),a=null),a||(a=this.VideoSample=this.createVideoSample(!1,s.pts,s.dts));break;case 12:i=!0;break;default:i=!1}if(a&&i){a.units.push(n)}}),n&&a&&(this.pushAccessUnit(a,e),this.VideoSample=null)}getNALuType(e,t){return 31&e[t]}readSliceType(e){const t=new cu(e);return t.readUByte(),t.readUEG(),t.readUEG()}skipScalingList(e,t){let s,n=8,r=8;for(let i=0;i<e;i++)0!==r&&(s=t.readEG(),r=(n+s+256)%256),n=0===r?n:r}readSPS(e){const t=new cu(e);let s,n,r,i=0,a=0,o=0,l=0;const c=t.readUByte.bind(t),d=t.readBits.bind(t),u=t.readUEG.bind(t),h=t.readBoolean.bind(t),f=t.skipBits.bind(t),m=t.skipEG.bind(t),p=t.skipUEG.bind(t),g=this.skipScalingList.bind(this);c();const v=c();if(d(5),f(3),c(),p(),100===v||110===v||122===v||244===v||44===v||83===v||86===v||118===v||128===v){const e=u();if(3===e&&f(1),p(),p(),f(1),h())for(n=3!==e?8:12,r=0;r<n;r++)h()&&g(r<6?16:64,t)}p();const y=u();if(0===y)u();else if(1===y)for(f(1),m(),m(),s=u(),r=0;r<s;r++)m();p(),f(1);const b=u(),x=u(),E=d(1);0===E&&f(1),f(1),h()&&(i=u(),a=u(),o=u(),l=u());let S=[1,1];if(h()&&h()){switch(c()){case 1:S=[1,1];break;case 2:S=[12,11];break;case 3:S=[10,11];break;case 4:S=[16,11];break;case 5:S=[40,33];break;case 6:S=[24,11];break;case 7:S=[20,11];break;case 8:S=[32,11];break;case 9:S=[80,33];break;case 10:S=[18,11];break;case 11:S=[15,11];break;case 12:S=[64,33];break;case 13:S=[160,99];break;case 14:S=[4,3];break;case 15:S=[3,2];break;case 16:S=[2,1];break;case 255:S=[c()<<8|c(),c()<<8|c()]}}return{width:Math.ceil(16*(b+1)-2*i-2*a),height:(2-E)*(x+1)*16-(E?2:4)*(o+l),pixelRatio:S}}}class uu extends lu{constructor(){super(...arguments),this.initVPS=null}parsePES(e,t,s,n){const r=this.parseNALu(e,s.data,n);let i,a=this.VideoSample,o=!1;s.data=null,a&&r.length&&!e.audFound&&(this.pushAccessUnit(a,e),a=this.VideoSample=this.createVideoSample(!1,s.pts,s.dts)),r.forEach(n=>{var r,l;switch(n.type){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:case 9:a||(a=this.VideoSample=this.createVideoSample(!1,s.pts,s.dts)),a.frame=!0,i=!0;break;case 16:case 17:case 18:case 21:var c;if(i=!0,o)null!=(c=a)&&c.frame&&!a.key&&(this.pushAccessUnit(a,e),a=this.VideoSample=null);a||(a=this.VideoSample=this.createVideoSample(!0,s.pts,s.dts)),a.key=!0,a.frame=!0;break;case 19:case 20:i=!0,null!=(r=a)&&r.frame&&!a.key&&(this.pushAccessUnit(a,e),a=this.VideoSample=null),a||(a=this.VideoSample=this.createVideoSample(!0,s.pts,s.dts)),a.key=!0,a.frame=!0;break;case 39:i=!0,$a(n.data,2,s.pts,t.samples);break;case 32:i=!0,e.vps||("object"!==typeof e.params&&(e.params={}),e.params=ta(e.params,this.readVPS(n.data)),this.initVPS=n.data),e.vps=[n.data];break;case 33:if(i=!0,o=!0,void 0===e.vps||e.vps[0]===this.initVPS||void 0===e.sps||this.matchSPS(e.sps[0],n.data)||(this.initVPS=e.vps[0],e.sps=e.pps=void 0),!e.sps){const t=this.readSPS(n.data);e.width=t.width,e.height=t.height,e.pixelRatio=t.pixelRatio,e.codec=t.codecString,e.sps=[],"object"!==typeof e.params&&(e.params={});for(const s in t.params)e.params[s]=t.params[s]}this.pushParameterSet(e.sps,n.data,e.vps),a||(a=this.VideoSample=this.createVideoSample(!0,s.pts,s.dts)),a.key=!0;break;case 34:if(i=!0,"object"===typeof e.params){if(!e.pps){e.pps=[];const t=this.readPPS(n.data);for(const s in t)e.params[s]=t[s]}this.pushParameterSet(e.pps,n.data,e.vps)}break;case 35:i=!0,e.audFound=!0,null!=(l=a)&&l.frame&&(this.pushAccessUnit(a,e),a=null),a||(a=this.VideoSample=this.createVideoSample(!1,s.pts,s.dts));break;default:i=!1}if(a&&i){a.units.push(n)}}),n&&a&&(this.pushAccessUnit(a,e),this.VideoSample=null)}pushParameterSet(e,t,s){(s&&s[0]===this.initVPS||!s&&!e.length)&&e.push(t)}getNALuType(e,t){return(126&e[t])>>>1}ebsp2rbsp(e){const t=new Uint8Array(e.byteLength);let s=0;for(let n=0;n<e.byteLength;n++)n>=2&&3===e[n]&&0===e[n-1]&&0===e[n-2]||(t[s]=e[n],s++);return new Uint8Array(t.buffer,0,s)}pushAccessUnit(e,t){super.pushAccessUnit(e,t),this.initVPS&&(this.initVPS=null)}readVPS(e){const t=new cu(e);t.readUByte(),t.readUByte(),t.readBits(4),t.skipBits(2),t.readBits(6);return{numTemporalLayers:t.readBits(3)+1,temporalIdNested:t.readBoolean()}}readSPS(e){const t=new cu(this.ebsp2rbsp(e));t.readUByte(),t.readUByte(),t.readBits(4);const s=t.readBits(3);t.readBoolean();const n=t.readBits(2),r=t.readBoolean(),i=t.readBits(5),a=t.readUByte(),o=t.readUByte(),l=t.readUByte(),c=t.readUByte(),d=t.readUByte(),u=t.readUByte(),h=t.readUByte(),f=t.readUByte(),m=t.readUByte(),p=t.readUByte(),g=t.readUByte(),v=[],y=[];for(let W=0;W<s;W++)v.push(t.readBoolean()),y.push(t.readBoolean());if(s>0)for(let W=s;W<8;W++)t.readBits(2);for(let W=0;W<s;W++)v[W]&&(t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte()),y[W]&&t.readUByte();t.readUEG();const b=t.readUEG();3==b&&t.skipBits(1);const x=t.readUEG(),E=t.readUEG(),S=t.readBoolean();let T=0,k=0,w=0,L=0;S&&(T+=t.readUEG(),k+=t.readUEG(),w+=t.readUEG(),L+=t.readUEG());const C=t.readUEG(),A=t.readUEG(),R=t.readUEG();for(let W=t.readBoolean()?0:s;W<=s;W++)t.skipUEG(),t.skipUEG(),t.skipUEG();t.skipUEG(),t.skipUEG(),t.skipUEG(),t.skipUEG(),t.skipUEG(),t.skipUEG();if(t.readBoolean()){if(t.readBoolean())for(let e=0;e<4;e++)for(let s=0;s<(3===e?2:6);s++){if(t.readBoolean()){const s=Math.min(64,1<<4+(e<<1));e>1&&t.readEG();for(let e=0;e<s;e++)t.readEG()}else t.readUEG()}}t.readBoolean(),t.readBoolean();t.readBoolean()&&(t.readUByte(),t.skipUEG(),t.skipUEG(),t.readBoolean());const _=t.readUEG();let N=0;for(let W=0;W<_;W++){let e=!1;if(0!==W&&(e=t.readBoolean()),e){W===_&&t.readUEG(),t.readBoolean(),t.readUEG();let e=0;for(let s=0;s<=N;s++){const s=t.readBoolean();let n=!1;s||(n=t.readBoolean()),(s||n)&&e++}N=e}else{const e=t.readUEG(),s=t.readUEG();N=e+s;for(let n=0;n<e;n++)t.readUEG(),t.readBoolean();for(let n=0;n<s;n++)t.readUEG(),t.readBoolean()}}if(t.readBoolean()){const e=t.readUEG();for(let s=0;s<e;s++){for(let e=0;e<R+4;e++)t.readBits(1);t.readBits(1)}}let I=0,j=1,P=1,D=!0,M=1,O=0;t.readBoolean(),t.readBoolean();let F=!1;if(t.readBoolean()){if(t.readBoolean()){const e=t.readUByte();e>0&&e<16?(j=[1,12,10,16,40,24,20,32,80,18,15,64,160,4,3,2][e-1],P=[1,11,11,11,33,11,11,11,33,11,11,33,99,3,2,1][e-1]):255===e&&(j=t.readBits(16),P=t.readBits(16))}t.readBoolean()&&t.readBoolean();if(t.readBoolean()){t.readBits(3),t.readBoolean();t.readBoolean()&&(t.readUByte(),t.readUByte(),t.readUByte())}t.readBoolean()&&(t.readUEG(),t.readUEG()),t.readBoolean(),t.readBoolean(),t.readBoolean(),F=t.readBoolean(),F&&(t.skipUEG(),t.skipUEG(),t.skipUEG(),t.skipUEG());if(t.readBoolean()){M=t.readBits(32),O=t.readBits(32);t.readBoolean()&&t.readUEG();if(t.readBoolean()){const e=t.readBoolean(),n=t.readBoolean();let r=!1;(e||n)&&(r=t.readBoolean(),r&&(t.readUByte(),t.readBits(5),t.readBoolean(),t.readBits(5)),t.readBits(4),t.readBits(4),r&&t.readBits(4),t.readBits(5),t.readBits(5),t.readBits(5));for(let i=0;i<=s;i++){D=t.readBoolean();let s=!1;D||t.readBoolean()?t.readEG():s=t.readBoolean();const i=s?1:t.readUEG()+1;if(e)for(let e=0;e<i;e++)t.readUEG(),t.readUEG(),r&&(t.readUEG(),t.readUEG()),t.skipBits(1);if(n)for(let e=0;e<i;e++)t.readUEG(),t.readUEG(),r&&(t.readUEG(),t.readUEG()),t.skipBits(1)}}}t.readBoolean()&&(t.readBoolean(),t.readBoolean(),t.readBoolean(),I=t.readUEG())}let U=x,B=E;if(S){let e=1,t=1;1===b?e=t=2:2==b&&(e=2),U=x-e*k-e*T,B=E-t*L-t*w}const G=n?["A","B","C"][n]:"",V=a<<24|o<<16|l<<8|c;let z=0;for(let W=0;W<32;W++)z=(z|(V>>W&1)<<31-W)>>>0;let H=z.toString(16);1===i&&"2"===H&&(H="6");const K=r?"H":"L";return{codecString:"hvc1.".concat(G).concat(i,".").concat(H,".").concat(K).concat(g,".B0"),params:{general_tier_flag:r,general_profile_idc:i,general_profile_space:n,general_profile_compatibility_flags:[a,o,l,c],general_constraint_indicator_flags:[d,u,h,f,m,p],general_level_idc:g,bit_depth:C+8,bit_depth_luma_minus8:C,bit_depth_chroma_minus8:A,min_spatial_segmentation_idc:I,chroma_format_idc:b,frame_rate:{fixed:D,fps:O/M}},width:U,height:B,pixelRatio:[j,P]}}readPPS(e){const t=new cu(this.ebsp2rbsp(e));t.readUByte(),t.readUByte(),t.skipUEG(),t.skipUEG(),t.skipBits(2),t.skipBits(3),t.skipBits(2),t.skipUEG(),t.skipUEG(),t.skipEG(),t.skipBits(2);t.readBoolean()&&t.skipUEG(),t.skipEG(),t.skipEG(),t.skipBits(4);const s=t.readBoolean(),n=t.readBoolean();let r=1;return n&&s?r=0:n?r=3:s&&(r=2),{parallelismType:r}}matchSPS(e,t){return String.fromCharCode.apply(null,e).substr(3)===String.fromCharCode.apply(null,t).substr(3)}}const hu=188;class fu{constructor(e,t,s,n){this.logger=void 0,this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.sampleAes=null,this.pmtParsed=!1,this.audioCodec=void 0,this.videoCodec=void 0,this._pmtId=-1,this._videoTrack=void 0,this._audioTrack=void 0,this._id3Track=void 0,this._txtTrack=void 0,this.aacOverFlow=null,this.remainderData=null,this.videoParser=void 0,this.observer=e,this.config=t,this.typeSupported=s,this.logger=n,this.videoParser=null}static probe(e,t){const s=fu.syncOffset(e);return s>0&&t.warn("MPEG2-TS detected but first sync word found @ offset ".concat(s)),-1!==s}static syncOffset(e){const t=e.length;let s=Math.min(940,t-hu)+1,n=0;for(;n<s;){let r=!1,i=-1,a=0;for(let o=n;o<t;o+=hu){if(71!==e[o]||t-o!==hu&&71!==e[o+hu]){if(a)return-1;break}if(a++,-1===i&&(i=o,0!==i&&(s=Math.min(i+18612,e.length-hu)+1)),r||(r=0===mu(e,o)),r&&a>1&&(0===i&&a>2||o+hu>s))return i}n++}return-1}static createTrack(e,t){return{container:"video"===e||"audio"===e?"video/mp2t":void 0,type:e,id:Na[e],pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0,duration:"audio"===e?t:void 0}}resetInitSegment(e,t,s,n){this.pmtParsed=!1,this._pmtId=-1,this._videoTrack=fu.createTrack("video"),this._videoTrack.duration=n,this._audioTrack=fu.createTrack("audio",n),this._id3Track=fu.createTrack("id3"),this._txtTrack=fu.createTrack("text"),this._audioTrack.segmentCodec="aac",this.videoParser=null,this.aacOverFlow=null,this.remainderData=null,this.audioCodec=t,this.videoCodec=s}resetTimeStamp(){}resetContiguity(){const{_audioTrack:e,_videoTrack:t,_id3Track:s}=this;e&&(e.pesData=null),t&&(t.pesData=null),s&&(s.pesData=null),this.aacOverFlow=null,this.remainderData=null}demux(e,t){let s,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];n||(this.sampleAes=null);const i=this._videoTrack,a=this._audioTrack,o=this._id3Track,l=this._txtTrack;let c=i.pid,d=i.pesData,u=a.pid,h=o.pid,f=a.pesData,m=o.pesData,p=null,g=this.pmtParsed,v=this._pmtId,y=e.length;if(this.remainderData&&(y=(e=qa(this.remainderData,e)).length,this.remainderData=null),y<hu&&!r)return this.remainderData=e,{audioTrack:a,videoTrack:i,id3Track:o,textTrack:l};const b=Math.max(0,fu.syncOffset(e));y-=(y-b)%hu,y<e.byteLength&&!r&&(this.remainderData=new Uint8Array(e.buffer,y,e.buffer.byteLength-y));let x=0;for(let S=b;S<y;S+=hu)if(71===e[S]){const t=!!(64&e[S+1]),r=mu(e,S);let y;if((48&e[S+3])>>4>1){if(y=S+5+e[S+4],y===S+hu)continue}else y=S+4;switch(r){case c:t&&(d&&(s=bu(d,this.logger))&&(this.readyVideoParser(i.segmentCodec),null!==this.videoParser&&this.videoParser.parsePES(i,l,s,!1)),d={data:[],size:0}),d&&(d.data.push(e.subarray(y,S+hu)),d.size+=S+hu-y);break;case u:if(t){if(f&&(s=bu(f,this.logger)))switch(a.segmentCodec){case"aac":this.parseAACPES(a,s);break;case"mp3":this.parseMPEGPES(a,s);break;case"ac3":this.parseAC3PES(a,s)}f={data:[],size:0}}f&&(f.data.push(e.subarray(y,S+hu)),f.size+=S+hu-y);break;case h:t&&(m&&(s=bu(m,this.logger))&&this.parseID3PES(o,s),m={data:[],size:0}),m&&(m.data.push(e.subarray(y,S+hu)),m.size+=S+hu-y);break;case 0:t&&(y+=e[y]+1),v=this._pmtId=pu(e,y);break;case v:{t&&(y+=e[y]+1);const s=gu(e,y,this.typeSupported,n,this.observer,this.logger);c=s.videoPid,c>0&&(i.pid=c,i.segmentCodec=s.segmentVideoCodec),u=s.audioPid,u>0&&(a.pid=u,a.segmentCodec=s.segmentAudioCodec),h=s.id3Pid,h>0&&(o.pid=h),null===p||g||(this.logger.warn("MPEG-TS PMT found at ".concat(S," after unknown PID '").concat(p,"'. Backtracking to sync byte @").concat(b," to parse all TS packets.")),p=null,S=b-188),g=this.pmtParsed=!0;break}case 17:case 8191:break;default:p=r}}else x++;x>0&&vu(this.observer,new Error("Found ".concat(x," TS packet/s that do not start with 0x47")),void 0,this.logger),i.pesData=d,a.pesData=f,o.pesData=m;const E={audioTrack:a,videoTrack:i,id3Track:o,textTrack:l};return r&&this.extractRemainingSamples(E),E}flush(){const{remainderData:e}=this;let t;return this.remainderData=null,t=e?this.demux(e,-1,!1,!0):{videoTrack:this._videoTrack,audioTrack:this._audioTrack,id3Track:this._id3Track,textTrack:this._txtTrack},this.extractRemainingSamples(t),this.sampleAes?this.decrypt(t,this.sampleAes):t}extractRemainingSamples(e){const{audioTrack:t,videoTrack:s,id3Track:n,textTrack:r}=e,i=s.pesData,a=t.pesData,o=n.pesData;let l;if(i&&(l=bu(i,this.logger))?(this.readyVideoParser(s.segmentCodec),null!==this.videoParser&&(this.videoParser.parsePES(s,r,l,!0),s.pesData=null)):s.pesData=i,a&&(l=bu(a,this.logger))){switch(t.segmentCodec){case"aac":this.parseAACPES(t,l);break;case"mp3":this.parseMPEGPES(t,l);break;case"ac3":this.parseAC3PES(t,l)}t.pesData=null}else null!=a&&a.size&&this.logger.log("last AAC PES packet truncated,might overlap between fragments"),t.pesData=a;o&&(l=bu(o,this.logger))?(this.parseID3PES(n,l),n.pesData=null):n.pesData=o}demuxSampleAes(e,t,s){const n=this.demux(e,s,!0,!this.config.progressive),r=this.sampleAes=new ou(this.observer,this.config,t);return this.decrypt(n,r)}readyVideoParser(e){null===this.videoParser&&("avc"===e?this.videoParser=new du:"hevc"===e&&(this.videoParser=new uu))}decrypt(e,t){return new Promise(s=>{const{audioTrack:n,videoTrack:r}=e;n.samples&&"aac"===n.segmentCodec?t.decryptAacSamples(n.samples,0,()=>{r.samples?t.decryptAvcSamples(r.samples,0,0,()=>{s(e)}):s(e)}):r.samples&&t.decryptAvcSamples(r.samples,0,0,()=>{s(e)})})}destroy(){this.observer&&this.observer.removeAllListeners(),this.config=this.logger=this.observer=null,this.aacOverFlow=this.videoParser=this.remainderData=this.sampleAes=null,this._videoTrack=this._audioTrack=this._id3Track=this._txtTrack=void 0}parseAACPES(e,t){let s=0;const n=this.aacOverFlow;let r,i,a,o=t.data;if(n){this.aacOverFlow=null;const t=n.missing,r=n.sample.unit.byteLength;if(-1===t)o=qa(n.sample.unit,o);else{const i=r-t;n.sample.unit.set(o.subarray(0,t),i),e.samples.push(n.sample),s=n.missing}}for(r=s,i=o.length;r<i-1&&!Ad(o,r);r++);if(r!==s){let e;const t=r<i-1;if(e=t?"AAC PES did not start with ADTS header,offset:".concat(r):"No ADTS header found in AAC PES",vu(this.observer,new Error(e),t,this.logger),!t)return}if(_d(e,this.observer,o,r,this.audioCodec),void 0!==t.pts)a=t.pts;else{if(!n)return void this.logger.warn("[tsdemuxer]: AAC PES unknown PTS");{const t=Nd(e.samplerate);a=n.sample.pts+t}}let l,c=0;for(;r<i;){if(l=Id(e,o,r,a,c),r+=l.length,l.missing){this.aacOverFlow=l;break}for(c++;r<i-1&&!Ad(o,r);r++);}}parseMPEGPES(e,t){const s=t.data,n=s.length;let r=0,i=0;const a=t.pts;if(void 0!==a)for(;i<n;)if(eu(s,i)){const t=$d(e,s,i,a,r);if(!t)break;i+=t.length,r++}else i++;else this.logger.warn("[tsdemuxer]: MPEG PES unknown PTS")}parseAC3PES(e,t){{const s=t.data,n=t.pts;if(void 0===n)return void this.logger.warn("[tsdemuxer]: AC3 PES unknown PTS");const r=s.length;let i,a=0,o=0;for(;o<r&&(i=ru(e,s,o,n,a++))>0;)o+=i}}parseID3PES(e,t){if(void 0===t.pts)return void this.logger.warn("[tsdemuxer]: ID3 PES unknown PTS");const s=ta({},t,{type:this._videoTrack?Vd.emsg:Vd.audioId3,duration:Number.POSITIVE_INFINITY});e.samples.push(s)}}function mu(e,t){return((31&e[t+1])<<8)+e[t+2]}function pu(e,t){return(31&e[t+10])<<8|e[t+11]}function gu(e,t,s,n,r,i){const a={audioPid:-1,videoPid:-1,id3Pid:-1,segmentVideoCodec:"avc",segmentAudioCodec:"aac"},o=t+3+((15&e[t+1])<<8|e[t+2])-4;for(t+=12+((15&e[t+10])<<8|e[t+11]);t<o;){const o=mu(e,t),l=(15&e[t+3])<<8|e[t+4];switch(e[t]){case 207:if(!n){yu("ADTS AAC",i);break}case 15:-1===a.audioPid&&(a.audioPid=o);break;case 21:-1===a.id3Pid&&(a.id3Pid=o);break;case 219:if(!n){yu("H.264",i);break}case 27:-1===a.videoPid&&(a.videoPid=o);break;case 3:case 4:s.mpeg||s.mp3?-1===a.audioPid&&(a.audioPid=o,a.segmentAudioCodec="mp3"):i.log("MPEG audio found, not supported in this browser");break;case 193:if(!n){yu("AC-3",i);break}case 129:s.ac3?-1===a.audioPid&&(a.audioPid=o,a.segmentAudioCodec="ac3"):i.log("AC-3 audio found, not supported in this browser");break;case 6:if(-1===a.audioPid&&l>0){let n=t+5,r=l;for(;r>2;){if(106===e[n])!0!==s.ac3?i.log("AC-3 audio found, not supported in this browser for now"):(a.audioPid=o,a.segmentAudioCodec="ac3");const t=e[n+1]+2;n+=t,r-=t}}break;case 194:case 135:return vu(r,new Error("Unsupported EC-3 in M2TS found"),void 0,i),a;case 36:-1===a.videoPid&&(a.videoPid=o,a.segmentVideoCodec="hevc",i.log("HEVC in M2TS found"))}t+=l+5}return a}function vu(e,t,s,n){n.warn("parsing error: ".concat(t.message)),e.emit(Hi.ERROR,Hi.ERROR,{type:Vi.MEDIA_ERROR,details:zi.FRAG_PARSING_ERROR,fatal:!1,levelRetry:s,error:t,reason:t.message})}function yu(e,t){t.log("".concat(e," with AES-128-CBC encryption found in unencrypted stream"))}function bu(e,t){let s,n,r,i,a,o=0;const l=e.data;if(!e||0===e.size)return null;for(;l[0].length<19&&l.length>1;)l[0]=qa(l[0],l[1]),l.splice(1,1);s=l[0];if(1===(s[0]<<16)+(s[1]<<8)+s[2]){if(n=(s[4]<<8)+s[5],n&&n>e.size-6)return null;const c=s[7];192&c&&(i=536870912*(14&s[9])+4194304*(255&s[10])+16384*(254&s[11])+128*(255&s[12])+(254&s[13])/2,64&c?(a=536870912*(14&s[14])+4194304*(255&s[15])+16384*(254&s[16])+128*(255&s[17])+(254&s[18])/2,i-a>54e5&&(t.warn("".concat(Math.round((i-a)/9e4),"s delta between PTS and DTS, align them")),i=a)):a=i),r=s[8];let d=r+9;if(e.size<=d)return null;e.size-=d;const u=new Uint8Array(e.size);for(let e=0,t=l.length;e<t;e++){s=l[e];let t=s.byteLength;if(d){if(d>t){d-=t;continue}s=s.subarray(d),t-=d,d=0}u.set(s,o),o+=t}return n&&(n-=r+3),{data:u,pts:i,dts:a,len:n}}return null}class xu{static getSilentFrame(e,t){if("mp4a.40.2"===e){if(1===t)return new Uint8Array([0,200,0,128,35,128]);if(2===t)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(3===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(4===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(5===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(6===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224])}else{if(1===t)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(2===t)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(3===t)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94])}}}const Eu=Math.pow(2,32)-1;class Su{static init(){let e;for(e in Su.types={avc1:[],avcC:[],hvc1:[],hvcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],".mp3":[],dac3:[],"ac-3":[],mvex:[],mvhd:[],pasp:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]},Su.types)Su.types.hasOwnProperty(e)&&(Su.types[e]=[e.charCodeAt(0),e.charCodeAt(1),e.charCodeAt(2),e.charCodeAt(3)]);const t=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),s=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);Su.HDLR_TYPES={video:t,audio:s};const n=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),r=new Uint8Array([0,0,0,0,0,0,0,0]);Su.STTS=Su.STSC=Su.STCO=r,Su.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),Su.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),Su.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),Su.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);const i=new Uint8Array([105,115,111,109]),a=new Uint8Array([97,118,99,49]),o=new Uint8Array([0,0,0,1]);Su.FTYP=Su.box(Su.types.ftyp,i,o,i,a),Su.DINF=Su.box(Su.types.dinf,Su.box(Su.types.dref,n))}static box(e){let t=8;for(var s=arguments.length,n=new Array(s>1?s-1:0),r=1;r<s;r++)n[r-1]=arguments[r];let i=n.length;const a=i;for(;i--;)t+=n[i].byteLength;const o=new Uint8Array(t);for(o[0]=t>>24&255,o[1]=t>>16&255,o[2]=t>>8&255,o[3]=255&t,o.set(e,4),i=0,t=8;i<a;i++)o.set(n[i],t),t+=n[i].byteLength;return o}static hdlr(e){return Su.box(Su.types.hdlr,Su.HDLR_TYPES[e])}static mdat(e){return Su.box(Su.types.mdat,e)}static mdhd(e,t){t*=e;const s=Math.floor(t/(Eu+1)),n=Math.floor(t%(Eu+1));return Su.box(Su.types.mdhd,new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,e>>24&255,e>>16&255,e>>8&255,255&e,s>>24,s>>16&255,s>>8&255,255&s,n>>24,n>>16&255,n>>8&255,255&n,85,196,0,0]))}static mdia(e){return Su.box(Su.types.mdia,Su.mdhd(e.timescale||0,e.duration||0),Su.hdlr(e.type),Su.minf(e))}static mfhd(e){return Su.box(Su.types.mfhd,new Uint8Array([0,0,0,0,e>>24,e>>16&255,e>>8&255,255&e]))}static minf(e){return"audio"===e.type?Su.box(Su.types.minf,Su.box(Su.types.smhd,Su.SMHD),Su.DINF,Su.stbl(e)):Su.box(Su.types.minf,Su.box(Su.types.vmhd,Su.VMHD),Su.DINF,Su.stbl(e))}static moof(e,t,s){return Su.box(Su.types.moof,Su.mfhd(e),Su.traf(s,t))}static moov(e){let t=e.length;const s=[];for(;t--;)s[t]=Su.trak(e[t]);return Su.box.apply(null,[Su.types.moov,Su.mvhd(e[0].timescale||0,e[0].duration||0)].concat(s).concat(Su.mvex(e)))}static mvex(e){let t=e.length;const s=[];for(;t--;)s[t]=Su.trex(e[t]);return Su.box.apply(null,[Su.types.mvex,...s])}static mvhd(e,t){t*=e;const s=Math.floor(t/(Eu+1)),n=Math.floor(t%(Eu+1)),r=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,e>>24&255,e>>16&255,e>>8&255,255&e,s>>24,s>>16&255,s>>8&255,255&s,n>>24,n>>16&255,n>>8&255,255&n,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return Su.box(Su.types.mvhd,r)}static sdtp(e){const t=e.samples||[],s=new Uint8Array(4+t.length);let n,r;for(n=0;n<t.length;n++)r=t[n].flags,s[n+4]=r.dependsOn<<4|r.isDependedOn<<2|r.hasRedundancy;return Su.box(Su.types.sdtp,s)}static stbl(e){return Su.box(Su.types.stbl,Su.stsd(e),Su.box(Su.types.stts,Su.STTS),Su.box(Su.types.stsc,Su.STSC),Su.box(Su.types.stsz,Su.STSZ),Su.box(Su.types.stco,Su.STCO))}static avc1(e){let t,s,n,r=[],i=[];for(t=0;t<e.sps.length;t++)s=e.sps[t],n=s.byteLength,r.push(n>>>8&255),r.push(255&n),r=r.concat(Array.prototype.slice.call(s));for(t=0;t<e.pps.length;t++)s=e.pps[t],n=s.byteLength,i.push(n>>>8&255),i.push(255&n),i=i.concat(Array.prototype.slice.call(s));const a=Su.box(Su.types.avcC,new Uint8Array([1,r[3],r[4],r[5],255,224|e.sps.length].concat(r).concat([e.pps.length]).concat(i))),o=e.width,l=e.height,c=e.pixelRatio[0],d=e.pixelRatio[1];return Su.box(Su.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,o>>8&255,255&o,l>>8&255,255&l,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),a,Su.box(Su.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),Su.box(Su.types.pasp,new Uint8Array([c>>24,c>>16&255,c>>8&255,255&c,d>>24,d>>16&255,d>>8&255,255&d])))}static esds(e){const t=e.config;return new Uint8Array([0,0,0,0,3,25,0,1,0,4,17,64,21,0,0,0,0,0,0,0,0,0,0,0,5,2,...t,6,1,2])}static audioStsd(e){const t=e.samplerate||0;return new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,e.channelCount||0,0,16,0,0,0,0,t>>8&255,255&t,0,0])}static mp4a(e){return Su.box(Su.types.mp4a,Su.audioStsd(e),Su.box(Su.types.esds,Su.esds(e)))}static mp3(e){return Su.box(Su.types[".mp3"],Su.audioStsd(e))}static ac3(e){return Su.box(Su.types["ac-3"],Su.audioStsd(e),Su.box(Su.types.dac3,e.config))}static stsd(e){const{segmentCodec:t}=e;if("audio"===e.type){if("aac"===t)return Su.box(Su.types.stsd,Su.STSD,Su.mp4a(e));if("ac3"===t&&e.config)return Su.box(Su.types.stsd,Su.STSD,Su.ac3(e));if("mp3"===t&&"mp3"===e.codec)return Su.box(Su.types.stsd,Su.STSD,Su.mp3(e))}else{if(!e.pps||!e.sps)throw new Error("video track missing pps or sps");if("avc"===t)return Su.box(Su.types.stsd,Su.STSD,Su.avc1(e));if("hevc"===t&&e.vps)return Su.box(Su.types.stsd,Su.STSD,Su.hvc1(e))}throw new Error("unsupported ".concat(e.type," segment codec (").concat(t,"/").concat(e.codec,")"))}static tkhd(e){const t=e.id,s=(e.duration||0)*(e.timescale||0),n=e.width||0,r=e.height||0,i=Math.floor(s/(Eu+1)),a=Math.floor(s%(Eu+1));return Su.box(Su.types.tkhd,new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,t>>24&255,t>>16&255,t>>8&255,255&t,0,0,0,0,i>>24,i>>16&255,i>>8&255,255&i,a>>24,a>>16&255,a>>8&255,255&a,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,n>>8&255,255&n,0,0,r>>8&255,255&r,0,0]))}static traf(e,t){const s=Su.sdtp(e),n=e.id,r=Math.floor(t/(Eu+1)),i=Math.floor(t%(Eu+1));return Su.box(Su.types.traf,Su.box(Su.types.tfhd,new Uint8Array([0,0,0,0,n>>24,n>>16&255,n>>8&255,255&n])),Su.box(Su.types.tfdt,new Uint8Array([1,0,0,0,r>>24,r>>16&255,r>>8&255,255&r,i>>24,i>>16&255,i>>8&255,255&i])),Su.trun(e,s.length+16+20+8+16+8+8),s)}static trak(e){return e.duration=e.duration||4294967295,Su.box(Su.types.trak,Su.tkhd(e),Su.mdia(e))}static trex(e){const t=e.id;return Su.box(Su.types.trex,new Uint8Array([0,0,0,0,t>>24,t>>16&255,t>>8&255,255&t,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))}static trun(e,t){const s=e.samples||[],n=s.length,r=12+16*n,i=new Uint8Array(r);let a,o,l,c,d,u;for(t+=8+r,i.set(["video"===e.type?1:0,0,15,1,n>>>24&255,n>>>16&255,n>>>8&255,255&n,t>>>24&255,t>>>16&255,t>>>8&255,255&t],0),a=0;a<n;a++)o=s[a],l=o.duration,c=o.size,d=o.flags,u=o.cts,i.set([l>>>24&255,l>>>16&255,l>>>8&255,255&l,c>>>24&255,c>>>16&255,c>>>8&255,255&c,d.isLeading<<2|d.dependsOn,d.isDependedOn<<6|d.hasRedundancy<<4|d.paddingValue<<1|d.isNonSync,61440&d.degradPrio,15&d.degradPrio,u>>>24&255,u>>>16&255,u>>>8&255,255&u],12+16*a);return Su.box(Su.types.trun,i)}static initSegment(e){Su.types||Su.init();const t=Su.moov(e);return qa(Su.FTYP,t)}static hvc1(e){const t=e.params,s=[e.vps,e.sps,e.pps],n=new Uint8Array([1,t.general_profile_space<<6|(t.general_tier_flag?32:0)|t.general_profile_idc,t.general_profile_compatibility_flags[0],t.general_profile_compatibility_flags[1],t.general_profile_compatibility_flags[2],t.general_profile_compatibility_flags[3],t.general_constraint_indicator_flags[0],t.general_constraint_indicator_flags[1],t.general_constraint_indicator_flags[2],t.general_constraint_indicator_flags[3],t.general_constraint_indicator_flags[4],t.general_constraint_indicator_flags[5],t.general_level_idc,240|t.min_spatial_segmentation_idc>>8,255&t.min_spatial_segmentation_idc,252|t.parallelismType,252|t.chroma_format_idc,248|t.bit_depth_luma_minus8,248|t.bit_depth_chroma_minus8,0,parseInt(t.frame_rate.fps),3|t.temporal_id_nested<<2|t.num_temporal_layers<<3|(t.frame_rate.fixed?64:0),s.length]);let r=n.length;for(let h=0;h<s.length;h+=1){r+=3;for(let e=0;e<s[h].length;e+=1)r+=2+s[h][e].length}const i=new Uint8Array(r);i.set(n,0),r=n.length;const a=s.length-1;for(let h=0;h<s.length;h+=1){i.set(new Uint8Array([32+h|(h===a?128:0),0,s[h].length]),r),r+=3;for(let e=0;e<s[h].length;e+=1)i.set(new Uint8Array([s[h][e].length>>8,255&s[h][e].length]),r),r+=2,i.set(s[h][e],r),r+=s[h][e].length}const o=Su.box(Su.types.hvcC,i),l=e.width,c=e.height,d=e.pixelRatio[0],u=e.pixelRatio[1];return Su.box(Su.types.hvc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,l>>8&255,255&l,c>>8&255,255&c,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),o,Su.box(Su.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),Su.box(Su.types.pasp,new Uint8Array([d>>24,d>>16&255,d>>8&255,255&d,u>>24,u>>16&255,u>>8&255,255&u])))}}Su.types=void 0,Su.HDLR_TYPES=void 0,Su.STTS=void 0,Su.STSC=void 0,Su.STCO=void 0,Su.STSZ=void 0,Su.VMHD=void 0,Su.SMHD=void 0,Su.STSD=void 0,Su.FTYP=void 0,Su.DINF=void 0;function Tu(e,t){const s=e*t*(arguments.length>2&&void 0!==arguments[2]?arguments[2]:1);return arguments.length>3&&void 0!==arguments[3]&&arguments[3]?Math.round(s):s}function ku(e){return Tu(e,1e3,1/9e4,arguments.length>1&&void 0!==arguments[1]&&arguments[1])}function wu(e){const{baseTime:t,timescale:s,trackId:n}=e;return"".concat(t/s," (").concat(t,"/").concat(s,") trackId: ").concat(n)}let Lu,Cu=null,Au=null;function Ru(e,t,s,n){return{duration:t,size:s,cts:n,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:e?2:1,isNonSync:e?0:1}}}class _u extends ra{constructor(e,t,s,n){if(super("mp4-remuxer",n),this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.ISGenerated=!1,this._initPTS=null,this._initDTS=null,this.nextVideoTs=null,this.nextAudioTs=null,this.videoSampleDuration=null,this.isAudioContiguous=!1,this.isVideoContiguous=!1,this.videoTrackConfig=void 0,this.observer=e,this.config=t,this.typeSupported=s,this.ISGenerated=!1,null===Cu){const e=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);Cu=e?parseInt(e[1]):0}if(null===Au){const e=navigator.userAgent.match(/Safari\/(\d+)/i);Au=e?parseInt(e[1]):0}}destroy(){this.config=this.videoTrackConfig=this._initPTS=this._initDTS=null}resetTimeStamp(e){const t=this._initPTS;t&&e&&e.trackId===t.trackId&&e.baseTime===t.baseTime&&e.timescale===t.timescale||this.log("Reset initPTS: ".concat(t?wu(t):t," > ").concat(e?wu(e):e)),this._initPTS=this._initDTS=e}resetNextTimestamp(){this.log("reset next timestamp"),this.isVideoContiguous=!1,this.isAudioContiguous=!1}resetInitSegment(){this.log("ISGenerated flag reset"),this.ISGenerated=!1,this.videoTrackConfig=void 0}getVideoStartPts(e){let t=!1;const s=e[0].pts,n=e.reduce((e,n)=>{let r=n.pts,i=r-e;return i<-4294967296&&(t=!0,r=Nu(r,s),i=r-e),i>0?e:r},s);return t&&this.debug("PTS rollover detected"),n}remux(e,t,s,n,r,i,a,o){let l,c,d,u,h,f,m=r,p=r;const g=e.pid>-1,v=t.pid>-1,y=t.samples.length,b=e.samples.length>0,x=a&&y>0||y>1;if((!g||b)&&(!v||x)||this.ISGenerated||a){if(this.ISGenerated){var E,S,T,k;const e=this.videoTrackConfig;(e&&(t.width!==e.width||t.height!==e.height||(null==(E=t.pixelRatio)?void 0:E[0])!==(null==(S=e.pixelRatio)?void 0:S[0])||(null==(T=t.pixelRatio)?void 0:T[1])!==(null==(k=e.pixelRatio)?void 0:k[1]))||!e&&x||null===this.nextAudioTs&&b)&&this.resetInitSegment()}this.ISGenerated||(d=this.generateIS(e,t,r,i));const s=this.isVideoContiguous;let n,a=-1;if(x&&(a=function(e){for(let t=0;t<e.length;t++)if(e[t].key)return t;return-1}(t.samples),!s&&this.config.forceKeyFrameOnDiscontinuity))if(f=!0,a>0){this.warn("Dropped ".concat(a," out of ").concat(y," video samples due to a missing keyframe"));const e=this.getVideoStartPts(t.samples);t.samples=t.samples.slice(a),t.dropped+=a,p+=(t.samples[0].pts-e)/t.inputTimeScale,n=p}else-1===a&&(this.warn("No keyframe found out of ".concat(y," video samples")),f=!1);if(this.ISGenerated){if(b&&x){const s=this.getVideoStartPts(t.samples),n=(Nu(e.samples[0].pts,s)-s)/t.inputTimeScale;m+=Math.max(0,n),p+=Math.max(0,-n)}if(b){if(e.samplerate||(this.warn("regenerate InitSegment as audio detected"),d=this.generateIS(e,t,r,i)),c=this.remuxAudio(e,m,this.isAudioContiguous,i,v||x||o===Qi?p:void 0),x){const n=c?c.endPTS-c.startPTS:0;t.inputTimeScale||(this.warn("regenerate InitSegment as video detected"),d=this.generateIS(e,t,r,i)),l=this.remuxVideo(t,p,s,n)}}else x&&(l=this.remuxVideo(t,p,s,0));l&&(l.firstKeyFrame=a,l.independent=-1!==a,l.firstKeyFramePTS=n)}}return this.ISGenerated&&this._initPTS&&this._initDTS&&(s.samples.length&&(h=Iu(s,r,this._initPTS,this._initDTS)),n.samples.length&&(u=ju(n,r,this._initPTS))),{audio:c,video:l,initSegment:d,independent:f,text:u,id3:h}}computeInitPts(e,t,s,n){const r=Math.round(s*t);let i=Nu(e,r);if(i<r+t)for(this.log("Adjusting PTS for rollover in timeline near ".concat((r-i)/t," ").concat(n));i<r+t;)i+=8589934592;return i-r}generateIS(e,t,s,n){const r=e.samples,i=t.samples,a=this.typeSupported,o={},l=this._initPTS;let c,d,u,h=!l||n,f="audio/mp4",m=-1;if(h&&(c=d=1/0),e.config&&r.length){switch(e.timescale=e.samplerate,e.segmentCodec){case"mp3":a.mpeg?(f="audio/mpeg",e.codec=""):a.mp3&&(e.codec="mp3");break;case"ac3":e.codec="ac-3"}o.audio={id:"audio",container:f,codec:e.codec,initSegment:"mp3"===e.segmentCodec&&a.mpeg?new Uint8Array(0):Su.initSegment([e]),metadata:{channelCount:e.channelCount}},h&&(m=e.id,u=e.inputTimeScale,l&&u===l.timescale?h=!1:c=d=this.computeInitPts(r[0].pts,u,s,"audio"))}if(t.sps&&t.pps&&i.length){if(t.timescale=t.inputTimeScale,o.video={id:"main",container:"video/mp4",codec:t.codec,initSegment:Su.initSegment([t]),metadata:{width:t.width,height:t.height}},h)if(m=t.id,u=t.inputTimeScale,l&&u===l.timescale)h=!1;else{const e=this.getVideoStartPts(i),t=Nu(i[0].dts,e),n=this.computeInitPts(t,u,s,"video"),r=this.computeInitPts(e,u,s,"video");d=Math.min(d,n),c=Math.min(c,r)}this.videoTrackConfig={width:t.width,height:t.height,pixelRatio:t.pixelRatio}}if(Object.keys(o).length)return this.ISGenerated=!0,h?(l&&this.warn("Timestamps at playlist time: ".concat(n?"":"~").concat(s," ").concat(c/u," != initPTS: ").concat(l.baseTime/l.timescale," (").concat(l.baseTime,"/").concat(l.timescale,") trackId: ").concat(l.trackId)),this.log("Found initPTS at playlist time: ".concat(s," offset: ").concat(c/u," (").concat(c,"/").concat(u,") trackId: ").concat(m)),this._initPTS={baseTime:c,timescale:u,trackId:m},this._initDTS={baseTime:d,timescale:u,trackId:m}):c=u=void 0,{tracks:o,initPTS:c,timescale:u,trackId:m}}remuxVideo(e,t,s,n){const r=e.inputTimeScale,i=e.samples,a=[],o=i.length,l=this._initPTS,c=l.baseTime*r/l.timescale;let d,u,h=this.nextVideoTs,f=8,m=this.videoSampleDuration,p=Number.POSITIVE_INFINITY,g=Number.NEGATIVE_INFINITY,v=!1;if(!s||null===h){const e=c+t*r,n=i[0].pts-Nu(i[0].dts,i[0].pts);Cu&&null!==h&&Math.abs(e-n-(h+c))<15e3?s=!0:h=e-n-c}const y=h+c;for(let D=0;D<o;D++){const e=i[D];e.pts=Nu(e.pts,y),e.dts=Nu(e.dts,y),e.dts<i[D>0?D-1:D].dts&&(v=!0)}v&&i.sort(function(e,t){const s=e.dts-t.dts,n=e.pts-t.pts;return s||n}),d=i[0].dts,u=i[i.length-1].dts;const b=u-d,x=b?Math.round(b/(o-1)):m||e.inputTimeScale/30;if(s){const s=d-y,n=s>x,r=s<-1;if((n||r)&&(n?this.warn("".concat((e.segmentCodec||"").toUpperCase(),": ").concat(ku(s,!0)," ms (").concat(s,"dts) hole between fragments detected at ").concat(t.toFixed(3))):this.warn("".concat((e.segmentCodec||"").toUpperCase(),": ").concat(ku(-s,!0)," ms (").concat(s,"dts) overlapping between fragments detected at ").concat(t.toFixed(3))),!r||y>=i[0].pts||Cu)){d=y;const e=i[0].pts-s;if(n)i[0].dts=d,i[0].pts=e;else{let t=!0;for(let n=0;n<i.length&&!(i[n].dts>e&&t);n++){const e=i[n].pts;if(i[n].dts-=s,i[n].pts-=s,n<i.length-1){const s=i[n+1].pts;t=s<=i[n].pts==s<=e}}}this.log("Video: Initial PTS/DTS adjusted: ".concat(ku(e,!0),"/").concat(ku(d,!0),", delta: ").concat(ku(s,!0)," ms"))}}d=Math.max(0,d);let E=0,S=0,T=d;for(let D=0;D<o;D++){const e=i[D],t=e.units,s=t.length;let n=0;for(let r=0;r<s;r++)n+=t[r].data.length;S+=n,E+=s,e.length=n,e.dts<T?(e.dts=T,T+=x/4|0||1):T=e.dts,p=Math.min(e.pts,p),g=Math.max(e.pts,g)}u=i[o-1].dts;const k=S+4*E+8;let w;try{w=new Uint8Array(k)}catch(P){return void this.observer.emit(Hi.ERROR,Hi.ERROR,{type:Vi.MUX_ERROR,details:zi.REMUX_ALLOC_ERROR,fatal:!1,error:P,bytes:k,reason:"fail allocating video mdat ".concat(k)})}const L=new DataView(w.buffer);L.setUint32(0,k),w.set(Su.types.mdat,4);let C=!1,A=Number.POSITIVE_INFINITY,R=Number.POSITIVE_INFINITY,_=Number.NEGATIVE_INFINITY,N=Number.NEGATIVE_INFINITY;for(let D=0;D<o;D++){const e=i[D],t=e.units;let s,l=0;for(let n=0,r=t.length;n<r;n++){const e=t[n],s=e.data,r=e.data.byteLength;L.setUint32(f,r),f+=4,w.set(s,f),f+=r,l+=4+r}if(D<o-1)m=i[D+1].dts-e.dts,s=i[D+1].pts-e.pts;else{const t=this.config,a=D>0?e.dts-i[D-1].dts:x;if(s=D>0?e.pts-i[D-1].pts:x,t.stretchShortVideoTrack&&null!==this.nextAudioTs){const s=Math.floor(t.maxBufferHole*r),i=(n?p+n*r:this.nextAudioTs+c)-e.pts;i>s?(m=i-a,m<0?m=a:C=!0,this.log("It is approximately ".concat(i/90," ms to the next segment; using duration ").concat(m/90," ms for the last video frame."))):m=a}else m=a}const d=Math.round(e.pts-e.dts);A=Math.min(A,m),_=Math.max(_,m),R=Math.min(R,s),N=Math.max(N,s),a.push(Ru(e.key,m,l,d))}if(a.length)if(Cu){if(Cu<70){const e=a[0].flags;e.dependsOn=2,e.isNonSync=0}}else if(Au&&N-R<_-A&&x/_<.025&&0===a[0].cts){this.warn("Found irregular gaps in sample duration. Using PTS instead of DTS to determine MP4 sample duration.");let e=d;for(let t=0,s=a.length;t<s;t++){const n=e+a[t].duration,r=e+a[t].cts;if(t<s-1){const e=n+a[t+1].cts;a[t].duration=e-r}else a[t].duration=t?a[t-1].duration:x;a[t].cts=0,e=n}}m=C||!m?x:m;const I=u+m;this.nextVideoTs=h=I-c,this.videoSampleDuration=m,this.isVideoContiguous=!0;const j={data1:Su.moof(e.sequenceNumber++,d,ta(e,{samples:a})),data2:w,startPTS:(p-c)/r,endPTS:(g+m-c)/r,startDTS:(d-c)/r,endDTS:h/r,type:"video",hasAudio:!1,hasVideo:!0,nb:a.length,dropped:e.dropped};return e.samples=[],e.dropped=0,j}getSamplesPerFrame(e){switch(e.segmentCodec){case"mp3":return 1152;case"ac3":return 1536;default:return 1024}}remuxAudio(e,t,s,n,r){const i=e.inputTimeScale,a=i/(e.samplerate?e.samplerate:i),o=this.getSamplesPerFrame(e),l=o*a,c=this._initPTS,d="mp3"===e.segmentCodec&&this.typeSupported.mpeg,u=[],h=void 0!==r;let f=e.samples,m=d?0:8,p=this.nextAudioTs||-1;const g=c.baseTime*i/c.timescale,v=g+t*i;if(this.isAudioContiguous=s=s||f.length&&p>0&&(n&&Math.abs(v-(p+g))<9e3||Math.abs(Nu(f[0].pts,v)-(p+g))<20*l),f.forEach(function(e){e.pts=Nu(e.pts,v)}),!s||p<0){const e=f.length;if(f=f.filter(e=>e.pts>=0),e!==f.length&&this.warn("Removed ".concat(f.length-e," of ").concat(e," samples (initPTS ").concat(g," / ").concat(i,")")),!f.length)return;p=0===r?0:n&&!h?Math.max(0,v-g):f[0].pts-g}if("aac"===e.segmentCodec){const t=this.config.maxAudioFramesDrift;for(let s=0,n=p+g;s<f.length;s++){const r=f[s],a=r.pts,o=a-n,c=Math.abs(1e3*o/i);if(o<=-t*l&&h)0===s&&(this.warn("Audio frame @ ".concat((a/i).toFixed(3),"s overlaps marker by ").concat(Math.round(1e3*o/i)," ms.")),this.nextAudioTs=p=a-g,n=a);else if(o>=t*l&&c<1e4&&h){let t=Math.round(o/l);for(n=a-t*l;n<0&&t&&l;)t--,n+=l;0===s&&(this.nextAudioTs=p=n-g),this.warn("Injecting ".concat(t," audio frames @ ").concat(((n-g)/i).toFixed(3),"s due to ").concat(Math.round(1e3*o/i)," ms gap."));for(let i=0;i<t;i++){let t=xu.getSilentFrame(e.parsedCodec||e.manifestCodec||e.codec,e.channelCount);t||(this.log("Unable to get silent frame for given audio codec; duplicating last frame instead."),t=r.unit.subarray()),f.splice(s,0,{unit:t,pts:n}),n+=l,s++}}r.pts=n,n+=l}}let y,b=null,x=null,E=0,S=f.length;for(;S--;)E+=f[S].unit.byteLength;for(let _=0,N=f.length;_<N;_++){const t=f[_],n=t.unit;let r=t.pts;if(null!==x){u[_-1].duration=Math.round((r-x)/a)}else{if(s&&"aac"===e.segmentCodec&&(r=p+g),b=r,!(E>0))return;E+=m;try{y=new Uint8Array(E)}catch(R){return void this.observer.emit(Hi.ERROR,Hi.ERROR,{type:Vi.MUX_ERROR,details:zi.REMUX_ALLOC_ERROR,fatal:!1,error:R,bytes:E,reason:"fail allocating audio mdat ".concat(E)})}if(!d){new DataView(y.buffer).setUint32(0,E),y.set(Su.types.mdat,4)}}y.set(n,m);const i=n.byteLength;m+=i,u.push(Ru(!0,o,i,0)),x=r}const T=u.length;if(!T)return;const k=u[u.length-1];p=x-g,this.nextAudioTs=p+a*k.duration;const w=d?new Uint8Array(0):Su.moof(e.sequenceNumber++,b/a,ta({},e,{samples:u}));e.samples=[];const L=(b-g)/i,C=this.nextAudioTs/i,A={data1:w,data2:y,startPTS:L,endPTS:C,startDTS:L,endDTS:C,type:"audio",hasAudio:!0,hasVideo:!1,nb:T};return this.isAudioContiguous=!0,A}}function Nu(e,t){let s;if(null===t)return e;for(s=t<e?-8589934592:8589934592;Math.abs(e-t)>4294967296;)e+=s;return e}function Iu(e,t,s,n){const r=e.samples.length;if(!r)return;const i=e.inputTimeScale;for(let o=0;o<r;o++){const r=e.samples[o];r.pts=Nu(r.pts-s.baseTime*i/s.timescale,t*i)/i,r.dts=Nu(r.dts-n.baseTime*i/n.timescale,t*i)/i}const a=e.samples;return e.samples=[],{samples:a}}function ju(e,t,s){const n=e.samples.length;if(!n)return;const r=e.inputTimeScale;for(let a=0;a<n;a++){const n=e.samples[a];n.pts=Nu(n.pts-s.baseTime*r/s.timescale,t*r)/r}e.samples.sort((e,t)=>e.pts-t.pts);const i=e.samples;return e.samples=[],{samples:i}}function Pu(e,t){let s=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return void 0!==(null==e?void 0:e.start)?(e.start+(s?e.duration:0))/e.timescale:t}function Du(e,t,s){const n=e.codec;if(n&&n.length>4)return n;if(t===Ea){if("ec-3"===n||"ac-3"===n||"alac"===n)return n;if("fLaC"===n||"Opus"===n){return ho(n,!1)}return s.warn('Unhandled audio codec "'.concat(n,'" in mp4 MAP')),n||"mp4a"}return s.warn('Unhandled video codec "'.concat(n,'" in mp4 MAP')),n||"avc1"}try{Lu=self.performance.now.bind(self.performance)}catch(Ip){Lu=Date.now}const Mu=[{demux:class{constructor(e,t){this.remainderData=null,this.timeOffset=0,this.config=void 0,this.videoTrack=void 0,this.audioTrack=void 0,this.id3Track=void 0,this.txtTrack=void 0,this.config=t}resetTimeStamp(){}resetInitSegment(e,t,s,n){const r=this.videoTrack=zd("video",1),i=this.audioTrack=zd("audio",1),a=this.txtTrack=zd("text",1);if(this.id3Track=zd("id3",1),this.timeOffset=0,null==e||!e.byteLength)return;const o=Ua(e);if(o.video){const{id:e,timescale:t,codec:s,supplemental:n}=o.video;r.id=e,r.timescale=a.timescale=t,r.codec=s,r.supplemental=n}if(o.audio){const{id:e,timescale:t,codec:s}=o.audio;i.id=e,i.timescale=t,i.codec=s}a.id=Na.text,r.sampleDuration=0,r.duration=i.duration=n}resetContiguity(){this.remainderData=null}static probe(e){return function(e){const t=e.byteLength;for(let s=0;s<t;){const n=Pa(e,s);if(n>8&&109===e[s+4]&&111===e[s+5]&&111===e[s+6]&&102===e[s+7])return!0;s=n>1?s+n:t}return!1}(e)}demux(e,t){this.timeOffset=t;let s=e;const n=this.videoTrack,r=this.txtTrack;if(this.config.progressive){this.remainderData&&(s=qa(this.remainderData,e));const t=function(e){const t={valid:null,remainder:null},s=Oa(e,["moof"]);if(s.length<2)return t.remainder=e,t;const n=s[s.length-1];return t.valid=e.slice(0,n.byteOffset-8),t.remainder=e.slice(n.byteOffset-8),t}(s);this.remainderData=t.remainder,n.samples=t.valid||new Uint8Array}else n.samples=s;const i=this.extractID3Track(n,t);return r.samples=Ya(t,n),{videoTrack:n,audioTrack:this.audioTrack,id3Track:i,textTrack:this.txtTrack}}flush(){const e=this.timeOffset,t=this.videoTrack,s=this.txtTrack;t.samples=this.remainderData||new Uint8Array,this.remainderData=null;const n=this.extractID3Track(t,this.timeOffset);return s.samples=Ya(e,t),{videoTrack:t,audioTrack:zd(),id3Track:n,textTrack:zd()}}extractID3Track(e,t){const s=this.id3Track;if(e.samples.length){const n=Oa(e.samples,["emsg"]);n&&n.forEach(e=>{const n=function(e){const t=e[0];let s="",n="",r=0,i=0,a=0,o=0,l=0,c=0;if(0===t){for(;"\0"!==Ia(e.subarray(c,c+1));)s+=Ia(e.subarray(c,c+1)),c+=1;for(s+=Ia(e.subarray(c,c+1)),c+=1;"\0"!==Ia(e.subarray(c,c+1));)n+=Ia(e.subarray(c,c+1)),c+=1;n+=Ia(e.subarray(c,c+1)),c+=1,r=Pa(e,12),i=Pa(e,16),o=Pa(e,20),l=Pa(e,24),c=28}else if(1===t){c+=4,r=Pa(e,c),c+=4;const t=Pa(e,c);c+=4;const i=Pa(e,c);for(c+=4,a=2**32*t+i,Bi(a)||(a=Number.MAX_SAFE_INTEGER,da.warn("Presentation time exceeds safe integer limit and wrapped to max safe integer in parsing emsg box")),o=Pa(e,c),c+=4,l=Pa(e,c),c+=4;"\0"!==Ia(e.subarray(c,c+1));)s+=Ia(e.subarray(c,c+1)),c+=1;for(s+=Ia(e.subarray(c,c+1)),c+=1;"\0"!==Ia(e.subarray(c,c+1));)n+=Ia(e.subarray(c,c+1)),c+=1;n+=Ia(e.subarray(c,c+1)),c+=1}return{schemeIdUri:s,value:n,timeScale:r,presentationTime:a,presentationTimeDelta:i,eventDuration:o,id:l,payload:e.subarray(c,e.byteLength)}}(e);if(iu.test(n.schemeIdUri)){const e=au(n,t);let r=4294967295===n.eventDuration?Number.POSITIVE_INFINITY:n.eventDuration/n.timeScale;r<=.001&&(r=Number.POSITIVE_INFINITY);const i=n.payload;s.samples.push({data:i,len:i.byteLength,dts:e,pts:e,type:Vd.emsg,duration:r})}else if(this.config.enableEmsgKLVMetadata&&n.schemeIdUri.startsWith("urn:misb:KLV:bin:1910.1")){const e=au(n,t);s.samples.push({data:n.payload,len:n.payload.byteLength,dts:e,pts:e,type:Vd.misbklv,duration:Number.POSITIVE_INFINITY})}})}return s}demuxSampleAes(e,t,s){return Promise.reject(new Error("The MP4 demuxer does not support SAMPLE-AES decryption"))}destroy(){this.config=null,this.remainderData=null,this.videoTrack=this.audioTrack=this.id3Track=this.txtTrack=void 0}},remux:class extends ra{constructor(e,t,s,n){super("passthrough-remuxer",n),this.emitInitSegment=!1,this.audioCodec=void 0,this.videoCodec=void 0,this.initData=void 0,this.initPTS=null,this.initTracks=void 0,this.lastEndTime=null,this.isVideoContiguous=!1}destroy(){}resetTimeStamp(e){this.lastEndTime=null;const t=this.initPTS;t&&e&&t.baseTime===e.baseTime&&t.timescale===e.timescale||(this.initPTS=e)}resetNextTimestamp(){this.isVideoContiguous=!1,this.lastEndTime=null}resetInitSegment(e,t,s,n){this.audioCodec=t,this.videoCodec=s,this.generateInitSegment(e,n),this.emitInitSegment=!0}generateInitSegment(e,t){let{audioCodec:s,videoCodec:n}=this;if(null==e||!e.byteLength)return this.initTracks=void 0,void(this.initData=void 0);const{audio:r,video:i}=this.initData=Ua(e);if(t)!function(e,t){if(!e||!t)return;const s=t.keyId;s&&t.isCommonEncryption&&Ka(e,(e,t)=>{const n=e.subarray(8,24);n.some(e=>0!==e)||(da.log("[eme] Patching keyId in 'enc".concat(t?"a":"v",">sinf>>tenc' box: ").concat(ma(n)," -> ").concat(ma(s))),e.set(s,8))})}(e,t);else{const e=r||i;null!=e&&e.encrypted&&this.warn('Init segment with encrypted track with has no key ("'.concat(e.codec,'")!'))}r&&(s=Du(r,Ea,this)),i&&(n=Du(i,Sa,this));const a={};r&&i?a.audiovideo={container:"video/mp4",codec:s+","+n,supplemental:i.supplemental,encrypted:i.encrypted,initSegment:e,id:"main"}:r?a.audio={container:"audio/mp4",codec:s,encrypted:r.encrypted,initSegment:e,id:"audio"}:i?a.video={container:"video/mp4",codec:n,supplemental:i.supplemental,encrypted:i.encrypted,initSegment:e,id:"main"}:this.warn("initSegment does not contain moov or trak boxes."),this.initTracks=a}remux(e,t,s,n,r,i){var a,o;let{initPTS:l,lastEndTime:c}=this;const d={audio:void 0,video:void 0,text:n,id3:s,initSegment:void 0};Ui(c)||(c=this.lastEndTime=r||0);const u=t.samples;if(!u.length)return d;const h={initPTS:void 0,timescale:void 0,trackId:void 0};let f=this.initData;if(null!=(a=f)&&a.length||(this.generateInitSegment(u),f=this.initData),null==(o=f)||!o.length)return this.warn("Failed to generate initSegment."),d;this.emitInitSegment&&(h.tracks=this.initTracks,this.emitInitSegment=!1);const m=function(e,t,s){const n={},r=Oa(e,["moof","traf"]);for(let i=0;i<r.length;i++){const e=r[i],a=Oa(e,["tfhd"])[0],o=Pa(a,4),l=t[o];if(!l)continue;n[o]||(n[o]={start:NaN,duration:0,sampleCount:0,timescale:l.timescale,type:l.type});const c=n[o],d=Oa(e,["tfdt"])[0];if(d){const e=d[0];let t=Pa(d,4);1===e&&(t===Ra?s.warn("[mp4-demuxer]: Ignoring assumed invalid signed 64-bit track fragment decode time"):(t*=Ra+1,t+=Pa(d,8))),Ui(t)&&(!Ui(c.start)||t<c.start)&&(c.start=t)}const u=l.default,h=Pa(a,0)|(null==u?void 0:u.flags);let f=(null==u?void 0:u.duration)||0;8&h&&(f=Pa(a,2&h?12:8));const m=Oa(e,["trun"]);let p=c.start||0,g=0,v=f;for(let t=0;t<m.length;t++){const e=m[t],s=Pa(e,4),n=c.sampleCount;c.sampleCount+=s;const r=1&e[3],i=4&e[3],a=1&e[2],o=2&e[2],l=4&e[2],d=8&e[2];let u=8,h=s;for(r&&(u+=4),i&&s&&(1&e[u+1]||void 0!==c.keyFrameIndex||(c.keyFrameIndex=n),u+=4,a?(v=Pa(e,u),u+=4):v=f,o&&(u+=4),d&&(u+=4),p+=v,g+=v,h--);h--;)a?(v=Pa(e,u),u+=4):v=f,o&&(u+=4),l&&(1&e[u+1]||void 0===c.keyFrameIndex&&(c.keyFrameIndex=c.sampleCount-(h+1),c.keyFrameStart=p),u+=4),d&&(u+=4),p+=v,g+=v;!g&&f&&(g+=f*s)}c.duration+=g}if(!Object.keys(n).some(e=>n[e].duration)){let t=1/0,s=0;const r=Oa(e,["sidx"]);for(let e=0;e<r.length;e++){const n=Fa(r[e]);if(null!=n&&n.references){t=Math.min(t,n.earliestPresentationTime/n.timescale);const e=n.references.reduce((e,t)=>e+t.info.duration||0,0);s=Math.max(s,e+n.earliestPresentationTime/n.timescale)}}s&&Ui(s)&&Object.keys(n).forEach(e=>{n[e].duration||(n[e].duration=s*n[e].timescale-n[e].start)})}return n}(u,f,this),p=f.audio?m[f.audio.id]:null,g=f.video?m[f.video.id]:null,v=Pu(g,1/0),y=Pu(p,1/0),b=Pu(g,0,!0),x=Pu(p,0,!0);let E=r,S=0;const T=p&&(!g||!l&&y<v||l&&l.trackId===f.audio.id),k=T?p:g;if(k){const e=k.timescale,t=k.start-r*e,s=T?f.audio.id:f.video.id;E=k.start/e,S=T?x-y:b-v,!i&&l||!function(e,t,s,n){if(null===e)return!0;const r=Math.max(n,1),i=t-e.baseTime/e.timescale;return Math.abs(i-s)>r}(l,E,r,S)&&e===l.timescale||(l&&this.warn("Timestamps at playlist time: ".concat(i?"":"~").concat(r," ").concat(t/e," != initPTS: ").concat(l.baseTime/l.timescale," (").concat(l.baseTime,"/").concat(l.timescale,") trackId: ").concat(l.trackId)),this.log("Found initPTS at playlist time: ".concat(r," offset: ").concat(E-r," (").concat(t,"/").concat(e,") trackId: ").concat(s)),l=null,h.initPTS=t,h.timescale=e,h.trackId=s)}else this.warn("No audio or video samples found for initPTS at playlist time: ".concat(r));l?(h.initPTS=l.baseTime,h.timescale=l.timescale,h.trackId=l.trackId):(h.timescale&&void 0!==h.trackId&&void 0!==h.initPTS||(this.warn("Could not set initPTS"),h.initPTS=E,h.timescale=1,h.trackId=-1),this.initPTS=l={baseTime:h.initPTS,timescale:h.timescale,trackId:h.trackId});const w=E-l.baseTime/l.timescale,L=w+S;S>0?this.lastEndTime=L:(this.warn("Duration parsed from mp4 should be greater than zero"),this.resetNextTimestamp());const C=!!f.audio,A=!!f.video;let R="";C&&(R+="audio"),A&&(R+="video");const _={data1:u,startPTS:w,startDTS:w,endPTS:L,endDTS:L,type:R,hasAudio:C,hasVideo:A,nb:1,dropped:0,encrypted:!!f.audio&&f.audio.encrypted||!!f.video&&f.video.encrypted};d.audio=C&&!A?_:void 0,d.video=A?_:void 0;const N=null==g?void 0:g.sampleCount;if(N){const e=g.keyFrameIndex,t=-1!==e;_.nb=N,_.dropped=0===e||this.isVideoContiguous?0:t?e:N,_.independent=t,_.firstKeyFrame=e,t&&g.keyFrameStart&&(_.firstKeyFramePTS=(g.keyFrameStart-l.baseTime)/l.timescale),this.isVideoContiguous||(d.independent=t),this.isVideoContiguous||(this.isVideoContiguous=t),_.dropped&&this.warn("fmp4 does not start with IDR: firstIDR ".concat(e,"/").concat(N," dropped: ").concat(_.dropped," start: ").concat(_.firstKeyFramePTS||"NA"))}return d.initSegment=h,d.id3=Iu(s,r,l,l),n.samples.length&&(d.text=ju(n,r,l)),d}}},{demux:fu,remux:_u},{demux:class extends Hd{constructor(e,t){super(),this.observer=void 0,this.config=void 0,this.observer=e,this.config=t}resetInitSegment(e,t,s,n){super.resetInitSegment(e,t,s,n),this._audioTrack={container:"audio/adts",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"aac",samples:[],manifestCodec:t,duration:n,inputTimeScale:9e4,dropped:0}}static probe(e,t){if(!e)return!1;const s=kd(e,0);let n=(null==s?void 0:s.length)||0;if(tu(e,n))return!1;for(let r=e.length;n<r;n++)if(Rd(e,n))return t.log("ADTS sync word found !"),!0;return!1}canParse(e,t){return function(e,t){return function(e,t){return t+5<e.length}(e,t)&&wd(e,t)&&Cd(e,t)<=e.length-t}(e,t)}appendFrame(e,t,s){_d(e,this.observer,t,s,e.manifestCodec);const n=Id(e,t,s,this.basePTS,this.frameIndex);if(n&&0===n.missing)return n}},remux:_u},{demux:class extends Hd{resetInitSegment(e,t,s,n){super.resetInitSegment(e,t,s,n),this._audioTrack={container:"audio/mpeg",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"mp3",samples:[],manifestCodec:t,duration:n,inputTimeScale:9e4,dropped:0}}static probe(e){if(!e)return!1;const t=kd(e,0);let s=(null==t?void 0:t.length)||0;if(t&&11===e[s]&&119===e[s+1]&&void 0!==Gd(t)&&su(e,s)<=16)return!1;for(let n=e.length;s<n;s++)if(tu(e,s))return da.log("MPEG Audio sync word found !"),!0;return!1}canParse(e,t){return function(e,t){return Zd(e,t)&&4<=e.length-t}(e,t)}appendFrame(e,t,s){if(null!==this.basePTS)return $d(e,t,s,this.basePTS,this.frameIndex)}},remux:_u}];Mu.splice(2,0,{demux:nu,remux:_u});class Ou{constructor(e,t,s,n,r,i){this.asyncResult=!1,this.logger=void 0,this.observer=void 0,this.typeSupported=void 0,this.config=void 0,this.id=void 0,this.demuxer=void 0,this.remuxer=void 0,this.decrypter=void 0,this.probe=void 0,this.decryptionPromise=null,this.transmuxConfig=void 0,this.currentTransmuxState=void 0,this.observer=e,this.typeSupported=t,this.config=s,this.id=r,this.logger=i}configure(e){this.transmuxConfig=e,this.decrypter&&this.decrypter.reset()}push(e,t,s,n){const r=s.transmuxing;r.executeStart=Lu();let i=new Uint8Array(e);const{currentTransmuxState:a,transmuxConfig:o}=this;n&&(this.currentTransmuxState=n);const{contiguous:l,discontinuity:c,trackSwitch:d,accurateTimeOffset:u,timeOffset:h,initSegmentChange:f}=n||a,{audioCodec:m,videoCodec:p,defaultInitPts:g,duration:v,initSegmentData:y}=o,b=function(e,t){let s=null;e.byteLength>0&&null!=(null==t?void 0:t.key)&&null!==t.iv&&null!=t.method&&(s=t);return s}(i,t);if(b&&Xl(b.method)){const e=this.getDecrypter(),t=Ql(b.method);if(!e.isSync())return this.asyncResult=!0,this.decryptionPromise=e.webCryptoDecrypt(i,b.key.buffer,b.iv.buffer,t).then(e=>{const t=this.push(e,null,s);return this.decryptionPromise=null,t}),this.decryptionPromise;{let n=e.softwareDecrypt(i,b.key.buffer,b.iv.buffer,t);if(s.part>-1){const t=e.flush();n=t?t.buffer:t}if(!n)return r.executeEnd=Lu(),Fu(s);i=new Uint8Array(n)}}const x=this.needsProbing(c,d);if(x){const e=this.configureTransmuxer(i);if(e)return this.logger.warn("[transmuxer] ".concat(e.message)),this.observer.emit(Hi.ERROR,Hi.ERROR,{type:Vi.MEDIA_ERROR,details:zi.FRAG_PARSING_ERROR,fatal:!1,error:e,reason:e.message}),r.executeEnd=Lu(),Fu(s)}(c||d||f||x)&&this.resetInitSegment(y,m,p,v,t),(c||f||x)&&this.resetInitialTimestamp(g),l||this.resetContiguity();const E=this.transmux(i,b,h,u,s);this.asyncResult=Uu(E);const S=this.currentTransmuxState;return S.contiguous=!0,S.discontinuity=!1,S.trackSwitch=!1,r.executeEnd=Lu(),E}flush(e){const t=e.transmuxing;t.executeStart=Lu();const{decrypter:s,currentTransmuxState:n,decryptionPromise:r}=this;if(r)return this.asyncResult=!0,r.then(()=>this.flush(e));const i=[],{timeOffset:a}=n;if(s){const t=s.flush();t&&i.push(this.push(t.buffer,null,e))}const{demuxer:o,remuxer:l}=this;if(!o||!l){t.executeEnd=Lu();const s=[Fu(e)];return this.asyncResult?Promise.resolve(s):s}const c=o.flush(a);return Uu(c)?(this.asyncResult=!0,c.then(t=>(this.flushRemux(i,t,e),i))):(this.flushRemux(i,c,e),this.asyncResult?Promise.resolve(i):i)}flushRemux(e,t,s){const{audioTrack:n,videoTrack:r,id3Track:i,textTrack:a}=t,{accurateTimeOffset:o,timeOffset:l}=this.currentTransmuxState;this.logger.log("[transmuxer.ts]: Flushed ".concat(this.id," sn: ").concat(s.sn).concat(s.part>-1?" part: "+s.part:""," of ").concat(this.id===Xi?"level":"track"," ").concat(s.level));const c=this.remuxer.remux(n,r,i,a,l,o,!0,this.id);e.push({remuxResult:c,chunkMeta:s}),s.transmuxing.executeEnd=Lu()}resetInitialTimestamp(e){const{demuxer:t,remuxer:s}=this;t&&s&&(t.resetTimeStamp(e),s.resetTimeStamp(e))}resetContiguity(){const{demuxer:e,remuxer:t}=this;e&&t&&(e.resetContiguity(),t.resetNextTimestamp())}resetInitSegment(e,t,s,n,r){const{demuxer:i,remuxer:a}=this;i&&a&&(i.resetInitSegment(e,t,s,n),a.resetInitSegment(e,t,s,r))}destroy(){this.demuxer&&(this.demuxer.destroy(),this.demuxer=void 0),this.remuxer&&(this.remuxer.destroy(),this.remuxer=void 0)}transmux(e,t,s,n,r){let i;return i=t&&"SAMPLE-AES"===t.method?this.transmuxSampleAes(e,t,s,n,r):this.transmuxUnencrypted(e,s,n,r),i}transmuxUnencrypted(e,t,s,n){const{audioTrack:r,videoTrack:i,id3Track:a,textTrack:o}=this.demuxer.demux(e,t,!1,!this.config.progressive);return{remuxResult:this.remuxer.remux(r,i,a,o,t,s,!1,this.id),chunkMeta:n}}transmuxSampleAes(e,t,s,n,r){return this.demuxer.demuxSampleAes(e,t,s).then(e=>({remuxResult:this.remuxer.remux(e.audioTrack,e.videoTrack,e.id3Track,e.textTrack,s,n,!1,this.id),chunkMeta:r}))}configureTransmuxer(e){const{config:t,observer:s,typeSupported:n}=this;let r;for(let d=0,u=Mu.length;d<u;d++){var i;if(null!=(i=Mu[d].demux)&&i.probe(e,this.logger)){r=Mu[d];break}}if(!r)return new Error("Failed to find demuxer by probing fragment data");const a=this.demuxer,o=this.remuxer,l=r.remux,c=r.demux;o&&o instanceof l||(this.remuxer=new l(s,t,n,this.logger)),a&&a instanceof c||(this.demuxer=new c(s,t,n,this.logger),this.probe=c.probe)}needsProbing(e,t){return!this.demuxer||!this.remuxer||e||t}getDecrypter(){let e=this.decrypter;return e||(e=this.decrypter=new wl(this.config)),e}}const Fu=e=>({remuxResult:{},chunkMeta:e});function Uu(e){return"then"in e&&e.then instanceof Function}class Bu{constructor(e,t,s,n,r){this.audioCodec=void 0,this.videoCodec=void 0,this.initSegmentData=void 0,this.duration=void 0,this.defaultInitPts=void 0,this.audioCodec=e,this.videoCodec=t,this.initSegmentData=s,this.duration=n,this.defaultInitPts=r||null}}class Gu{constructor(e,t,s,n,r,i){this.discontinuity=void 0,this.contiguous=void 0,this.accurateTimeOffset=void 0,this.trackSwitch=void 0,this.timeOffset=void 0,this.initSegmentChange=void 0,this.discontinuity=e,this.contiguous=t,this.accurateTimeOffset=s,this.trackSwitch=n,this.timeOffset=r,this.initSegmentChange=i}}let Vu=0;class zu{constructor(e,t,s,n){this.error=null,this.hls=void 0,this.id=void 0,this.instanceNo=Vu++,this.observer=void 0,this.frag=null,this.part=null,this.useWorker=void 0,this.workerContext=null,this.transmuxer=null,this.onTransmuxComplete=void 0,this.onFlush=void 0,this.onWorkerMessage=e=>{const t=e.data,s=this.hls;if(s&&null!=t&&t.event&&t.instanceNo===this.instanceNo)switch(t.event){case"init":{var n;const e=null==(n=this.workerContext)?void 0:n.objectURL;e&&self.URL.revokeObjectURL(e);break}case"transmuxComplete":this.handleTransmuxComplete(t.data);break;case"flush":this.onFlush(t.data);break;case"workerLog":s.logger[t.data.logType]&&s.logger[t.data.logType](t.data.message);break;default:t.data=t.data||{},t.data.frag=this.frag,t.data.part=this.part,t.data.id=this.id,s.trigger(t.event,t.data)}},this.onWorkerError=e=>{if(!this.hls)return;const t=new Error("".concat(e.message,"  (").concat(e.filename,":").concat(e.lineno,")"));this.hls.config.enableWorker=!1,this.hls.logger.warn('Error in "'.concat(this.id,'" Web Worker, fallback to inline')),this.hls.trigger(Hi.ERROR,{type:Vi.OTHER_ERROR,details:zi.INTERNAL_EXCEPTION,fatal:!1,event:"demuxerWorker",error:t})};const r=e.config;this.hls=e,this.id=t,this.useWorker=!!r.enableWorker,this.onTransmuxComplete=s,this.onFlush=n;const i=(e,t)=>{(t=t||{}).frag=this.frag||void 0,e===Hi.ERROR&&(t.parent=this.id,t.part=this.part,this.error=t.error),this.hls.trigger(e,t)};this.observer=new yd,this.observer.on(Hi.FRAG_DECRYPTED,i),this.observer.on(Hi.ERROR,i);const a=go(r.preferManagedMediaSource);if(this.useWorker&&"undefined"!==typeof Worker){const s=this.hls.logger;if(r.workerPath||"function"===typeof __HLS_WORKER_BUNDLE__){try{r.workerPath?(s.log("loading Web Worker ".concat(r.workerPath,' for "').concat(t,'"')),this.workerContext=function(e){const t=xd[e];if(t)return t.clientCount++,t;const s=new self.URL(e,self.location.href).href,n={worker:new self.Worker(s),scriptURL:s,clientCount:1};return xd[e]=n,n}(r.workerPath)):(s.log('injecting Web Worker for "'.concat(t,'"')),this.workerContext=function(){const e=xd[bd];if(e)return e.clientCount++,e;const t=new self.Blob(["var exports={};var module={exports:exports};function define(f){f()};define.amd=true;(".concat(__HLS_WORKER_BUNDLE__.toString(),")(true);")],{type:"text/javascript"}),s=self.URL.createObjectURL(t),n={worker:new self.Worker(s),objectURL:s,clientCount:1};return xd[bd]=n,n}());const{worker:e}=this.workerContext;e.addEventListener("message",this.onWorkerMessage),e.addEventListener("error",this.onWorkerError),e.postMessage({instanceNo:this.instanceNo,cmd:"init",typeSupported:a,id:t,config:Do(r)})}catch(Ip){s.warn('Error setting up "'.concat(t,'" Web Worker, fallback to inline'),Ip),this.terminateWorker(),this.error=null,this.transmuxer=new Ou(this.observer,a,r,"",t,e.logger)}return}}this.transmuxer=new Ou(this.observer,a,r,"",t,e.logger)}reset(){if(this.frag=null,this.part=null,this.workerContext){const e=this.instanceNo;this.instanceNo=Vu++;const t=this.hls.config,s=go(t.preferManagedMediaSource);this.workerContext.worker.postMessage({instanceNo:this.instanceNo,cmd:"reset",resetNo:e,typeSupported:s,id:this.id,config:Do(t)})}}terminateWorker(){if(this.workerContext){const{worker:e}=this.workerContext;this.workerContext=null,e.removeEventListener("message",this.onWorkerMessage),e.removeEventListener("error",this.onWorkerError),function(e){const t=xd[e||bd];if(t&&1===t.clientCount--){const{worker:s,objectURL:n}=t;delete xd[e||bd],n&&self.URL.revokeObjectURL(n),s.terminate()}}(this.hls.config.workerPath)}}destroy(){if(this.workerContext)this.terminateWorker(),this.onWorkerMessage=this.onWorkerError=null;else{const e=this.transmuxer;e&&(e.destroy(),this.transmuxer=null)}const e=this.observer;e&&e.removeAllListeners(),this.frag=null,this.part=null,this.observer=null,this.hls=null}push(e,t,s,n,r,i,a,o,l,c){var d,u;l.transmuxing.start=self.performance.now();const{instanceNo:h,transmuxer:f}=this,m=i?i.start:r.start,p=r.decryptdata,g=this.frag,v=!(g&&r.cc===g.cc),y=!(g&&l.level===g.level),b=g?l.sn-g.sn:-1,x=this.part?l.part-this.part.index:-1,E=0===b&&l.id>1&&l.id===(null==g?void 0:g.stats.chunkCount),S=!y&&(1===b||0===b&&(1===x||E&&x<=0)),T=self.performance.now();(y||b||0===r.stats.parsing.start)&&(r.stats.parsing.start=T),!i||!x&&S||(i.stats.parsing.start=T);const k=!(g&&(null==(d=r.initSegment)?void 0:d.url)===(null==(u=g.initSegment)?void 0:u.url)),w=new Gu(v,S,o,y,m,k);if(!S||v||k){this.hls.logger.log("[transmuxer-interface]: Starting new transmux session for ".concat(r.type," sn: ").concat(l.sn).concat(l.part>-1?" part: "+l.part:""," ").concat(this.id===Xi?"level":"track",": ").concat(l.level," id: ").concat(l.id,"\n        discontinuity: ").concat(v,"\n        trackSwitch: ").concat(y,"\n        contiguous: ").concat(S,"\n        accurateTimeOffset: ").concat(o,"\n        timeOffset: ").concat(m,"\n        initSegmentChange: ").concat(k));const e=new Bu(s,n,t,a,c);this.configureTransmuxer(e)}if(this.frag=r,this.part=i,this.workerContext)this.workerContext.worker.postMessage({instanceNo:h,cmd:"demux",data:e,decryptdata:p,chunkMeta:l,state:w},e instanceof ArrayBuffer?[e]:[]);else if(f){const t=f.push(e,p,l,w);Uu(t)?t.then(e=>{this.handleTransmuxComplete(e)}).catch(e=>{this.transmuxerError(e,l,"transmuxer-interface push error")}):this.handleTransmuxComplete(t)}}flush(e){e.transmuxing.start=self.performance.now();const{instanceNo:t,transmuxer:s}=this;if(this.workerContext)this.workerContext.worker.postMessage({instanceNo:t,cmd:"flush",chunkMeta:e});else if(s){const t=s.flush(e);Uu(t)?t.then(t=>{this.handleFlushResult(t,e)}).catch(t=>{this.transmuxerError(t,e,"transmuxer-interface flush error")}):this.handleFlushResult(t,e)}}transmuxerError(e,t,s){this.hls&&(this.error=e,this.hls.trigger(Hi.ERROR,{type:Vi.MEDIA_ERROR,details:zi.FRAG_PARSING_ERROR,chunkMeta:t,frag:this.frag||void 0,part:this.part||void 0,fatal:!1,error:e,err:e,reason:s}))}handleFlushResult(e,t){e.forEach(e=>{this.handleTransmuxComplete(e)}),this.onFlush(t)}configureTransmuxer(e){const{instanceNo:t,transmuxer:s}=this;this.workerContext?this.workerContext.worker.postMessage({instanceNo:t,cmd:"configure",config:e}):s&&s.configure(e)}handleTransmuxComplete(e){e.chunkMeta.transmuxing.end=self.performance.now(),this.onTransmuxComplete(e)}}class Hu extends ra{constructor(e,t){super(t,e.logger),this.hls=void 0,this.canLoad=!1,this.timer=-1,this.hls=e}destroy(){this.clearTimer(),this.hls=this.log=this.warn=null}clearTimer(){-1!==this.timer&&(self.clearTimeout(this.timer),this.timer=-1)}startLoad(){this.canLoad=!0,this.loadPlaylist()}stopLoad(){this.canLoad=!1,this.clearTimer()}switchParams(e,t,s){const n=null==t?void 0:t.renditionReports;if(n){let i=-1;for(let s=0;s<n.length;s++){const a=n[s];let o;try{o=new self.URL(a.URI,t.url).href}catch(r){this.warn("Could not construct new URL for Rendition Report: ".concat(r)),o=a.URI||""}if(o===e){i=s;break}o===e.substring(0,o.length)&&(i=s)}if(-1!==i){const e=n[i],r=parseInt(e["LAST-MSN"])||t.lastPartSn;let a=parseInt(e["LAST-PART"])||t.lastPartIndex;if(this.hls.config.lowLatencyMode){const e=Math.min(t.age-t.partTarget,t.targetduration);a>=0&&e>t.partTarget&&(a+=1)}const o=s&&_o(s);return new No(r,a>=0?a:void 0,o)}}}loadPlaylist(e){this.clearTimer()}loadingPlaylist(e,t){this.clearTimer()}shouldLoadPlaylist(e){return this.canLoad&&!!e&&!!e.url&&(!e.details||e.details.live)}getUrlWithDirectives(e,t){if(t)try{return t.addDirectives(e)}catch(s){this.warn("Could not construct new URL with HLS Delivery Directives: ".concat(s))}return e}playlistLoaded(e,t,s){const{details:n,stats:r}=t,i=self.performance.now(),a=r.loading.first?Math.max(0,i-r.loading.first):0;n.advancedDateTime=Date.now()-a;const o=this.hls.config.timelineOffset;if(o!==n.appliedTimelineOffset){const e=Math.max(o||0,0);n.appliedTimelineOffset=e,n.fragments.forEach(t=>{t.setStart(t.playlistOffset+e)})}if(n.live||null!=s&&s.live){const o="levelInfo"in t?t.levelInfo:t.track;if(n.reloaded(s),s&&n.fragments.length>0){Dc(s,n,this);const e=n.playlistParsingError;if(e){this.warn(e);const s=this.hls;if(!s.config.ignorePlaylistParsingErrors){var l;const{networkDetails:i}=t;return void s.trigger(Hi.ERROR,{type:Vi.NETWORK_ERROR,details:zi.LEVEL_PARSING_ERROR,fatal:!1,url:n.url,error:e,reason:e.message,level:t.level||void 0,parent:null==(l=n.fragments[0])?void 0:l.type,networkDetails:i,stats:r})}n.playlistParsingError=null}}-1===n.requestScheduled&&(n.requestScheduled=r.loading.start);const c=this.hls.mainForwardBufferInfo,d=c?c.end-c.len:0,u=Uc(n,1e3*(n.edge-d));if(n.requestScheduled+u<i?n.requestScheduled=i:n.requestScheduled+=u,this.log("live playlist ".concat(e," ").concat(n.advanced?"REFRESHED "+n.lastPartSn+"-"+n.lastPartIndex:n.updated?"UPDATED":"MISSED")),!this.canLoad||!n.live)return;let h,f,m;if(n.canBlockReload&&n.endSN&&n.advanced){const e=this.hls.config.lowLatencyMode,r=n.lastPartSn,a=n.endSN,l=n.lastPartIndex,c=r===a;-1!==l?c?(f=a+1,m=e?0:l):(f=r,m=e?l+1:n.maxPartIndex):f=a+1;const d=n.age,u=d+n.ageHeader;let p=Math.min(u-n.partTarget,1.5*n.targetduration);if(p>0){if(u>3*n.targetduration)this.log("Playlist last advanced ".concat(d.toFixed(2),"s ago. Omitting segment and part directives.")),f=void 0,m=void 0;else if(null!=s&&s.tuneInGoal&&u-n.partTarget>s.tuneInGoal)this.warn("CDN Tune-in goal increased from: ".concat(s.tuneInGoal," to: ").concat(p," with playlist age: ").concat(n.age)),p=0;else{const e=Math.floor(p/n.targetduration);if(f+=e,void 0!==m){m+=Math.round(p%n.targetduration/n.partTarget)}this.log("CDN Tune-in age: ".concat(n.ageHeader,"s last advanced ").concat(d.toFixed(2),"s goal: ").concat(p," skip sn ").concat(e," to part ").concat(m))}n.tuneInGoal=p}if(h=this.getDeliveryDirectives(n,t.deliveryDirectives,f,m),e||!c)return n.requestScheduled=i,void this.loadingPlaylist(o,h)}else(n.canBlockReload||n.canSkipUntil)&&(h=this.getDeliveryDirectives(n,t.deliveryDirectives,f,m));h&&void 0!==f&&n.canBlockReload&&(n.requestScheduled=r.loading.first+Math.max(u-2*a,u/2)),this.scheduleLoading(o,h,n)}else this.clearTimer()}scheduleLoading(e,t,s){const n=s||e.details;if(!n)return void this.loadingPlaylist(e,t);const r=self.performance.now(),i=n.requestScheduled;if(r>=i)return void this.loadingPlaylist(e,t);const a=i-r;this.log("reload live playlist ".concat(e.name||e.bitrate+"bps"," in ").concat(Math.round(a)," ms")),this.clearTimer(),this.timer=self.setTimeout(()=>this.loadingPlaylist(e,t),a)}getDeliveryDirectives(e,t,s,n){let r=_o(e);return null!=t&&t.skip&&e.deltaUpdateFailed&&(s=t.msn,n=t.part,r=Co),new No(s,n,r)}checkRetry(e){const t=e.details,s=Xo(e),n=e.errorAction,{action:r,retryCount:i=0,retryConfig:a}=n||{},o=!!n&&!!a&&(r===al||!n.resolved&&r===rl);if(o){var l;if(i>=a.maxNumRetry)return!1;if(s&&null!=(l=e.context)&&l.deliveryDirectives)this.warn("Retrying playlist loading ".concat(i+1,"/").concat(a.maxNumRetry,' after "').concat(t,'" without delivery-directives')),this.loadPlaylist();else{const e=Zo(a,i);this.clearTimer(),this.timer=self.setTimeout(()=>this.loadPlaylist(),e),this.warn("Retrying playlist loading ".concat(i+1,"/").concat(a.maxNumRetry,' after "').concat(t,'" in ').concat(e,"ms"))}e.levelRetry=!0,n.resolved=!0}return o}}function Ku(e,t){if(e.length!==t.length)return!1;for(let s=0;s<e.length;s++)if(!Wu(e[s].attrs,t[s].attrs))return!1;return!0}function Wu(e,t,s){const n=e["STABLE-RENDITION-ID"];return n&&!s?n===t["STABLE-RENDITION-ID"]:!(s||["LANGUAGE","NAME","CHARACTERISTICS","AUTOSELECT","DEFAULT","FORCED","ASSOC-LANGUAGE"]).some(s=>e[s]!==t[s])}function qu(e,t){return t.label.toLowerCase()===e.name.toLowerCase()&&(!t.language||t.language.toLowerCase()===(e.lang||"").toLowerCase())}class Yu{constructor(e){this.tracks=void 0,this.queues={video:[],audio:[],audiovideo:[]},this.tracks=e}destroy(){this.tracks=this.queues=null}append(e,t,s){if(null===this.queues||null===this.tracks)return;const n=this.queues[t];n.push(e),1!==n.length||s||this.executeNext(t)}appendBlocker(e){return new Promise(t=>{const s={label:"async-blocker",execute:t,onStart:()=>{},onComplete:()=>{},onError:()=>{}};this.append(s,e)})}prependBlocker(e){return new Promise(t=>{if(this.queues){const s={label:"async-blocker-prepend",execute:t,onStart:()=>{},onComplete:()=>{},onError:()=>{}};this.queues[e].unshift(s)}})}removeBlockers(){null!==this.queues&&[this.queues.video,this.queues.audio,this.queues.audiovideo].forEach(e=>{var t;const s=null==(t=e[0])?void 0:t.label;"async-blocker"!==s&&"async-blocker-prepend"!==s||(e[0].execute(),e.splice(0,1))})}unblockAudio(e){if(null===this.queues)return;this.queues.audio[0]===e&&this.shiftAndExecuteNext("audio")}executeNext(e){if(null===this.queues||null===this.tracks)return;const t=this.queues[e];if(t.length){const r=t[0];try{r.execute()}catch(n){var s;if(r.onError(n),null===this.queues||null===this.tracks)return;const t=null==(s=this.tracks[e])?void 0:s.buffer;null!=t&&t.updating||this.shiftAndExecuteNext(e)}}}shiftAndExecuteNext(e){null!==this.queues&&(this.queues[e].shift(),this.executeNext(e))}current(e){var t;return(null==(t=this.queues)?void 0:t[e][0])||null}toString(){const{queues:e,tracks:t}=this;return null===e||null===t?"<destroyed>":"\n".concat(this.list("video"),"\n").concat(this.list("audio"),"\n").concat(this.list("audiovideo"),"}")}list(e){var t,s;return null!=(t=this.queues)&&t[e]||null!=(s=this.tracks)&&s[e]?"".concat(e,": (").concat(this.listSbInfo(e),") ").concat(this.listOps(e)):""}listSbInfo(e){var t;const s=null==(t=this.tracks)?void 0:t[e],n=null==s?void 0:s.buffer;return n?"SourceBuffer".concat(n.updating?" updating":"").concat(s.ended?" ended":"").concat(s.ending?" ending":""):"none"}listOps(e){var t;return(null==(t=this.queues)?void 0:t[e].map(e=>e.label).join(", "))||""}}const Xu=/(avc[1234]|hvc1|hev1|dvh[1e]|vp09|av01)(?:\.[^.,]+)+/,Qu="HlsJsTrackRemovedError";class $u extends Error{constructor(e){super(e),this.name=Qu}}function Ju(e){const t=e.querySelectorAll("source");[].slice.call(t).forEach(t=>{e.removeChild(t)})}function Zu(e){return"audio"===e?1:0}class eh{constructor(e){this.hls=void 0,this.autoLevelCapping=void 0,this.firstLevel=void 0,this.media=void 0,this.restrictedLevels=void 0,this.timer=void 0,this.clientRect=void 0,this.streamController=void 0,this.hls=e,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.firstLevel=-1,this.media=null,this.restrictedLevels=[],this.timer=void 0,this.clientRect=null,this.registerListeners()}setStreamController(e){this.streamController=e}destroy(){this.hls&&this.unregisterListener(),this.timer&&this.stopCapping(),this.media=null,this.clientRect=null,this.hls=this.streamController=null}registerListeners(){const{hls:e}=this;e.on(Hi.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),e.on(Hi.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(Hi.MANIFEST_PARSED,this.onManifestParsed,this),e.on(Hi.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(Hi.BUFFER_CODECS,this.onBufferCodecs,this),e.on(Hi.MEDIA_DETACHING,this.onMediaDetaching,this)}unregisterListener(){const{hls:e}=this;e.off(Hi.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),e.off(Hi.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(Hi.MANIFEST_PARSED,this.onManifestParsed,this),e.off(Hi.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(Hi.BUFFER_CODECS,this.onBufferCodecs,this),e.off(Hi.MEDIA_DETACHING,this.onMediaDetaching,this)}onFpsDropLevelCapping(e,t){const s=this.hls.levels[t.droppedLevel];this.isLevelAllowed(s)&&this.restrictedLevels.push({bitrate:s.bitrate,height:s.height,width:s.width})}onMediaAttaching(e,t){this.media=t.media instanceof HTMLVideoElement?t.media:null,this.clientRect=null,this.timer&&this.hls.levels.length&&this.detectPlayerSize()}onManifestParsed(e,t){const s=this.hls;this.restrictedLevels=[],this.firstLevel=t.firstLevel,s.config.capLevelToPlayerSize&&t.video&&this.startCapping()}onLevelsUpdated(e,t){this.timer&&Ui(this.autoLevelCapping)&&this.detectPlayerSize()}onBufferCodecs(e,t){this.hls.config.capLevelToPlayerSize&&t.video&&this.startCapping()}onMediaDetaching(){this.stopCapping(),this.media=null}detectPlayerSize(){if(this.media){if(this.mediaHeight<=0||this.mediaWidth<=0)return void(this.clientRect=null);const e=this.hls.levels;if(e.length){const t=this.hls,s=this.getMaxLevel(e.length-1);s!==this.autoLevelCapping&&t.logger.log("Setting autoLevelCapping to ".concat(s,": ").concat(e[s].height,"p@").concat(e[s].bitrate," for media ").concat(this.mediaWidth,"x").concat(this.mediaHeight)),t.autoLevelCapping=s,t.autoLevelEnabled&&t.autoLevelCapping>this.autoLevelCapping&&this.streamController&&this.streamController.nextLevelSwitch(),this.autoLevelCapping=t.autoLevelCapping}}}getMaxLevel(e){const t=this.hls.levels;if(!t.length)return-1;const s=t.filter((t,s)=>this.isLevelAllowed(t)&&s<=e);return this.clientRect=null,eh.getMaxLevelByMediaSize(s,this.mediaWidth,this.mediaHeight)}startCapping(){this.timer||(this.autoLevelCapping=Number.POSITIVE_INFINITY,self.clearInterval(this.timer),this.timer=self.setInterval(this.detectPlayerSize.bind(this),1e3),this.detectPlayerSize())}stopCapping(){this.restrictedLevels=[],this.firstLevel=-1,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.timer&&(self.clearInterval(this.timer),this.timer=void 0)}getDimensions(){if(this.clientRect)return this.clientRect;const e=this.media,t={width:0,height:0};if(e){const s=e.getBoundingClientRect();t.width=s.width,t.height=s.height,t.width||t.height||(t.width=s.right-s.left||e.width||0,t.height=s.bottom-s.top||e.height||0)}return this.clientRect=t,t}get mediaWidth(){return this.getDimensions().width*this.contentScaleFactor}get mediaHeight(){return this.getDimensions().height*this.contentScaleFactor}get contentScaleFactor(){let e=1;if(!this.hls.config.ignoreDevicePixelRatio)try{e=self.devicePixelRatio}catch(Np){}return Math.min(e,this.hls.config.maxDevicePixelRatio)}isLevelAllowed(e){return!this.restrictedLevels.some(t=>e.bitrate===t.bitrate&&e.width===t.width&&e.height===t.height)}static getMaxLevelByMediaSize(e,t,s){if(null==e||!e.length)return-1;const n=(e,t)=>!t||(e.width!==t.width||e.height!==t.height);let r=e.length-1;const i=Math.max(t,s);for(let a=0;a<e.length;a+=1){const t=e[a];if((t.width>=i||t.height>=i)&&n(t,e[a+1])){r=a;break}}return r}}const th={MANIFEST:"m",AUDIO:"a",VIDEO:"v",MUXED:"av",INIT:"i",CAPTION:"c",TIMED_TEXT:"tt",KEY:"k",OTHER:"o"},sh={HLS:"h"};class nh{constructor(e,t){Array.isArray(e)&&(e=e.map(e=>e instanceof nh?e:new nh(e))),this.value=e,this.params=t}}function rh(e,t,s,n){return new Error("failed to ".concat(e,' "').concat((r=t,Array.isArray(r)?JSON.stringify(r):r instanceof Map?"Map{}":r instanceof Set?"Set{}":"object"===typeof r?JSON.stringify(r):String(r)),'" as ').concat(s),{cause:n});var r}function ih(e,t,s){return rh("serialize",e,t,s)}class ah{constructor(e){this.description=e}}const oh="Bare Item";function lh(e){if(!1===ArrayBuffer.isView(e))throw ih(e,"Byte Sequence");return":".concat((t=e,btoa(String.fromCharCode(...t))),":");var t}function ch(e){if(function(e){return e<-999999999999999||999999999999999<e}(e))throw ih(e,"Integer");return e.toString()}function dh(e,t){if(e<0)return-dh(-e,t);const s=Math.pow(10,t);if(Math.abs(e*s%1-.5)<Number.EPSILON){const t=Math.floor(e*s);return(t%2===0?t:t+1)/s}return Math.round(e*s)/s}function uh(e){const t=dh(e,3);if(Math.floor(Math.abs(t)).toString().length>12)throw ih(e,"Decimal");const s=t.toString();return s.includes(".")?s:"".concat(s,".0")}const hh=/[\x00-\x1f\x7f]+/;function fh(e){const t=(s=e).description||s.toString().slice(7,-1);var s;if(!1===/^([a-zA-Z*])([!#$%&'*+\-.^_`|~\w:/]*)$/.test(t))throw ih(t,"Token");return t}function mh(e){switch(typeof e){case"number":if(!Ui(e))throw ih(e,oh);return Number.isInteger(e)?ch(e):uh(e);case"string":return function(e){if(hh.test(e))throw ih(e,"String");return'"'.concat(e.replace(/\\/g,"\\\\").replace(/"/g,'\\"'),'"')}(e);case"symbol":return fh(e);case"boolean":return function(e){if("boolean"!==typeof e)throw ih(e,"Boolean");return e?"?1":"?0"}(e);case"object":if(e instanceof Date)return function(e){return"@".concat(ch(e.getTime()/1e3))}(e);if(e instanceof Uint8Array)return lh(e);if(e instanceof ah)return fh(e);default:throw ih(e,oh)}}function ph(e){if(!1===/^[a-z*][a-z0-9\-_.*]*$/.test(e))throw ih(e,"Key");return e}function gh(e){return null==e?"":Object.entries(e).map(e=>{let[t,s]=e;return!0===s?";".concat(ph(t)):";".concat(ph(t),"=").concat(mh(s))}).join("")}function vh(e){return e instanceof nh?"".concat(mh(e.value)).concat(gh(e.params)):mh(e)}function yh(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{whitespace:!0};if("object"!==typeof e||null==e)throw ih(e,"Dict");const s=e instanceof Map?e.entries():Object.entries(e),n=(null===t||void 0===t?void 0:t.whitespace)?" ":"";return Array.from(s).map(e=>{let[t,s]=e;s instanceof nh===!1&&(s=new nh(s));let n=ph(t);var r;return!0===s.value?n+=gh(s.params):(n+="=",Array.isArray(s.value)?n+="(".concat((r=s).value.map(vh).join(" "),")").concat(gh(r.params)):n+=vh(s)),n}).join(",".concat(n))}function bh(e,t){return yh(e,t)}const xh="CMCD-Object",Eh="CMCD-Request",Sh="CMCD-Session",Th="CMCD-Status",kh={br:xh,ab:xh,d:xh,ot:xh,tb:xh,tpb:xh,lb:xh,tab:xh,lab:xh,url:xh,pb:Eh,bl:Eh,tbl:Eh,dl:Eh,ltc:Eh,mtp:Eh,nor:Eh,nrr:Eh,rc:Eh,sn:Eh,sta:Eh,su:Eh,ttfb:Eh,ttfbb:Eh,ttlb:Eh,cmsdd:Eh,cmsds:Eh,smrt:Eh,df:Eh,cs:Eh,ts:Eh,cid:Sh,pr:Sh,sf:Sh,sid:Sh,st:Sh,v:Sh,msd:Sh,bs:Th,bsd:Th,cdn:Th,rtp:Th,bg:Th,pt:Th,ec:Th,e:Th},wh=Eh;function Lh(e,t){const s={};if(!e)return s;const n=Object.keys(e),r=t?(i=t,Object.keys(i).reduce((e,t)=>{var s;return null===(s=i[t])||void 0===s||s.forEach(s=>e[s]=t),e},{})):{};var i;return n.reduce((t,s)=>{var n;const i=kh[s]||r[s]||wh;return(null!==(n=t[i])&&void 0!==n?n:t[i]={})[s]=e[s],t},s)}const Ch="event";const Ah=e=>Math.round(e),Rh=(e,t)=>Array.isArray(e)?e.map(e=>Rh(e,t)):e instanceof nh&&"string"===typeof e.value?new nh(Rh(e.value,t),e.params):(t.baseUrl&&(e=function(e,t){const s=new URL(e),n=new URL(t);if(s.origin!==n.origin)return e;const r=s.pathname.split("/").slice(1),i=n.pathname.split("/").slice(1,-1);for(;r[0]===i[0];)r.shift(),i.shift();for(;i.length;)i.shift(),r.unshift("..");return r.join("/")+s.search+s.hash}(e,t.baseUrl)),1===t.version?encodeURIComponent(e):e),_h=e=>100*Ah(e/100),Nh={br:Ah,d:Ah,bl:_h,dl:_h,mtp:_h,nor:(e,t)=>{let s=e;return t.version>=2&&(e instanceof nh&&"string"===typeof e.value?s=new nh([e]):"string"===typeof e&&(s=[e])),Rh(s,t)},rtp:_h,tb:Ah},Ih="request",jh="response",Ph=["ab","bg","bl","br","bs","bsd","cdn","cid","cs","df","ec","lab","lb","ltc","msd","mtp","pb","pr","pt","sf","sid","sn","st","sta","tab","tb","tbl","tpb","ts","v"],Dh=["e"],Mh=/^[a-zA-Z0-9-.]+-[a-zA-Z0-9-.]+$/;function Oh(e){return Mh.test(e)}const Fh=["d","dl","nor","ot","rtp","su"];const Uh=["cmsdd","cmsds","rc","smrt","ttfb","ttfbb","ttlb","url"];const Bh=["bl","br","bs","cid","d","dl","mtp","nor","nrr","ot","pr","rtp","sf","sid","st","su","tb","v"];function Gh(e){return Bh.includes(e)||Oh(e)}const Vh={[jh]:function(e){return Ph.includes(e)||Fh.includes(e)||Uh.includes(e)||Oh(e)},[Ch]:function(e){return Ph.includes(e)||Dh.includes(e)||Oh(e)},[Ih]:function(e){return Ph.includes(e)||Fh.includes(e)||Oh(e)}};function zh(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const s={};if(null==e||"object"!==typeof e)return s;const n=t.version||e.v||1,r=t.reportingMode||Ih,i=1===n?Gh:Vh[r];let a=Object.keys(e).filter(i);const o=t.filter;"function"===typeof o&&(a=a.filter(o));const l=r===jh||r===Ch;l&&!a.includes("ts")&&a.push("ts"),n>1&&!a.includes("v")&&a.push("v");const c=ta({},Nh,t.formatters),d={version:n,reportingMode:r,baseUrl:t.baseUrl};return a.sort().forEach(t=>{let r=e[t];const i=c[t];if("function"===typeof i&&(r=i(r,d)),"v"===t){if(1===n)return;r=n}"pr"==t&&1===r||(l&&"ts"===t&&!Ui(r)&&(r=Date.now()),function(e){return"number"===typeof e?Ui(e):null!=e&&""!==e&&!1!==e}(r)&&(function(e){return["ot","sf","st","e","sta"].includes(e)}(t)&&"string"===typeof r&&(r=new ah(r)),s[t]=r))}),s}function Hh(e,t,s){return ta(e,function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const s={};if(!e)return s;const n=Lh(zh(e,t),null===t||void 0===t?void 0:t.customHeaderMap);return Object.entries(n).reduce((e,t)=>{let[s,n]=t;const r=bh(n,{whitespace:!1});return r&&(e[s]=r),e},s)}(t,s))}function Kh(e){if(!e)return"";const t=function(e){return e?bh(zh(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}),{whitespace:!1}):""}(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:{});return encodeURIComponent(t)}const Wh=/CMCD=[^&#]+/;function qh(e,t,s){const n=function(e){if(!e)return"";const t=Kh(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:{});return"".concat("CMCD","=").concat(t)}(t,s);if(!n)return e;if(Wh.test(e))return e.replace(Wh,n);const r=e.includes("?")?"&":"?";return"".concat(e).concat(r).concat(n)}function Yh(e,t,s,n){e&&Object.keys(t).forEach(r=>{const i=e.filter(e=>e.groupId===r).map(e=>{const i=ta({},e);return i.details=void 0,i.attrs=new Vl(i.attrs),i.url=i.attrs.URI=Xh(e.url,e.attrs["STABLE-RENDITION-ID"],"PER-RENDITION-URIS",s),i.groupId=i.attrs["GROUP-ID"]=t[r],i.attrs["PATHWAY-ID"]=n,i});e.push(...i)})}function Xh(e,t,s,n){const{HOST:r,PARAMS:i,[s]:a}=n;let o;t&&(o=null==a?void 0:a[t],o&&(e=o));const l=new self.URL(e);return r&&!o&&(l.host=r),i&&Object.keys(i).sort().forEach(e=>{e&&l.searchParams.set(e,i[e])}),l.href}class Qh extends ra{constructor(e){super("eme",e.logger),this.hls=void 0,this.config=void 0,this.media=null,this.mediaResolved=void 0,this.keyFormatPromise=null,this.keySystemAccessPromises={},this._requestLicenseFailureCount=0,this.mediaKeySessions=[],this.keyIdToKeySessionPromise={},this.mediaKeys=null,this.setMediaKeysQueue=Qh.CDMCleanupPromise?[Qh.CDMCleanupPromise]:[],this.bannedKeyIds={},this.onMediaEncrypted=e=>{const{initDataType:t,initData:s}=e,n='"'.concat(e.type,'" event: init data type: "').concat(t,'"');if(this.debug(n),null!==s){if(!this.keyFormatPromise){let e=Object.keys(this.keySystemAccessPromises);e.length||(e=cc(this.config));const t=e.map(lc).filter(e=>!!e);this.keyFormatPromise=this.getKeyFormatPromise(t)}this.keyFormatPromise.then(r=>{const i=oc(r);if("sinf"!==t||i!==sc.FAIRPLAY)return void this.log('Ignoring "'.concat(e.type,'" event with init data type: "').concat(t,'" for selected key-system ').concat(i));let a;try{const e=Ia(new Uint8Array(s)),t=Wa($l(JSON.parse(e).sinf));if(!t)throw new Error("'schm' box missing or not cbcs/cenc with schi > tenc");a=new Uint8Array(t.subarray(8,24))}catch(u){return void this.warn("".concat(n," Failed to parse sinf: ").concat(u))}const o=ma(a),{keyIdToKeySessionPromise:l,mediaKeySessions:c}=this;let d=l[o];for(let e=0;e<c.length;e++){const n=c[e],r=n.decryptdata;if(!r.keyId)continue;const i=ma(r.keyId);if(ql(a,r.keyId)||-1!==r.uri.replace(/-/g,"").indexOf(o)){if(d=l[i],!d)continue;if(r.pssh)break;delete l[i],r.pssh=new Uint8Array(s),r.keyId=a,d=l[o]=d.then(()=>this.generateRequestWithPreferredKeySession(n,t,s,"encrypted-event-key-match")),d.catch(e=>this.handleError(e));break}}d||this.handleError(new Error("Key ID ".concat(o," not encountered in playlist. Key-system sessions ").concat(c.length,".")))}).catch(e=>this.handleError(e))}},this.onWaitingForKey=e=>{this.log('"'.concat(e.type,'" event'))},this.hls=e,this.config=e.config,this.registerListeners()}destroy(){this.onDestroying(),this.onMediaDetached();const e=this.config;e.requestMediaKeySystemAccessFunc=null,e.licenseXhrSetup=e.licenseResponseCallback=void 0,e.drmSystems=e.drmSystemOptions={},this.hls=this.config=this.keyIdToKeySessionPromise=null,this.onMediaEncrypted=this.onWaitingForKey=null}registerListeners(){this.hls.on(Hi.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(Hi.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.on(Hi.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.on(Hi.MANIFEST_LOADED,this.onManifestLoaded,this),this.hls.on(Hi.DESTROYING,this.onDestroying,this)}unregisterListeners(){this.hls.off(Hi.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.off(Hi.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.off(Hi.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.off(Hi.MANIFEST_LOADED,this.onManifestLoaded,this),this.hls.off(Hi.DESTROYING,this.onDestroying,this)}getLicenseServerUrl(e){const{drmSystems:t,widevineLicenseUrl:s}=this.config,n=null==t?void 0:t[e];return n?n.licenseUrl:e===sc.WIDEVINE&&s?s:void 0}getLicenseServerUrlOrThrow(e){const t=this.getLicenseServerUrl(e);if(void 0===t)throw new Error('no license server URL configured for key-system "'.concat(e,'"'));return t}getServerCertificateUrl(e){const{drmSystems:t}=this.config,s=null==t?void 0:t[e];if(s)return s.serverCertificateUrl;this.log('No Server Certificate in config.drmSystems["'.concat(e,'"]'))}attemptKeySystemAccess(e){const t=this.hls.levels,s=(e,t,s)=>!!e&&s.indexOf(e)===t,n=t.map(e=>e.audioCodec).filter(s),r=t.map(e=>e.videoCodec).filter(s);return n.length+r.length===0&&r.push("avc1.42e01e"),new Promise((t,s)=>{const i=e=>{const a=e.shift();this.getMediaKeysPromise(a,n,r).then(e=>t({keySystem:a,mediaKeys:e})).catch(t=>{e.length?i(e):s(t instanceof Zh?t:new Zh({type:Vi.KEY_SYSTEM_ERROR,details:zi.KEY_SYSTEM_NO_ACCESS,error:t,fatal:!0},t.message))})};i(e)})}requestMediaKeySystemAccess(e,t){const{requestMediaKeySystemAccessFunc:s}=this.config;if("function"!==typeof s){let e="Configured requestMediaKeySystemAccess is not a function ".concat(s);return null===dc&&"http:"===self.location.protocol&&(e="navigator.requestMediaKeySystemAccess is not available over insecure protocol ".concat(location.protocol)),Promise.reject(new Error(e))}return s(e,t)}getMediaKeysPromise(e,t,s){var n;const r=function(e,t,s,n){let r;switch(e){case sc.FAIRPLAY:r=["cenc","sinf"];break;case sc.WIDEVINE:case sc.PLAYREADY:r=["cenc"];break;case sc.CLEARKEY:r=["cenc","keyids"];break;default:throw new Error("Unknown key-system: ".concat(e))}return function(e,t,s,n){return[{initDataTypes:e,persistentState:n.persistentState||"optional",distinctiveIdentifier:n.distinctiveIdentifier||"optional",sessionTypes:n.sessionTypes||[n.sessionType||"temporary"],audioCapabilities:t.map(e=>({contentType:"audio/mp4; codecs=".concat(e),robustness:n.audioRobustness||"",encryptionScheme:n.audioEncryptionScheme||null})),videoCapabilities:s.map(e=>({contentType:"video/mp4; codecs=".concat(e),robustness:n.videoRobustness||"",encryptionScheme:n.videoEncryptionScheme||null}))}]}(r,t,s,n)}(e,t,s,this.config.drmSystemOptions||{});let i=this.keySystemAccessPromises[e],a=null==(n=i)?void 0:n.keySystemAccess;if(!a){this.log('Requesting encrypted media "'.concat(e,'" key-system access with config: ').concat(Do(r))),a=this.requestMediaKeySystemAccess(e,r);const t=i=this.keySystemAccessPromises[e]={keySystemAccess:a};return a.catch(t=>{this.log('Failed to obtain access to key-system "'.concat(e,'": ').concat(t))}),a.then(s=>{this.log('Access for key-system "'.concat(s.keySystem,'" obtained'));const n=this.fetchServerCertificate(e);this.log('Create media-keys for "'.concat(e,'"'));const r=t.mediaKeys=s.createMediaKeys().then(s=>(this.log('Media-keys created for "'.concat(e,'"')),t.hasMediaKeys=!0,n.then(t=>t?this.setMediaKeysServerCertificate(s,e,t):s)));return r.catch(t=>{this.error('Failed to create media-keys for "'.concat(e,'"}: ').concat(t))}),r})}return a.then(()=>i.mediaKeys)}createMediaKeySessionContext(e){let{decryptdata:t,keySystem:s,mediaKeys:n}=e;this.log('Creating key-system session "'.concat(s,'" keyId: ').concat(ma(t.keyId||[])," keyUri: ").concat(t.uri));const r=n.createSession(),i={decryptdata:t,keySystem:s,mediaKeys:n,mediaKeysSession:r,keyStatus:"status-pending"};return this.mediaKeySessions.push(i),i}renewKeySession(e){const t=e.decryptdata;if(t.pssh){const s=this.createMediaKeySessionContext(e),n=$h(t),r="cenc";this.keyIdToKeySessionPromise[n]=this.generateRequestWithPreferredKeySession(s,r,t.pssh.buffer,"expired")}else this.warn("Could not renew expired session. Missing pssh initData.");this.removeSession(e)}updateKeySession(e,t){const s=e.mediaKeysSession;return this.log('Updating key-session "'.concat(s.sessionId,'" for keyId ').concat(ma(e.decryptdata.keyId||[]),"\n      } (data length: ").concat(t.byteLength,")")),s.update(t)}getSelectedKeySystemFormats(){return Object.keys(this.keySystemAccessPromises).map(e=>({keySystem:e,hasMediaKeys:this.keySystemAccessPromises[e].hasMediaKeys})).filter(e=>{let{hasMediaKeys:t}=e;return!!t}).map(e=>{let{keySystem:t}=e;return lc(t)}).filter(e=>!!e)}getKeySystemAccess(e){return this.getKeySystemSelectionPromise(e).then(e=>{let{keySystem:t,mediaKeys:s}=e;return this.attemptSetMediaKeys(t,s)})}selectKeySystem(e){return new Promise((t,s)=>{this.getKeySystemSelectionPromise(e).then(e=>{let{keySystem:n}=e;const r=lc(n);r?t(r):s(new Error('Unable to find format for key-system "'.concat(n,'"')))}).catch(s)})}selectKeySystemFormat(e){const t=Object.keys(e.levelkeys||{});return this.keyFormatPromise||(this.log("Selecting key-system from fragment (sn: ".concat(e.sn," ").concat(e.type,": ").concat(e.level,") key formats ").concat(t.join(", "))),this.keyFormatPromise=this.getKeyFormatPromise(t)),this.keyFormatPromise}getKeyFormatPromise(e){const t=cc(this.config),s=e.map(oc).filter(e=>!!e&&-1!==t.indexOf(e));return this.selectKeySystem(s)}getKeyStatus(e){const{mediaKeySessions:t}=this;for(let s=0;s<t.length;s++){const n=Jh(e,t[s]);if(n)return n}}loadKey(e){const t=e.keyInfo.decryptdata,s=$h(t),n=this.bannedKeyIds[s];if(n||"internal-error"===this.getKeyStatus(t)){const s=ef(n||"internal-error",t);return this.handleError(s,e.frag),Promise.reject(s)}const r="(keyId: ".concat(s,' format: "').concat(t.keyFormat,'" method: ').concat(t.method," uri: ").concat(t.uri,")");this.log("Starting session for key ".concat(r));const i=this.keyIdToKeySessionPromise[s];if(!i){const n=this.getKeySystemForKeyPromise(t).then(s=>{let{keySystem:n,mediaKeys:i}=s;return this.throwIfDestroyed(),this.log("Handle encrypted media sn: ".concat(e.frag.sn," ").concat(e.frag.type,": ").concat(e.frag.level," using key ").concat(r)),this.attemptSetMediaKeys(n,i).then(()=>(this.throwIfDestroyed(),this.createMediaKeySessionContext({keySystem:n,mediaKeys:i,decryptdata:t})))}).then(e=>{const s=t.pssh?t.pssh.buffer:null;return this.generateRequestWithPreferredKeySession(e,"cenc",s,"playlist-key")});return n.catch(t=>this.handleError(t,e.frag)),this.keyIdToKeySessionPromise[s]=n,n}return i.catch(s=>{if(s instanceof Zh){const n=na({},s.data);"internal-error"===this.getKeyStatus(t)&&(n.decryptdata=t);const r=new Zh(n,s.message);this.handleError(r,e.frag)}}),i}throwIfDestroyed(){if(!this.hls)throw new Error("invalid state")}handleError(e,t){if(this.hls)if(e instanceof Zh){t&&(e.data.frag=t);const s=e.data.decryptdata;this.error("".concat(e.message).concat(s?" (".concat(ma(s.keyId||[]),")"):"")),this.hls.trigger(Hi.ERROR,e.data)}else this.error(e.message),this.hls.trigger(Hi.ERROR,{type:Vi.KEY_SYSTEM_ERROR,details:zi.KEY_SYSTEM_NO_KEYS,error:e,fatal:!0})}getKeySystemForKeyPromise(e){const t=$h(e),s=this.keyIdToKeySessionPromise[t];if(!s){const t=oc(e.keyFormat),s=t?[t]:cc(this.config);return this.attemptKeySystemAccess(s)}return s}getKeySystemSelectionPromise(e){if(e.length||(e=cc(this.config)),0===e.length)throw new Zh({type:Vi.KEY_SYSTEM_ERROR,details:zi.KEY_SYSTEM_NO_CONFIGURED_LICENSE,fatal:!0},"Missing key-system license configuration options ".concat(Do({drmSystems:this.config.drmSystems})));return this.attemptKeySystemAccess(e)}attemptSetMediaKeys(e,t){if(this.mediaResolved=void 0,this.mediaKeys===t)return Promise.resolve();const s=this.setMediaKeysQueue.slice();this.log('Setting media-keys for "'.concat(e,'"'));const n=Promise.all(s).then(()=>this.media?this.media.setMediaKeys(t):new Promise((e,s)=>{this.mediaResolved=()=>{if(this.mediaResolved=void 0,!this.media)return s(new Error("Attempted to set mediaKeys without media element attached"));this.mediaKeys=t,this.media.setMediaKeys(t).then(e).catch(s)}}));return this.mediaKeys=t,this.setMediaKeysQueue.push(n),n.then(()=>{this.log('Media-keys set for "'.concat(e,'"')),s.push(n),this.setMediaKeysQueue=this.setMediaKeysQueue.filter(e=>-1===s.indexOf(e))})}generateRequestWithPreferredKeySession(e,t,s,n){var r;const i=null==(r=this.config.drmSystems)||null==(r=r[e.keySystem])?void 0:r.generateRequest;if(i)try{const n=i.call(this.hls,t,s,e);if(!n)throw new Error("Invalid response from configured generateRequest filter");t=n.initDataType,s=n.initData?n.initData:null,e.decryptdata.pssh=s?new Uint8Array(s):null}catch(f){if(this.warn(f.message),this.hls&&this.hls.config.debug)throw f}if(null===s)return this.log('Skipping key-session request for "'.concat(n,'" (no initData)')),Promise.resolve(e);const a=$h(e.decryptdata),o=e.decryptdata.uri;this.log('Generating key-session request for "'.concat(n,'" keyId: ').concat(a," URI: ").concat(o," (init data type: ").concat(t," length: ").concat(s.byteLength,")"));const l=new yd,c=e._onmessage=t=>{const s=e.mediaKeysSession;if(!s)return void l.emit("error",new Error("invalid state"));const{messageType:n,message:r}=t;this.log('"'.concat(n,'" message event for session "').concat(s.sessionId,'" message size: ').concat(r.byteLength)),"license-request"===n||"license-renewal"===n?this.renewLicense(e,r).catch(e=>{l.eventNames().length?l.emit("error",e):this.handleError(e)}):"license-release"===n?e.keySystem===sc.FAIRPLAY&&this.updateKeySession(e,Jl("acknowledged")).then(()=>this.removeSession(e)).catch(e=>this.handleError(e)):this.warn('unhandled media key message type "'.concat(n,'"'))},d=(e,t)=>{let s;t.keyStatus=e,e.startsWith("usable")?l.emit("resolved"):"internal-error"===e||"output-restricted"===e||"output-downscaled"===e?s=ef(e,t.decryptdata):"expired"===e?s=new Error("key expired (keyId: ".concat(a,")")):"released"===e?s=new Error("key released"):"status-pending"===e||this.warn('unhandled key status change "'.concat(e,'" (keyId: ').concat(a,")")),s&&(l.eventNames().length?l.emit("error",s):this.handleError(s))},u=e._onkeystatuseschange=t=>{if(!e.mediaKeysSession)return void l.emit("error",new Error("invalid state"));const s=this.getKeyStatuses(e);if(!Object.keys(s).some(e=>"status-pending"!==s[e]))return;if("expired"===s[a])return this.log("Expired key ".concat(Do(s),' in key-session "').concat(e.mediaKeysSession.sessionId,'"')),void this.renewKeySession(e);let n=s[a];if(n)d(n,e);else{var r;const t=1e3;e.keyStatusTimeouts||(e.keyStatusTimeouts={}),(r=e.keyStatusTimeouts)[a]||(r[a]=self.setTimeout(()=>{if(!e.mediaKeysSession||!this.mediaKeys)return;const s=this.getKeyStatus(e.decryptdata);if(s&&"status-pending"!==s)return this.log("No status for keyId ".concat(a,' in key-session "').concat(e.mediaKeysSession.sessionId,'". Using session key-status ').concat(s," from other session.")),d(s,e);this.log("key status for ".concat(a,' in key-session "').concat(e.mediaKeysSession.sessionId,'" timed out after ').concat(t,"ms")),n="internal-error",d(n,e)},t)),this.log("No status for keyId ".concat(a," (").concat(Do(s),")."))}};$c(e.mediaKeysSession,"message",c),$c(e.mediaKeysSession,"keystatuseschange",u);const h=new Promise((e,t)=>{l.on("error",t),l.on("resolved",e)});return e.mediaKeysSession.generateRequest(t,s).then(()=>{this.log('Request generated for key-session "'.concat(e.mediaKeysSession.sessionId,'" keyId: ').concat(a," URI: ").concat(o))}).catch(t=>{throw new Zh({type:Vi.KEY_SYSTEM_ERROR,details:zi.KEY_SYSTEM_NO_SESSION,error:t,decryptdata:e.decryptdata,fatal:!1},"Error generating key-session request: ".concat(t))}).then(()=>h).catch(t=>(l.removeAllListeners(),this.removeSession(e).then(()=>{throw t}))).then(()=>(l.removeAllListeners(),e))}getKeyStatuses(e){const t={};return e.mediaKeysSession.keyStatuses.forEach((s,n)=>{if("string"===typeof n&&"object"===typeof s){const e=n;n=s,s=e}const r="buffer"in n?new Uint8Array(n.buffer,n.byteOffset,n.byteLength):new Uint8Array(n);if(e.keySystem===sc.PLAYREADY&&16===r.length){const e=ma(r);t[e]=s,Zl(r)}const i=ma(r);"internal-error"===s&&(this.bannedKeyIds[i]=s),this.log('key status change "'.concat(s,'" for keyStatuses keyId: ').concat(i,' key-session "').concat(e.mediaKeysSession.sessionId,'"')),t[i]=s}),t}fetchServerCertificate(e){const t=this.config,s=new(0,t.loader)(t),n=this.getServerCertificateUrl(e);return n?(this.log('Fetching server certificate for "'.concat(e,'"')),new Promise((r,i)=>{const a={responseType:"arraybuffer",url:n},o=t.certLoadPolicy.default,l={loadPolicy:o,timeout:o.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},c={onSuccess:(e,t,s,n)=>{r(e.data)},onError:(t,s,r,o)=>{i(new Zh({type:Vi.KEY_SYSTEM_ERROR,details:zi.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED,fatal:!0,networkDetails:r,response:na({url:a.url,data:void 0},t)},'"'.concat(e,'" certificate request failed (').concat(n,"). Status: ").concat(t.code," (").concat(t.text,")")))},onTimeout:(t,s,r)=>{i(new Zh({type:Vi.KEY_SYSTEM_ERROR,details:zi.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED,fatal:!0,networkDetails:r,response:{url:a.url,data:void 0}},'"'.concat(e,'" certificate request timed out (').concat(n,")")))},onAbort:(e,t,s)=>{i(new Error("aborted"))}};s.load(a,l,c)})):Promise.resolve()}setMediaKeysServerCertificate(e,t,s){return new Promise((n,r)=>{e.setServerCertificate(s).then(r=>{this.log("setServerCertificate ".concat(r?"success":"not supported by CDM"," (").concat(s.byteLength,') on "').concat(t,'"')),n(e)}).catch(e=>{r(new Zh({type:Vi.KEY_SYSTEM_ERROR,details:zi.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED,error:e,fatal:!0},e.message))})})}renewLicense(e,t){return this.requestLicense(e,new Uint8Array(t)).then(t=>this.updateKeySession(e,new Uint8Array(t)).catch(t=>{throw new Zh({type:Vi.KEY_SYSTEM_ERROR,details:zi.KEY_SYSTEM_SESSION_UPDATE_FAILED,decryptdata:e.decryptdata,error:t,fatal:!1},t.message)}))}unpackPlayReadyKeyMessage(e,t){const s=String.fromCharCode.apply(null,new Uint16Array(t.buffer));if(!s.includes("PlayReadyKeyMessage"))return e.setRequestHeader("Content-Type","text/xml; charset=utf-8"),t;const n=(new DOMParser).parseFromString(s,"application/xml"),r=n.querySelectorAll("HttpHeader");if(r.length>0){let t;for(let s=0,n=r.length;s<n;s++){var i,a;t=r[s];const n=null==(i=t.querySelector("name"))?void 0:i.textContent,o=null==(a=t.querySelector("value"))?void 0:a.textContent;n&&o&&e.setRequestHeader(n,o)}}const o=n.querySelector("Challenge"),l=null==o?void 0:o.textContent;if(!l)throw new Error("Cannot find <Challenge> in key message");return Jl(atob(l))}setupLicenseXHR(e,t,s,n){const r=this.config.licenseXhrSetup;return r?Promise.resolve().then(()=>{if(!s.decryptdata)throw new Error("Key removed");return r.call(this.hls,e,t,s,n)}).catch(i=>{if(!s.decryptdata)throw i;return e.open("POST",t,!0),r.call(this.hls,e,t,s,n)}).then(s=>{e.readyState||e.open("POST",t,!0);return{xhr:e,licenseChallenge:s||n}}):(e.open("POST",t,!0),Promise.resolve({xhr:e,licenseChallenge:n}))}requestLicense(e,t){const s=this.config.keyLoadPolicy.default;return new Promise((n,r)=>{const i=this.getLicenseServerUrlOrThrow(e.keySystem);this.log("Sending license request to URL: ".concat(i));const a=new XMLHttpRequest;a.responseType="arraybuffer",a.onreadystatechange=()=>{if(!this.hls||!e.mediaKeysSession)return r(new Error("invalid state"));if(4===a.readyState)if(200===a.status){this._requestLicenseFailureCount=0;let t=a.response;this.log("License received ".concat(t instanceof ArrayBuffer?t.byteLength:t));const s=this.config.licenseResponseCallback;if(s)try{t=s.call(this.hls,a,i,e)}catch(o){this.error(o)}n(t)}else{const o=s.errorRetry,l=o?o.maxNumRetry:0;if(this._requestLicenseFailureCount++,this._requestLicenseFailureCount>l||a.status>=400&&a.status<500)r(new Zh({type:Vi.KEY_SYSTEM_ERROR,details:zi.KEY_SYSTEM_LICENSE_REQUEST_FAILED,decryptdata:e.decryptdata,fatal:!0,networkDetails:a,response:{url:i,data:void 0,code:a.status,text:a.statusText}},"License Request XHR failed (".concat(i,"). Status: ").concat(a.status," (").concat(a.statusText,")")));else{const s=l-this._requestLicenseFailureCount+1;this.warn("Retrying license request, ".concat(s," attempts left")),this.requestLicense(e,t).then(n,r)}}},e.licenseXhr&&e.licenseXhr.readyState!==XMLHttpRequest.DONE&&e.licenseXhr.abort(),e.licenseXhr=a,this.setupLicenseXHR(a,i,e,t).then(t=>{let{xhr:s,licenseChallenge:n}=t;e.keySystem==sc.PLAYREADY&&(n=this.unpackPlayReadyKeyMessage(s,n)),s.send(n)}).catch(r)})}onDestroying(){this.unregisterListeners(),this._clear()}onMediaAttached(e,t){if(!this.config.emeEnabled)return;const s=t.media;this.media=s,$c(s,"encrypted",this.onMediaEncrypted),$c(s,"waitingforkey",this.onWaitingForKey);const n=this.mediaResolved;n?n():this.mediaKeys=s.mediaKeys}onMediaDetached(){const e=this.media;e&&(Jc(e,"encrypted",this.onMediaEncrypted),Jc(e,"waitingforkey",this.onWaitingForKey),this.media=null,this.mediaKeys=null)}_clear(){var e;this._requestLicenseFailureCount=0,this.keyIdToKeySessionPromise={},this.bannedKeyIds={};const t=this.mediaResolved;if(t&&t(),!this.mediaKeys&&!this.mediaKeySessions.length)return;const s=this.media,n=this.mediaKeySessions.slice();this.mediaKeySessions=[],this.mediaKeys=null,mc.clearKeyUriToKeyIdMap();const r=n.length;Qh.CDMCleanupPromise=Promise.all(n.map(e=>this.removeSession(e)).concat((null==s||null==(e=s.setMediaKeys(null))?void 0:e.catch(e=>{this.log("Could not clear media keys: ".concat(e)),this.hls&&this.hls.trigger(Hi.ERROR,{type:Vi.OTHER_ERROR,details:zi.KEY_SYSTEM_DESTROY_MEDIA_KEYS_ERROR,fatal:!1,error:new Error("Could not clear media keys: ".concat(e))})}))||Promise.resolve())).catch(e=>{this.log("Could not close sessions and clear media keys: ".concat(e)),this.hls&&this.hls.trigger(Hi.ERROR,{type:Vi.OTHER_ERROR,details:zi.KEY_SYSTEM_DESTROY_CLOSE_SESSION_ERROR,fatal:!1,error:new Error("Could not close sessions and clear media keys: ".concat(e))})}).then(()=>{r&&this.log("finished closing key sessions and clearing media keys")})}onManifestLoading(){this._clear()}onManifestLoaded(e,t){let{sessionKeys:s}=t;if(s&&this.config.emeEnabled&&!this.keyFormatPromise){const e=s.reduce((e,t)=>(-1===e.indexOf(t.keyFormat)&&e.push(t.keyFormat),e),[]);this.log("Selecting key-system from session-keys ".concat(e.join(", "))),this.keyFormatPromise=this.getKeyFormatPromise(e)}}removeSession(e){const{mediaKeysSession:t,licenseXhr:s,decryptdata:n}=e;if(t){this.log('Remove licenses and keys and close session "'.concat(t.sessionId,'" keyId: ').concat(ma((null==n?void 0:n.keyId)||[]))),e._onmessage&&(t.removeEventListener("message",e._onmessage),e._onmessage=void 0),e._onkeystatuseschange&&(t.removeEventListener("keystatuseschange",e._onkeystatuseschange),e._onkeystatuseschange=void 0),s&&s.readyState!==XMLHttpRequest.DONE&&s.abort(),e.mediaKeysSession=e.decryptdata=e.licenseXhr=void 0;const r=this.mediaKeySessions.indexOf(e);r>-1&&this.mediaKeySessions.splice(r,1);const{keyStatusTimeouts:i}=e;i&&Object.keys(i).forEach(e=>self.clearTimeout(i[e]));const{drmSystemOptions:a}=this.config,o=function(e){var t;return!!e&&("persistent-license"===e.sessionType||!(null==(t=e.sessionTypes)||!t.some(e=>"persistent-license"===e)))}(a)?new Promise((e,s)=>{self.setTimeout(()=>s(new Error("MediaKeySession.remove() timeout")),8e3),t.remove().then(e).catch(s)}):Promise.resolve();return o.catch(e=>{this.log("Could not remove session: ".concat(e)),this.hls&&this.hls.trigger(Hi.ERROR,{type:Vi.OTHER_ERROR,details:zi.KEY_SYSTEM_DESTROY_REMOVE_SESSION_ERROR,fatal:!1,error:new Error("Could not remove session: ".concat(e))})}).then(()=>t.close()).catch(e=>{this.log("Could not close session: ".concat(e)),this.hls&&this.hls.trigger(Hi.ERROR,{type:Vi.OTHER_ERROR,details:zi.KEY_SYSTEM_DESTROY_CLOSE_SESSION_ERROR,fatal:!1,error:new Error("Could not close session: ".concat(e))})})}return Promise.resolve()}}function $h(e){if(!e)throw new Error("Could not read keyId of undefined decryptdata");if(null===e.keyId)throw new Error("keyId is null");return ma(e.keyId)}function Jh(e,t){return e.keyId&&t.mediaKeysSession.keyStatuses.has(e.keyId)?t.mediaKeysSession.keyStatuses.get(e.keyId):e.matches(t.decryptdata)?t.keyStatus:void 0}Qh.CDMCleanupPromise=void 0;class Zh extends Error{constructor(e,t){super(t),this.data=void 0,e.error||(e.error=new Error(t)),this.data=e,e.err=e.error}}function ef(e,t){const s="output-restricted"===e,n=s?zi.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED:zi.KEY_SYSTEM_STATUS_INTERNAL_ERROR;return new Zh({type:Vi.KEY_SYSTEM_ERROR,details:n,fatal:!1,decryptdata:t},s?"HDCP level output restricted":'key status changed to "'.concat(e,'"'))}function tf(e,t){let s;try{s=new Event("addtrack")}catch(Ip){s=document.createEvent("Event"),s.initEvent("addtrack",!1,!1)}s.track=e,t.dispatchEvent(s)}function sf(e,t){const s=e.mode;if("disabled"===s&&(e.mode="hidden"),e.cues&&!e.cues.getCueById(t.id))try{if(e.addCue(t),!e.cues.getCueById(t.id))throw new Error("addCue is failed for: ".concat(t))}catch(Ip){da.debug("[texttrack-utils]: ".concat(Ip));try{const s=new self.TextTrackCue(t.startTime,t.endTime,t.text);s.id=t.id,e.addCue(s)}catch(n){da.debug("[texttrack-utils]: Legacy TextTrackCue fallback failed: ".concat(n))}}"disabled"===s&&(e.mode=s)}function nf(e,t){const s=e.mode;if("disabled"===s&&(e.mode="hidden"),e.cues)for(let n=e.cues.length;n--;)t&&e.cues[n].removeEventListener("enter",t),e.removeCue(e.cues[n]);"disabled"===s&&(e.mode=s)}function rf(e,t,s,n){const r=e.mode;if("disabled"===r&&(e.mode="hidden"),e.cues&&e.cues.length>0){const r=function(e,t,s){const n=[],r=function(e,t){if(t<=e[0].startTime)return 0;const s=e.length-1;if(t>e[s].endTime)return-1;let n,r=0,i=s;for(;r<=i;)if(n=Math.floor((i+r)/2),t<e[n].startTime)i=n-1;else{if(!(t>e[n].startTime&&r<s))return n;r=n+1}return e[r].startTime-t<t-e[i].startTime?r:i}(e,t);if(r>-1)for(let i=r,a=e.length;i<a;i++){const r=e[i];if(r.startTime>=t&&r.endTime<=s)n.push(r);else if(r.startTime>s)return n}return n}(e.cues,t,s);for(let t=0;t<r.length;t++)n&&!n(r[t])||e.removeCue(r[t])}"disabled"===r&&(e.mode=r)}function af(e){const t=[];for(let s=0;s<e.length;s++){const n=e[s];"subtitles"!==n.kind&&"captions"!==n.kind||!n.label||t.push(e[s])}return t}function of(e){let t=5381,s=e.length;for(;s;)t=33*t^e.charCodeAt(--s);return(t>>>0).toString()}const lf=.025;let cf=function(e){return e[e.Point=0]="Point",e[e.Range=1]="Range",e}({});function df(e,t,s){return"".concat(e.identifier,"-").concat(s+1,"-").concat(of(t))}class uf{constructor(e,t){this.base=void 0,this._duration=null,this._timelineStart=null,this.appendInPlaceDisabled=void 0,this.appendInPlaceStarted=void 0,this.dateRange=void 0,this.hasPlayed=!1,this.cumulativeDuration=0,this.resumeOffset=NaN,this.playoutLimit=NaN,this.restrictions={skip:!1,jump:!1},this.snapOptions={out:!1,in:!1},this.assetList=[],this.assetListLoader=void 0,this.assetListResponse=null,this.resumeAnchor=void 0,this.error=void 0,this.resetOnResume=void 0,this.base=t,this.dateRange=e,this.setDateRange(e)}setDateRange(e){this.dateRange=e,this.resumeOffset=e.attr.optionalFloat("X-RESUME-OFFSET",this.resumeOffset),this.playoutLimit=e.attr.optionalFloat("X-PLAYOUT-LIMIT",this.playoutLimit),this.restrictions=e.attr.enumeratedStringList("X-RESTRICT",this.restrictions),this.snapOptions=e.attr.enumeratedStringList("X-SNAP",this.snapOptions)}reset(){var e;this.appendInPlaceStarted=!1,null==(e=this.assetListLoader)||e.destroy(),this.assetListLoader=void 0,this.supplementsPrimary||(this.assetListResponse=null,this.assetList=[],this._duration=null)}isAssetPastPlayoutLimit(e){var t;if(e>0&&e>=this.assetList.length)return!0;const s=this.playoutLimit;if(e<=0||isNaN(s))return!1;if(0===s)return!0;return((null==(t=this.assetList[e])?void 0:t.startOffset)||0)>s}findAssetIndex(e){return this.assetList.indexOf(e)}get identifier(){return this.dateRange.id}get startDate(){return this.dateRange.startDate}get startTime(){const e=this.dateRange.startTime;if(this.snapOptions.out){const t=this.dateRange.tagAnchor;if(t)return hf(e,t)}return e}get startOffset(){return this.cue.pre?0:this.startTime}get startIsAligned(){if(0===this.startTime||this.snapOptions.out)return!0;const e=this.dateRange.tagAnchor;if(e){const t=this.dateRange.startTime;return t-hf(t,e)<.1}return!1}get resumptionOffset(){const e=this.resumeOffset,t=Ui(e)?e:this.duration;return this.cumulativeDuration+t}get resumeTime(){const e=this.startOffset+this.resumptionOffset;if(this.snapOptions.in){const t=this.resumeAnchor;if(t)return hf(e,t)}return e}get appendInPlace(){return!!this.appendInPlaceStarted||!this.appendInPlaceDisabled&&!(this.cue.once||this.cue.pre||!this.startIsAligned||!(isNaN(this.playoutLimit)&&isNaN(this.resumeOffset)||this.resumeOffset&&this.duration&&Math.abs(this.resumeOffset-this.duration)<lf))}set appendInPlace(e){this.appendInPlaceStarted?this.resetOnResume=!e:this.appendInPlaceDisabled=!e}get timelineStart(){return null!==this._timelineStart?this._timelineStart:this.startTime}set timelineStart(e){this._timelineStart=e}get duration(){const e=this.playoutLimit;let t;return t=null!==this._duration?this._duration:this.dateRange.duration?this.dateRange.duration:this.dateRange.plannedDuration||0,!isNaN(e)&&e<t&&(t=e),t}set duration(e){this._duration=e}get cue(){return this.dateRange.cue}get timelineOccupancy(){return"RANGE"===this.dateRange.attr["X-TIMELINE-OCCUPIES"]?cf.Range:cf.Point}get supplementsPrimary(){return"PRIMARY"===this.dateRange.attr["X-TIMELINE-STYLE"]}get contentMayVary(){return"NO"!==this.dateRange.attr["X-CONTENT-MAY-VARY"]}get assetUrl(){return this.dateRange.attr["X-ASSET-URI"]}get assetListUrl(){return this.dateRange.attr["X-ASSET-LIST"]}get baseUrl(){return this.base.url}get assetListLoaded(){return this.assetList.length>0||null!==this.assetListResponse}toString(){return'["'.concat((e=this).identifier,'" ').concat(e.cue.pre?"<pre>":e.cue.post?"<post>":"").concat(e.timelineStart.toFixed(2),"-").concat(e.resumeTime.toFixed(2),"]");var e}}function hf(e,t){return e-t.start<t.duration/2&&!(Math.abs(e-(t.start+t.duration))<lf)?t.start:t.start+t.duration}function ff(e,t,s){const n=new self.URL(e,s);return"data:"!==n.protocol&&n.searchParams.set("_HLS_primary_id",t),n}function mf(e,t){for(;null!=(s=e.assetList[++t])&&s.error;)var s;return t}function pf(e){const t=e.timelineStart,s=e.duration||0;return'["'.concat(e.identifier,'" ').concat(t.toFixed(2),"-").concat((t+s).toFixed(2),"]")}class gf{constructor(e,t,s,n){this.hls=void 0,this.interstitial=void 0,this.assetItem=void 0,this.tracks=null,this.hasDetails=!1,this.mediaAttached=null,this._currentTime=void 0,this._bufferedEosTime=void 0,this.checkPlayout=()=>{this.reachedPlayout(this.currentTime)&&this.hls&&this.hls.trigger(Hi.PLAYOUT_LIMIT_REACHED,{})};const r=this.hls=new e(t);this.interstitial=s,this.assetItem=n;const i=()=>{this.hasDetails=!0};r.once(Hi.LEVEL_LOADED,i),r.once(Hi.AUDIO_TRACK_LOADED,i),r.once(Hi.SUBTITLE_TRACK_LOADED,i),r.on(Hi.MEDIA_ATTACHING,(e,t)=>{let{media:s}=t;this.removeMediaListeners(),this.mediaAttached=s;this.interstitial.playoutLimit&&(s.addEventListener("timeupdate",this.checkPlayout),this.appendInPlace&&r.on(Hi.BUFFER_APPENDED,()=>{const e=this.bufferedEnd;this.reachedPlayout(e)&&(this._bufferedEosTime=e,r.trigger(Hi.BUFFERED_TO_END,void 0))}))})}get appendInPlace(){return this.interstitial.appendInPlace}loadSource(){const e=this.hls;if(e)if(e.url)e.levels.length&&!e.started&&e.startLoad(-1,!0);else{let s=this.assetItem.uri;try{s=ff(s,e.config.primarySessionId||"").href}catch(t){}e.loadSource(s)}}bufferedInPlaceToEnd(e){var t;if(!this.appendInPlace)return!1;if(null!=(t=this.hls)&&t.bufferedToEnd)return!0;if(!e)return!1;const s=Math.min(this._bufferedEosTime||1/0,this.duration),n=this.timelineOffset,r=Pl.bufferInfo(e,n,0);return this.getAssetTime(r.end)>=s-.02}reachedPlayout(e){const t=this.interstitial.playoutLimit;return this.startOffset+e>=t}get destroyed(){var e;return!(null!=(e=this.hls)&&e.userConfig)}get assetId(){return this.assetItem.identifier}get interstitialId(){return this.assetItem.parentIdentifier}get media(){var e;return(null==(e=this.hls)?void 0:e.media)||null}get bufferedEnd(){const e=this.media||this.mediaAttached;if(!e)return this._bufferedEosTime?this._bufferedEosTime:this.currentTime;const t=Pl.bufferInfo(e,e.currentTime,.001);return this.getAssetTime(t.end)}get currentTime(){const e=this.media||this.mediaAttached;return e?this.getAssetTime(e.currentTime):this._currentTime||0}get duration(){const e=this.assetItem.duration;if(!e)return 0;const t=this.interstitial.playoutLimit;if(t){const s=t-this.startOffset;if(s>0&&s<e)return s}return e}get remaining(){const e=this.duration;return e?Math.max(0,e-this.currentTime):0}get startOffset(){return this.assetItem.startOffset}get timelineOffset(){var e;return(null==(e=this.hls)?void 0:e.config.timelineOffset)||0}set timelineOffset(e){const t=this.timelineOffset;if(e!==t){const s=e-t;if(Math.abs(s)>1/9e4&&this.hls){if(this.hasDetails)throw new Error("Cannot set timelineOffset after playlists are loaded");this.hls.config.timelineOffset=e}}}getAssetTime(e){const t=this.timelineOffset,s=this.duration;return Math.min(Math.max(0,e-t),s)}removeMediaListeners(){const e=this.mediaAttached;e&&(this._currentTime=e.currentTime,this.bufferSnapShot(),e.removeEventListener("timeupdate",this.checkPlayout))}bufferSnapShot(){var e;this.mediaAttached&&(null!=(e=this.hls)&&e.bufferedToEnd&&(this._bufferedEosTime=this.bufferedEnd))}destroy(){this.removeMediaListeners(),this.hls&&this.hls.destroy(),this.hls=null,this.tracks=this.mediaAttached=this.checkPlayout=null}attachMedia(e){var t;this.loadSource(),null==(t=this.hls)||t.attachMedia(e)}detachMedia(){var e;this.removeMediaListeners(),this.mediaAttached=null,null==(e=this.hls)||e.detachMedia()}resumeBuffering(){var e;null==(e=this.hls)||e.resumeBuffering()}pauseBuffering(){var e;null==(e=this.hls)||e.pauseBuffering()}transferMedia(){var e;return this.bufferSnapShot(),(null==(e=this.hls)?void 0:e.transferMedia())||null}resetDetails(){const e=this.hls;if(e&&this.hasDetails){e.stopLoad();const t=e=>delete e.details;e.levels.forEach(t),e.allAudioTracks.forEach(t),e.allSubtitleTracks.forEach(t),this.hasDetails=!1}}on(e,t,s){var n;null==(n=this.hls)||n.on(e,t)}once(e,t,s){var n;null==(n=this.hls)||n.once(e,t)}off(e,t,s){var n;null==(n=this.hls)||n.off(e,t)}toString(){var e;return"HlsAssetPlayer: ".concat(pf(this.assetItem)," ").concat(null==(e=this.hls)?void 0:e.sessionId," ").concat(this.appendInPlace?"append-in-place":"")}}class vf extends ra{constructor(e,t){super("interstitials-sched",t),this.onScheduleUpdate=void 0,this.eventMap={},this.events=null,this.items=null,this.durations={primary:0,playout:0,integrated:0},this.onScheduleUpdate=e}destroy(){this.reset(),this.onScheduleUpdate=null}reset(){this.eventMap={},this.setDurations(0,0,0),this.events&&this.events.forEach(e=>e.reset()),this.events=this.items=null}resetErrorsInRange(e,t){return this.events?this.events.reduce((s,n)=>e<=n.startOffset&&t>n.startOffset?(delete n.error,s+1):s,0):0}get duration(){const e=this.items;return e?e[e.length-1].end:0}get length(){return this.items?this.items.length:0}getEvent(e){return e&&this.eventMap[e]||null}hasEvent(e){return e in this.eventMap}findItemIndex(e,t){if(e.event)return this.findEventIndex(e.event.identifier);let s=-1;e.nextEvent?s=this.findEventIndex(e.nextEvent.identifier)-1:e.previousEvent&&(s=this.findEventIndex(e.previousEvent.identifier)+1);const n=this.items;if(n)for(n[s]||(void 0===t&&(t=e.start),s=this.findItemIndexAtTime(t));s>=0&&null!=(r=n[s])&&r.event;){var r;s--}return s}findItemIndexAtTime(e,t){const s=this.items;if(s)for(let n=0;n<s.length;n++){let r=s[n];if(t&&"primary"!==t&&(r=r[t]),e===r.start||e>r.start&&e<r.end)return n}return-1}findJumpRestrictedIndex(e,t){const s=this.items;if(s)for(let n=e;n<=t&&s[n];n++){const e=s[n].event;if(null!=e&&e.restrictions.jump&&!e.appendInPlace)return n}return-1}findEventIndex(e){const t=this.items;if(t)for(let n=t.length;n--;){var s;if((null==(s=t[n].event)?void 0:s.identifier)===e)return n}return-1}findAssetIndex(e,t){const s=e.assetList,n=s.length;if(n>1)for(let r=0;r<n;r++){const e=s[r];if(!e.error){const s=e.timelineStart;if(t===s||t>s&&(t<s+(e.duration||0)||r===n-1))return r}}return 0}get assetIdAtEnd(){var e;const t=null==(e=this.items)||null==(e=e[this.length-1])?void 0:e.event;if(t){const e=t.assetList,s=e[e.length-1];if(s)return s.identifier}return null}parseInterstitialDateRanges(e,t){const s=e.main.details,{dateRanges:n}=s,r=this.events,i=this.parseDateRanges(n,{url:s.url},t),a=Object.keys(n),o=r?r.filter(e=>!a.includes(e.identifier)):[];i.length&&i.sort((e,t)=>{const s=e.cue.pre,n=e.cue.post,r=t.cue.pre,i=t.cue.post;if(s&&!r)return-1;if(r&&!s)return 1;if(n&&!i)return 1;if(i&&!n)return-1;if(!s&&!r&&!n&&!i){const s=e.startTime,n=t.startTime;if(s!==n)return s-n}return e.dateRange.tagOrder-t.dateRange.tagOrder}),this.events=i,o.forEach(e=>{this.removeEvent(e)}),this.updateSchedule(e,o)}updateSchedule(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],s=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const n=this.events||[];if(n.length||t.length||this.length<2){const r=this.items,i=this.parseSchedule(n,e);(s||t.length||(null==r?void 0:r.length)!==i.length||i.some((e,t)=>Math.abs(e.playout.start-r[t].playout.start)>.005||Math.abs(e.playout.end-r[t].playout.end)>.005))&&(this.items=i,this.onScheduleUpdate(t,r))}}parseDateRanges(e,t,s){const n=[],r=Object.keys(e);for(let i=0;i<r.length;i++){const a=r[i],o=e[a];if(o.isInterstitial){let e=this.eventMap[a];e?e.setDateRange(o):(e=new uf(o,t),this.eventMap[a]=e,!1===s&&(e.appendInPlace=s)),n.push(e)}}return n}parseSchedule(e,t){const s=[],n=t.main.details,r=n.live?1/0:n.edge;let i=0;if((e=e.filter(e=>!e.error&&!(e.cue.once&&e.hasPlayed))).length){this.resolveOffsets(e,t);let n=0,o=0;if(e.forEach((t,a)=>{const l=t.cue.pre,c=t.cue.post,d=e[a-1]||null,u=t.appendInPlace,h=c?r:t.startOffset,f=t.duration,m=t.timelineOccupancy===cf.Range?f:0,p=t.resumptionOffset,g=(null==d?void 0:d.startTime)===h,v=h+t.cumulativeDuration;let y=u?v+f:h+p;if(l||!c&&h<=0){const e=o;o+=m,t.timelineStart=v;const n=i;i+=f,s.push({event:t,start:v,end:y,playout:{start:n,end:i},integrated:{start:e,end:o}})}else{if(!(h<=r))return;{if(!g){const r=h-n;if(r>.033){const l=n,c=o;o+=r;const d=i;i+=r;const u={previousEvent:e[a-1]||null,nextEvent:t,start:l,end:l+r,playout:{start:d,end:i},integrated:{start:c,end:o}};s.push(u)}else r>0&&d&&(d.cumulativeDuration+=r,s[s.length-1].end=h)}c&&(y=v),t.timelineStart=v;const r=o;o+=m;const l=i;i+=f,s.push({event:t,start:v,end:y,playout:{start:l,end:i},integrated:{start:r,end:o}})}}const b=t.resumeTime;n=c||b>r?r:b}),n<r){var a;const e=n,t=o,l=r-n;o+=l;const c=i;i+=l,s.push({previousEvent:(null==(a=s[s.length-1])?void 0:a.event)||null,nextEvent:null,start:n,end:e+l,playout:{start:c,end:i},integrated:{start:t,end:o}})}this.setDurations(r,i,o)}else{const e=0;s.push({previousEvent:null,nextEvent:null,start:e,end:r,playout:{start:e,end:r},integrated:{start:e,end:r}}),this.setDurations(r,r,r)}return s}setDurations(e,t,s){this.durations={primary:e,playout:t,integrated:s}}resolveOffsets(e,t){const s=t.main.details,n=s.live?1/0:s.edge;let r=0,i=-1;e.forEach((a,o)=>{const l=a.cue.pre,c=a.cue.post,d=l?0:c?n:a.startTime;this.updateAssetDurations(a);if(i===d?a.cumulativeDuration=r:(r=0,i=d),!c&&a.snapOptions.in&&(a.resumeAnchor=Ko(null,s.fragments,a.startOffset+a.resumptionOffset,0,0)||void 0),a.appendInPlace&&!a.appendInPlaceStarted){this.primaryCanResumeInPlaceAt(a,t)||(a.appendInPlace=!1)}if(!a.appendInPlace&&o+1<e.length){e[o+1].startTime-e[o].resumeTime<.033&&(e[o+1].appendInPlace=!1,e[o+1].appendInPlace&&this.warn("Could not change append strategy for abutting event ".concat(a)))}const u=Ui(a.resumeOffset)?a.resumeOffset:a.duration;r+=u})}primaryCanResumeInPlaceAt(e,t){const s=e.resumeTime,n=e.startTime+e.resumptionOffset;if(Math.abs(s-n)>lf)return this.log('"'.concat(e.identifier,'" resumption ').concat(s," not aligned with estimated timeline end ").concat(n)),!1;return!Object.keys(t).some(n=>{const r=t[n].details,i=r.edge;if(s>=i)return this.log('"'.concat(e.identifier,'" resumption ').concat(s," past ").concat(n," playlist end ").concat(i)),!1;const a=Ko(null,r.fragments,s);if(!a)return this.log('"'.concat(e.identifier,'" resumption ').concat(s," does not align with any fragments in ").concat(n," playlist (").concat(r.fragStart,"-").concat(r.fragmentEnd,")")),!0;const o="audio"===n?.175:0;return!(Math.abs(a.start-s)<lf+o||Math.abs(a.end-s)<lf+o)&&(this.log('"'.concat(e.identifier,'" resumption ').concat(s," not aligned with ").concat(n," fragment bounds (").concat(a.start,"-").concat(a.end," sn: ").concat(a.sn," cc: ").concat(a.cc,")")),!0)})}updateAssetDurations(e){if(!e.assetListLoaded)return;const t=e.timelineStart;let s=0,n=!1,r=!1;for(let i=0;i<e.assetList.length;i++){const a=e.assetList[i],o=t+s;a.startOffset=s,a.timelineStart=o,n||(n=null===a.duration),r||(r=!!a.error);s+=a.error?0:a.duration||0}e.duration=n&&!r?Math.max(s,e.duration):s}removeEvent(e){e.reset(),delete this.eventMap[e.identifier]}}function yf(e){return"[".concat(e.event?'"'+e.event.identifier+'"':"primary",": ").concat(e.start.toFixed(2),"-").concat(e.end.toFixed(2),"]")}class bf{constructor(e){this.hls=void 0,this.hls=e}destroy(){this.hls=null}loadAssetList(e,t){const s=e.assetListUrl;let n;try{n=ff(s,this.hls.sessionId,e.baseUrl)}catch(d){const t=this.assignAssetListError(e,zi.ASSET_LIST_LOAD_ERROR,d,s);return void this.hls.trigger(Hi.ERROR,t)}t&&"data:"!==n.protocol&&n.searchParams.set("_HLS_start_offset",""+t);const r=this.hls.config,i=new(0,r.loader)(r),a={responseType:"json",url:n.href},o=r.interstitialAssetListLoadPolicy.default,l={loadPolicy:o,timeout:o.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},c={onSuccess:(t,s,n,r)=>{const i=t.data,a=null==i?void 0:i.ASSETS;if(!Array.isArray(a)){const t=this.assignAssetListError(e,zi.ASSET_LIST_PARSING_ERROR,new Error("Invalid interstitial asset list"),n.url,s,r);return void this.hls.trigger(Hi.ERROR,t)}e.assetListResponse=i,this.hls.trigger(Hi.ASSET_LIST_LOADED,{event:e,assetListResponse:i,networkDetails:r})},onError:(t,s,n,r)=>{const i=this.assignAssetListError(e,zi.ASSET_LIST_LOAD_ERROR,new Error("Error loading X-ASSET-LIST: HTTP status ".concat(t.code," ").concat(t.text," (").concat(s.url,")")),s.url,r,n);this.hls.trigger(Hi.ERROR,i)},onTimeout:(t,s,n)=>{const r=this.assignAssetListError(e,zi.ASSET_LIST_LOAD_TIMEOUT,new Error("Timeout loading X-ASSET-LIST (".concat(s.url,")")),s.url,t,n);this.hls.trigger(Hi.ERROR,r)}};return i.load(a,l,c),this.hls.trigger(Hi.ASSET_LIST_LOADING,{event:e}),i}assignAssetListError(e,t,s,n,r,i){return e.error=s,{type:Vi.NETWORK_ERROR,details:t,fatal:!1,interstitial:e,url:n,error:s,networkDetails:i,stats:r}}}function xf(e){var t;null==e||null==(t=e.play())||t.catch(()=>{})}function Ef(e,t){return"[".concat(e,"] Advancing timeline position to ").concat(t)}class Sf{constructor(e){this.buffered=void 0;const t=(t,s,n)=>{if((s>>>=0)>n-1)throw new DOMException("Failed to execute '".concat(t,"' on 'TimeRanges': The index provided (").concat(s,") is greater than the maximum bound (").concat(n,")"));return e[s][t]};this.buffered={get length(){return e.length},end:s=>t("end",s,e.length),start:s=>t("start",s,e.length)}}}const Tf={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,128:174,129:176,130:189,131:191,132:8482,133:162,134:163,135:9834,136:224,137:32,138:232,139:226,140:234,141:238,142:244,143:251,144:193,145:201,146:211,147:218,148:220,149:252,150:8216,151:161,152:42,153:8217,154:9473,155:169,156:8480,157:8226,158:8220,159:8221,160:192,161:194,162:199,163:200,164:202,165:203,166:235,167:206,168:207,169:239,170:212,171:217,172:249,173:219,174:171,175:187,176:195,177:227,178:205,179:204,180:236,181:210,182:242,183:213,184:245,185:123,186:125,187:92,188:94,189:95,190:124,191:8764,192:196,193:228,194:214,195:246,196:223,197:165,198:164,199:9475,200:197,201:229,202:216,203:248,204:9487,205:9491,206:9495,207:9499},kf=e=>String.fromCharCode(Tf[e]||e),wf=15,Lf=100,Cf={17:1,18:3,21:5,22:7,23:9,16:11,19:12,20:14},Af={17:2,18:4,21:6,22:8,23:10,19:13,20:15},Rf={25:1,26:3,29:5,30:7,31:9,24:11,27:12,28:14},_f={25:2,26:4,29:6,30:8,31:10,27:13,28:15},Nf=["white","green","blue","cyan","red","yellow","magenta","black","transparent"];class If{constructor(){this.time=null,this.verboseLevel=0}log(e,t){if(this.verboseLevel>=e){const s="function"===typeof t?t():t;da.log("".concat(this.time," [").concat(e,"] ").concat(s))}}}const jf=function(e){const t=[];for(let s=0;s<e.length;s++)t.push(e[s].toString(16));return t};class Pf{constructor(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1}reset(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1}setStyles(e){const t=["foreground","underline","italics","background","flash"];for(let s=0;s<t.length;s++){const n=t[s];e.hasOwnProperty(n)&&(this[n]=e[n])}}isDefault(){return"white"===this.foreground&&!this.underline&&!this.italics&&"black"===this.background&&!this.flash}equals(e){return this.foreground===e.foreground&&this.underline===e.underline&&this.italics===e.italics&&this.background===e.background&&this.flash===e.flash}copy(e){this.foreground=e.foreground,this.underline=e.underline,this.italics=e.italics,this.background=e.background,this.flash=e.flash}toString(){return"color="+this.foreground+", underline="+this.underline+", italics="+this.italics+", background="+this.background+", flash="+this.flash}}class Df{constructor(){this.uchar=" ",this.penState=new Pf}reset(){this.uchar=" ",this.penState.reset()}setChar(e,t){this.uchar=e,this.penState.copy(t)}setPenState(e){this.penState.copy(e)}equals(e){return this.uchar===e.uchar&&this.penState.equals(e.penState)}copy(e){this.uchar=e.uchar,this.penState.copy(e.penState)}isEmpty(){return" "===this.uchar&&this.penState.isDefault()}}class Mf{constructor(e){this.chars=[],this.pos=0,this.currPenState=new Pf,this.cueStartTime=null,this.logger=void 0;for(let t=0;t<Lf;t++)this.chars.push(new Df);this.logger=e}equals(e){for(let t=0;t<Lf;t++)if(!this.chars[t].equals(e.chars[t]))return!1;return!0}copy(e){for(let t=0;t<Lf;t++)this.chars[t].copy(e.chars[t])}isEmpty(){let e=!0;for(let t=0;t<Lf;t++)if(!this.chars[t].isEmpty()){e=!1;break}return e}setCursor(e){this.pos!==e&&(this.pos=e),this.pos<0?(this.logger.log(3,"Negative cursor position "+this.pos),this.pos=0):this.pos>Lf&&(this.logger.log(3,"Too large cursor position "+this.pos),this.pos=Lf)}moveCursor(e){const t=this.pos+e;if(e>1)for(let s=this.pos+1;s<t+1;s++)this.chars[s].setPenState(this.currPenState);this.setCursor(t)}backSpace(){this.moveCursor(-1),this.chars[this.pos].setChar(" ",this.currPenState)}insertChar(e){e>=144&&this.backSpace();const t=kf(e);this.pos>=Lf?this.logger.log(0,()=>"Cannot insert "+e.toString(16)+" ("+t+") at position "+this.pos+". Skipping it!"):(this.chars[this.pos].setChar(t,this.currPenState),this.moveCursor(1))}clearFromPos(e){let t;for(t=e;t<Lf;t++)this.chars[t].reset()}clear(){this.clearFromPos(0),this.pos=0,this.currPenState.reset()}clearToEndOfRow(){this.clearFromPos(this.pos)}getTextString(){const e=[];let t=!0;for(let s=0;s<Lf;s++){const n=this.chars[s].uchar;" "!==n&&(t=!1),e.push(n)}return t?"":e.join("")}setPenStyles(e){this.currPenState.setStyles(e);this.chars[this.pos].setPenState(this.currPenState)}}class Of{constructor(e){this.rows=[],this.currRow=14,this.nrRollUpRows=null,this.lastOutputScreen=null,this.logger=void 0;for(let t=0;t<wf;t++)this.rows.push(new Mf(e));this.logger=e}reset(){for(let e=0;e<wf;e++)this.rows[e].clear();this.currRow=14}equals(e){let t=!0;for(let s=0;s<wf;s++)if(!this.rows[s].equals(e.rows[s])){t=!1;break}return t}copy(e){for(let t=0;t<wf;t++)this.rows[t].copy(e.rows[t])}isEmpty(){let e=!0;for(let t=0;t<wf;t++)if(!this.rows[t].isEmpty()){e=!1;break}return e}backSpace(){this.rows[this.currRow].backSpace()}clearToEndOfRow(){this.rows[this.currRow].clearToEndOfRow()}insertChar(e){this.rows[this.currRow].insertChar(e)}setPen(e){this.rows[this.currRow].setPenStyles(e)}moveCursor(e){this.rows[this.currRow].moveCursor(e)}setCursor(e){this.logger.log(2,"setCursor: "+e);this.rows[this.currRow].setCursor(e)}setPAC(e){this.logger.log(2,()=>"pacData = "+Do(e));let t=e.row-1;if(this.nrRollUpRows&&t<this.nrRollUpRows-1&&(t=this.nrRollUpRows-1),this.nrRollUpRows&&this.currRow!==t){for(let t=0;t<wf;t++)this.rows[t].clear();const e=this.currRow+1-this.nrRollUpRows,s=this.lastOutputScreen;if(s){const n=s.rows[e].cueStartTime,r=this.logger.time;if(null!==n&&null!==r&&n<r)for(let i=0;i<this.nrRollUpRows;i++)this.rows[t-this.nrRollUpRows+i+1].copy(s.rows[e+i])}}this.currRow=t;const s=this.rows[this.currRow];if(null!==e.indent){const t=e.indent,n=Math.max(t-1,0);s.setCursor(e.indent),e.color=s.chars[n].penState.foreground}const n={foreground:e.color,underline:e.underline,italics:e.italics,background:"black",flash:!1};this.setPen(n)}setBkgData(e){this.logger.log(2,()=>"bkgData = "+Do(e)),this.backSpace(),this.setPen(e),this.insertChar(32)}setRollUpRows(e){this.nrRollUpRows=e}rollUp(){if(null===this.nrRollUpRows)return void this.logger.log(3,"roll_up but nrRollUpRows not set yet");this.logger.log(1,()=>this.getDisplayText());const e=this.currRow+1-this.nrRollUpRows,t=this.rows.splice(e,1)[0];t.clear(),this.rows.splice(this.currRow,0,t),this.logger.log(2,"Rolling up")}getDisplayText(e){e=e||!1;const t=[];let s="",n=-1;for(let r=0;r<wf;r++){const s=this.rows[r].getTextString();s&&(n=r+1,e?t.push("Row "+n+": '"+s+"'"):t.push(s.trim()))}return t.length>0&&(s=e?"["+t.join(" | ")+"]":t.join("\n")),s}getTextAndFormat(){return this.rows}}class Ff{constructor(e,t,s){this.chNr=void 0,this.outputFilter=void 0,this.mode=void 0,this.verbose=void 0,this.displayedMemory=void 0,this.nonDisplayedMemory=void 0,this.lastOutputScreen=void 0,this.currRollUpRow=void 0,this.writeScreen=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chNr=e,this.outputFilter=t,this.mode=null,this.verbose=0,this.displayedMemory=new Of(s),this.nonDisplayedMemory=new Of(s),this.lastOutputScreen=new Of(s),this.currRollUpRow=this.displayedMemory.rows[14],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null,this.logger=s}reset(){this.mode=null,this.displayedMemory.reset(),this.nonDisplayedMemory.reset(),this.lastOutputScreen.reset(),this.outputFilter.reset(),this.currRollUpRow=this.displayedMemory.rows[14],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null}getHandler(){return this.outputFilter}setHandler(e){this.outputFilter=e}setPAC(e){this.writeScreen.setPAC(e)}setBkgData(e){this.writeScreen.setBkgData(e)}setMode(e){e!==this.mode&&(this.mode=e,this.logger.log(2,()=>"MODE="+e),"MODE_POP-ON"===this.mode?this.writeScreen=this.nonDisplayedMemory:(this.writeScreen=this.displayedMemory,this.writeScreen.reset()),"MODE_ROLL-UP"!==this.mode&&(this.displayedMemory.nrRollUpRows=null,this.nonDisplayedMemory.nrRollUpRows=null),this.mode=e)}insertChars(e){for(let s=0;s<e.length;s++)this.writeScreen.insertChar(e[s]);const t=this.writeScreen===this.displayedMemory?"DISP":"NON_DISP";this.logger.log(2,()=>t+": "+this.writeScreen.getDisplayText(!0)),"MODE_PAINT-ON"!==this.mode&&"MODE_ROLL-UP"!==this.mode||(this.logger.log(1,()=>"DISPLAYED: "+this.displayedMemory.getDisplayText(!0)),this.outputDataUpdate())}ccRCL(){this.logger.log(2,"RCL - Resume Caption Loading"),this.setMode("MODE_POP-ON")}ccBS(){this.logger.log(2,"BS - BackSpace"),"MODE_TEXT"!==this.mode&&(this.writeScreen.backSpace(),this.writeScreen===this.displayedMemory&&this.outputDataUpdate())}ccAOF(){}ccAON(){}ccDER(){this.logger.log(2,"DER- Delete to End of Row"),this.writeScreen.clearToEndOfRow(),this.outputDataUpdate()}ccRU(e){this.logger.log(2,"RU("+e+") - Roll Up"),this.writeScreen=this.displayedMemory,this.setMode("MODE_ROLL-UP"),this.writeScreen.setRollUpRows(e)}ccFON(){this.logger.log(2,"FON - Flash On"),this.writeScreen.setPen({flash:!0})}ccRDC(){this.logger.log(2,"RDC - Resume Direct Captioning"),this.setMode("MODE_PAINT-ON")}ccTR(){this.logger.log(2,"TR"),this.setMode("MODE_TEXT")}ccRTD(){this.logger.log(2,"RTD"),this.setMode("MODE_TEXT")}ccEDM(){this.logger.log(2,"EDM - Erase Displayed Memory"),this.displayedMemory.reset(),this.outputDataUpdate(!0)}ccCR(){this.logger.log(2,"CR - Carriage Return"),this.writeScreen.rollUp(),this.outputDataUpdate(!0)}ccENM(){this.logger.log(2,"ENM - Erase Non-displayed Memory"),this.nonDisplayedMemory.reset()}ccEOC(){if(this.logger.log(2,"EOC - End Of Caption"),"MODE_POP-ON"===this.mode){const e=this.displayedMemory;this.displayedMemory=this.nonDisplayedMemory,this.nonDisplayedMemory=e,this.writeScreen=this.nonDisplayedMemory,this.logger.log(1,()=>"DISP: "+this.displayedMemory.getDisplayText())}this.outputDataUpdate(!0)}ccTO(e){this.logger.log(2,"TO("+e+") - Tab Offset"),this.writeScreen.moveCursor(e)}ccMIDROW(e){const t={flash:!1};if(t.underline=e%2===1,t.italics=e>=46,t.italics)t.foreground="white";else{const s=Math.floor(e/2)-16,n=["white","green","blue","cyan","red","yellow","magenta"];t.foreground=n[s]}this.logger.log(2,"MIDROW: "+Do(t)),this.writeScreen.setPen(t)}outputDataUpdate(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const t=this.logger.time;null!==t&&this.outputFilter&&(null!==this.cueStartTime||this.displayedMemory.isEmpty()?this.displayedMemory.equals(this.lastOutputScreen)||(this.outputFilter.newCue(this.cueStartTime,t,this.lastOutputScreen),e&&this.outputFilter.dispatchCue&&this.outputFilter.dispatchCue(),this.cueStartTime=this.displayedMemory.isEmpty()?null:t):this.cueStartTime=t,this.lastOutputScreen.copy(this.displayedMemory))}cueSplitAtTime(e){this.outputFilter&&(this.displayedMemory.isEmpty()||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,e,this.displayedMemory),this.cueStartTime=e))}}class Uf{constructor(e,t,s){this.channels=void 0,this.currentChannel=0,this.cmdHistory={a:null,b:null},this.logger=void 0;const n=this.logger=new If;this.channels=[null,new Ff(e,t,n),new Ff(e+1,s,n)]}getHandler(e){return this.channels[e].getHandler()}setHandler(e,t){this.channels[e].setHandler(t)}addData(e,t){this.logger.time=e;for(let s=0;s<t.length;s+=2){const e=127&t[s],n=127&t[s+1];let r=!1,i=null;if(0===e&&0===n)continue;this.logger.log(3,()=>"["+jf([t[s],t[s+1]])+"] -> ("+jf([e,n])+")");const a=this.cmdHistory;if(e>=16&&e<=31){if(Gf(e,n,a)){Bf(null,null,a),this.logger.log(3,()=>"Repeated command ("+jf([e,n])+") is dropped");continue}Bf(e,n,this.cmdHistory),r=this.parseCmd(e,n),r||(r=this.parseMidrow(e,n)),r||(r=this.parsePAC(e,n)),r||(r=this.parseBackgroundAttributes(e,n))}else Bf(null,null,a);if(!r&&(i=this.parseChars(e,n),i)){const e=this.currentChannel;if(e&&e>0){this.channels[e].insertChars(i)}else this.logger.log(2,"No channel found yet. TEXT-MODE?")}r||i||this.logger.log(2,()=>"Couldn't parse cleaned data "+jf([e,n])+" orig: "+jf([t[s],t[s+1]]))}}parseCmd(e,t){if(!((20===e||28===e||21===e||29===e)&&t>=32&&t<=47)&&!((23===e||31===e)&&t>=33&&t<=35))return!1;const s=20===e||21===e||23===e?1:2,n=this.channels[s];return 20===e||21===e||28===e||29===e?32===t?n.ccRCL():33===t?n.ccBS():34===t?n.ccAOF():35===t?n.ccAON():36===t?n.ccDER():37===t?n.ccRU(2):38===t?n.ccRU(3):39===t?n.ccRU(4):40===t?n.ccFON():41===t?n.ccRDC():42===t?n.ccTR():43===t?n.ccRTD():44===t?n.ccEDM():45===t?n.ccCR():46===t?n.ccENM():47===t&&n.ccEOC():n.ccTO(t-32),this.currentChannel=s,!0}parseMidrow(e,t){let s=0;if((17===e||25===e)&&t>=32&&t<=47){if(s=17===e?1:2,s!==this.currentChannel)return this.logger.log(0,"Mismatch channel in midrow parsing"),!1;const n=this.channels[s];return!!n&&(n.ccMIDROW(t),this.logger.log(3,()=>"MIDROW ("+jf([e,t])+")"),!0)}return!1}parsePAC(e,t){let s;if(!((e>=17&&e<=23||e>=25&&e<=31)&&t>=64&&t<=127)&&!((16===e||24===e)&&t>=64&&t<=95))return!1;const n=e<=23?1:2;s=t>=64&&t<=95?1===n?Cf[e]:Rf[e]:1===n?Af[e]:_f[e];const r=this.channels[n];return!!r&&(r.setPAC(this.interpretPAC(s,t)),this.currentChannel=n,!0)}interpretPAC(e,t){let s;const n={color:null,italics:!1,indent:null,underline:!1,row:e};return s=t>95?t-96:t-64,n.underline=1===(1&s),s<=13?n.color=["white","green","blue","cyan","red","yellow","magenta","white"][Math.floor(s/2)]:s<=15?(n.italics=!0,n.color="white"):n.indent=4*Math.floor((s-16)/2),n}parseChars(e,t){let s,n=null,r=null;if(e>=25?(s=2,r=e-8):(s=1,r=e),r>=17&&r<=19){let e;e=17===r?t+80:18===r?t+112:t+144,this.logger.log(2,()=>"Special char '"+kf(e)+"' in channel "+s),n=[e]}else e>=32&&e<=127&&(n=0===t?[e]:[e,t]);return n&&this.logger.log(3,()=>"Char codes =  "+jf(n).join(",")),n}parseBackgroundAttributes(e,t){if(!((16===e||24===e)&&t>=32&&t<=47)&&!((23===e||31===e)&&t>=45&&t<=47))return!1;let s;const n={};16===e||24===e?(s=Math.floor((t-32)/2),n.background=Nf[s],t%2===1&&(n.background=n.background+"_semi")):45===t?n.background="transparent":(n.foreground="black",47===t&&(n.underline=!0));const r=e<=23?1:2;return this.channels[r].setBkgData(n),!0}reset(){for(let e=0;e<Object.keys(this.channels).length;e++){const t=this.channels[e];t&&t.reset()}Bf(null,null,this.cmdHistory)}cueSplitAtTime(e){for(let t=0;t<this.channels.length;t++){const s=this.channels[t];s&&s.cueSplitAtTime(e)}}}function Bf(e,t,s){s.a=e,s.b=t}function Gf(e,t,s){return s.a===e&&s.b===t}var Vf=function(){if(null!=tc&&tc.VTTCue)return self.VTTCue;const e=["","lr","rl"],t=["start","middle","end","left","right"];function s(e,t){if("string"!==typeof t)return!1;if(!Array.isArray(e))return!1;const s=t.toLowerCase();return!!~e.indexOf(s)&&s}function n(e){return s(t,e)}function r(e){for(var t=arguments.length,s=new Array(t>1?t-1:0),n=1;n<t;n++)s[n-1]=arguments[n];let r=1;for(;r<arguments.length;r++){const t=arguments[r];for(const s in t)e[s]=t[s]}return e}function i(t,i,a){const o=this,l={enumerable:!0};o.hasBeenReset=!1;let c="",d=!1,u=t,h=i,f=a,m=null,p="",g=!0,v="auto",y="start",b=50,x="middle",E=50,S="middle";Object.defineProperty(o,"id",r({},l,{get:function(){return c},set:function(e){c=""+e}})),Object.defineProperty(o,"pauseOnExit",r({},l,{get:function(){return d},set:function(e){d=!!e}})),Object.defineProperty(o,"startTime",r({},l,{get:function(){return u},set:function(e){if("number"!==typeof e)throw new TypeError("Start time must be set to a number.");u=e,this.hasBeenReset=!0}})),Object.defineProperty(o,"endTime",r({},l,{get:function(){return h},set:function(e){if("number"!==typeof e)throw new TypeError("End time must be set to a number.");h=e,this.hasBeenReset=!0}})),Object.defineProperty(o,"text",r({},l,{get:function(){return f},set:function(e){f=""+e,this.hasBeenReset=!0}})),Object.defineProperty(o,"region",r({},l,{get:function(){return m},set:function(e){m=e,this.hasBeenReset=!0}})),Object.defineProperty(o,"vertical",r({},l,{get:function(){return p},set:function(t){const n=function(t){return s(e,t)}(t);if(!1===n)throw new SyntaxError("An invalid or illegal string was specified.");p=n,this.hasBeenReset=!0}})),Object.defineProperty(o,"snapToLines",r({},l,{get:function(){return g},set:function(e){g=!!e,this.hasBeenReset=!0}})),Object.defineProperty(o,"line",r({},l,{get:function(){return v},set:function(e){if("number"!==typeof e&&"auto"!==e)throw new SyntaxError("An invalid number or illegal string was specified.");v=e,this.hasBeenReset=!0}})),Object.defineProperty(o,"lineAlign",r({},l,{get:function(){return y},set:function(e){const t=n(e);if(!t)throw new SyntaxError("An invalid or illegal string was specified.");y=t,this.hasBeenReset=!0}})),Object.defineProperty(o,"position",r({},l,{get:function(){return b},set:function(e){if(e<0||e>100)throw new Error("Position must be between 0 and 100.");b=e,this.hasBeenReset=!0}})),Object.defineProperty(o,"positionAlign",r({},l,{get:function(){return x},set:function(e){const t=n(e);if(!t)throw new SyntaxError("An invalid or illegal string was specified.");x=t,this.hasBeenReset=!0}})),Object.defineProperty(o,"size",r({},l,{get:function(){return E},set:function(e){if(e<0||e>100)throw new Error("Size must be between 0 and 100.");E=e,this.hasBeenReset=!0}})),Object.defineProperty(o,"align",r({},l,{get:function(){return S},set:function(e){const t=n(e);if(!t)throw new SyntaxError("An invalid or illegal string was specified.");S=t,this.hasBeenReset=!0}})),o.displayState=void 0}return i.prototype.getCueAsHTML=function(){return self.WebVTT.convertCueToDOMTree(self,this.text)},i}();class zf{decode(e,t){if(!e)return"";if("string"!==typeof e)throw new Error("Error - expected string data.");return decodeURIComponent(encodeURIComponent(e))}}function Hf(e){function t(e,t,s,n){return 3600*(0|e)+60*(0|t)+(0|s)+parseFloat(n||0)}const s=e.match(/^(?:(\d+):)?(\d{2}):(\d{2})(\.\d+)?/);return s?parseFloat(s[2])>59?t(s[2],s[3],0,s[4]):t(s[1],s[2],s[3],s[4]):null}class Kf{constructor(){this.values=Object.create(null)}set(e,t){this.get(e)||""===t||(this.values[e]=t)}get(e,t,s){return s?this.has(e)?this.values[e]:t[s]:this.has(e)?this.values[e]:t}has(e){return e in this.values}alt(e,t,s){for(let n=0;n<s.length;++n)if(t===s[n]){this.set(e,t);break}}integer(e,t){/^-?\d+$/.test(t)&&this.set(e,parseInt(t,10))}percent(e,t){if(/^([\d]{1,3})(\.[\d]*)?%$/.test(t)){const s=parseFloat(t);if(s>=0&&s<=100)return this.set(e,s),!0}return!1}}function Wf(e,t,s,n){const r=n?e.split(n):[e];for(const i in r){if("string"!==typeof r[i])continue;const e=r[i].split(s);if(2!==e.length)continue;t(e[0],e[1])}}const qf=new Vf(0,0,""),Yf="middle"===qf.align?"middle":"center";function Xf(e,t,s){const n=e;function r(){const t=Hf(e);if(null===t)throw new Error("Malformed timestamp: "+n);return e=e.replace(/^[^\sa-zA-Z-]+/,""),t}function i(){e=e.replace(/^\s+/,"")}if(i(),t.startTime=r(),i(),"--\x3e"!==e.slice(0,3))throw new Error("Malformed time stamp (time stamps must be separated by '--\x3e'): "+n);e=e.slice(3),i(),t.endTime=r(),i(),function(e,t){const n=new Kf;Wf(e,function(e,t){let r;switch(e){case"region":for(let r=s.length-1;r>=0;r--)if(s[r].id===t){n.set(e,s[r].region);break}break;case"vertical":n.alt(e,t,["rl","lr"]);break;case"line":r=t.split(","),n.integer(e,r[0]),n.percent(e,r[0])&&n.set("snapToLines",!1),n.alt(e,r[0],["auto"]),2===r.length&&n.alt("lineAlign",r[1],["start",Yf,"end"]);break;case"position":r=t.split(","),n.percent(e,r[0]),2===r.length&&n.alt("positionAlign",r[1],["start",Yf,"end","line-left","line-right","auto"]);break;case"size":n.percent(e,t);break;case"align":n.alt(e,t,["start",Yf,"end","left","right"])}},/:/,/\s/),t.region=n.get("region",null),t.vertical=n.get("vertical","");let r=n.get("line","auto");"auto"===r&&-1===qf.line&&(r=-1),t.line=r,t.lineAlign=n.get("lineAlign","start"),t.snapToLines=n.get("snapToLines",!0),t.size=n.get("size",100),t.align=n.get("align",Yf);let i=n.get("position","auto");"auto"===i&&50===qf.position&&(i="start"===t.align||"left"===t.align?0:"end"===t.align||"right"===t.align?100:50),t.position=i}(e,t)}function Qf(e){return e.replace(/<br(?: \/)?>/gi,"\n")}class $f{constructor(){this.state="INITIAL",this.buffer="",this.decoder=new zf,this.regionList=[],this.cue=null,this.oncue=void 0,this.onparsingerror=void 0,this.onflush=void 0}parse(e){const t=this;function s(){let e=t.buffer,s=0;for(e=Qf(e);s<e.length&&"\r"!==e[s]&&"\n"!==e[s];)++s;const n=e.slice(0,s);return"\r"===e[s]&&++s,"\n"===e[s]&&++s,t.buffer=e.slice(s),n}function n(e){Wf(e,function(e,t){},/:/)}e&&(t.buffer+=t.decoder.decode(e,{stream:!0}));try{let e="";if("INITIAL"===t.state){if(!/\r\n|\n/.test(t.buffer))return this;e=s();const n=e.match(/^(\xef\xbb\xbf)?WEBVTT([ \t].*)?$/);if(null==n||!n[0])throw new Error("Malformed WebVTT signature.");t.state="HEADER"}let r=!1;for(;t.buffer;){if(!/\r\n|\n/.test(t.buffer))return this;switch(r?r=!1:e=s(),t.state){case"HEADER":/:/.test(e)?n(e):e||(t.state="ID");continue;case"NOTE":e||(t.state="ID");continue;case"ID":if(/^NOTE($|[ \t])/.test(e)){t.state="NOTE";break}if(!e)continue;if(t.cue=new Vf(0,0,""),t.state="CUE",-1===e.indexOf("--\x3e")){t.cue.id=e;continue}case"CUE":if(!t.cue){t.state="BADCUE";continue}try{Xf(e,t.cue,t.regionList)}catch(Np){t.cue=null,t.state="BADCUE";continue}t.state="CUETEXT";continue;case"CUETEXT":{const s=-1!==e.indexOf("--\x3e");if(!e||s&&(r=!0)){t.oncue&&t.cue&&t.oncue(t.cue),t.cue=null,t.state="ID";continue}if(null===t.cue)continue;t.cue.text&&(t.cue.text+="\n"),t.cue.text+=e}continue;case"BADCUE":e||(t.state="ID")}}}catch(Np){"CUETEXT"===t.state&&t.cue&&t.oncue&&t.oncue(t.cue),t.cue=null,t.state="INITIAL"===t.state?"BADWEBVTT":"BADCUE"}return this}flush(){const e=this;try{if((e.cue||"HEADER"===e.state)&&(e.buffer+="\n\n",e.parse()),"INITIAL"===e.state||"BADWEBVTT"===e.state)throw new Error("Malformed WebVTT signature.")}catch(Np){e.onparsingerror&&e.onparsingerror(Np)}return e.onflush&&e.onflush(),this}}const Jf=/\r\n|\n\r|\n|\r/g,Zf=function(e,t){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return e.slice(s,s+t.length)===t};function em(e,t,s){return of(e.toString())+of(t.toString())+of(s)}function tm(e,t,s,n,r,i,a){const o=new $f,l=fa(new Uint8Array(e)).trim().replace(Jf,"\n").split("\n"),c=[],d=t?function(e){return Tu(e,9e4,1/(arguments.length>1&&void 0!==arguments[1]?arguments[1]:1))}(t.baseTime,t.timescale):0;let u,h="00:00.000",f=0,m=0,p=!0;o.oncue=function(e){const i=s[n];let a=s.ccOffset;const o=(f-d)/9e4;if(null!=i&&i.new&&(void 0!==m?a=s.ccOffset=i.start:function(e,t,s){let n=e[t],r=e[n.prevCC];if(!r||!r.new&&n.new)return e.ccOffset=e.presentationOffset=n.start,void(n.new=!1);for(;null!=(i=r)&&i.new;){var i;e.ccOffset+=n.start-r.start,n.new=!1,n=r,r=e[n.prevCC]}e.presentationOffset=s}(s,n,o)),o){if(!t)return void(u=new Error("Missing initPTS for VTT MPEGTS"));a=o-s.presentationOffset}const l=e.endTime-e.startTime,h=Nu(9e4*(e.startTime+a-m),9e4*r)/9e4;e.startTime=Math.max(h,0),e.endTime=Math.max(h+l,0);const p=e.text.trim();e.text=decodeURIComponent(encodeURIComponent(p)),e.id||(e.id=em(e.startTime,e.endTime,p)),e.endTime>0&&c.push(e)},o.onparsingerror=function(e){u=e},o.onflush=function(){u?a(u):i(c)},l.forEach(e=>{if(p){if(Zf(e,"X-TIMESTAMP-MAP=")){p=!1,e.slice(16).split(",").forEach(e=>{Zf(e,"LOCAL:")?h=e.slice(6):Zf(e,"MPEGTS:")&&(f=parseInt(e.slice(7)))});try{m=function(e){let t=parseInt(e.slice(-3));const s=parseInt(e.slice(-6,-4)),n=parseInt(e.slice(-9,-7)),r=e.length>9?parseInt(e.substring(0,e.indexOf(":"))):0;if(!Ui(t)||!Ui(s)||!Ui(n)||!Ui(r))throw Error("Malformed X-TIMESTAMP-MAP: Local:".concat(e));return t+=1e3*s,t+=6e4*n,t+=36e5*r,t}(h)/1e3}catch(t){u=t}return}""===e&&(p=!1)}o.parse(e+"\n")}),o.flush()}const sm="stpp.ttml.im1t",nm=/^(\d{2,}):(\d{2}):(\d{2}):(\d{2})\.?(\d+)?$/,rm=/^(\d*(?:\.\d*)?)(h|m|s|ms|f|t)$/,im={left:"start",center:"center",right:"end",start:"start",end:"end"};function am(e,t,s,n){const r=Oa(new Uint8Array(e),["mdat"]);if(0===r.length)return void n(new Error("Could not parse IMSC1 mdat"));const i=r.map(e=>fa(e)),a=function(e,t){return Tu(e,t,1/(arguments.length>2&&void 0!==arguments[2]?arguments[2]:1),arguments.length>3&&void 0!==arguments[3]&&arguments[3])}(t.baseTime,1,t.timescale);try{i.forEach(e=>s(function(e,t){const s=(new DOMParser).parseFromString(e,"text/xml"),n=s.getElementsByTagName("tt")[0];if(!n)throw new Error("Invalid ttml");const r={frameRate:30,subFrameRate:1,frameRateMultiplier:0,tickRate:0},i=Object.keys(r).reduce((e,t)=>(e[t]=n.getAttribute("ttp:".concat(t))||r[t],e),{}),a="preserve"!==n.getAttribute("xml:space"),o=lm(om(n,"styling","style")),l=lm(om(n,"layout","region")),c=om(n,"body","[begin]");return[].map.call(c,e=>{const s=cm(e,a);if(!s||!e.hasAttribute("begin"))return null;const n=hm(e.getAttribute("begin"),i),r=hm(e.getAttribute("dur"),i);let c=hm(e.getAttribute("end"),i);if(null===n)throw um(e);if(null===c){if(null===r)throw um(e);c=n+r}const d=new Vf(n-t,c-t,s);d.id=em(d.startTime,d.endTime,d.text);const u=function(e,t,s){const n="http://www.w3.org/ns/ttml#styling";let r=null;const i=["displayAlign","textAlign","color","backgroundColor","fontSize","fontFamily"],a=null!=e&&e.hasAttribute("style")?e.getAttribute("style"):null;a&&s.hasOwnProperty(a)&&(r=s[a]);return i.reduce((s,i)=>{const a=dm(t,n,i)||dm(e,n,i)||dm(r,n,i);return a&&(s[i]=a),s},{})}(l[e.getAttribute("region")],o[e.getAttribute("style")],o),{textAlign:h}=u;if(h){const e=im[h];e&&(d.lineAlign=e),d.align=h}return ta(d,u),d}).filter(e=>null!==e)}(e,a)))}catch(o){n(o)}}function om(e,t,s){const n=e.getElementsByTagName(t)[0];return n?[].slice.call(n.querySelectorAll(s)):[]}function lm(e){return e.reduce((e,t)=>{const s=t.getAttribute("xml:id");return s&&(e[s]=t),e},{})}function cm(e,t){return[].slice.call(e.childNodes).reduce((e,s,n)=>{var r;return"br"===s.nodeName&&n?e+"\n":null!=(r=s.childNodes)&&r.length?cm(s,t):t?e+s.textContent.trim().replace(/\s+/g," "):e+s.textContent},"")}function dm(e,t,s){return e&&e.hasAttributeNS(t,s)?e.getAttributeNS(t,s):null}function um(e){return new Error("Could not parse ttml timestamp ".concat(e))}function hm(e,t){if(!e)return null;let s=Hf(e);return null===s&&(nm.test(e)?s=function(e,t){const s=nm.exec(e),n=(0|s[4])+(0|s[5])/t.subFrameRate;return 3600*(0|s[1])+60*(0|s[2])+(0|s[3])+n/t.frameRate}(e,t):rm.test(e)&&(s=function(e,t){const s=rm.exec(e),n=Number(s[1]);switch(s[2]){case"h":return 3600*n;case"m":return 60*n;case"ms":return 1e3*n;case"f":return n/t.frameRate;case"t":return n/t.tickRate}return n}(e,t))),s}class fm{constructor(e,t){this.timelineController=void 0,this.cueRanges=[],this.trackName=void 0,this.startTime=null,this.endTime=null,this.screen=null,this.timelineController=e,this.trackName=t}dispatchCue(){null!==this.startTime&&(this.timelineController.addCues(this.trackName,this.startTime,this.endTime,this.screen,this.cueRanges),this.startTime=null)}newCue(e,t,s){(null===this.startTime||this.startTime>e)&&(this.startTime=e),this.endTime=t,this.screen=s,this.timelineController.createCaptionsTrack(this.trackName)}reset(){this.cueRanges=[],this.startTime=null}}function mm(e){return e.characteristics&&/transcribes-spoken-dialog/gi.test(e.characteristics)&&/describes-music-and-sound/gi.test(e.characteristics)?"captions":"subtitles"}function pm(e,t){return!!e&&e.kind===mm(t)&&qu(t,e)}function gm(e,t,s,n){return Math.min(t,n)-Math.max(e,s)}const vm=/\s/,ym={newCue(e,t,s,n){const r=[];let i,a,o,l,c;const d=self.VTTCue||self.TextTrackCue;for(let h=0;h<n.rows.length;h++)if(i=n.rows[h],o=!0,l=0,c="",!i.isEmpty()){var u;for(let e=0;e<i.chars.length;e++)vm.test(i.chars[e].uchar)&&o?l++:(c+=i.chars[e].uchar,o=!1);i.cueStartTime=t,t===s&&(s+=1e-4),l>=16?l--:l++;const n=Qf(c.trim()),f=em(t,s,n);null!=e&&null!=(u=e.cues)&&u.getCueById(f)||(a=new d(t,s,n),a.id=f,a.line=h+1,a.align="left",a.position=10+Math.min(80,10*Math.floor(8*l/32)),r.push(a))}return e&&r.length&&(r.sort((e,t)=>"auto"===e.line||"auto"===t.line?0:e.line>8&&t.line>8?t.line-e.line:e.line-t.line),r.forEach(t=>sf(e,t))),r}};const bm=/(\d+)-(\d+)\/(\d+)/;class xm{constructor(e){this.fetchSetup=void 0,this.requestTimeout=void 0,this.request=null,this.response=null,this.controller=void 0,this.context=null,this.config=null,this.callbacks=null,this.stats=void 0,this.loader=null,this.fetchSetup=e.fetchSetup||Em,this.controller=new self.AbortController,this.stats=new xa}destroy(){this.loader=this.callbacks=this.context=this.config=this.request=null,this.abortInternal(),this.response=null,this.fetchSetup=this.controller=this.stats=null}abortInternal(){this.controller&&!this.stats.loading.end&&(this.stats.aborted=!0,this.controller.abort())}abort(){var e;this.abortInternal(),null!=(e=this.callbacks)&&e.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.response)}load(e,t,s){const n=this.stats;if(n.loading.start)throw new Error("Loader can only be used once.");n.loading.start=self.performance.now();const r=function(e,t){const s={method:"GET",mode:"cors",credentials:"same-origin",signal:t,headers:new self.Headers(ta({},e.headers))};e.rangeEnd&&s.headers.set("Range","bytes="+e.rangeStart+"-"+String(e.rangeEnd-1));return s}(e,this.controller.signal),i="arraybuffer"===e.responseType,a=i?"byteLength":"length",{maxTimeToFirstByteMs:o,maxLoadTimeMs:l}=t.loadPolicy;this.context=e,this.config=t,this.callbacks=s,this.request=this.fetchSetup(e,r),self.clearTimeout(this.requestTimeout),t.timeout=o&&Ui(o)?o:l,this.requestTimeout=self.setTimeout(()=>{this.callbacks&&(this.abortInternal(),this.callbacks.onTimeout(n,e,this.response))},t.timeout);(Uu(this.request)?this.request.then(self.fetch):self.fetch(this.request)).then(s=>{var r;this.response=this.loader=s;const a=Math.max(self.performance.now(),n.loading.start);if(self.clearTimeout(this.requestTimeout),t.timeout=l,this.requestTimeout=self.setTimeout(()=>{this.callbacks&&(this.abortInternal(),this.callbacks.onTimeout(n,e,this.response))},l-(a-n.loading.start)),!s.ok){const{status:e,statusText:t}=s;throw new Sm(t||"fetch, bad network response",e,s)}n.loading.first=a,n.total=function(e){const t=e.get("Content-Range");if(t){const e=function(e){const t=bm.exec(e);if(t)return parseInt(t[2])-parseInt(t[1])+1}(t);if(Ui(e))return e}const s=e.get("Content-Length");if(s)return parseInt(s)}(s.headers)||n.total;const o=null==(r=this.callbacks)?void 0:r.onProgress;return o&&Ui(t.highWaterMark)?this.loadProgressively(s,n,e,t.highWaterMark,o):i?s.arrayBuffer():"json"===e.responseType?s.json():s.text()}).then(s=>{var r,i;const o=this.response;if(!o)throw new Error("loader destroyed");self.clearTimeout(this.requestTimeout),n.loading.end=Math.max(self.performance.now(),n.loading.first);const l=s[a];l&&(n.loaded=n.total=l);const c={url:o.url,data:s,code:o.status},d=null==(r=this.callbacks)?void 0:r.onProgress;d&&!Ui(t.highWaterMark)&&d(n,e,s,o),null==(i=this.callbacks)||i.onSuccess(c,n,e,o)}).catch(t=>{var s;if(self.clearTimeout(this.requestTimeout),n.aborted)return;const r=t&&t.code||0,i=t?t.message:null;null==(s=this.callbacks)||s.onError({code:r,text:i},e,t?t.details:null,n)})}getCacheAge(){let e=null;if(this.response){const t=this.response.headers.get("age");e=t?parseFloat(t):null}return e}getResponseHeader(e){return this.response?this.response.headers.get(e):null}loadProgressively(e,t,s){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,r=arguments.length>4?arguments[4]:void 0;const i=new md,a=e.body.getReader(),o=()=>a.read().then(a=>{if(a.done)return i.dataLength&&r(t,s,i.flush().buffer,e),Promise.resolve(new ArrayBuffer(0));const l=a.value,c=l.length;return t.loaded+=c,c<n||i.dataLength?(i.push(l),i.dataLength>=n&&r(t,s,i.flush().buffer,e)):r(t,s,l.buffer,e),o()}).catch(()=>Promise.reject());return o()}}function Em(e,t){return new self.Request(e.url,t)}class Sm extends Error{constructor(e,t,s){super(e),this.code=void 0,this.details=void 0,this.code=t,this.details=s}}const Tm=/^age:\s*[\d.]+\s*$/im;class km{constructor(e){this.xhrSetup=void 0,this.requestTimeout=void 0,this.retryTimeout=void 0,this.retryDelay=void 0,this.config=null,this.callbacks=null,this.context=null,this.loader=null,this.stats=void 0,this.xhrSetup=e&&e.xhrSetup||null,this.stats=new xa,this.retryDelay=0}destroy(){this.callbacks=null,this.abortInternal(),this.loader=null,this.config=null,this.context=null,this.xhrSetup=null}abortInternal(){const e=this.loader;self.clearTimeout(this.requestTimeout),self.clearTimeout(this.retryTimeout),e&&(e.onreadystatechange=null,e.onprogress=null,4!==e.readyState&&(this.stats.aborted=!0,e.abort()))}abort(){var e;this.abortInternal(),null!=(e=this.callbacks)&&e.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.loader)}load(e,t,s){if(this.stats.loading.start)throw new Error("Loader can only be used once.");this.stats.loading.start=self.performance.now(),this.context=e,this.config=t,this.callbacks=s,this.loadInternal()}loadInternal(){const{config:e,context:t}=this;if(!e||!t)return;const s=this.loader=new self.XMLHttpRequest,n=this.stats;n.loading.first=0,n.loaded=0,n.aborted=!1;const r=this.xhrSetup;r?Promise.resolve().then(()=>{if(this.loader===s&&!this.stats.aborted)return r(s,t.url)}).catch(e=>{if(this.loader===s&&!this.stats.aborted)return s.open("GET",t.url,!0),r(s,t.url)}).then(()=>{this.loader!==s||this.stats.aborted||this.openAndSendXhr(s,t,e)}).catch(e=>{var r;null==(r=this.callbacks)||r.onError({code:s.status,text:e.message},t,s,n)}):this.openAndSendXhr(s,t,e)}openAndSendXhr(e,t,s){e.readyState||e.open("GET",t.url,!0);const n=t.headers,{maxTimeToFirstByteMs:r,maxLoadTimeMs:i}=s.loadPolicy;if(n)for(const a in n)e.setRequestHeader(a,n[a]);t.rangeEnd&&e.setRequestHeader("Range","bytes="+t.rangeStart+"-"+(t.rangeEnd-1)),e.onreadystatechange=this.readystatechange.bind(this),e.onprogress=this.loadprogress.bind(this),e.responseType=t.responseType,self.clearTimeout(this.requestTimeout),s.timeout=r&&Ui(r)?r:i,this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),s.timeout),e.send()}readystatechange(){const{context:e,loader:t,stats:s}=this;if(!e||!t)return;const n=t.readyState,r=this.config;if(!s.aborted&&n>=2&&(0===s.loading.first&&(s.loading.first=Math.max(self.performance.now(),s.loading.start),r.timeout!==r.loadPolicy.maxLoadTimeMs&&(self.clearTimeout(this.requestTimeout),r.timeout=r.loadPolicy.maxLoadTimeMs,this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),r.loadPolicy.maxLoadTimeMs-(s.loading.first-s.loading.start)))),4===n)){self.clearTimeout(this.requestTimeout),t.onreadystatechange=null,t.onprogress=null;const n=t.status,l="text"===t.responseType?t.responseText:null;if(n>=200&&n<300){const r=null!=l?l:t.response;if(null!=r){var i,a;s.loading.end=Math.max(self.performance.now(),s.loading.first);const o="arraybuffer"===t.responseType?r.byteLength:r.length;s.loaded=s.total=o,s.bwEstimate=8e3*s.total/(s.loading.end-s.loading.first);const l=null==(i=this.callbacks)?void 0:i.onProgress;l&&l(s,e,r,t);const c={url:t.responseURL,data:r,code:n};return void(null==(a=this.callbacks)||a.onSuccess(c,s,e,t))}}const c=r.loadPolicy.errorRetry;var o;if(tl(c,s.retry,!1,{url:e.url,data:void 0,code:n}))this.retry(c);else da.error("".concat(n," while loading ").concat(e.url)),null==(o=this.callbacks)||o.onError({code:n,text:t.statusText},e,t,s)}}loadtimeout(){if(!this.config)return;const e=this.config.loadPolicy.timeoutRetry;if(tl(e,this.stats.retry,!0))this.retry(e);else{var t;da.warn("timeout while loading ".concat(null==(t=this.context)?void 0:t.url));const e=this.callbacks;e&&(this.abortInternal(),e.onTimeout(this.stats,this.context,this.loader))}}retry(e){const{context:t,stats:s}=this;this.retryDelay=Zo(e,s.retry),s.retry++,da.warn("".concat(status?"HTTP Status "+status:"Timeout"," while loading ").concat(null==t?void 0:t.url,", retrying ").concat(s.retry,"/").concat(e.maxNumRetry," in ").concat(this.retryDelay,"ms")),this.abortInternal(),this.loader=null,self.clearTimeout(this.retryTimeout),this.retryTimeout=self.setTimeout(this.loadInternal.bind(this),this.retryDelay)}loadprogress(e){const t=this.stats;t.loaded=e.loaded,e.lengthComputable&&(t.total=e.total)}getCacheAge(){let e=null;if(this.loader&&Tm.test(this.loader.getAllResponseHeaders())){const t=this.loader.getResponseHeader("age");e=t?parseFloat(t):null}return e}getResponseHeader(e){return this.loader&&new RegExp("^".concat(e,":\\s*[\\d.]+\\s*$"),"im").test(this.loader.getAllResponseHeaders())?this.loader.getResponseHeader(e):null}}const wm=na(na({autoStartLoad:!0,startPosition:-1,defaultAudioCodec:void 0,debug:!1,capLevelOnFPSDrop:!1,capLevelToPlayerSize:!1,ignoreDevicePixelRatio:!1,maxDevicePixelRatio:Number.POSITIVE_INFINITY,preferManagedMediaSource:!0,initialLiveManifestSize:1,maxBufferLength:30,backBufferLength:1/0,frontBufferFlushThreshold:1/0,startOnSegmentBoundary:!1,maxBufferSize:6e7,maxFragLookUpTolerance:.25,maxBufferHole:.1,detectStallWithCurrentTimeMs:1250,highBufferWatchdogPeriod:2,nudgeOffset:.1,nudgeMaxRetry:3,nudgeOnVideoHole:!0,liveSyncMode:"edge",liveSyncDurationCount:3,liveSyncOnStallIncrease:1,liveMaxLatencyDurationCount:1/0,liveSyncDuration:void 0,liveMaxLatencyDuration:void 0,maxLiveSyncPlaybackRate:1,liveDurationInfinity:!1,liveBackBufferLength:null,maxMaxBufferLength:600,enableWorker:!0,workerPath:null,enableSoftwareAES:!0,startLevel:void 0,startFragPrefetch:!1,fpsDroppedMonitoringPeriod:5e3,fpsDroppedMonitoringThreshold:.2,appendErrorMaxRetry:3,ignorePlaylistParsingErrors:!1,loader:km,fLoader:void 0,pLoader:void 0,xhrSetup:void 0,licenseXhrSetup:void 0,licenseResponseCallback:void 0,abrController:class extends ra{constructor(e){super("abr",e.logger),this.hls=void 0,this.lastLevelLoadSec=0,this.lastLoadedFragLevel=-1,this.firstSelection=-1,this._nextAutoLevel=-1,this.nextAutoLevelKey="",this.audioTracksByGroup=null,this.codecTiers=null,this.timer=-1,this.fragCurrent=null,this.partCurrent=null,this.bitrateTestDelay=0,this.rebufferNotice=-1,this.supportedCache={},this.bwEstimator=void 0,this._abandonRulesCheck=e=>{var t;const{fragCurrent:s,partCurrent:n,hls:r}=this,{autoLevelEnabled:i,media:a}=r;if(!s||!a)return;const o=performance.now(),l=n?n.stats:s.stats,c=n?n.duration:s.duration,d=o-l.loading.start,u=r.minAutoLevel,h=s.level,f=this._nextAutoLevel;if(l.aborted||l.loaded&&l.loaded===l.total||h<=u)return this.clearTimer(),void(this._nextAutoLevel=-1);if(!i)return;const m=f>-1&&f!==h,p=!!e||m;if(!p&&(a.paused||!a.playbackRate||!a.readyState))return;const g=r.mainForwardBufferInfo;if(!p&&null===g)return;const v=this.bwEstimator.getEstimateTTFB(),y=Math.abs(a.playbackRate);if(d<=Math.max(v,c/(2*y)*1e3))return;const b=g?g.len/y:0,x=l.loading.first?l.loading.first-l.loading.start:-1,E=l.loaded&&x>-1,S=this.getBwEstimate(),T=r.levels,k=T[h],w=Math.max(l.loaded,Math.round(c*(s.bitrate||k.averageBitrate)/8));let L=E?d-x:d;L<1&&E&&(L=Math.min(d,8*l.loaded/S));const C=E?1e3*l.loaded/L:0,A=v/1e3,R=C?(w-l.loaded)/C:8*w/S+A;if(R<=b)return;const _=C?8*C:S,N=!0===(null==(t=(null==e?void 0:e.details)||this.hls.latestLevelDetails)?void 0:t.live),I=this.hls.config.abrBandWidthUpFactor;let j,P=Number.POSITIVE_INFINITY;for(j=h-1;j>u;j--){const e=T[j].maxBitrate,t=!T[j].details||N;if(P=this.getTimeToLoadFrag(A,_,c*e,t),P<Math.min(b,c+A))break}if(P>=R)return;if(P>10*c)return;E?this.bwEstimator.sample(d-Math.min(v,x),l.loaded):this.bwEstimator.sampleTTFB(d);const D=T[j].maxBitrate;this.getBwEstimate()*I>D&&this.resetEstimator(D);const M=this.findBestLevel(D,u,j,0,b,1,1);M>-1&&(j=M),this.warn("Fragment ".concat(s.sn).concat(n?" part "+n.index:""," of level ").concat(h," is loading too slowly;\n      Fragment duration: ").concat(s.duration.toFixed(3),"\n      Time to underbuffer: ").concat(b.toFixed(3)," s\n      Estimated load time for current fragment: ").concat(R.toFixed(3)," s\n      Estimated load time for down switch fragment: ").concat(P.toFixed(3)," s\n      TTFB estimate: ").concat(0|x," ms\n      Current BW estimate: ").concat(Ui(S)?0|S:"Unknown"," bps\n      New BW estimate: ").concat(0|this.getBwEstimate()," bps\n      Switching to level ").concat(j," @ ").concat(0|D," bps")),r.nextLoadLevel=r.nextAutoLevel=j,this.clearTimer();const O=()=>{if(this.clearTimer(),this.fragCurrent===s&&this.hls.loadLevel===j&&j>0){const e=this.getStarvationDelay();if(this.warn("Aborting inflight request ".concat(j>0?"and switching down":"","\n      Fragment duration: ").concat(s.duration.toFixed(3)," s\n      Time to underbuffer: ").concat(e.toFixed(3)," s")),s.abortRequests(),this.fragCurrent=this.partCurrent=null,j>u){let t=this.findBestLevel(this.hls.levels[u].bitrate,u,j,0,e,1,1);-1===t&&(t=u),this.hls.nextLoadLevel=this.hls.nextAutoLevel=t,this.resetEstimator(this.hls.levels[t].bitrate)}}};m||R>2*P?O():this.timer=self.setInterval(O,1e3*P),r.trigger(Hi.FRAG_LOAD_EMERGENCY_ABORTED,{frag:s,part:n,stats:l})},this.hls=e,this.bwEstimator=this.initEstimator(),this.registerListeners()}resetEstimator(e){e&&(this.log("setting initial bwe to ".concat(e)),this.hls.config.abrEwmaDefaultEstimate=e),this.firstSelection=-1,this.bwEstimator=this.initEstimator()}initEstimator(){const e=this.hls.config;return new Zi(e.abrEwmaSlowVoD,e.abrEwmaFastVoD,e.abrEwmaDefaultEstimate)}registerListeners(){const{hls:e}=this;e.on(Hi.MANIFEST_LOADING,this.onManifestLoading,this),e.on(Hi.FRAG_LOADING,this.onFragLoading,this),e.on(Hi.FRAG_LOADED,this.onFragLoaded,this),e.on(Hi.FRAG_BUFFERED,this.onFragBuffered,this),e.on(Hi.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(Hi.LEVEL_LOADED,this.onLevelLoaded,this),e.on(Hi.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(Hi.MAX_AUTO_LEVEL_UPDATED,this.onMaxAutoLevelUpdated,this),e.on(Hi.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e&&(e.off(Hi.MANIFEST_LOADING,this.onManifestLoading,this),e.off(Hi.FRAG_LOADING,this.onFragLoading,this),e.off(Hi.FRAG_LOADED,this.onFragLoaded,this),e.off(Hi.FRAG_BUFFERED,this.onFragBuffered,this),e.off(Hi.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(Hi.LEVEL_LOADED,this.onLevelLoaded,this),e.off(Hi.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(Hi.MAX_AUTO_LEVEL_UPDATED,this.onMaxAutoLevelUpdated,this),e.off(Hi.ERROR,this.onError,this))}destroy(){this.unregisterListeners(),this.clearTimer(),this.hls=this._abandonRulesCheck=this.supportedCache=null,this.fragCurrent=this.partCurrent=null}onManifestLoading(e,t){this.lastLoadedFragLevel=-1,this.firstSelection=-1,this.lastLevelLoadSec=0,this.supportedCache={},this.fragCurrent=this.partCurrent=null,this.onLevelsUpdated(),this.clearTimer()}onLevelsUpdated(){this.lastLoadedFragLevel>-1&&this.fragCurrent&&(this.lastLoadedFragLevel=this.fragCurrent.level),this._nextAutoLevel=-1,this.onMaxAutoLevelUpdated(),this.codecTiers=null,this.audioTracksByGroup=null}onMaxAutoLevelUpdated(){this.firstSelection=-1,this.nextAutoLevelKey=""}onFragLoading(e,t){const s=t.frag;if(!this.ignoreFragment(s)){var n;if(!s.bitrateTest)this.fragCurrent=s,this.partCurrent=null!=(n=t.part)?n:null;this.clearTimer(),this.timer=self.setInterval(this._abandonRulesCheck,100)}}onLevelSwitching(e,t){this.clearTimer()}onError(e,t){if(!t.fatal)switch(t.details){case zi.BUFFER_ADD_CODEC_ERROR:case zi.BUFFER_APPEND_ERROR:this.lastLoadedFragLevel=-1,this.firstSelection=-1;break;case zi.FRAG_LOAD_TIMEOUT:{const e=t.frag,{fragCurrent:s,partCurrent:n}=this;if(e&&s&&e.sn===s.sn&&e.level===s.level){const t=performance.now(),s=n?n.stats:e.stats,r=t-s.loading.start,i=s.loading.first?s.loading.first-s.loading.start:-1;if(s.loaded&&i>-1){const e=this.bwEstimator.getEstimateTTFB();this.bwEstimator.sample(r-Math.min(e,i),s.loaded)}else this.bwEstimator.sampleTTFB(r)}break}}}getTimeToLoadFrag(e,t,s,n){return e+s/t+(n?e+this.lastLevelLoadSec:0)}onLevelLoaded(e,t){const s=this.hls.config,{loading:n}=t.stats,r=n.end-n.first;Ui(r)&&(this.lastLevelLoadSec=r/1e3),t.details.live?this.bwEstimator.update(s.abrEwmaSlowLive,s.abrEwmaFastLive):this.bwEstimator.update(s.abrEwmaSlowVoD,s.abrEwmaFastVoD),this.timer>-1&&this._abandonRulesCheck(t.levelInfo)}onFragLoaded(e,t){let{frag:s,part:n}=t;const r=n?n.stats:s.stats;if(s.type===Xi&&this.bwEstimator.sampleTTFB(r.loading.first-r.loading.start),!this.ignoreFragment(s)){if(this.clearTimer(),s.level===this._nextAutoLevel&&(this._nextAutoLevel=-1),this.firstSelection=-1,this.hls.config.abrMaxWithRealBitrate){const e=n?n.duration:s.duration,t=this.hls.levels[s.level],i=(t.loaded?t.loaded.bytes:0)+r.loaded,a=(t.loaded?t.loaded.duration:0)+e;t.loaded={bytes:i,duration:a},t.realBitrate=Math.round(8*i/a)}if(s.bitrateTest){const e={stats:r,frag:s,part:n,id:s.type};this.onFragBuffered(Hi.FRAG_BUFFERED,e),s.bitrateTest=!1}else this.lastLoadedFragLevel=s.level}}onFragBuffered(e,t){const{frag:s,part:n}=t,r=null!=n&&n.stats.loaded?n.stats:s.stats;if(r.aborted)return;if(this.ignoreFragment(s))return;const i=r.parsing.end-r.loading.start-Math.min(r.loading.first-r.loading.start,this.bwEstimator.getEstimateTTFB());this.bwEstimator.sample(i,r.loaded),r.bwEstimate=this.getBwEstimate(),s.bitrateTest?this.bitrateTestDelay=i/1e3:this.bitrateTestDelay=0}ignoreFragment(e){return e.type!==Xi||"initSegment"===e.sn}clearTimer(){this.timer>-1&&(self.clearInterval(this.timer),this.timer=-1)}get firstAutoLevel(){const{maxAutoLevel:e,minAutoLevel:t}=this.hls,s=this.getBwEstimate(),n=this.hls.config.maxStarvationDelay,r=this.findBestLevel(s,t,e,0,n,1,1);if(r>-1)return r;const i=this.hls.firstLevel,a=Math.min(Math.max(i,t),e);return this.warn("Could not find best starting auto level. Defaulting to first in playlist ".concat(i," clamped to ").concat(a)),a}get forcedAutoLevel(){return this.nextAutoLevelKey?-1:this._nextAutoLevel}get nextAutoLevel(){const e=this.forcedAutoLevel,t=this.bwEstimator.canEstimate(),s=this.lastLoadedFragLevel>-1;if(-1!==e&&(!t||!s||this.nextAutoLevelKey===this.getAutoLevelKey()))return e;const n=t&&s?this.getNextABRAutoLevel():this.firstAutoLevel;if(-1!==e){const t=this.hls.levels;if(t.length>Math.max(e,n)&&t[e].loadError<=t[n].loadError)return e}return this._nextAutoLevel=n,this.nextAutoLevelKey=this.getAutoLevelKey(),n}getAutoLevelKey(){return"".concat(this.getBwEstimate(),"_").concat(this.getStarvationDelay().toFixed(2))}getNextABRAutoLevel(){const{fragCurrent:e,partCurrent:t,hls:s}=this;if(s.levels.length<=1)return s.loadLevel;const{maxAutoLevel:n,config:r,minAutoLevel:i}=s,a=t?t.duration:e?e.duration:0,o=this.getBwEstimate(),l=this.getStarvationDelay();let c=r.abrBandWidthFactor,d=r.abrBandWidthUpFactor;if(l){const e=this.findBestLevel(o,i,n,l,0,c,d);if(e>=0)return this.rebufferNotice=-1,e}let u=a?Math.min(a,r.maxStarvationDelay):r.maxStarvationDelay;if(!l){const e=this.bitrateTestDelay;if(e){u=(a?Math.min(a,r.maxLoadingDelay):r.maxLoadingDelay)-e,this.info("bitrate test took ".concat(Math.round(1e3*e),"ms, set first fragment max fetchDuration to ").concat(Math.round(1e3*u)," ms")),c=d=1}}const h=this.findBestLevel(o,i,n,l,u,c,d);if(this.rebufferNotice!==h&&(this.rebufferNotice=h,this.info("".concat(l?"rebuffering expected":"buffer is empty",", optimal quality level ").concat(h))),h>-1)return h;const f=s.levels[i],m=s.loadLevelObj;return m&&(null==f?void 0:f.bitrate)<m.bitrate?i:s.loadLevel}getStarvationDelay(){const e=this.hls,t=e.media;if(!t)return 1/0;const s=t&&0!==t.playbackRate?Math.abs(t.playbackRate):1,n=e.mainForwardBufferInfo;return(n?n.len:0)/s}getBwEstimate(){return this.bwEstimator.canEstimate()?this.bwEstimator.getEstimate():this.hls.config.abrEwmaDefaultEstimate}findBestLevel(e,t,s,n,r,i,a){var o;const l=n+r,c=this.lastLoadedFragLevel,d=-1===c?this.hls.firstLevel:c,{fragCurrent:u,partCurrent:h}=this,{levels:f,allAudioTracks:m,loadLevel:p,config:g}=this.hls;if(1===f.length)return 0;const v=f[d],y=!(null==(o=this.hls.latestLevelDetails)||!o.live),b=-1===p||-1===c;let x,E="SDR",S=(null==v?void 0:v.frameRate)||0;const{audioPreference:T,videoPreference:k}=g,w=this.audioTracksByGroup||(this.audioTracksByGroup=Oo(m));let L=-1;if(b){if(-1!==this.firstSelection)return this.firstSelection;const n=this.codecTiers||(this.codecTiers=function(e,t,s,n){return e.slice(s,n+1).reduce((e,s,n)=>{if(!s.codecSet)return e;const r=s.audioGroups;let i=e[s.codecSet];i||(e[s.codecSet]=i={minBitrate:1/0,minHeight:1/0,minFramerate:1/0,minIndex:n,maxScore:0,videoRanges:{SDR:0},channels:{2:0},hasDefaultAudio:!r,fragmentError:0}),i.minBitrate=Math.min(i.minBitrate,s.bitrate);const a=Math.min(s.height,s.width);return i.minHeight=Math.min(i.minHeight,a),i.minFramerate=Math.min(i.minFramerate,s.frameRate),i.minIndex=Math.min(i.minIndex,n),i.maxScore=Math.max(i.maxScore,s.score),i.fragmentError+=s.fragmentError,i.videoRanges[s.videoRange]=(i.videoRanges[s.videoRange]||0)+1,r&&r.forEach(e=>{if(!e)return;const s=t.groups[e];s&&(i.hasDefaultAudio=i.hasDefaultAudio||t.hasDefaultAudio?s.hasDefault:s.hasAutoSelect||!t.hasDefaultAudio&&!t.hasAutoSelectAudio,Object.keys(s.channels).forEach(e=>{i.channels[e]=(i.channels[e]||0)+s.channels[e]}))}),e},{})}(f,w,t,s)),r=function(e,t,s,n,r){const i=Object.keys(e),a=null==n?void 0:n.channels,o=null==n?void 0:n.audioCodec,l=null==r?void 0:r.videoCodec,c=a&&2===parseInt(a);let d=!1,u=!1,h=1/0,f=1/0,m=1/0,p=1/0,g=0,v=[];const{preferHDR:y,allowedVideoRanges:b}=Po(t,r);for(let T=i.length;T--;){const t=e[i[T]];d||(d=t.channels[2]>0),h=Math.min(h,t.minHeight),f=Math.min(f,t.minFramerate),m=Math.min(m,t.minBitrate),b.filter(e=>t.videoRanges[e]>0).length>0&&(u=!0)}h=Ui(h)?h:0,f=Ui(f)?f:0;const x=Math.max(1080,h),E=Math.max(30,f);m=Ui(m)?m:s,s=Math.max(m,s),u||(t=void 0);const S=i.length>1;return{codecSet:i.reduce((t,n)=>{const r=e[n];if(n===t)return t;if(v=u?b.filter(e=>r.videoRanges[e]>0):[],S){if(r.minBitrate>s)return Mo(n,"min bitrate of ".concat(r.minBitrate," > current estimate of ").concat(s)),t;if(!r.hasDefaultAudio)return Mo(n,"no renditions with default or auto-select sound found"),t;if(o&&n.indexOf(o.substring(0,4))%5!==0)return Mo(n,'audio codec preference "'.concat(o,'" not found')),t;if(a&&!c){if(!r.channels[a])return Mo(n,"no renditions with ".concat(a," channel sound found (channels options: ").concat(Object.keys(r.channels),")")),t}else if((!o||c)&&d&&0===r.channels[2])return Mo(n,"no renditions with stereo sound found"),t;if(r.minHeight>x)return Mo(n,"min resolution of ".concat(r.minHeight," > maximum of ").concat(x)),t;if(r.minFramerate>E)return Mo(n,"min framerate of ".concat(r.minFramerate," > maximum of ").concat(E)),t;if(!v.some(e=>r.videoRanges[e]>0))return Mo(n,"no variants with VIDEO-RANGE of ".concat(Do(v)," found")),t;if(l&&n.indexOf(l.substring(0,4))%5!==0)return Mo(n,'video codec preference "'.concat(l,'" not found')),t;if(r.maxScore<g)return Mo(n,"max score of ".concat(r.maxScore," < selected max of ").concat(g)),t}return t&&(lo(n)>=lo(t)||r.fragmentError>e[t].fragmentError)?t:(p=r.minIndex,g=r.maxScore,n)},void 0),videoRanges:v,preferHDR:y,minFramerate:f,minBitrate:m,minIndex:p}}(n,E,e,T,k),{codecSet:i,videoRanges:a,minFramerate:o,minBitrate:l,minIndex:c,preferHDR:d}=r;L=c,x=i,E=d?a[a.length-1]:a[0],S=o,e=Math.max(e,l),this.log("picked start tier ".concat(Do(r)))}else x=null==v?void 0:v.codecSet,E=null==v?void 0:v.videoRange;const C=h?h.duration:u?u.duration:0,A=this.bwEstimator.getEstimateTTFB()/1e3,R=[];for(let N=s;N>=t;N--){var _;const t=f[N],o=N>d;if(!t)continue;if(g.useMediaCapabilities&&!t.supportedResult&&!t.supportedPromise){const s=navigator.mediaCapabilities;"function"===typeof(null==s?void 0:s.decodingInfo)&&Eo(t,w,E,S,e,T)?(t.supportedPromise=So(t,w,s,this.supportedCache),t.supportedPromise.then(e=>{if(!this.hls)return;t.supportedResult=e;const s=this.hls.levels,n=s.indexOf(t);e.error?this.warn('MediaCapabilities decodingInfo error: "'.concat(e.error,'" for level ').concat(n," ").concat(Do(e))):e.supported?e.decodingInfoResults.some(e=>!1===e.smooth||!1===e.powerEfficient)&&this.log("MediaCapabilities decodingInfo for level ".concat(n," not smooth or powerEfficient: ").concat(Do(e))):(this.warn("Unsupported MediaCapabilities decodingInfo result for level ".concat(n," ").concat(Do(e))),n>-1&&s.length>1&&(this.log("Removing unsupported level ".concat(n)),this.hls.removeLevel(n),-1===this.hls.loadLevel&&(this.hls.nextLoadLevel=0)))}).catch(e=>{this.warn("Error handling MediaCapabilities decodingInfo: ".concat(e))})):t.supportedResult=bo}if((x&&t.codecSet!==x||E&&t.videoRange!==E||o&&S>t.frameRate||!o&&S>0&&S<t.frameRate||null!=(_=t.supportedResult)&&null!=(_=_.decodingInfoResults)&&_.some(e=>!1===e.smooth))&&(!b||N!==L)){R.push(N);continue}const u=t.details,m=(h?null==u?void 0:u.partTarget:null==u?void 0:u.averagetargetduration)||C;let v;v=o?a*e:i*e;const k=C&&n>=2*C&&0===r?t.averageBitrate:t.maxBitrate,I=this.getTimeToLoadFrag(A,v,k*m,void 0===u);if(v>=k&&(N===c||0===t.loadError&&0===t.fragmentError)&&(I<=A||!Ui(I)||y&&!this.bitrateTestDelay||I<l)){const e=this.forcedAutoLevel;return N===p||-1!==e&&e===p||(R.length&&this.trace("Skipped level(s) ".concat(R.join(",")," of ").concat(s,' max with CODECS and VIDEO-RANGE:"').concat(f[R[0]].codecs,'" ').concat(f[R[0]].videoRange,'; not compatible with "').concat(x,'" ').concat(E)),this.info("switch candidate:".concat(d,"->").concat(N," adjustedbw(").concat(Math.round(v),")-bitrate=").concat(Math.round(v-k)," ttfb:").concat(A.toFixed(1)," avgDuration:").concat(m.toFixed(1)," maxFetchDuration:").concat(l.toFixed(1)," fetchDuration:").concat(I.toFixed(1)," firstSelection:").concat(b," codecSet:").concat(t.codecSet," videoRange:").concat(t.videoRange," hls.loadLevel:").concat(p))),b&&(this.firstSelection=N),N}}return-1}set nextAutoLevel(e){const t=this.deriveNextAutoLevel(e);this._nextAutoLevel!==t&&(this.nextAutoLevelKey="",this._nextAutoLevel=t)}deriveNextAutoLevel(e){const{maxAutoLevel:t,minAutoLevel:s}=this.hls;return Math.min(Math.max(e,s),t)}},bufferController:class extends ra{constructor(e,t){var s;super("buffer-controller",e.logger),this.hls=void 0,this.fragmentTracker=void 0,this.details=null,this._objectUrl=null,this.operationQueue=null,this.bufferCodecEventsTotal=0,this.media=null,this.mediaSource=null,this.lastMpegAudioChunk=null,this.blockedAudioAppend=null,this.lastVideoAppendEnd=0,this.appendSource=void 0,this.transferData=void 0,this.overrides=void 0,this.appendErrors={audio:0,video:0,audiovideo:0},this.tracks={},this.sourceBuffers=[[null,null],[null,null]],this._onEndStreaming=e=>{var t;this.hls&&"open"===(null==(t=this.mediaSource)?void 0:t.readyState)&&this.hls.pauseBuffering()},this._onStartStreaming=e=>{this.hls&&this.hls.resumeBuffering()},this._onMediaSourceOpen=e=>{const{media:t,mediaSource:s}=this;e&&this.log("Media source opened"),t&&s&&(s.removeEventListener("sourceopen",this._onMediaSourceOpen),t.removeEventListener("emptied",this._onMediaEmptied),this.updateDuration(),this.hls.trigger(Hi.MEDIA_ATTACHED,{media:t,mediaSource:s}),null!==this.mediaSource&&this.checkPendingTracks())},this._onMediaSourceClose=()=>{this.log("Media source closed")},this._onMediaSourceEnded=()=>{this.log("Media source ended")},this._onMediaEmptied=()=>{const{mediaSrc:e,_objectUrl:t}=this;e!==t&&this.error("Media element src was set while attaching MediaSource (".concat(t," > ").concat(e,")"))},this.hls=e,this.fragmentTracker=t,this.appendSource=(s=ua(e.config.preferManagedMediaSource),"undefined"!==typeof self&&s===self.ManagedMediaSource),this.initTracks(),this.registerListeners()}hasSourceTypes(){return Object.keys(this.tracks).length>0}destroy(){this.unregisterListeners(),this.details=null,this.lastMpegAudioChunk=this.blockedAudioAppend=null,this.transferData=this.overrides=void 0,this.operationQueue&&(this.operationQueue.destroy(),this.operationQueue=null),this.hls=this.fragmentTracker=null,this._onMediaSourceOpen=this._onMediaSourceClose=null,this._onMediaSourceEnded=null,this._onStartStreaming=this._onEndStreaming=null}registerListeners(){const{hls:e}=this;e.on(Hi.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(Hi.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(Hi.MANIFEST_LOADING,this.onManifestLoading,this),e.on(Hi.MANIFEST_PARSED,this.onManifestParsed,this),e.on(Hi.BUFFER_RESET,this.onBufferReset,this),e.on(Hi.BUFFER_APPENDING,this.onBufferAppending,this),e.on(Hi.BUFFER_CODECS,this.onBufferCodecs,this),e.on(Hi.BUFFER_EOS,this.onBufferEos,this),e.on(Hi.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(Hi.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(Hi.FRAG_PARSED,this.onFragParsed,this),e.on(Hi.FRAG_CHANGED,this.onFragChanged,this),e.on(Hi.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(Hi.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(Hi.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(Hi.MANIFEST_LOADING,this.onManifestLoading,this),e.off(Hi.MANIFEST_PARSED,this.onManifestParsed,this),e.off(Hi.BUFFER_RESET,this.onBufferReset,this),e.off(Hi.BUFFER_APPENDING,this.onBufferAppending,this),e.off(Hi.BUFFER_CODECS,this.onBufferCodecs,this),e.off(Hi.BUFFER_EOS,this.onBufferEos,this),e.off(Hi.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(Hi.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(Hi.FRAG_PARSED,this.onFragParsed,this),e.off(Hi.FRAG_CHANGED,this.onFragChanged,this),e.off(Hi.ERROR,this.onError,this)}transferMedia(){const{media:e,mediaSource:t}=this;if(!e)return null;const s={};if(this.operationQueue){const e=this.isUpdating();e||this.operationQueue.removeBlockers();const t=this.isQueued();(e||t)&&this.warn("Transfering MediaSource with".concat(t?" operations in queue":"").concat(e?" updating SourceBuffer(s)":""," ").concat(this.operationQueue)),this.operationQueue.destroy()}const n=this.transferData;return!this.sourceBufferCount&&n&&n.mediaSource===t?ta(s,n.tracks):this.sourceBuffers.forEach(e=>{const[t]=e;t&&(s[t]=ta({},this.tracks[t]),this.removeBuffer(t)),e[0]=e[1]=null}),{media:e,mediaSource:t,tracks:s}}initTracks(){this.sourceBuffers=[[null,null],[null,null]],this.tracks={},this.resetQueue(),this.resetAppendErrors(),this.lastMpegAudioChunk=this.blockedAudioAppend=null,this.lastVideoAppendEnd=0}onManifestLoading(){this.bufferCodecEventsTotal=0,this.details=null}onManifestParsed(e,t){var s;let n=2;(t.audio&&!t.video||!t.altAudio)&&(n=1),this.bufferCodecEventsTotal=n,this.log("".concat(n," bufferCodec event(s) expected.")),null!=(s=this.transferData)&&s.mediaSource&&this.sourceBufferCount&&n&&this.bufferCreated()}onMediaAttaching(e,t){const s=this.media=t.media;this.transferData=this.overrides=void 0;const n=ua(this.appendSource);if(n){const e=!!t.mediaSource;(e||t.overrides)&&(this.transferData=t,this.overrides=t.overrides);const i=this.mediaSource=t.mediaSource||new n;if(this.assignMediaSource(i),e)this._objectUrl=s.src,this.attachTransferred();else{const e=this._objectUrl=self.URL.createObjectURL(i);if(this.appendSource)try{s.removeAttribute("src");const t=self.ManagedMediaSource;s.disableRemotePlayback=s.disableRemotePlayback||t&&i instanceof t,Ju(s),function(e,t){const s=self.document.createElement("source");s.type="video/mp4",s.src=t,e.appendChild(s)}(s,e),s.load()}catch(r){s.src=e}else s.src=e}s.addEventListener("emptied",this._onMediaEmptied)}}assignMediaSource(e){var t,s;this.log("".concat((null==(t=this.transferData)?void 0:t.mediaSource)===e?"transferred":"created"," media source: ").concat(null==(s=e.constructor)?void 0:s.name)),e.addEventListener("sourceopen",this._onMediaSourceOpen),e.addEventListener("sourceended",this._onMediaSourceEnded),e.addEventListener("sourceclose",this._onMediaSourceClose),this.appendSource&&(e.addEventListener("startstreaming",this._onStartStreaming),e.addEventListener("endstreaming",this._onEndStreaming))}attachTransferred(){const e=this.media,t=this.transferData;if(!t||!e)return;const s=this.tracks,n=t.tracks,r=n?Object.keys(n):null,i=r?r.length:0,a=()=>{Promise.resolve().then(()=>{this.media&&this.mediaSourceOpenOrEnded&&this._onMediaSourceOpen()})};if(n&&r&&i){if(!this.tracksReady)return this.hls.config.startFragPrefetch=!0,void this.log("attachTransferred: waiting for SourceBuffer track info");if(this.log("attachTransferred: (bufferCodecEventsTotal ".concat(this.bufferCodecEventsTotal,")\nrequired tracks: ").concat(Do(s,(e,t)=>"initSegment"===e?void 0:t),";\ntransfer tracks: ").concat(Do(n,(e,t)=>"initSegment"===e?void 0:t),"}")),!ha(n,s)){t.mediaSource=null,t.tracks=void 0;const r=e.currentTime,i=this.details,a=Math.max(r,(null==i?void 0:i.fragments[0].start)||0);return a-r>1?void this.log("attachTransferred: waiting for playback to reach new tracks start time ".concat(r," -> ").concat(a)):(this.warn('attachTransferred: resetting MediaSource for incompatible tracks ("'.concat(Object.keys(n),'"->"').concat(Object.keys(s),'") start time: ').concat(a," currentTime: ").concat(r)),this.onMediaDetaching(Hi.MEDIA_DETACHING,{}),this.onMediaAttaching(Hi.MEDIA_ATTACHING,t),void(e.currentTime=a))}this.transferData=void 0,r.forEach(e=>{const t=e,s=n[t];if(s){const e=s.buffer;if(e){const n=this.fragmentTracker,r=s.id;if(n.hasFragments(r)||n.hasParts(r)){const s=Pl.getBuffered(e);n.detectEvictedFragments(t,s,r,null,!0)}const i=Zu(t),a=[t,e];this.sourceBuffers[i]=a,e.updating&&this.operationQueue&&this.operationQueue.prependBlocker(t),this.trackSourceBuffer(t,s)}}}),a(),this.bufferCreated()}else this.log("attachTransferred: MediaSource w/o SourceBuffers"),a()}get mediaSourceOpenOrEnded(){var e;const t=null==(e=this.mediaSource)?void 0:e.readyState;return"open"===t||"ended"===t}onMediaDetaching(e,t){const s=!!t.transferMedia;this.transferData=this.overrides=void 0;const{media:n,mediaSource:r,_objectUrl:i}=this;if(r){if(this.log("media source ".concat(s?"transferring":"detaching")),s)this.sourceBuffers.forEach(e=>{let[t]=e;t&&this.removeBuffer(t)}),this.resetQueue();else{if(this.mediaSourceOpenOrEnded){const e="open"===r.readyState;try{const t=r.sourceBuffers;for(let s=t.length;s--;)e&&t[s].abort(),r.removeSourceBuffer(t[s]);e&&r.endOfStream()}catch(Ip){this.warn("onMediaDetaching: ".concat(Ip.message," while calling endOfStream"))}}this.sourceBufferCount&&this.onBufferReset()}r.removeEventListener("sourceopen",this._onMediaSourceOpen),r.removeEventListener("sourceended",this._onMediaSourceEnded),r.removeEventListener("sourceclose",this._onMediaSourceClose),this.appendSource&&(r.removeEventListener("startstreaming",this._onStartStreaming),r.removeEventListener("endstreaming",this._onEndStreaming)),this.mediaSource=null,this._objectUrl=null}n&&(n.removeEventListener("emptied",this._onMediaEmptied),s||(i&&self.URL.revokeObjectURL(i),this.mediaSrc===i?(n.removeAttribute("src"),this.appendSource&&Ju(n),n.load()):this.warn("media|source.src was changed by a third party - skip cleanup")),this.media=null),this.hls.trigger(Hi.MEDIA_DETACHED,t)}onBufferReset(){this.sourceBuffers.forEach(e=>{let[t]=e;t&&this.resetBuffer(t)}),this.initTracks()}resetBuffer(e){var t;const s=null==(t=this.tracks[e])?void 0:t.buffer;if(this.removeBuffer(e),s)try{var n;null!=(n=this.mediaSource)&&n.sourceBuffers.length&&this.mediaSource.removeSourceBuffer(s)}catch(Ip){this.warn("onBufferReset ".concat(e),Ip)}delete this.tracks[e]}removeBuffer(e){this.removeBufferListeners(e),this.sourceBuffers[Zu(e)]=[null,null];const t=this.tracks[e];t&&(t.buffer=void 0)}resetQueue(){this.operationQueue&&this.operationQueue.destroy(),this.operationQueue=new Yu(this.tracks)}onBufferCodecs(e,t){var s;const n=this.tracks,r=Object.keys(t);this.log('BUFFER_CODECS: "'.concat(r,'" (current SB count ').concat(this.sourceBufferCount,")"));const i="audiovideo"in t&&(n.audio||n.video)||n.audiovideo&&("audio"in t||"video"in t),a=!i&&this.sourceBufferCount&&this.media&&r.some(e=>!n[e]);i||a?this.warn('Unsupported transition between "'.concat(Object.keys(n),'" and "').concat(r,'" SourceBuffers')):(r.forEach(e=>{var s,r;const i=t[e],{id:a,codec:o,levelCodec:l,container:c,metadata:d,supplemental:u}=i;let h=n[e];const f=null==(s=this.transferData)||null==(s=s.tracks)?void 0:s[e],m=null!=f&&f.buffer?f:h,p=(null==m?void 0:m.pendingCodec)||(null==m?void 0:m.codec),g=null==m?void 0:m.levelCodec;h||(h=n[e]={buffer:void 0,listeners:[],codec:o,supplemental:u,container:c,levelCodec:l,metadata:d,id:a});const v=fo(p,g),y=null==v?void 0:v.replace(Xu,"$1");let b=fo(o,l);const x=null==(r=b)?void 0:r.replace(Xu,"$1");b&&v&&y!==x&&("audio"===e.slice(0,5)&&(b=ho(b,this.appendSource)),this.log("switching codec ".concat(p," to ").concat(b)),b!==(h.pendingCodec||h.codec)&&(h.pendingCodec=b),h.container=c,this.appendChangeType(e,c,b))}),(this.tracksReady||this.sourceBufferCount)&&(t.tracks=this.sourceBufferTracks),this.sourceBufferCount||(this.bufferCodecEventsTotal>1&&!this.tracks.video&&!t.video&&"main"===(null==(s=t.audio)?void 0:s.id)&&(this.log("Main audio-only"),this.bufferCodecEventsTotal=1),this.mediaSourceOpenOrEnded&&this.checkPendingTracks()))}get sourceBufferTracks(){return Object.keys(this.tracks).reduce((e,t)=>{const s=this.tracks[t];return e[t]={id:s.id,container:s.container,codec:s.codec,levelCodec:s.levelCodec},e},{})}appendChangeType(e,t,s){const n="".concat(t,";codecs=").concat(s),r={label:"change-type=".concat(n),execute:()=>{const r=this.tracks[e];if(r){const i=r.buffer;null!=i&&i.changeType&&(this.log("changing ".concat(e," sourceBuffer type to ").concat(n)),i.changeType(n),r.codec=s,r.container=t)}this.shiftAndExecuteNext(e)},onStart:()=>{},onComplete:()=>{},onError:t=>{this.warn("Failed to change ".concat(e," SourceBuffer type"),t)}};this.append(r,e,this.isPending(this.tracks[e]))}blockAudio(e){var t;const s=e.start,n=s+.05*e.duration;if(!0===(null==(t=this.fragmentTracker.getAppendedFrag(s,Xi))?void 0:t.gap))return;const r={label:"block-audio",execute:()=>{var e;const t=this.tracks.video;(this.lastVideoAppendEnd>n||null!=t&&t.buffer&&Pl.isBuffered(t.buffer,n)||!0===(null==(e=this.fragmentTracker.getAppendedFrag(n,Xi))?void 0:e.gap))&&(this.blockedAudioAppend=null,this.shiftAndExecuteNext("audio"))},onStart:()=>{},onComplete:()=>{},onError:e=>{this.warn("Error executing block-audio operation",e)}};this.blockedAudioAppend={op:r,frag:e},this.append(r,"audio",!0)}unblockAudio(){const{blockedAudioAppend:e,operationQueue:t}=this;e&&t&&(this.blockedAudioAppend=null,t.unblockAudio(e.op))}onBufferAppending(e,t){const{tracks:s}=this,{data:n,type:r,parent:i,frag:a,part:o,chunkMeta:l,offset:c}=t,d=l.buffering[r],{sn:u,cc:h}=a,f=self.performance.now();d.start=f;const m=a.stats.buffering,p=o?o.stats.buffering:null;0===m.start&&(m.start=f),p&&0===p.start&&(p.start=f);const g=s.audio;let v=!1;"audio"===r&&"audio/mpeg"===(null==g?void 0:g.container)&&(v=!this.lastMpegAudioChunk||1===l.id||this.lastMpegAudioChunk.sn!==l.sn,this.lastMpegAudioChunk=l);const y=s.video,b=null==y?void 0:y.buffer;if(b&&"initSegment"!==u){const e=o||a,t=this.blockedAudioAppend;if("audio"!==r||"main"===i||this.blockedAudioAppend||y.ending||y.ended){if("video"===r){const s=e.end;if(t){const e=t.frag.start;(s>e||s<this.lastVideoAppendEnd||Pl.isBuffered(b,e))&&this.unblockAudio()}this.lastVideoAppendEnd=s}}else{const t=e.start+.05*e.duration,s=b.buffered,n=this.currentOp("video");s.length||n?!n&&!Pl.isBuffered(b,t)&&this.lastVideoAppendEnd<t&&this.blockAudio(e):this.blockAudio(e)}}const x=(o||a).start,E={label:"append-".concat(r),execute:()=>{var e;d.executeStart=self.performance.now();const t=null==(e=this.tracks[r])?void 0:e.buffer;t&&(v?this.updateTimestampOffset(t,x,.1,r,u,h):void 0!==c&&Ui(c)&&this.updateTimestampOffset(t,c,1e-6,r,u,h)),this.appendExecutor(n,r)},onStart:()=>{},onComplete:()=>{const e=self.performance.now();d.executeEnd=d.end=e,0===m.first&&(m.first=e),p&&0===p.first&&(p.first=e);const t={};this.sourceBuffers.forEach(e=>{let[s,n]=e;s&&(t[s]=Pl.getBuffered(n))}),this.appendErrors[r]=0,"audio"===r||"video"===r?this.appendErrors.audiovideo=0:(this.appendErrors.audio=0,this.appendErrors.video=0),this.hls.trigger(Hi.BUFFER_APPENDED,{type:r,frag:a,part:o,chunkMeta:l,parent:a.type,timeRanges:t})},onError:e=>{var t;const s={type:Vi.MEDIA_ERROR,parent:a.type,details:zi.BUFFER_APPEND_ERROR,sourceBufferName:r,frag:a,part:o,chunkMeta:l,error:e,err:e,fatal:!1},n=null==(t=this.media)?void 0:t.error;if(e.code===DOMException.QUOTA_EXCEEDED_ERR||"QuotaExceededError"==e.name||"quota"in e)s.details=zi.BUFFER_FULL_ERROR;else if(e.code===DOMException.INVALID_STATE_ERR&&this.mediaSourceOpenOrEnded&&!n)s.errorAction=ul(!0);else if(e.name===Qu&&0===this.sourceBufferCount)s.errorAction=ul(!0);else{const e=++this.appendErrors[r];this.warn("Failed ".concat(e,"/").concat(this.hls.config.appendErrorMaxRetry,' times to append segment in "').concat(r,'" sourceBuffer (').concat(n||"no media error",")")),(e>=this.hls.config.appendErrorMaxRetry||n)&&(s.fatal=!0)}this.hls.trigger(Hi.ERROR,s)}};this.log('queuing "'.concat(r,'" append sn: ').concat(u).concat(o?" p: "+o.index:""," of ").concat(a.type===Xi?"level":"track"," ").concat(a.level," cc: ").concat(h)),this.append(E,r,this.isPending(this.tracks[r]))}getFlushOp(e,t,s){return this.log('queuing "'.concat(e,'" remove ').concat(t,"-").concat(s)),{label:"remove",execute:()=>{this.removeExecutor(e,t,s)},onStart:()=>{},onComplete:()=>{this.hls.trigger(Hi.BUFFER_FLUSHED,{type:e})},onError:n=>{this.warn("Failed to remove ".concat(t,"-").concat(s,' from "').concat(e,'" SourceBuffer'),n)}}}onBufferFlushing(e,t){const{type:s,startOffset:n,endOffset:r}=t;s?this.append(this.getFlushOp(s,n,r),s):this.sourceBuffers.forEach(e=>{let[t]=e;t&&this.append(this.getFlushOp(t,n,r),t)})}onFragParsed(e,t){const{frag:s,part:n}=t,r=[],i=n?n.elementaryStreams:s.elementaryStreams;i[Ta]?r.push("audiovideo"):(i[Ea]&&r.push("audio"),i[Sa]&&r.push("video"));0===r.length&&this.warn("Fragments must have at least one ElementaryStreamType set. type: ".concat(s.type," level: ").concat(s.level," sn: ").concat(s.sn)),this.blockBuffers(()=>{const e=self.performance.now();s.stats.buffering.end=e,n&&(n.stats.buffering.end=e);const t=n?n.stats:s.stats;this.hls.trigger(Hi.FRAG_BUFFERED,{frag:s,part:n,stats:t,id:s.type})},r).catch(e=>{this.warn("Fragment buffered callback ".concat(e)),this.stepOperationQueue(this.sourceBufferTypes)})}onFragChanged(e,t){this.trimBuffers()}get bufferedToEnd(){return this.sourceBufferCount>0&&!this.sourceBuffers.some(e=>{let[t]=e;if(t){const e=this.tracks[t];if(e)return!e.ended||e.ending}return!1})}onBufferEos(e,t){var s;this.sourceBuffers.forEach(e=>{let[s]=e;if(s){const e=this.tracks[s];t.type&&t.type!==s||(e.ending=!0,e.ended||(e.ended=!0,this.log("".concat(s," buffer reached EOS"))))}});const n=!1!==(null==(s=this.overrides)?void 0:s.endOfStream);this.sourceBufferCount>0&&!this.sourceBuffers.some(e=>{let[t]=e;var s;return t&&!(null!=(s=this.tracks[t])&&s.ended)})?n?(this.log("Queueing EOS"),this.blockUntilOpen(()=>{this.tracksEnded();const{mediaSource:e}=this;e&&"open"===e.readyState?(this.log("Calling mediaSource.endOfStream()"),e.endOfStream(),this.hls.trigger(Hi.BUFFERED_TO_END,void 0)):e&&this.log("Could not call mediaSource.endOfStream(). mediaSource.readyState: ".concat(e.readyState))})):(this.tracksEnded(),this.hls.trigger(Hi.BUFFERED_TO_END,void 0)):"video"===t.type&&this.unblockAudio()}tracksEnded(){this.sourceBuffers.forEach(e=>{let[t]=e;if(null!==t){const e=this.tracks[t];e&&(e.ending=!1)}})}onLevelUpdated(e,t){let{details:s}=t;s.fragments.length&&(this.details=s,this.updateDuration())}updateDuration(){this.blockUntilOpen(()=>{const e=this.getDurationAndRange();e&&this.updateMediaSource(e)})}onError(e,t){if(t.details===zi.BUFFER_APPEND_ERROR&&t.frag){var s;const e=null==(s=t.errorAction)?void 0:s.nextAutoLevel;Ui(e)&&e!==t.frag.level&&this.resetAppendErrors()}}resetAppendErrors(){this.appendErrors={audio:0,video:0,audiovideo:0}}trimBuffers(){const{hls:e,details:t,media:s}=this;if(!s||null===t)return;if(!this.sourceBufferCount)return;const n=e.config,r=s.currentTime,i=t.levelTargetDuration,a=t.live&&null!==n.liveBackBufferLength?n.liveBackBufferLength:n.backBufferLength;if(Ui(a)&&a>=0){const e=Math.max(a,i),t=Math.floor(r/i)*i-e;this.flushBackBuffer(r,i,t)}const o=n.frontBufferFlushThreshold;if(Ui(o)&&o>0){const e=Math.max(n.maxBufferLength,o),t=Math.max(e,i),s=Math.floor(r/i)*i+t;this.flushFrontBuffer(r,i,s)}}flushBackBuffer(e,t,s){this.sourceBuffers.forEach(e=>{let[t,n]=e;if(n){const e=Pl.getBuffered(n);if(e.length>0&&s>e.start(0)){var r;this.hls.trigger(Hi.BACK_BUFFER_REACHED,{bufferEnd:s});const e=this.tracks[t];if(null!=(r=this.details)&&r.live)this.hls.trigger(Hi.LIVE_BACK_BUFFER_REACHED,{bufferEnd:s});else if(null!=e&&e.ended)return void this.log("Cannot flush ".concat(t," back buffer while SourceBuffer is in ended state"));this.hls.trigger(Hi.BUFFER_FLUSHING,{startOffset:0,endOffset:s,type:t})}}})}flushFrontBuffer(e,t,s){this.sourceBuffers.forEach(t=>{let[n,r]=t;if(r){const t=Pl.getBuffered(r),i=t.length;if(i<2)return;const a=t.start(i-1),o=t.end(i-1);if(s>a||e>=a&&e<=o)return;this.hls.trigger(Hi.BUFFER_FLUSHING,{startOffset:a,endOffset:1/0,type:n})}})}getDurationAndRange(){var e;const{details:t,mediaSource:s}=this;if(!t||!this.media||"open"!==(null==s?void 0:s.readyState))return null;const n=t.edge;if(t.live&&this.hls.config.liveDurationInfinity){if(t.fragments.length&&s.setLiveSeekableRange){const e=Math.max(0,t.fragmentStart);return{duration:1/0,start:e,end:Math.max(e,n)}}return{duration:1/0}}const r=null==(e=this.overrides)?void 0:e.duration;if(r)return Ui(r)?{duration:r}:null;const i=this.media.duration;return n>(Ui(s.duration)?s.duration:0)&&n>i||!Ui(i)?{duration:n}:null}updateMediaSource(e){let{duration:t,start:s,end:n}=e;const r=this.mediaSource;this.media&&r&&"open"===r.readyState&&(r.duration!==t&&(Ui(t)&&this.log("Updating MediaSource duration to ".concat(t.toFixed(3))),r.duration=t),void 0!==s&&void 0!==n&&(this.log("MediaSource duration is set to ".concat(r.duration,". Setting seekable range to ").concat(s,"-").concat(n,".")),r.setLiveSeekableRange(s,n)))}get tracksReady(){const e=this.pendingTrackCount;return e>0&&(e>=this.bufferCodecEventsTotal||this.isPending(this.tracks.audiovideo))}checkPendingTracks(){const{bufferCodecEventsTotal:e,pendingTrackCount:t,tracks:s}=this;if(this.log("checkPendingTracks (pending: ".concat(t," codec events expected: ").concat(e,") ").concat(Do(s))),this.tracksReady){var n;const e=null==(n=this.transferData)?void 0:n.tracks;e&&Object.keys(e).length?this.attachTransferred():this.createSourceBuffers()}}bufferCreated(){if(this.sourceBufferCount){const e={};this.sourceBuffers.forEach(t=>{let[s,n]=t;if(s){const t=this.tracks[s];e[s]={buffer:n,container:t.container,codec:t.codec,supplemental:t.supplemental,levelCodec:t.levelCodec,id:t.id,metadata:t.metadata}}}),this.hls.trigger(Hi.BUFFER_CREATED,{tracks:e}),this.log("SourceBuffers created. Running queue: ".concat(this.operationQueue)),this.sourceBuffers.forEach(e=>{let[t]=e;this.executeNext(t)})}else{const e=new Error("could not create source buffer for media codec(s)");this.hls.trigger(Hi.ERROR,{type:Vi.MEDIA_ERROR,details:zi.BUFFER_INCOMPATIBLE_CODECS_ERROR,fatal:!0,error:e,reason:e.message})}}createSourceBuffers(){const{tracks:e,sourceBuffers:t,mediaSource:s}=this;if(!s)throw new Error("createSourceBuffers called when mediaSource was null");for(const i in e){const a=i,o=e[a];if(this.isPending(o)){const e=this.getTrackCodec(o,a),i="".concat(o.container,";codecs=").concat(e);o.codec=e,this.log("creating sourceBuffer(".concat(i,")").concat(this.currentOp(a)?" Queued":""," ").concat(Do(o)));try{const e=s.addSourceBuffer(i),n=Zu(a),r=[a,e];t[n]=r,o.buffer=e}catch(r){var n;return this.error("error while trying to add sourceBuffer: ".concat(r.message)),this.shiftAndExecuteNext(a),null==(n=this.operationQueue)||n.removeBlockers(),delete this.tracks[a],void this.hls.trigger(Hi.ERROR,{type:Vi.MEDIA_ERROR,details:zi.BUFFER_ADD_CODEC_ERROR,fatal:!1,error:r,sourceBufferName:a,mimeType:i,parent:o.id})}this.trackSourceBuffer(a,o)}}this.bufferCreated()}getTrackCodec(e,t){const s=e.supplemental;let n=e.codec;s&&("video"===t||"audiovideo"===t)&&ro(s,"video")&&(n=function(e,t){const s=[];if(e){const t=e.split(",");for(let e=0;e<t.length;e++)no(t[e],"video")||s.push(t[e])}return t&&s.push(t),s.join(",")}(n,s));const r=fo(n,e.levelCodec);return r?"audio"===t.slice(0,5)?ho(r,this.appendSource):r:""}trackSourceBuffer(e,t){const s=t.buffer;if(!s)return;const n=this.getTrackCodec(t,e);this.tracks[e]={buffer:s,codec:n,container:t.container,levelCodec:t.levelCodec,supplemental:t.supplemental,metadata:t.metadata,id:t.id,listeners:[]},this.removeBufferListeners(e),this.addBufferListener(e,"updatestart",this.onSBUpdateStart),this.addBufferListener(e,"updateend",this.onSBUpdateEnd),this.addBufferListener(e,"error",this.onSBUpdateError),this.appendSource&&this.addBufferListener(e,"bufferedchange",(e,t)=>{const s=t.removedRanges;null!=s&&s.length&&this.hls.trigger(Hi.BUFFER_FLUSHED,{type:e})})}get mediaSrc(){var e,t;const s=(null==(e=this.media)||null==(t=e.querySelector)?void 0:t.call(e,"source"))||this.media;return null==s?void 0:s.src}onSBUpdateStart(e){const t=this.currentOp(e);t&&t.onStart()}onSBUpdateEnd(e){var t;if("closed"===(null==(t=this.mediaSource)?void 0:t.readyState))return void this.resetBuffer(e);const s=this.currentOp(e);s&&(s.onComplete(),this.shiftAndExecuteNext(e))}onSBUpdateError(e,t){var s;const n=new Error("".concat(e," SourceBuffer error. MediaSource readyState: ").concat(null==(s=this.mediaSource)?void 0:s.readyState));this.error("".concat(n),t),this.hls.trigger(Hi.ERROR,{type:Vi.MEDIA_ERROR,details:zi.BUFFER_APPENDING_ERROR,sourceBufferName:e,error:n,fatal:!1});const r=this.currentOp(e);r&&r.onError(n)}updateTimestampOffset(e,t,s,n,r,i){const a=t-e.timestampOffset;Math.abs(a)>=s&&(this.log("Updating ".concat(n," SourceBuffer timestampOffset to ").concat(t," (sn: ").concat(r," cc: ").concat(i,")")),e.timestampOffset=t)}removeExecutor(e,t,s){const{media:n,mediaSource:r}=this,i=this.tracks[e],a=null==i?void 0:i.buffer;if(!n||!r||!a)return this.warn("Attempting to remove from the ".concat(e," SourceBuffer, but it does not exist")),void this.shiftAndExecuteNext(e);const o=Ui(n.duration)?n.duration:1/0,l=Ui(r.duration)?r.duration:1/0,c=Math.max(0,t),d=Math.min(s,o,l);d>c&&(!i.ending||i.ended)?(i.ended=!1,this.log("Removing [".concat(c,",").concat(d,"] from the ").concat(e," SourceBuffer")),a.remove(c,d)):this.shiftAndExecuteNext(e)}appendExecutor(e,t){const s=this.tracks[t],n=null==s?void 0:s.buffer;if(!n)throw new $u("Attempting to append to the ".concat(t," SourceBuffer, but it does not exist"));s.ending=!1,s.ended=!1,n.appendBuffer(e)}blockUntilOpen(e){if(this.isUpdating()||this.isQueued())this.blockBuffers(e).catch(e=>{this.warn("SourceBuffer blocked callback ".concat(e)),this.stepOperationQueue(this.sourceBufferTypes)});else try{e()}catch(t){this.warn("Callback run without blocking ".concat(this.operationQueue," ").concat(t))}}isUpdating(){return this.sourceBuffers.some(e=>{let[t,s]=e;return t&&s.updating})}isQueued(){return this.sourceBuffers.some(e=>{let[t]=e;return t&&!!this.currentOp(t)})}isPending(e){return!!e&&!e.buffer}blockBuffers(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.sourceBufferTypes;if(!t.length)return this.log("Blocking operation requested, but no SourceBuffers exist"),Promise.resolve().then(e);const{operationQueue:s}=this,n=t.map(e=>this.appendBlocker(e));return t.length>1&&!!this.blockedAudioAppend&&this.unblockAudio(),Promise.all(n).then(t=>{s===this.operationQueue&&(e(),this.stepOperationQueue(this.sourceBufferTypes))})}stepOperationQueue(e){e.forEach(e=>{var t;const s=null==(t=this.tracks[e])?void 0:t.buffer;s&&!s.updating&&this.shiftAndExecuteNext(e)})}append(e,t,s){this.operationQueue&&this.operationQueue.append(e,t,s)}appendBlocker(e){if(this.operationQueue)return this.operationQueue.appendBlocker(e)}currentOp(e){return this.operationQueue?this.operationQueue.current(e):null}executeNext(e){e&&this.operationQueue&&this.operationQueue.executeNext(e)}shiftAndExecuteNext(e){this.operationQueue&&this.operationQueue.shiftAndExecuteNext(e)}get pendingTrackCount(){return Object.keys(this.tracks).reduce((e,t)=>e+(this.isPending(this.tracks[t])?1:0),0)}get sourceBufferCount(){return this.sourceBuffers.reduce((e,t)=>{let[s]=t;return e+(s?1:0)},0)}get sourceBufferTypes(){return this.sourceBuffers.map(e=>{let[t]=e;return t}).filter(e=>!!e)}addBufferListener(e,t,s){const n=this.tracks[e];if(!n)return;const r=n.buffer;if(!r)return;const i=s.bind(this,e);n.listeners.push({event:t,listener:i}),r.addEventListener(t,i)}removeBufferListeners(e){const t=this.tracks[e];if(!t)return;const s=t.buffer;s&&(t.listeners.forEach(e=>{s.removeEventListener(e.event,e.listener)}),t.listeners.length=0)}},capLevelController:eh,errorController:class extends ra{constructor(e){super("error-controller",e.logger),this.hls=void 0,this.playlistError=0,this.hls=e,this.registerListeners()}registerListeners(){const e=this.hls;e.on(Hi.ERROR,this.onError,this),e.on(Hi.MANIFEST_LOADING,this.onManifestLoading,this),e.on(Hi.LEVEL_UPDATED,this.onLevelUpdated,this)}unregisterListeners(){const e=this.hls;e&&(e.off(Hi.ERROR,this.onError,this),e.off(Hi.ERROR,this.onErrorOut,this),e.off(Hi.MANIFEST_LOADING,this.onManifestLoading,this),e.off(Hi.LEVEL_UPDATED,this.onLevelUpdated,this))}destroy(){this.unregisterListeners(),this.hls=null}startLoad(e){}stopLoad(){this.playlistError=0}getVariantLevelIndex(e){return(null==e?void 0:e.type)===Xi?e.level:this.getVariantIndex()}getVariantIndex(){var e;const t=this.hls,s=t.currentLevel;return null!=(e=t.loadLevelObj)&&e.details||-1===s?t.loadLevel:s}variantHasKey(e,t){if(e){var s;if(null!=(s=e.details)&&s.hasKey(t))return!0;const n=e.audioGroups;if(n){return this.hls.allAudioTracks.filter(e=>n.indexOf(e.groupId)>=0).some(e=>{var s;return null==(s=e.details)?void 0:s.hasKey(t)})}}return!1}onManifestLoading(){this.playlistError=0}onLevelUpdated(){this.playlistError=0}onError(e,t){var s;if(t.fatal)return;const n=this.hls,r=t.context;switch(t.details){case zi.FRAG_LOAD_ERROR:case zi.FRAG_LOAD_TIMEOUT:case zi.KEY_LOAD_ERROR:case zi.KEY_LOAD_TIMEOUT:return void(t.errorAction=this.getFragRetryOrSwitchAction(t));case zi.FRAG_PARSING_ERROR:if(null!=(s=t.frag)&&s.gap)return void(t.errorAction=ul());case zi.FRAG_GAP:case zi.FRAG_DECRYPT_ERROR:return t.errorAction=this.getFragRetryOrSwitchAction(t),void(t.errorAction.action=rl);case zi.LEVEL_EMPTY_ERROR:case zi.LEVEL_PARSING_ERROR:{var i;const e=t.parent===Xi?t.level:n.loadLevel;t.details===zi.LEVEL_EMPTY_ERROR&&null!=(i=t.context)&&null!=(i=i.levelDetails)&&i.live?t.errorAction=this.getPlaylistRetryOrSwitchAction(t,e):(t.levelRetry=!1,t.errorAction=this.getLevelSwitchAction(t,e))}return;case zi.LEVEL_LOAD_ERROR:case zi.LEVEL_LOAD_TIMEOUT:return void("number"===typeof(null==r?void 0:r.level)&&(t.errorAction=this.getPlaylistRetryOrSwitchAction(t,r.level)));case zi.AUDIO_TRACK_LOAD_ERROR:case zi.AUDIO_TRACK_LOAD_TIMEOUT:case zi.SUBTITLE_LOAD_ERROR:case zi.SUBTITLE_TRACK_LOAD_TIMEOUT:if(r){const e=n.loadLevelObj;if(e&&(r.type===qi&&e.hasAudioGroup(r.groupId)||r.type===Yi&&e.hasSubtitleGroup(r.groupId)))return t.errorAction=this.getPlaylistRetryOrSwitchAction(t,n.loadLevel),t.errorAction.action=rl,void(t.errorAction.flags=ll)}return;case zi.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED:return void(t.errorAction={action:rl,flags:cl});case zi.KEY_SYSTEM_SESSION_UPDATE_FAILED:case zi.KEY_SYSTEM_STATUS_INTERNAL_ERROR:case zi.KEY_SYSTEM_NO_SESSION:return void(t.errorAction={action:rl,flags:dl});case zi.BUFFER_ADD_CODEC_ERROR:case zi.REMUX_ALLOC_ERROR:case zi.BUFFER_APPEND_ERROR:var a;if(!t.errorAction)t.errorAction=this.getLevelSwitchAction(t,null!=(a=t.level)?a:n.loadLevel);return;case zi.INTERNAL_EXCEPTION:case zi.BUFFER_APPENDING_ERROR:case zi.BUFFER_FULL_ERROR:case zi.LEVEL_SWITCH_ERROR:case zi.BUFFER_STALLED_ERROR:case zi.BUFFER_SEEK_OVER_HOLE:case zi.BUFFER_NUDGE_ON_STALL:return void(t.errorAction=ul())}t.type===Vi.KEY_SYSTEM_ERROR&&(t.levelRetry=!1,t.errorAction=ul())}getPlaylistRetryOrSwitchAction(e,t){const s=Jo(this.hls.config.playlistLoadPolicy,e),n=this.playlistError++;if(tl(s,n,Xo(e),e.response))return{action:al,flags:ol,retryConfig:s,retryCount:n};const r=this.getLevelSwitchAction(e,t);return s&&(r.retryConfig=s,r.retryCount=n),r}getFragRetryOrSwitchAction(e){const t=this.hls,s=this.getVariantLevelIndex(e.frag),n=t.levels[s],{fragLoadPolicy:r,keyLoadPolicy:i}=t.config,a=Jo(Qo(e)?i:r,e),o=t.levels.reduce((e,t)=>e+t.fragmentError,0);if(n&&(e.details!==zi.FRAG_GAP&&n.fragmentError++,!$o(e))){if(tl(a,o,Xo(e),e.response))return{action:al,flags:ol,retryConfig:a,retryCount:o}}const l=this.getLevelSwitchAction(e,s);return a&&(l.retryConfig=a,l.retryCount=o),l}getLevelSwitchAction(e,t){const s=this.hls;null!==t&&void 0!==t||(t=s.loadLevel);const n=this.hls.levels[t];if(n){var r,i;const t=e.details;n.loadError++,t===zi.BUFFER_APPEND_ERROR&&n.fragmentError++;let l=-1;const{levels:c,loadLevel:d,minAutoLevel:u,maxAutoLevel:h}=s;s.autoLevelEnabled||s.config.preserveManualLevelOnError||(s.loadLevel=-1);const f=null==(r=e.frag)?void 0:r.type,m=(f===Qi&&t===zi.FRAG_PARSING_ERROR||"audio"===e.sourceBufferName&&(t===zi.BUFFER_ADD_CODEC_ERROR||t===zi.BUFFER_APPEND_ERROR))&&c.some(e=>{let{audioCodec:t}=e;return n.audioCodec!==t}),p="video"===e.sourceBufferName&&(t===zi.BUFFER_ADD_CODEC_ERROR||t===zi.BUFFER_APPEND_ERROR)&&c.some(e=>{let{codecSet:t,audioCodec:s}=e;return n.codecSet!==t&&n.audioCodec===s}),{type:g,groupId:v}=null!=(i=e.context)?i:{};for(let s=c.length;s--;){const r=(s+d)%c.length;if(r!==d&&r>=u&&r<=h&&0===c[r].loadError){var a,o;const s=c[r];if(t===zi.FRAG_GAP&&f===Xi&&e.frag){const t=c[r].details;if(t){const s=Ko(e.frag,t.fragments,e.frag.start);if(null!=s&&s.gap)continue}}else{if(g===qi&&s.hasAudioGroup(v)||g===Yi&&s.hasSubtitleGroup(v))continue;if(f===Qi&&null!=(a=n.audioGroups)&&a.some(e=>s.hasAudioGroup(e))||f===$i&&null!=(o=n.subtitleGroups)&&o.some(e=>s.hasSubtitleGroup(e))||m&&n.audioCodec===s.audioCodec||p&&n.codecSet===s.codecSet||!m&&n.codecSet!==s.codecSet)continue}l=r;break}}if(l>-1&&s.loadLevel!==l)return e.levelRetry=!0,this.playlistError=0,{action:rl,flags:ol,nextAutoLevel:l}}return{action:rl,flags:ll}}onErrorOut(e,t){var s;switch(null==(s=t.errorAction)?void 0:s.action){case nl:break;case rl:this.sendAlternateToPenaltyBox(t),t.errorAction.resolved||t.details===zi.FRAG_GAP?/MediaSource readyState: ended/.test(t.error.message)&&(this.warn('MediaSource ended after "'.concat(t.sourceBufferName,'" sourceBuffer append error. Attempting to recover from media error.')),this.hls.recoverMediaError()):t.fatal=!0}t.fatal&&this.hls.stopLoad()}sendAlternateToPenaltyBox(e){const t=this.hls,s=e.errorAction;if(!s)return;const{flags:n}=s,r=s.nextAutoLevel;switch(n){case ol:this.switchLevel(e,r);break;case cl:{const n=this.getVariantLevelIndex(e.frag),r=t.levels[n],i=null==r?void 0:r.attrs["HDCP-LEVEL"];if(s.hdcpLevel=i,"NONE"===i)this.warn("HDCP policy resticted output with HDCP-LEVEL=NONE");else if(i){t.maxHdcpLevel=wo[wo.indexOf(i)-1],s.resolved=!0,this.warn('Restricting playback to HDCP-LEVEL of "'.concat(t.maxHdcpLevel,'" or lower'));break}}case dl:{const t=e.decryptdata;if(t){const n=this.hls.levels,r=n.length;for(let s=r;s--;){var i,a;if(this.variantHasKey(n[s],t))this.log("Banned key found in level ".concat(s," (").concat(n[s].bitrate,'bps) or audio group "').concat(null==(i=n[s].audioGroups)?void 0:i.join(","),'" (').concat(null==(a=e.frag)?void 0:a.type," fragment) ").concat(ma(t.keyId||[]))),n[s].fragmentError++,n[s].loadError++,this.log("Removing level ".concat(s," with key error (").concat(e.error,")")),this.hls.removeLevel(s)}const o=e.frag;if(this.hls.levels.length<r)s.resolved=!0;else if(o&&o.type!==Xi){const e=o.decryptdata;e&&!t.matches(e)&&(s.resolved=!0)}}break}}s.resolved||this.switchLevel(e,r)}switchLevel(e,t){if(void 0!==t&&e.errorAction&&(this.warn("switching to level ".concat(t," after ").concat(e.details)),this.hls.nextAutoLevel=t,e.errorAction.resolved=!0,this.hls.nextLoadLevel=this.hls.nextAutoLevel,e.details===zi.BUFFER_ADD_CODEC_ERROR&&e.mimeType&&"audiovideo"!==e.sourceBufferName)){const t=vo(e.mimeType),s=this.hls.levels;for(let n=s.length;n--;)s[n]["".concat(e.sourceBufferName,"Codec")]===t&&(this.log("Removing level ".concat(n," for ").concat(e.details,' ("').concat(t,'" not supported)')),this.hls.removeLevel(n))}}},fpsController:class{constructor(e){this.hls=void 0,this.isVideoPlaybackQualityAvailable=!1,this.timer=void 0,this.media=null,this.lastTime=void 0,this.lastDroppedFrames=0,this.lastDecodedFrames=0,this.streamController=void 0,this.hls=e,this.registerListeners()}setStreamController(e){this.streamController=e}registerListeners(){this.hls.on(Hi.MEDIA_ATTACHING,this.onMediaAttaching,this),this.hls.on(Hi.MEDIA_DETACHING,this.onMediaDetaching,this)}unregisterListeners(){this.hls.off(Hi.MEDIA_ATTACHING,this.onMediaAttaching,this),this.hls.off(Hi.MEDIA_DETACHING,this.onMediaDetaching,this)}destroy(){this.timer&&clearInterval(this.timer),this.unregisterListeners(),this.isVideoPlaybackQualityAvailable=!1,this.media=null}onMediaAttaching(e,t){const s=this.hls.config;if(s.capLevelOnFPSDrop){const e=t.media instanceof self.HTMLVideoElement?t.media:null;this.media=e,e&&"function"===typeof e.getVideoPlaybackQuality&&(this.isVideoPlaybackQualityAvailable=!0),self.clearInterval(this.timer),this.timer=self.setInterval(this.checkFPSInterval.bind(this),s.fpsDroppedMonitoringPeriod)}}onMediaDetaching(){this.media=null}checkFPS(e,t,s){const n=performance.now();if(t){if(this.lastTime){const e=n-this.lastTime,r=s-this.lastDroppedFrames,i=t-this.lastDecodedFrames,a=1e3*r/e,o=this.hls;if(o.trigger(Hi.FPS_DROP,{currentDropped:r,currentDecoded:i,totalDroppedFrames:s}),a>0&&r>o.config.fpsDroppedMonitoringThreshold*i){let e=o.currentLevel;o.logger.warn("drop FPS ratio greater than max allowed value for currentLevel: "+e),e>0&&(-1===o.autoLevelCapping||o.autoLevelCapping>=e)&&(e-=1,o.trigger(Hi.FPS_DROP_LEVEL_CAPPING,{level:e,droppedLevel:o.currentLevel}),o.autoLevelCapping=e,this.streamController.nextLevelSwitch())}}this.lastTime=n,this.lastDroppedFrames=s,this.lastDecodedFrames=t}}checkFPSInterval(){const e=this.media;if(e)if(this.isVideoPlaybackQualityAvailable){const t=e.getVideoPlaybackQuality();this.checkFPS(e,t.totalVideoFrames,t.droppedVideoFrames)}else this.checkFPS(e,e.webkitDecodedFrameCount,e.webkitDroppedFrameCount)}},stretchShortVideoTrack:!1,maxAudioFramesDrift:1,forceKeyFrameOnDiscontinuity:!0,abrEwmaFastLive:3,abrEwmaSlowLive:9,abrEwmaFastVoD:3,abrEwmaSlowVoD:9,abrEwmaDefaultEstimate:5e5,abrEwmaDefaultEstimateMax:5e6,abrBandWidthFactor:.95,abrBandWidthUpFactor:.7,abrMaxWithRealBitrate:!1,maxStarvationDelay:4,maxLoadingDelay:4,minAutoBitrate:0,emeEnabled:!1,widevineLicenseUrl:void 0,drmSystems:{},drmSystemOptions:{},requestMediaKeySystemAccessFunc:dc,requireKeySystemAccessOnStart:!1,testBandwidth:!0,progressive:!1,lowLatencyMode:!0,cmcd:void 0,enableDateRangeMetadataCues:!0,enableEmsgMetadataCues:!0,enableEmsgKLVMetadata:!1,enableID3MetadataCues:!0,enableInterstitialPlayback:!0,interstitialAppendInPlace:!0,interstitialLiveLookAhead:10,useMediaCapabilities:!0,preserveManualLevelOnError:!1,certLoadPolicy:{default:{maxTimeToFirstByteMs:8e3,maxLoadTimeMs:2e4,timeoutRetry:null,errorRetry:null}},keyLoadPolicy:{default:{maxTimeToFirstByteMs:8e3,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:2e4,backoff:"linear"},errorRetry:{maxNumRetry:8,retryDelayMs:1e3,maxRetryDelayMs:2e4,backoff:"linear"}}},manifestLoadPolicy:{default:{maxTimeToFirstByteMs:1/0,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},playlistLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:2,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},fragLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:12e4,timeoutRetry:{maxNumRetry:4,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:6,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},steeringManifestLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},interstitialAssetListLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:3e4,timeoutRetry:{maxNumRetry:0,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:0,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1e3,manifestLoadingMaxRetryTimeout:64e3,levelLoadingTimeOut:1e4,levelLoadingMaxRetry:4,levelLoadingRetryDelay:1e3,levelLoadingMaxRetryTimeout:64e3,fragLoadingTimeOut:2e4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1e3,fragLoadingMaxRetryTimeout:64e3},{cueHandler:ym,enableWebVTT:!0,enableIMSC1:!0,enableCEA708Captions:!0,captionsTextTrack1Label:"English",captionsTextTrack1LanguageCode:"en",captionsTextTrack2Label:"Spanish",captionsTextTrack2LanguageCode:"es",captionsTextTrack3Label:"Unknown CC",captionsTextTrack3LanguageCode:"",captionsTextTrack4Label:"Unknown CC",captionsTextTrack4LanguageCode:"",renderTextTracksNatively:!0}),{},{subtitleStreamController:class extends hd{constructor(e,t,s){super(e,t,s,"subtitle-stream-controller",$i),this.currentTrackId=-1,this.tracksBuffered=[],this.mainDetails=null,this.registerListeners()}onHandlerDestroying(){this.unregisterListeners(),super.onHandlerDestroying(),this.mainDetails=null}registerListeners(){super.registerListeners();const{hls:e}=this;e.on(Hi.LEVEL_LOADED,this.onLevelLoaded,this),e.on(Hi.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.on(Hi.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.on(Hi.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.on(Hi.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),e.on(Hi.BUFFER_FLUSHING,this.onBufferFlushing,this)}unregisterListeners(){super.unregisterListeners();const{hls:e}=this;e.off(Hi.LEVEL_LOADED,this.onLevelLoaded,this),e.off(Hi.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.off(Hi.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.off(Hi.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.off(Hi.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),e.off(Hi.BUFFER_FLUSHING,this.onBufferFlushing,this)}startLoad(e,t){this.stopLoad(),this.state=td,this.setInterval(500),this.nextLoadPosition=this.lastCurrentTime=e+this.timelineOffset,this.startPosition=t?-1:e,this.tick()}onManifestLoading(){super.onManifestLoading(),this.mainDetails=null}onMediaDetaching(e,t){this.tracksBuffered=[],super.onMediaDetaching(e,t)}onLevelLoaded(e,t){this.mainDetails=t.details}onSubtitleFragProcessed(e,t){const{frag:s,success:n}=t;if(this.fragContextChanged(s)||(wa(s)&&(this.fragPrevious=s),this.state=td),!n)return;const r=this.tracksBuffered[this.currentTrackId];if(!r)return;let i;const a=s.start;for(let l=0;l<r.length;l++)if(a>=r[l].start&&a<=r[l].end){i=r[l];break}const o=s.start+s.duration;i?i.end=o:(i={start:a,end:o},r.push(i)),this.fragmentTracker.fragBuffered(s),this.fragBufferedComplete(s,null),this.media&&this.tick()}onBufferFlushing(e,t){const{startOffset:s,endOffset:n}=t;if(0===s&&n!==Number.POSITIVE_INFINITY){const e=n-1;if(e<=0)return;t.endOffsetSubtitles=Math.max(0,e),this.tracksBuffered.forEach(t=>{for(let s=0;s<t.length;)if(t[s].end<=e)t.shift();else{if(!(t[s].start<e))break;t[s].start=e,s++}}),this.fragmentTracker.removeFragmentsInRange(s,e,$i)}}onError(e,t){const s=t.frag;(null==s?void 0:s.type)===$i&&(t.details===zi.FRAG_GAP&&this.fragmentTracker.fragBuffered(s,!0),this.fragCurrent&&this.fragCurrent.abortRequests(),this.state!==ed&&(this.state=td))}onSubtitleTracksUpdated(e,t){let{subtitleTracks:s}=t;this.levels&&Ku(this.levels,s)?this.levels=s.map(e=>new Io(e)):(this.tracksBuffered=[],this.levels=s.map(e=>{const t=new Io(e);return this.tracksBuffered[t.id]=[],t}),this.fragmentTracker.removeFragmentsInRange(0,Number.POSITIVE_INFINITY,$i),this.fragPrevious=null,this.mediaBuffer=null)}onSubtitleTrackSwitch(e,t){var s;if(this.currentTrackId=t.id,null==(s=this.levels)||!s.length||-1===this.currentTrackId)return void this.clearInterval();const n=this.levels[this.currentTrackId];null!=n&&n.details?this.mediaBuffer=this.mediaBufferTimeRanges:this.mediaBuffer=null,n&&this.state!==ed&&this.setInterval(500)}onSubtitleTrackLoaded(e,t){var s;const{currentTrackId:n,levels:r}=this,{details:i,id:a}=t;if(!r)return void this.warn("Subtitle tracks were reset while loading level ".concat(a));const o=r[a];if(a>=r.length||!o)return;this.log("Subtitle track ".concat(a," loaded [").concat(i.startSN,",").concat(i.endSN,"]").concat(i.lastPartSn?"[part-".concat(i.lastPartSn,"-").concat(i.lastPartIndex,"]"):"",",duration:").concat(i.totalduration)),this.mediaBuffer=this.mediaBufferTimeRanges;let l=0;if(i.live||null!=(s=o.details)&&s.live){if(i.deltaUpdateFailed)return;const e=this.mainDetails;if(!e)return void(this.startFragRequested=!1);const t=e.fragments[0];var c;if(o.details)l=this.alignPlaylists(i,o.details,null==(c=this.levelLastLoaded)?void 0:c.details),0===l&&t&&(l=t.start,Fc(i,l));else i.hasProgramDateTime&&e.hasProgramDateTime?(Qc(i,e),l=i.fragmentStart):t&&(l=t.start,Fc(i,l));e&&!this.startFragRequested&&this.setStartPosition(e,l)}if(o.details=i,this.levelLastLoaded=o,a===n&&(this.hls.trigger(Hi.SUBTITLE_TRACK_UPDATED,{details:i,id:a,groupId:t.groupId}),this.tick(),i.live&&!this.fragCurrent&&this.media&&this.state===td)){Ko(null,i.fragments,this.media.currentTime,0)||(this.warn("Subtitle playlist not aligned with playback"),o.details=void 0)}}_handleFragmentLoadComplete(e){const{frag:t,payload:s}=e,n=t.decryptdata,r=this.hls;if(!this.fragContextChanged(t)&&s&&s.byteLength>0&&null!=n&&n.key&&n.iv&&Xl(n.method)){const e=performance.now();this.decrypter.decrypt(new Uint8Array(s),n.key.buffer,n.iv.buffer,Ql(n.method)).catch(e=>{throw r.trigger(Hi.ERROR,{type:Vi.MEDIA_ERROR,details:zi.FRAG_DECRYPT_ERROR,fatal:!1,error:e,reason:e.message,frag:t}),e}).then(s=>{const n=performance.now();r.trigger(Hi.FRAG_DECRYPTED,{frag:t,payload:s,stats:{tstart:e,tdecrypt:n}})}).catch(e=>{this.warn("".concat(e.name,": ").concat(e.message)),this.state=td})}}doTick(){if(this.media){if(this.state===td){const{currentTrackId:e,levels:t}=this,s=null==t?void 0:t[e];if(!s||!t.length||!s.details)return;if(this.waitForLive(s))return;const{config:n}=this,r=this.getLoadPosition(),i=Pl.bufferedInfo(this.tracksBuffered[this.currentTrackId]||[],r,n.maxBufferHole),{end:a,len:o}=i,l=s.details;if(o>this.hls.maxBufferLength+l.levelTargetDuration)return;const c=l.fragments,d=c.length,u=l.edge;let h=null;const f=this.fragPrevious;if(a<u){const e=n.maxFragLookUpTolerance,t=a>u-e?0:e;h=Ko(f,c,Math.max(c[0].start,a),t),!h&&f&&f.start<c[0].start&&(h=c[0])}else h=c[d-1];if(h=this.filterReplacedPrimary(h,s.details),!h)return;const m=c[h.sn-l.startSN-1];if(m&&m.cc===h.cc&&this.fragmentTracker.getState(m)===hl&&(h=m),this.fragmentTracker.getState(h)===hl){const e=this.mapToInitFragWhenRequired(h);e&&this.loadFragment(e,s,a)}}}else this.state=td}loadFragment(e,t,s){wa(e)?super.loadFragment(e,t,s):this._loadInitSegment(e,t)}get mediaBufferTimeRanges(){return new Sf(this.tracksBuffered[this.currentTrackId]||[])}},subtitleTrackController:class extends Hu{constructor(e){super(e,"subtitle-track-controller"),this.media=null,this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0,this.queuedDefaultTrack=-1,this.useTextTrackPolling=!1,this.subtitlePollingInterval=-1,this._subtitleDisplay=!0,this.asyncPollTrackChange=()=>this.pollTrackChange(0),this.onTextTracksChanged=()=>{if(this.useTextTrackPolling||self.clearInterval(this.subtitlePollingInterval),!this.media||!this.hls.config.renderTextTracksNatively)return;let e=null;const t=af(this.media.textTracks);for(let n=0;n<t.length;n++)if("hidden"===t[n].mode)e=t[n];else if("showing"===t[n].mode){e=t[n];break}const s=this.findTrackForTextTrack(e);this.subtitleTrack!==s&&this.setSubtitleTrack(s)},this.registerListeners()}destroy(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.currentTrack=null,this.onTextTracksChanged=this.asyncPollTrackChange=null,super.destroy()}get subtitleDisplay(){return this._subtitleDisplay}set subtitleDisplay(e){this._subtitleDisplay=e,this.trackId>-1&&this.toggleTrackModes()}registerListeners(){const{hls:e}=this;e.on(Hi.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(Hi.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(Hi.MANIFEST_LOADING,this.onManifestLoading,this),e.on(Hi.MANIFEST_PARSED,this.onManifestParsed,this),e.on(Hi.LEVEL_LOADING,this.onLevelLoading,this),e.on(Hi.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(Hi.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.on(Hi.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(Hi.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(Hi.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(Hi.MANIFEST_LOADING,this.onManifestLoading,this),e.off(Hi.MANIFEST_PARSED,this.onManifestParsed,this),e.off(Hi.LEVEL_LOADING,this.onLevelLoading,this),e.off(Hi.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(Hi.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.off(Hi.ERROR,this.onError,this)}onMediaAttached(e,t){this.media=t.media,this.media&&(this.queuedDefaultTrack>-1&&(this.subtitleTrack=this.queuedDefaultTrack,this.queuedDefaultTrack=-1),this.useTextTrackPolling=!(this.media.textTracks&&"onchange"in this.media.textTracks),this.useTextTrackPolling?this.pollTrackChange(500):this.media.textTracks.addEventListener("change",this.asyncPollTrackChange))}pollTrackChange(e){self.clearInterval(this.subtitlePollingInterval),this.subtitlePollingInterval=self.setInterval(this.onTextTracksChanged,e)}onMediaDetaching(e,t){const s=this.media;if(!s)return;const n=!!t.transferMedia;if(self.clearInterval(this.subtitlePollingInterval),this.useTextTrackPolling||s.textTracks.removeEventListener("change",this.asyncPollTrackChange),this.trackId>-1&&(this.queuedDefaultTrack=this.trackId),this.subtitleTrack=-1,this.media=null,n)return;af(s.textTracks).forEach(e=>{nf(e)})}onManifestLoading(){this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0}onManifestParsed(e,t){this.tracks=t.subtitleTracks}onSubtitleTrackLoaded(e,t){const{id:s,groupId:n,details:r}=t,i=this.tracksInGroup[s];if(!i||i.groupId!==n)return void this.warn("Subtitle track with id:".concat(s," and group:").concat(n," not found in active group ").concat(null==i?void 0:i.groupId));const a=i.details;i.details=t.details,this.log("Subtitle track ".concat(s,' "').concat(i.name,'" lang:').concat(i.lang," group:").concat(n," loaded [").concat(r.startSN,"-").concat(r.endSN,"]")),s===this.trackId&&this.playlistLoaded(s,t,a)}onLevelLoading(e,t){this.switchLevel(t.level)}onLevelSwitching(e,t){this.switchLevel(t.level)}switchLevel(e){const t=this.hls.levels[e];if(!t)return;const s=t.subtitleGroups||null,n=this.groupIds;let r=this.currentTrack;if(!s||(null==n?void 0:n.length)!==(null==s?void 0:s.length)||null!=s&&s.some(e=>-1===(null==n?void 0:n.indexOf(e)))){this.groupIds=s,this.trackId=-1,this.currentTrack=null;const e=this.tracks.filter(e=>!s||-1!==s.indexOf(e.groupId));if(e.length)this.selectDefaultTrack&&!e.some(e=>e.default)&&(this.selectDefaultTrack=!1),e.forEach((e,t)=>{e.id=t});else if(!r&&!this.tracksInGroup.length)return;this.tracksInGroup=e;const t=this.hls.config.subtitlePreference;if(!r&&t){this.selectDefaultTrack=!1;const s=Uo(t,e);if(s>-1)r=e[s];else{const e=Uo(t,this.tracks);r=this.tracks[e]}}let n=this.findTrackId(r);-1===n&&r&&(n=this.findTrackId(null));const i={subtitleTracks:e};this.log("Updating subtitle tracks, ".concat(e.length,' track(s) found in "').concat(null==s?void 0:s.join(","),'" group-id')),this.hls.trigger(Hi.SUBTITLE_TRACKS_UPDATED,i),-1!==n&&-1===this.trackId&&this.setSubtitleTrack(n)}}findTrackId(e){const t=this.tracksInGroup,s=this.selectDefaultTrack;for(let n=0;n<t.length;n++){const r=t[n];if((!s||r.default)&&(s||e)&&(!e||Bo(r,e)))return n}if(e){for(let s=0;s<t.length;s++){const n=t[s];if(Wu(e.attrs,n.attrs,["LANGUAGE","ASSOC-LANGUAGE","CHARACTERISTICS"]))return s}for(let s=0;s<t.length;s++){const n=t[s];if(Wu(e.attrs,n.attrs,["LANGUAGE"]))return s}}return-1}findTrackForTextTrack(e){if(e){const t=this.tracksInGroup;for(let s=0;s<t.length;s++){if(qu(t[s],e))return s}}return-1}onError(e,t){!t.fatal&&t.context&&(t.context.type!==Yi||t.context.id!==this.trackId||this.groupIds&&-1===this.groupIds.indexOf(t.context.groupId)||this.checkRetry(t))}get allSubtitleTracks(){return this.tracks}get subtitleTracks(){return this.tracksInGroup}get subtitleTrack(){return this.trackId}set subtitleTrack(e){this.selectDefaultTrack=!1,this.setSubtitleTrack(e)}setSubtitleOption(e){if(this.hls.config.subtitlePreference=e,e){if(-1===e.id)return this.setSubtitleTrack(-1),null;const t=this.allSubtitleTracks;if(this.selectDefaultTrack=!1,t.length){const s=this.currentTrack;if(s&&Bo(e,s))return s;const n=Uo(e,this.tracksInGroup);if(n>-1){const e=this.tracksInGroup[n];return this.setSubtitleTrack(n),e}if(s)return null;{const s=Uo(e,t);if(s>-1)return t[s]}}}return null}loadPlaylist(e){super.loadPlaylist(),this.shouldLoadPlaylist(this.currentTrack)&&this.scheduleLoading(this.currentTrack,e)}loadingPlaylist(e,t){super.loadingPlaylist(e,t);const s=e.id,n=e.groupId,r=this.getUrlWithDirectives(e.url,t),i=e.details,a=null==i?void 0:i.age;this.log("Loading subtitle ".concat(s,' "').concat(e.name,'" lang:').concat(e.lang," group:").concat(n).concat(void 0!==(null==t?void 0:t.msn)?" at sn "+t.msn+" part "+t.part:"").concat(a&&i.live?" age "+a.toFixed(1)+(i.type?" "+i.type||0:""):""," ").concat(r)),this.hls.trigger(Hi.SUBTITLE_TRACK_LOADING,{url:r,id:s,groupId:n,deliveryDirectives:t||null,track:e})}toggleTrackModes(){const{media:e}=this;if(!e)return;const t=af(e.textTracks),s=this.currentTrack;let n;if(s&&(n=t.filter(e=>qu(s,e))[0],n||this.warn('Unable to find subtitle TextTrack with name "'.concat(s.name,'" and language "').concat(s.lang,'"'))),[].slice.call(t).forEach(e=>{"disabled"!==e.mode&&e!==n&&(e.mode="disabled")}),n){const e=this.subtitleDisplay?"showing":"hidden";n.mode!==e&&(n.mode=e)}}setSubtitleTrack(e){const t=this.tracksInGroup;if(!this.media)return void(this.queuedDefaultTrack=e);if(e<-1||e>=t.length||!Ui(e))return void this.warn("Invalid subtitle track id: ".concat(e));this.selectDefaultTrack=!1;const s=this.currentTrack,n=t[e]||null;if(this.trackId=e,this.currentTrack=n,this.toggleTrackModes(),!n)return void this.hls.trigger(Hi.SUBTITLE_TRACK_SWITCH,{id:e});const r=!!n.details&&!n.details.live;if(e===this.trackId&&n===s&&r)return;this.log("Switching to subtitle-track ".concat(e)+(n?' "'.concat(n.name,'" lang:').concat(n.lang," group:").concat(n.groupId):""));const{id:i,groupId:a="",name:o,type:l,url:c}=n;this.hls.trigger(Hi.SUBTITLE_TRACK_SWITCH,{id:i,groupId:a,name:o,type:l,url:c});const d=this.switchParams(n.url,null==s?void 0:s.details,n.details);this.loadPlaylist(d)}},timelineController:class{constructor(e){this.hls=void 0,this.media=null,this.config=void 0,this.enabled=!0,this.Cues=void 0,this.textTracks=[],this.tracks=[],this.initPTS=[],this.unparsedVttFrags=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.cea608Parser1=void 0,this.cea608Parser2=void 0,this.lastCc=-1,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs={ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!0}},this.captionsProperties=void 0,this.hls=e,this.config=e.config,this.Cues=e.config.cueHandler,this.captionsProperties={textTrack1:{label:this.config.captionsTextTrack1Label,languageCode:this.config.captionsTextTrack1LanguageCode},textTrack2:{label:this.config.captionsTextTrack2Label,languageCode:this.config.captionsTextTrack2LanguageCode},textTrack3:{label:this.config.captionsTextTrack3Label,languageCode:this.config.captionsTextTrack3LanguageCode},textTrack4:{label:this.config.captionsTextTrack4Label,languageCode:this.config.captionsTextTrack4LanguageCode}},e.on(Hi.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(Hi.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(Hi.MANIFEST_LOADING,this.onManifestLoading,this),e.on(Hi.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(Hi.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.on(Hi.FRAG_LOADING,this.onFragLoading,this),e.on(Hi.FRAG_LOADED,this.onFragLoaded,this),e.on(Hi.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),e.on(Hi.FRAG_DECRYPTED,this.onFragDecrypted,this),e.on(Hi.INIT_PTS_FOUND,this.onInitPtsFound,this),e.on(Hi.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),e.on(Hi.BUFFER_FLUSHING,this.onBufferFlushing,this)}destroy(){const{hls:e}=this;e.off(Hi.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(Hi.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(Hi.MANIFEST_LOADING,this.onManifestLoading,this),e.off(Hi.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(Hi.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.off(Hi.FRAG_LOADING,this.onFragLoading,this),e.off(Hi.FRAG_LOADED,this.onFragLoaded,this),e.off(Hi.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),e.off(Hi.FRAG_DECRYPTED,this.onFragDecrypted,this),e.off(Hi.INIT_PTS_FOUND,this.onInitPtsFound,this),e.off(Hi.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),e.off(Hi.BUFFER_FLUSHING,this.onBufferFlushing,this),this.hls=this.config=this.media=null,this.cea608Parser1=this.cea608Parser2=void 0}initCea608Parsers(){const e=new fm(this,"textTrack1"),t=new fm(this,"textTrack2"),s=new fm(this,"textTrack3"),n=new fm(this,"textTrack4");this.cea608Parser1=new Uf(1,e,t),this.cea608Parser2=new Uf(3,s,n)}addCues(e,t,s,n,r){let i=!1;for(let a=r.length;a--;){const e=r[a],n=gm(e[0],e[1],t,s);if(n>=0&&(e[0]=Math.min(e[0],t),e[1]=Math.max(e[1],s),i=!0,n/(s-t)>.5))return}if(i||r.push([t,s]),this.config.renderTextTracksNatively){const r=this.captionsTracks[e];this.Cues.newCue(r,t,s,n)}else{const r=this.Cues.newCue(null,t,s,n);this.hls.trigger(Hi.CUES_PARSED,{type:"captions",cues:r,track:e})}}onInitPtsFound(e,t){let{frag:s,id:n,initPTS:r,timescale:i,trackId:a}=t;const{unparsedVttFrags:o}=this;n===Xi&&(this.initPTS[s.cc]={baseTime:r,timescale:i,trackId:a}),o.length&&(this.unparsedVttFrags=[],o.forEach(e=>{this.initPTS[e.frag.cc]?this.onFragLoaded(Hi.FRAG_LOADED,e):this.hls.trigger(Hi.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:e.frag,error:new Error("Subtitle discontinuity domain does not match main")})}))}getExistingTrack(e,t){const{media:s}=this;if(s)for(let n=0;n<s.textTracks.length;n++){const r=s.textTracks[n];if(pm(r,{name:e,lang:t,characteristics:"transcribes-spoken-dialog,describes-music-and-sound"}))return r}return null}createCaptionsTrack(e){this.config.renderTextTracksNatively?this.createNativeTrack(e):this.createNonNativeTrack(e)}createNativeTrack(e){if(this.captionsTracks[e])return;const{captionsProperties:t,captionsTracks:s,media:n}=this,{label:r,languageCode:i}=t[e],a=this.getExistingTrack(r,i);if(a)s[e]=a,nf(s[e]),tf(s[e],n);else{const t=this.createTextTrack("captions",r,i);t&&(t[e]=!0,s[e]=t)}}createNonNativeTrack(e){if(this.nonNativeCaptionsTracks[e])return;const t=this.captionsProperties[e];if(!t)return;const s={_id:e,label:t.label,kind:"captions",default:!!t.media&&!!t.media.default,closedCaptions:t.media};this.nonNativeCaptionsTracks[e]=s,this.hls.trigger(Hi.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:[s]})}createTextTrack(e,t,s){const n=this.media;if(n)return n.addTextTrack(e,t,s)}onMediaAttaching(e,t){this.media=t.media,t.mediaSource||this._cleanTracks()}onMediaDetaching(e,t){const s=!!t.transferMedia;if(this.media=null,s)return;const{captionsTracks:n}=this;Object.keys(n).forEach(e=>{nf(n[e]),delete n[e]}),this.nonNativeCaptionsTracks={}}onManifestLoading(){this.lastCc=-1,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs={ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!0}},this._cleanTracks(),this.tracks=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.textTracks=[],this.unparsedVttFrags=[],this.initPTS=[],this.cea608Parser1&&this.cea608Parser2&&(this.cea608Parser1.reset(),this.cea608Parser2.reset())}_cleanTracks(){const{media:e}=this;if(!e)return;const t=e.textTracks;if(t)for(let s=0;s<t.length;s++)nf(t[s])}onSubtitleTracksUpdated(e,t){const s=t.subtitleTracks||[],n=s.some(e=>e.textCodec===sm);if(this.config.enableWebVTT||n&&this.config.enableIMSC1){if(Ku(this.tracks,s))return void(this.tracks=s);if(this.textTracks=[],this.tracks=s,this.config.renderTextTracksNatively){const e=this.media,t=e?af(e.textTracks):null;if(this.tracks.forEach((e,s)=>{let n;if(t){let s=null;for(let n=0;n<t.length;n++)if(t[n]&&pm(t[n],e)){s=t[n],t[n]=null;break}s&&(n=s)}if(n)nf(n);else{const t=mm(e);n=this.createTextTrack(t,e.name,e.lang),n&&(n.mode="disabled")}n&&this.textTracks.push(n)}),null!=t&&t.length){const e=t.filter(e=>null!==e).map(e=>e.label);e.length&&this.hls.logger.warn("Media element contains unused subtitle tracks: ".concat(e.join(", "),". Replace media element for each source to clear TextTracks and captions menu."))}}else if(this.tracks.length){const e=this.tracks.map(e=>({label:e.name,kind:e.type.toLowerCase(),default:e.default,subtitleTrack:e}));this.hls.trigger(Hi.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:e})}}}onManifestLoaded(e,t){this.config.enableCEA708Captions&&t.captions&&t.captions.forEach(e=>{const t=/(?:CC|SERVICE)([1-4])/.exec(e.instreamId);if(!t)return;const s="textTrack".concat(t[1]),n=this.captionsProperties[s];n&&(n.label=e.name,e.lang&&(n.languageCode=e.lang),n.media=e)})}closedCaptionsForLevel(e){const t=this.hls.levels[e.level];return null==t?void 0:t.attrs["CLOSED-CAPTIONS"]}onFragLoading(e,t){if(this.enabled&&t.frag.type===Xi){var s,n;const{cea608Parser1:e,cea608Parser2:r,lastSn:i}=this,{cc:a,sn:o}=t.frag,l=null!=(s=null==(n=t.part)?void 0:n.index)?s:-1;e&&r&&(o!==i+1||o===i&&l!==this.lastPartIndex+1||a!==this.lastCc)&&(e.reset(),r.reset()),this.lastCc=a,this.lastSn=o,this.lastPartIndex=l}}onFragLoaded(e,t){const{frag:s,payload:n}=t;if(s.type===$i)if(n.byteLength){const e=s.decryptdata,r="stats"in t;if(null==e||!e.encrypted||r){const e=this.tracks[s.level],r=this.vttCCs;r[s.cc]||(r[s.cc]={start:s.start,prevCC:this.prevCC,new:!0},this.prevCC=s.cc),e&&e.textCodec===sm?this._parseIMSC1(s,n):this._parseVTTs(t)}}else this.hls.trigger(Hi.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:s,error:new Error("Empty subtitle payload")})}_parseIMSC1(e,t){const s=this.hls;am(t,this.initPTS[e.cc],t=>{this._appendCues(t,e.level),s.trigger(Hi.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:e})},t=>{s.logger.log("Failed to parse IMSC1: ".concat(t)),s.trigger(Hi.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:e,error:t})})}_parseVTTs(e){var t;const{frag:s,payload:n}=e,{initPTS:r,unparsedVttFrags:i}=this,a=r.length-1;if(!r[s.cc]&&-1===a)return void i.push(e);const o=this.hls;tm(null!=(t=s.initSegment)&&t.data?qa(s.initSegment.data,new Uint8Array(n)).buffer:n,this.initPTS[s.cc],this.vttCCs,s.cc,s.start,e=>{this._appendCues(e,s.level),o.trigger(Hi.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:s})},t=>{const r="Missing initPTS for VTT MPEGTS"===t.message;r?i.push(e):this._fallbackToIMSC1(s,n),o.logger.log("Failed to parse VTT cue: ".concat(t)),r&&a>s.cc||o.trigger(Hi.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:s,error:t})})}_fallbackToIMSC1(e,t){const s=this.tracks[e.level];s.textCodec||am(t,this.initPTS[e.cc],()=>{s.textCodec=sm,this._parseIMSC1(e,t)},()=>{s.textCodec="wvtt"})}_appendCues(e,t){const s=this.hls;if(this.config.renderTextTracksNatively){const s=this.textTracks[t];if(!s||"disabled"===s.mode)return;e.forEach(e=>sf(s,e))}else{const n=this.tracks[t];if(!n)return;const r=n.default?"default":"subtitles"+t;s.trigger(Hi.CUES_PARSED,{type:"subtitles",cues:e,track:r})}}onFragDecrypted(e,t){const{frag:s}=t;s.type===$i&&this.onFragLoaded(Hi.FRAG_LOADED,t)}onSubtitleTracksCleared(){this.tracks=[],this.captionsTracks={}}onFragParsingUserdata(e,t){if(!this.enabled||!this.config.enableCEA708Captions)return;const{frag:s,samples:n}=t;if(s.type!==Xi||"NONE"!==this.closedCaptionsForLevel(s))for(let r=0;r<n.length;r++){const e=n[r].bytes;if(e){this.cea608Parser1||this.initCea608Parsers();const t=this.extractCea608Data(e);this.cea608Parser1.addData(n[r].pts,t[0]),this.cea608Parser2.addData(n[r].pts,t[1])}}}onBufferFlushing(e,t){let{startOffset:s,endOffset:n,endOffsetSubtitles:r,type:i}=t;const{media:a}=this;if(a&&!(a.currentTime<n)){if(!i||"video"===i){const{captionsTracks:e}=this;Object.keys(e).forEach(t=>rf(e[t],s,n))}if(this.config.renderTextTracksNatively&&0===s&&void 0!==r){const{textTracks:e}=this;Object.keys(e).forEach(t=>rf(e[t],s,r))}}}extractCea608Data(e){const t=[[],[]],s=31&e[0];let n=2;for(let r=0;r<s;r++){const s=e[n++],r=127&e[n++],i=127&e[n++];if(0===r&&0===i)continue;if(0!==(4&s)){const e=3&s;0!==e&&1!==e||(t[e].push(r),t[e].push(i))}}return t}},audioStreamController:class extends hd{constructor(e,t,s){super(e,t,s,"audio-stream-controller",Qi),this.mainAnchor=null,this.mainFragLoading=null,this.audioOnly=!1,this.bufferedTrack=null,this.switchingTrack=null,this.trackId=-1,this.waitingData=null,this.mainDetails=null,this.flushing=!1,this.bufferFlushed=!1,this.cachedTrackLoadedData=null,this.registerListeners()}onHandlerDestroying(){this.unregisterListeners(),super.onHandlerDestroying(),this.resetItem()}resetItem(){this.mainDetails=this.mainAnchor=this.mainFragLoading=this.bufferedTrack=this.switchingTrack=this.waitingData=this.cachedTrackLoadedData=null}registerListeners(){super.registerListeners();const{hls:e}=this;e.on(Hi.LEVEL_LOADED,this.onLevelLoaded,this),e.on(Hi.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),e.on(Hi.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(Hi.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.on(Hi.BUFFER_RESET,this.onBufferReset,this),e.on(Hi.BUFFER_CREATED,this.onBufferCreated,this),e.on(Hi.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(Hi.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(Hi.INIT_PTS_FOUND,this.onInitPtsFound,this),e.on(Hi.FRAG_LOADING,this.onFragLoading,this),e.on(Hi.FRAG_BUFFERED,this.onFragBuffered,this)}unregisterListeners(){const{hls:e}=this;e&&(super.unregisterListeners(),e.off(Hi.LEVEL_LOADED,this.onLevelLoaded,this),e.off(Hi.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),e.off(Hi.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(Hi.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.off(Hi.BUFFER_RESET,this.onBufferReset,this),e.off(Hi.BUFFER_CREATED,this.onBufferCreated,this),e.off(Hi.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(Hi.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(Hi.INIT_PTS_FOUND,this.onInitPtsFound,this),e.off(Hi.FRAG_LOADING,this.onFragLoading,this),e.off(Hi.FRAG_BUFFERED,this.onFragBuffered,this))}onInitPtsFound(e,t){let{frag:s,id:n,initPTS:r,timescale:i,trackId:a}=t;if(n===Xi){const e=s.cc,t=this.fragCurrent;if(this.initPTS[e]={baseTime:r,timescale:i,trackId:a},this.log("InitPTS for cc: ".concat(e," found from main: ").concat(r/i," (").concat(r,"/").concat(i,") trackId: ").concat(a)),this.mainAnchor=s,this.state===dd){const t=this.waitingData;(!t&&!this.loadingParts||t&&t.frag.cc!==e)&&this.syncWithAnchor(s,null==t?void 0:t.frag)}else!this.hls.hasEnoughToStart&&t&&t.cc!==e?(t.abortRequests(),this.syncWithAnchor(s,t)):this.state===td&&this.tick()}}getLoadPosition(){return!this.startFragRequested&&this.nextLoadPosition>=0?this.nextLoadPosition:super.getLoadPosition()}syncWithAnchor(e,t){var s;const n=(null==(s=this.mainFragLoading)?void 0:s.frag)||null;if(t&&(null==n?void 0:n.cc)===t.cc)return;const r=(n||e).cc,i=Yo(this.getLevelDetails(),r,this.getLoadPosition());i&&(this.log("Syncing with main frag at ".concat(i.start," cc ").concat(i.cc)),this.startFragRequested=!1,this.nextLoadPosition=i.start,this.resetLoadingState(),this.state===td&&this.doTickIdle())}startLoad(e,t){if(!this.levels)return this.startPosition=e,void(this.state=ed);const s=this.lastCurrentTime;this.stopLoad(),this.setInterval(100),s>0&&-1===e?(this.log("Override startPosition with lastCurrentTime @".concat(s.toFixed(3))),e=s,this.state=td):this.state=id,this.nextLoadPosition=this.lastCurrentTime=e+this.timelineOffset,this.startPosition=t?-1:e,this.tick()}doTick(){switch(this.state){case td:this.doTickIdle();break;case id:{const{levels:e,trackId:t}=this,s=null==e?void 0:e[t],n=null==s?void 0:s.details;if(n&&!this.waitForLive(s)){if(this.waitForCdnTuneIn(n))break;this.state=dd}break}case rd:this.checkRetryDate();break;case dd:{const e=this.waitingData;if(e){const{frag:t,part:s,cache:n,complete:r}=e,i=this.mainAnchor;if(void 0!==this.initPTS[t.cc]){this.waitingData=null,this.state=nd;const e={frag:t,part:s,payload:n.flush().buffer,networkDetails:null};this._handleFragmentLoadProgress(e),r&&super._handleFragmentLoadComplete(e)}else i&&i.cc!==e.frag.cc&&this.syncWithAnchor(i,e.frag)}else this.state=td}}this.onTickEnd()}resetLoadingState(){const e=this.waitingData;e&&(this.fragmentTracker.removeFragment(e.frag),this.waitingData=null),super.resetLoadingState()}onTickEnd(){const{media:e}=this;null!=e&&e.readyState&&(this.lastCurrentTime=e.currentTime)}doTickIdle(){var e;const{hls:t,levels:s,media:n,trackId:r}=this,i=t.config;if(!this.buffering||!n&&!this.primaryPrefetch&&(this.startFragRequested||!i.startFragPrefetch)||null==s||!s[r])return;const a=s[r],o=a.details;if(!o||this.waitForLive(a)||this.waitForCdnTuneIn(o))return this.state=id,void(this.startFragRequested=!1);const l=this.mediaBuffer?this.mediaBuffer:this.media;this.bufferFlushed&&l&&(this.bufferFlushed=!1,this.afterBufferFlushed(l,Ea,Qi));const c=this.getFwdBufferInfo(l,Qi);if(null===c)return;if(!this.switchingTrack&&this._streamEnded(c,o))return t.trigger(Hi.BUFFER_EOS,{type:"audio"}),void(this.state=ld);const d=c.len,u=t.maxBufferLength,h=o.fragments,f=h[0].start,m=this.getLoadPosition(),p=this.flushing?m:c.end;if(this.switchingTrack&&n){const e=m;o.PTSKnown&&e<f&&(c.end>f||c.nextStart)&&(this.log("Alt audio track ahead of main track, seek to start of alt audio track"),n.currentTime=f+.05)}if(d>=u&&!this.switchingTrack&&p<h[h.length-1].start)return;let g=this.getNextFragment(p,o);if(g&&this.isLoopLoading(g,p)&&(g=this.getNextFragmentLoopLoading(g,o,c,Xi,u)),!g)return void(this.bufferFlushed=!0);let v=(null==(e=this.mainFragLoading)?void 0:e.frag)||null;if(!this.audioOnly&&this.startFragRequested&&v&&wa(g)&&!g.endList&&(!o.live||!this.loadingParts&&p<this.hls.liveSyncPosition)&&(this.fragmentTracker.getState(v)===pl&&(this.mainFragLoading=v=null),v&&wa(v))){if(g.start>v.end){const e=this.fragmentTracker.getFragAtPos(p,Xi);e&&e.end>v.end&&(v=e,this.mainFragLoading={frag:e,targetBufferTime:null})}if(g.start>v.end)return}this.loadFragment(g,a,p)}onMediaDetaching(e,t){this.bufferFlushed=this.flushing=!1,super.onMediaDetaching(e,t)}onAudioTracksUpdated(e,t){let{audioTracks:s}=t;this.resetTransmuxer(),this.levels=s.map(e=>new Io(e))}onAudioTrackSwitching(e,t){const s=!!t.url;this.trackId=t.id;const{fragCurrent:n}=this;n&&(n.abortRequests(),this.removeUnbufferedFrags(n.start)),this.resetLoadingState(),s?(this.switchingTrack=t,this.flushAudioIfNeeded(t),this.state!==ed&&(this.setInterval(100),this.state=td,this.tick())):(this.resetTransmuxer(),this.switchingTrack=null,this.bufferedTrack=t,this.clearInterval())}onManifestLoading(){super.onManifestLoading(),this.bufferFlushed=this.flushing=this.audioOnly=!1,this.resetItem(),this.trackId=-1}onLevelLoaded(e,t){this.mainDetails=t.details;const s=this.cachedTrackLoadedData;s&&(this.cachedTrackLoadedData=null,this.onAudioTrackLoaded(Hi.AUDIO_TRACK_LOADED,s))}onAudioTrackLoaded(e,t){var s;const{levels:n}=this,{details:r,id:i,groupId:a,track:o}=t;if(!n)return void this.warn("Audio tracks reset while loading track ".concat(i,' "').concat(o.name,'" of "').concat(a,'"'));const l=this.mainDetails;if(!l||r.endCC>l.endCC||l.expired)return this.cachedTrackLoadedData=t,void(this.state!==ed&&(this.state=id));this.cachedTrackLoadedData=null,this.log("Audio track ".concat(i,' "').concat(o.name,'" of "').concat(a,'" loaded [').concat(r.startSN,",").concat(r.endSN,"]").concat(r.lastPartSn?"[part-".concat(r.lastPartSn,"-").concat(r.lastPartIndex,"]"):"",",duration:").concat(r.totalduration));const c=n[i];let d=0;if(r.live||null!=(s=c.details)&&s.live){if(this.checkLiveUpdate(r),r.deltaUpdateFailed)return;var u;if(c.details)d=this.alignPlaylists(r,c.details,null==(u=this.levelLastLoaded)?void 0:u.details);r.alignedSliding||(Xc(r,l),r.alignedSliding||Qc(r,l),d=r.fragmentStart)}c.details=r,this.levelLastLoaded=c,this.startFragRequested||this.setStartPosition(l,d),this.hls.trigger(Hi.AUDIO_TRACK_UPDATED,{details:r,id:i,groupId:t.groupId}),this.state!==id||this.waitForCdnTuneIn(r)||(this.state=td),this.tick()}_handleFragmentLoadProgress(e){var t;const s=e.frag,{part:n,payload:r}=e,{config:i,trackId:a,levels:o}=this;if(!o)return void this.warn("Audio tracks were reset while fragment load was in progress. Fragment ".concat(s.sn," of level ").concat(s.level," will not be buffered"));const l=o[a];if(!l)return void this.warn("Audio track is undefined on fragment load progress");const c=l.details;if(!c)return this.warn("Audio track details undefined on fragment load progress"),void this.removeUnbufferedFrags(s.start);const d=i.defaultAudioCodec||l.audioCodec||"mp4a.40.2";let u=this.transmuxer;u||(u=this.transmuxer=new zu(this.hls,Qi,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)));const h=this.initPTS[s.cc],f=null==(t=s.initSegment)?void 0:t.data;if(void 0!==h){const e=!1,t=n?n.index:-1,i=-1!==t,a=new Il(s.level,s.sn,s.stats.chunkCount,r.byteLength,t,i);u.push(r,f,d,"",s,n,c.totalduration,e,a,h)}else{this.log("Unknown video PTS for cc ".concat(s.cc,", waiting for video PTS before demuxing audio frag ").concat(s.sn," of [").concat(c.startSN," ,").concat(c.endSN,"],track ").concat(a));const{cache:e}=this.waitingData=this.waitingData||{frag:s,part:n,cache:new md,complete:!1};e.push(new Uint8Array(r)),this.state!==ed&&(this.state=dd)}}_handleFragmentLoadComplete(e){this.waitingData?this.waitingData.complete=!0:super._handleFragmentLoadComplete(e)}onBufferReset(){this.mediaBuffer=null}onBufferCreated(e,t){this.bufferFlushed=this.flushing=!1;const s=t.tracks.audio;s&&(this.mediaBuffer=s.buffer||null)}onFragLoading(e,t){!this.audioOnly&&t.frag.type===Xi&&wa(t.frag)&&(this.mainFragLoading=t,this.state===td&&this.tick())}onFragBuffered(e,t){const{frag:s,part:n}=t;if(s.type===Qi)if(this.fragContextChanged(s))this.warn("Fragment ".concat(s.sn).concat(n?" p: "+n.index:""," of level ").concat(s.level," finished buffering, but was aborted. state: ").concat(this.state,", audioSwitch: ").concat(this.switchingTrack?this.switchingTrack.name:"false"));else{if(wa(s)){this.fragPrevious=s;const e=this.switchingTrack;e&&(this.bufferedTrack=e,this.switchingTrack=null,this.hls.trigger(Hi.AUDIO_TRACK_SWITCHED,na({},e)))}this.fragBufferedComplete(s,n),this.media&&this.tick()}else this.audioOnly||s.type!==Xi||s.elementaryStreams.video||s.elementaryStreams.audiovideo||(this.audioOnly=!0,this.mainFragLoading=null)}onError(e,t){var s;if(t.fatal)this.state=cd;else switch(t.details){case zi.FRAG_GAP:case zi.FRAG_PARSING_ERROR:case zi.FRAG_DECRYPT_ERROR:case zi.FRAG_LOAD_ERROR:case zi.FRAG_LOAD_TIMEOUT:case zi.KEY_LOAD_ERROR:case zi.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(Qi,t);break;case zi.AUDIO_TRACK_LOAD_ERROR:case zi.AUDIO_TRACK_LOAD_TIMEOUT:case zi.LEVEL_PARSING_ERROR:t.levelRetry||this.state!==id||(null==(s=t.context)?void 0:s.type)!==qi||(this.state=td);break;case zi.BUFFER_ADD_CODEC_ERROR:case zi.BUFFER_APPEND_ERROR:if("audio"!==t.parent)return;this.reduceLengthAndFlushBuffer(t)||this.resetLoadingState();break;case zi.BUFFER_FULL_ERROR:if("audio"!==t.parent)return;this.reduceLengthAndFlushBuffer(t)&&(this.bufferedTrack=null,super.flushMainBuffer(0,Number.POSITIVE_INFINITY,"audio"));break;case zi.INTERNAL_EXCEPTION:this.recoverWorkerError(t)}}onBufferFlushing(e,t){let{type:s}=t;s!==Sa&&(this.flushing=!0)}onBufferFlushed(e,t){let{type:s}=t;if(s!==Sa){this.flushing=!1,this.bufferFlushed=!0,this.state===ld&&(this.state=td);const e=this.mediaBuffer||this.media;e&&(this.afterBufferFlushed(e,s,Qi),this.tick())}}_handleTransmuxComplete(e){var t;const s="audio",{hls:n}=this,{remuxResult:r,chunkMeta:i}=e,a=this.getCurrentContext(i);if(!a)return void this.resetWhenMissingContext(i);const{frag:o,part:l,level:c}=a,{details:d}=c,{audio:u,text:h,id3:f,initSegment:m}=r;if(!this.fragContextChanged(o)&&d){if(this.state=ad,this.switchingTrack&&u&&this.completeAudioSwitch(this.switchingTrack),null!=m&&m.tracks){const e=o.initSegment||o;if(this.unhandledEncryptionError(m,o))return;this._bufferInitSegment(c,m.tracks,e,i),n.trigger(Hi.FRAG_PARSING_INIT_SEGMENT,{frag:e,id:s,tracks:m.tracks})}if(u){const{startPTS:e,endPTS:t,startDTS:s,endDTS:n}=u;l&&(l.elementaryStreams[Ea]={startPTS:e,endPTS:t,startDTS:s,endDTS:n}),o.setElementaryStreamInfo(Ea,e,t,s,n),this.bufferFragmentData(u,o,l,i)}if(null!=f&&null!=(t=f.samples)&&t.length){const e=ta({id:s,frag:o,details:d},f);n.trigger(Hi.FRAG_PARSING_METADATA,e)}if(h){const e=ta({id:s,frag:o,details:d},h);n.trigger(Hi.FRAG_PARSING_USERDATA,e)}}else this.fragmentTracker.removeFragment(o)}_bufferInitSegment(e,t,s,n){if(this.state!==ad)return;if(t.video&&delete t.video,t.audiovideo&&delete t.audiovideo,!t.audio)return;const r=t.audio;r.id=Qi;const i=e.audioCodec;this.log("Init audio buffer, container:".concat(r.container,", codecs[level/parsed]=[").concat(i,"/").concat(r.codec,"]")),i&&1===i.split(",").length&&(r.levelCodec=i),this.hls.trigger(Hi.BUFFER_CODECS,t);const a=r.initSegment;if(null!=a&&a.byteLength){const e={type:"audio",frag:s,part:null,chunkMeta:n,parent:s.type,data:a};this.hls.trigger(Hi.BUFFER_APPENDING,e)}this.tickImmediate()}loadFragment(e,t,s){const n=this.fragmentTracker.getState(e);var r;if(this.switchingTrack||n===hl||n===ml)if(wa(e))if(null!=(r=t.details)&&r.live&&!this.initPTS[e.cc]){this.log("Waiting for video PTS in continuity counter ".concat(e.cc," of live stream before loading audio fragment ").concat(e.sn," of level ").concat(this.trackId)),this.state=dd;const s=this.mainDetails;s&&s.fragmentStart!==t.details.fragmentStart&&Qc(t.details,s)}else super.loadFragment(e,t,s);else this._loadInitSegment(e,t);else this.clearTrackerIfNeeded(e)}flushAudioIfNeeded(e){if(this.media&&this.bufferedTrack){const{name:t,lang:s,assocLang:n,characteristics:r,audioCodec:i,channels:a}=this.bufferedTrack;Bo({name:t,lang:s,assocLang:n,characteristics:r,audioCodec:i,channels:a},e,Go)||(zo(e.url,this.hls)?(this.log("Switching audio track : flushing all audio"),super.flushMainBuffer(0,Number.POSITIVE_INFINITY,"audio"),this.bufferedTrack=null):this.bufferedTrack=e)}}completeAudioSwitch(e){const{hls:t}=this;this.flushAudioIfNeeded(e),this.bufferedTrack=e,this.switchingTrack=null,t.trigger(Hi.AUDIO_TRACK_SWITCHED,na({},e))}},audioTrackController:class extends Hu{constructor(e){super(e,"audio-track-controller"),this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0,this.registerListeners()}registerListeners(){const{hls:e}=this;e.on(Hi.MANIFEST_LOADING,this.onManifestLoading,this),e.on(Hi.MANIFEST_PARSED,this.onManifestParsed,this),e.on(Hi.LEVEL_LOADING,this.onLevelLoading,this),e.on(Hi.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(Hi.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.on(Hi.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(Hi.MANIFEST_LOADING,this.onManifestLoading,this),e.off(Hi.MANIFEST_PARSED,this.onManifestParsed,this),e.off(Hi.LEVEL_LOADING,this.onLevelLoading,this),e.off(Hi.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(Hi.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.off(Hi.ERROR,this.onError,this)}destroy(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.currentTrack=null,super.destroy()}onManifestLoading(){this.tracks=[],this.tracksInGroup=[],this.groupIds=null,this.currentTrack=null,this.trackId=-1,this.selectDefaultTrack=!0}onManifestParsed(e,t){this.tracks=t.audioTracks||[]}onAudioTrackLoaded(e,t){const{id:s,groupId:n,details:r}=t,i=this.tracksInGroup[s];if(!i||i.groupId!==n)return void this.warn("Audio track with id:".concat(s," and group:").concat(n," not found in active group ").concat(null==i?void 0:i.groupId));const a=i.details;i.details=t.details,this.log("Audio track ".concat(s,' "').concat(i.name,'" lang:').concat(i.lang," group:").concat(n," loaded [").concat(r.startSN,"-").concat(r.endSN,"]")),s===this.trackId&&this.playlistLoaded(s,t,a)}onLevelLoading(e,t){this.switchLevel(t.level)}onLevelSwitching(e,t){this.switchLevel(t.level)}switchLevel(e){const t=this.hls.levels[e];if(!t)return;const s=t.audioGroups||null,n=this.groupIds;let r=this.currentTrack;if(!s||(null==n?void 0:n.length)!==(null==s?void 0:s.length)||null!=s&&s.some(e=>-1===(null==n?void 0:n.indexOf(e)))){this.groupIds=s,this.trackId=-1,this.currentTrack=null;const e=this.tracks.filter(e=>!s||-1!==s.indexOf(e.groupId));if(e.length)this.selectDefaultTrack&&!e.some(e=>e.default)&&(this.selectDefaultTrack=!1),e.forEach((e,t)=>{e.id=t});else if(!r&&!this.tracksInGroup.length)return;this.tracksInGroup=e;const t=this.hls.config.audioPreference;if(!r&&t){const s=Uo(t,e,Go);if(s>-1)r=e[s];else{const e=Uo(t,this.tracks);r=this.tracks[e]}}let n=this.findTrackId(r);-1===n&&r&&(n=this.findTrackId(null));const a={audioTracks:e};this.log("Updating audio tracks, ".concat(e.length," track(s) found in group(s): ").concat(null==s?void 0:s.join(","))),this.hls.trigger(Hi.AUDIO_TRACKS_UPDATED,a);const o=this.trackId;if(-1!==n&&-1===o)this.setAudioTrack(n);else if(e.length&&-1===o){var i;const t=new Error("No audio track selected for current audio group-ID(s): ".concat(null==(i=this.groupIds)?void 0:i.join(",")," track count: ").concat(e.length));this.warn(t.message),this.hls.trigger(Hi.ERROR,{type:Vi.MEDIA_ERROR,details:zi.AUDIO_TRACK_LOAD_ERROR,fatal:!0,error:t})}}}onError(e,t){!t.fatal&&t.context&&(t.context.type!==qi||t.context.id!==this.trackId||this.groupIds&&-1===this.groupIds.indexOf(t.context.groupId)||this.checkRetry(t))}get allAudioTracks(){return this.tracks}get audioTracks(){return this.tracksInGroup}get audioTrack(){return this.trackId}set audioTrack(e){this.selectDefaultTrack=!1,this.setAudioTrack(e)}setAudioOption(e){const t=this.hls;if(t.config.audioPreference=e,e){const s=this.allAudioTracks;if(this.selectDefaultTrack=!1,s.length){const n=this.currentTrack;if(n&&Bo(e,n,Go))return n;const r=Uo(e,this.tracksInGroup,Go);if(r>-1){const e=this.tracksInGroup[r];return this.setAudioTrack(r),e}if(n){let n=t.loadLevel;-1===n&&(n=t.firstAutoLevel);const r=function(e,t,s,n,r){const i=t[n],a=t.reduce((e,t,s)=>{const n=t.uri;return(e[n]||(e[n]=[])).push(s),e},{})[i.uri];a.length>1&&(n=Math.max.apply(Math,a));const o=i.videoRange,l=i.frameRate,c=i.codecSet.substring(0,4),d=Vo(t,n,t=>{if(t.videoRange!==o||t.frameRate!==l||t.codecSet.substring(0,4)!==c)return!1;const n=t.audioGroups,i=s.filter(e=>!n||-1!==n.indexOf(e.groupId));return Uo(e,i,r)>-1});return d>-1?d:Vo(t,n,t=>{const n=t.audioGroups,i=s.filter(e=>!n||-1!==n.indexOf(e.groupId));return Uo(e,i,r)>-1})}(e,t.levels,s,n,Go);if(-1===r)return null;t.nextLoadLevel=r}if(e.channels||e.audioCodec){const t=Uo(e,s);if(t>-1)return s[t]}}}return null}setAudioTrack(e){const t=this.tracksInGroup;if(e<0||e>=t.length)return void this.warn("Invalid audio track id: ".concat(e));this.selectDefaultTrack=!1;const s=this.currentTrack,n=t[e],r=n.details&&!n.details.live;if(e===this.trackId&&n===s&&r)return;if(this.log("Switching to audio-track ".concat(e,' "').concat(n.name,'" lang:').concat(n.lang," group:").concat(n.groupId," channels:").concat(n.channels)),this.trackId=e,this.currentTrack=n,this.hls.trigger(Hi.AUDIO_TRACK_SWITCHING,na({},n)),r)return;const i=this.switchParams(n.url,null==s?void 0:s.details,n.details);this.loadPlaylist(i)}findTrackId(e){const t=this.tracksInGroup;for(let s=0;s<t.length;s++){const n=t[s];if((!this.selectDefaultTrack||n.default)&&(!e||Bo(e,n,Go)))return s}if(e){const{name:s,lang:n,assocLang:r,characteristics:i,audioCodec:a,channels:o}=e;for(let e=0;e<t.length;e++){if(Bo({name:s,lang:n,assocLang:r,characteristics:i,audioCodec:a,channels:o},t[e],Go))return e}for(let l=0;l<t.length;l++){const s=t[l];if(Wu(e.attrs,s.attrs,["LANGUAGE","ASSOC-LANGUAGE","CHARACTERISTICS"]))return l}for(let l=0;l<t.length;l++){const s=t[l];if(Wu(e.attrs,s.attrs,["LANGUAGE"]))return l}}return-1}loadPlaylist(e){super.loadPlaylist();const t=this.currentTrack;this.shouldLoadPlaylist(t)&&zo(t.url,this.hls)&&this.scheduleLoading(t,e)}loadingPlaylist(e,t){super.loadingPlaylist(e,t);const s=e.id,n=e.groupId,r=this.getUrlWithDirectives(e.url,t),i=e.details,a=null==i?void 0:i.age;this.log("Loading audio-track ".concat(s,' "').concat(e.name,'" lang:').concat(e.lang," group:").concat(n).concat(void 0!==(null==t?void 0:t.msn)?" at sn "+t.msn+" part "+t.part:"").concat(a&&i.live?" age "+a.toFixed(1)+(i.type?" "+i.type||0:""):""," ").concat(r)),this.hls.trigger(Hi.AUDIO_TRACK_LOADING,{url:r,id:s,groupId:n,deliveryDirectives:t||null,track:e})}},emeController:Qh,cmcdController:class{constructor(e){this.hls=void 0,this.config=void 0,this.media=void 0,this.sid=void 0,this.cid=void 0,this.useHeaders=!1,this.includeKeys=void 0,this.initialized=!1,this.starved=!1,this.buffering=!0,this.audioBuffer=void 0,this.videoBuffer=void 0,this.onWaiting=()=>{this.initialized&&(this.starved=!0),this.buffering=!0},this.onPlaying=()=>{this.initialized||(this.initialized=!0),this.buffering=!1},this.applyPlaylistData=e=>{try{this.apply(e,{ot:th.MANIFEST,su:!this.initialized})}catch(t){this.hls.logger.warn("Could not generate manifest CMCD data.",t)}},this.applyFragmentData=e=>{try{const{frag:t,part:s}=e,n=this.hls.levels[t.level],r=this.getObjectType(t),i={d:1e3*(s||t).duration,ot:r};r!==th.VIDEO&&r!==th.AUDIO&&r!=th.MUXED||(i.br=n.bitrate/1e3,i.tb=this.getTopBandwidth(r)/1e3,i.bl=this.getBufferLength(r));const a=s?this.getNextPart(s):this.getNextFrag(t);null!=a&&a.url&&a.url!==t.url&&(i.nor=a.url),this.apply(e,i)}catch(t){this.hls.logger.warn("Could not generate segment CMCD data.",t)}},this.hls=e;const t=this.config=e.config,{cmcd:s}=t;null!=s&&(t.pLoader=this.createPlaylistLoader(),t.fLoader=this.createFragmentLoader(),this.sid=s.sessionId||e.sessionId,this.cid=s.contentId,this.useHeaders=!0===s.useHeaders,this.includeKeys=s.includeKeys,this.registerListeners())}registerListeners(){const e=this.hls;e.on(Hi.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(Hi.MEDIA_DETACHED,this.onMediaDetached,this),e.on(Hi.BUFFER_CREATED,this.onBufferCreated,this)}unregisterListeners(){const e=this.hls;e.off(Hi.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(Hi.MEDIA_DETACHED,this.onMediaDetached,this),e.off(Hi.BUFFER_CREATED,this.onBufferCreated,this)}destroy(){this.unregisterListeners(),this.onMediaDetached(),this.hls=this.config=this.audioBuffer=this.videoBuffer=null,this.onWaiting=this.onPlaying=this.media=null}onMediaAttached(e,t){this.media=t.media,this.media.addEventListener("waiting",this.onWaiting),this.media.addEventListener("playing",this.onPlaying)}onMediaDetached(){this.media&&(this.media.removeEventListener("waiting",this.onWaiting),this.media.removeEventListener("playing",this.onPlaying),this.media=null)}onBufferCreated(e,t){var s,n;this.audioBuffer=null==(s=t.tracks.audio)?void 0:s.buffer,this.videoBuffer=null==(n=t.tracks.video)?void 0:n.buffer}createData(){var e;return{v:1,sf:sh.HLS,sid:this.sid,cid:this.cid,pr:null==(e=this.media)?void 0:e.playbackRate,mtp:this.hls.bandwidthEstimate/1e3}}apply(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};ta(t,this.createData());const s=t.ot===th.INIT||t.ot===th.VIDEO||t.ot===th.MUXED;this.starved&&s&&(t.bs=!0,t.su=!0,this.starved=!1),null==t.su&&(t.su=this.buffering);const{includeKeys:n}=this;n&&(t=Object.keys(t).reduce((e,s)=>(n.includes(s)&&(e[s]=t[s]),e),{}));const r={baseUrl:e.url};this.useHeaders?(e.headers||(e.headers={}),Hh(e.headers,t,r)):e.url=qh(e.url,t,r)}getNextFrag(e){var t;const s=null==(t=this.hls.levels[e.level])?void 0:t.details;if(s){const t=e.sn-s.startSN;return s.fragments[t+1]}}getNextPart(e){var t;const{index:s,fragment:n}=e,r=null==(t=this.hls.levels[n.level])||null==(t=t.details)?void 0:t.partList;if(r){const{sn:e}=n;for(let t=r.length-1;t>=0;t--){const n=r[t];if(n.index===s&&n.fragment.sn===e)return r[t+1]}}}getObjectType(e){const{type:t}=e;return"subtitle"===t?th.TIMED_TEXT:"initSegment"===e.sn?th.INIT:"audio"===t?th.AUDIO:"main"===t?this.hls.audioTracks.length?th.VIDEO:th.MUXED:void 0}getTopBandwidth(e){let t,s=0;const n=this.hls;if(e===th.AUDIO)t=n.audioTracks;else{const e=n.maxAutoLevel,s=e>-1?e+1:n.levels.length;t=n.levels.slice(0,s)}return t.forEach(e=>{e.bitrate>s&&(s=e.bitrate)}),s>0?s:NaN}getBufferLength(e){const t=this.media,s=e===th.AUDIO?this.audioBuffer:this.videoBuffer;if(!s||!t)return NaN;return 1e3*Pl.bufferInfo(s,t.currentTime,this.config.maxBufferHole).len}createPlaylistLoader(){const{pLoader:e}=this.config,t=this.applyPlaylistData,s=e||this.config.loader;return class{constructor(e){this.loader=void 0,this.loader=new s(e)}get stats(){return this.loader.stats}get context(){return this.loader.context}destroy(){this.loader.destroy()}abort(){this.loader.abort()}load(e,s,n){t(e),this.loader.load(e,s,n)}}}createFragmentLoader(){const{fLoader:e}=this.config,t=this.applyFragmentData,s=e||this.config.loader;return class{constructor(e){this.loader=void 0,this.loader=new s(e)}get stats(){return this.loader.stats}get context(){return this.loader.context}destroy(){this.loader.destroy()}abort(){this.loader.abort()}load(e,s,n){t(e),this.loader.load(e,s,n)}}}},contentSteeringController:class extends ra{constructor(e){super("content-steering",e.logger),this.hls=void 0,this.loader=null,this.uri=null,this.pathwayId=".",this._pathwayPriority=null,this.timeToLoad=300,this.reloadTimer=-1,this.updated=0,this.started=!1,this.enabled=!0,this.levels=null,this.audioTracks=null,this.subtitleTracks=null,this.penalizedPathways={},this.hls=e,this.registerListeners()}registerListeners(){const e=this.hls;e.on(Hi.MANIFEST_LOADING,this.onManifestLoading,this),e.on(Hi.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(Hi.MANIFEST_PARSED,this.onManifestParsed,this),e.on(Hi.ERROR,this.onError,this)}unregisterListeners(){const e=this.hls;e&&(e.off(Hi.MANIFEST_LOADING,this.onManifestLoading,this),e.off(Hi.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(Hi.MANIFEST_PARSED,this.onManifestParsed,this),e.off(Hi.ERROR,this.onError,this))}pathways(){return(this.levels||[]).reduce((e,t)=>(-1===e.indexOf(t.pathwayId)&&e.push(t.pathwayId),e),[])}get pathwayPriority(){return this._pathwayPriority}set pathwayPriority(e){this.updatePathwayPriority(e)}startLoad(){if(this.started=!0,this.clearTimeout(),this.enabled&&this.uri){if(this.updated){const e=1e3*this.timeToLoad-(performance.now()-this.updated);if(e>0)return void this.scheduleRefresh(this.uri,e)}this.loadSteeringManifest(this.uri)}}stopLoad(){this.started=!1,this.loader&&(this.loader.destroy(),this.loader=null),this.clearTimeout()}clearTimeout(){-1!==this.reloadTimer&&(self.clearTimeout(this.reloadTimer),this.reloadTimer=-1)}destroy(){this.unregisterListeners(),this.stopLoad(),this.hls=null,this.levels=this.audioTracks=this.subtitleTracks=null}removeLevel(e){const t=this.levels;t&&(this.levels=t.filter(t=>t!==e))}onManifestLoading(){this.stopLoad(),this.enabled=!0,this.timeToLoad=300,this.updated=0,this.uri=null,this.pathwayId=".",this.levels=this.audioTracks=this.subtitleTracks=null}onManifestLoaded(e,t){const{contentSteering:s}=t;null!==s&&(this.pathwayId=s.pathwayId,this.uri=s.uri,this.started&&this.startLoad())}onManifestParsed(e,t){this.audioTracks=t.audioTracks,this.subtitleTracks=t.subtitleTracks}onError(e,t){const{errorAction:s}=t;if((null==s?void 0:s.action)===rl&&s.flags===ll){const e=this.levels;let n=this._pathwayPriority,r=this.pathwayId;if(t.context){const{groupId:s,pathwayId:n,type:i}=t.context;s&&e?r=this.getPathwayForGroupId(s,i,r):n&&(r=n)}r in this.penalizedPathways||(this.penalizedPathways[r]=performance.now()),!n&&e&&(n=this.pathways()),n&&n.length>1&&(this.updatePathwayPriority(n),s.resolved=this.pathwayId!==r),t.details!==zi.BUFFER_APPEND_ERROR||t.fatal?s.resolved||this.warn("Could not resolve ".concat(t.details,' ("').concat(t.error.message,'") with content-steering for Pathway: ').concat(r," levels: ").concat(e?e.length:e," priorities: ").concat(Do(n)," penalized: ").concat(Do(this.penalizedPathways))):s.resolved=!0}}filterParsedLevels(e){this.levels=e;let t=this.getLevelsForPathway(this.pathwayId);if(0===t.length){const s=e[0].pathwayId;this.log("No levels found in Pathway ".concat(this.pathwayId,'. Setting initial Pathway to "').concat(s,'"')),t=this.getLevelsForPathway(s),this.pathwayId=s}return t.length!==e.length&&this.log("Found ".concat(t.length,"/").concat(e.length,' levels in Pathway "').concat(this.pathwayId,'"')),t}getLevelsForPathway(e){return null===this.levels?[]:this.levels.filter(t=>e===t.pathwayId)}updatePathwayPriority(e){let t;this._pathwayPriority=e;const s=this.penalizedPathways,n=performance.now();Object.keys(s).forEach(e=>{n-s[e]>3e5&&delete s[e]});for(let r=0;r<e.length;r++){const n=e[r];if(n in s)continue;if(n===this.pathwayId)return;const i=this.hls.nextLoadLevel,a=this.hls.levels[i];if(t=this.getLevelsForPathway(n),t.length>0){this.log('Setting Pathway to "'.concat(n,'"')),this.pathwayId=n,zc(t),this.hls.trigger(Hi.LEVELS_UPDATED,{levels:t});const e=this.hls.levels[i];a&&e&&this.levels&&(e.attrs["STABLE-VARIANT-ID"]!==a.attrs["STABLE-VARIANT-ID"]&&e.bitrate!==a.bitrate&&this.log("Unstable Pathways change from bitrate ".concat(a.bitrate," to ").concat(e.bitrate)),this.hls.nextLoadLevel=i);break}}}getPathwayForGroupId(e,t,s){const n=this.getLevelsForPathway(s).concat(this.levels||[]);for(let r=0;r<n.length;r++)if(t===qi&&n[r].hasAudioGroup(e)||t===Yi&&n[r].hasSubtitleGroup(e))return n[r].pathwayId;return s}clonePathways(e){const t=this.levels;if(!t)return;const s={},n={};e.forEach(e=>{const{ID:r,"BASE-ID":i,"URI-REPLACEMENT":a}=e;if(t.some(e=>e.pathwayId===r))return;const o=this.getLevelsForPathway(i).map(e=>{const t=new Vl(e.attrs);t["PATHWAY-ID"]=r;const i=t.AUDIO&&"".concat(t.AUDIO,"_clone_").concat(r),o=t.SUBTITLES&&"".concat(t.SUBTITLES,"_clone_").concat(r);i&&(s[t.AUDIO]=i,t.AUDIO=i),o&&(n[t.SUBTITLES]=o,t.SUBTITLES=o);const l=Xh(e.uri,t["STABLE-VARIANT-ID"],"PER-VARIANT-URIS",a),c=new Io({attrs:t,audioCodec:e.audioCodec,bitrate:e.bitrate,height:e.height,name:e.name,url:l,videoCodec:e.videoCodec,width:e.width});if(e.audioGroups)for(let s=1;s<e.audioGroups.length;s++)c.addGroupId("audio","".concat(e.audioGroups[s],"_clone_").concat(r));if(e.subtitleGroups)for(let s=1;s<e.subtitleGroups.length;s++)c.addGroupId("text","".concat(e.subtitleGroups[s],"_clone_").concat(r));return c});t.push(...o),Yh(this.audioTracks,s,a,r),Yh(this.subtitleTracks,n,a,r)})}loadSteeringManifest(e){const t=this.hls.config,s=t.loader;let n;this.loader&&this.loader.destroy(),this.loader=new s(t);try{n=new self.URL(e)}catch(c){return this.enabled=!1,void this.log("Failed to parse Steering Manifest URI: ".concat(e))}if("data:"!==n.protocol){const e=0|(this.hls.bandwidthEstimate||t.abrEwmaDefaultEstimate);n.searchParams.set("_HLS_pathway",this.pathwayId),n.searchParams.set("_HLS_throughput",""+e)}const r={responseType:"json",url:n.href},i=t.steeringManifestLoadPolicy.default,a=i.errorRetry||i.timeoutRetry||{},o={loadPolicy:i,timeout:i.maxLoadTimeMs,maxRetry:a.maxNumRetry||0,retryDelay:a.retryDelayMs||0,maxRetryDelay:a.maxRetryDelayMs||0},l={onSuccess:(e,t,s,r)=>{this.log('Loaded steering manifest: "'.concat(n,'"'));const i=e.data;if(1!==(null==i?void 0:i.VERSION))return void this.log("Steering VERSION ".concat(i.VERSION," not supported!"));this.updated=performance.now(),this.timeToLoad=i.TTL;const{"RELOAD-URI":a,"PATHWAY-CLONES":o,"PATHWAY-PRIORITY":l}=i;if(a)try{this.uri=new self.URL(a,n).href}catch(c){return this.enabled=!1,void this.log("Failed to parse Steering Manifest RELOAD-URI: ".concat(a))}this.scheduleRefresh(this.uri||s.url),o&&this.clonePathways(o);const d={steeringManifest:i,url:n.toString()};this.hls.trigger(Hi.STEERING_MANIFEST_LOADED,d),l&&this.updatePathwayPriority(l)},onError:(e,t,s,n)=>{if(this.log("Error loading steering manifest: ".concat(e.code," ").concat(e.text," (").concat(t.url,")")),this.stopLoad(),410===e.code)return this.enabled=!1,void this.log("Steering manifest ".concat(t.url," no longer available"));let r=1e3*this.timeToLoad;if(429===e.code){const e=this.loader;if("function"===typeof(null==e?void 0:e.getResponseHeader)){const t=e.getResponseHeader("Retry-After");t&&(r=1e3*parseFloat(t))}return void this.log("Steering manifest ".concat(t.url," rate limited"))}this.scheduleRefresh(this.uri||t.url,r)},onTimeout:(e,t,s)=>{this.log("Timeout loading steering manifest (".concat(t.url,")")),this.scheduleRefresh(this.uri||t.url)}};this.log("Requesting steering manifest: ".concat(n)),this.loader.load(r,o,l)}scheduleRefresh(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1e3*this.timeToLoad;this.clearTimeout(),this.reloadTimer=self.setTimeout(()=>{var t;const s=null==(t=this.hls)?void 0:t.media;!s||s.ended?this.scheduleRefresh(e,1e3*this.timeToLoad):this.loadSteeringManifest(e)},t)}},interstitialsController:class extends ra{constructor(e,t){super("interstitials",e.logger),this.HlsPlayerClass=void 0,this.hls=void 0,this.assetListLoader=void 0,this.mediaSelection=null,this.altSelection=null,this.media=null,this.detachedData=null,this.requiredTracks=null,this.manager=null,this.playerQueue=[],this.bufferedPos=-1,this.timelinePos=-1,this.schedule=void 0,this.playingItem=null,this.bufferingItem=null,this.waitingItem=null,this.endedItem=null,this.playingAsset=null,this.endedAsset=null,this.bufferingAsset=null,this.shouldPlay=!1,this.onPlay=()=>{this.shouldPlay=!0},this.onPause=()=>{this.shouldPlay=!1},this.onSeeking=()=>{const e=this.currentTime;if(void 0===e||this.playbackDisabled||!this.schedule)return;const t=e-this.timelinePos;if(Math.abs(t)<1/7056e5)return;const s=t<=-.01;this.timelinePos=e,this.bufferedPos=e;const n=this.playingItem;if(!n)return void this.checkBuffer();if(s){this.schedule.resetErrorsInRange(e,e-t)&&this.updateSchedule(!0)}if(this.checkBuffer(),s&&e<n.start||e>=n.end){var r;const t=this.findItemIndex(n);let i=this.schedule.findItemIndexAtTime(e);if(-1===i&&(i=t+(s?-1:1),this.log("seeked ".concat(s?"back ":"","to position not covered by schedule ").concat(e," (resolving from ").concat(t," to ").concat(i,")"))),!this.isInterstitial(n)&&null!=(r=this.media)&&r.paused&&(this.shouldPlay=!1),!s&&i>t){const e=this.schedule.findJumpRestrictedIndex(t+1,i);if(e>t)return void this.setSchedulePosition(e)}return void this.setSchedulePosition(i)}const i=this.playingAsset;if(!i){if(this.playingLastItem&&this.isInterstitial(n)){const t=n.event.assetList[0];t&&(this.endedItem=this.playingItem,this.playingItem=null,this.setScheduleToAssetAtTime(e,t))}return}const a=i.timelineStart,o=i.duration||0;var l;(s&&e<a||e>=a+o)&&(null!=(l=n.event)&&l.appendInPlace&&(this.clearAssetPlayers(n.event,n),this.flushFrontBuffer(e)),this.setScheduleToAssetAtTime(e,i))},this.onTimeupdate=()=>{const e=this.currentTime;if(void 0===e||this.playbackDisabled)return;if(!(e>this.timelinePos))return;this.timelinePos=e,e>this.bufferedPos&&this.checkBuffer();const t=this.playingItem;if(!t||this.playingLastItem)return;if(e>=t.end){this.timelinePos=t.end;const e=this.findItemIndex(t);this.setSchedulePosition(e+1)}const s=this.playingAsset;if(!s)return;e>=s.timelineStart+(s.duration||0)&&this.setScheduleToAssetAtTime(e,s)},this.onScheduleUpdate=(e,t)=>{const s=this.schedule;if(!s)return;const n=this.playingItem,r=s.events||[],i=s.items||[],a=s.durations,o=e.map(e=>e.identifier),l=!(!r.length&&!o.length);(l||t)&&this.log("INTERSTITIALS_UPDATED (".concat(r.length,"): ").concat(r,"\nSchedule: ").concat(i.map(e=>yf(e))," pos: ").concat(this.timelinePos)),o.length&&this.log("Removed events ".concat(o));let c=null,d=null;n&&(c=this.updateItem(n,this.timelinePos),this.itemsMatch(n,c)?this.playingItem=c:this.waitingItem=this.endedItem=null),this.waitingItem=this.updateItem(this.waitingItem),this.endedItem=this.updateItem(this.endedItem);const u=this.bufferingItem;if(u&&(d=this.updateItem(u,this.bufferedPos),this.itemsMatch(u,d)?this.bufferingItem=d:u.event&&(this.bufferingItem=this.playingItem,this.clearInterstitial(u.event,null))),e.forEach(e=>{e.assetList.forEach(e=>{this.clearAssetPlayer(e.identifier,null)})}),this.playerQueue.forEach(e=>{if(e.interstitial.appendInPlace){const t=e.assetItem.timelineStart,s=e.timelineOffset-t;if(s)try{e.timelineOffset=t}catch(Np){Math.abs(s)>lf&&this.warn("".concat(Np,' ("').concat(e.assetId,'" ').concat(e.timelineOffset,"->").concat(t,")"))}}}),l||t){if(this.hls.trigger(Hi.INTERSTITIALS_UPDATED,{events:r.slice(0),schedule:i.slice(0),durations:a,removedIds:o}),this.isInterstitial(n)&&o.includes(n.event.identifier))return this.warn('Interstitial "'.concat(n.event.identifier,'" removed while playing')),void this.primaryFallback(n.event);n&&this.trimInPlace(c,n),u&&d!==c&&this.trimInPlace(d,u),this.checkBuffer()}},this.hls=e,this.HlsPlayerClass=t,this.assetListLoader=new bf(e),this.schedule=new vf(this.onScheduleUpdate,e.logger),this.registerListeners()}registerListeners(){const e=this.hls;e&&(e.on(Hi.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(Hi.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(Hi.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(Hi.MANIFEST_LOADING,this.onManifestLoading,this),e.on(Hi.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(Hi.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(Hi.AUDIO_TRACK_UPDATED,this.onAudioTrackUpdated,this),e.on(Hi.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.on(Hi.SUBTITLE_TRACK_UPDATED,this.onSubtitleTrackUpdated,this),e.on(Hi.EVENT_CUE_ENTER,this.onInterstitialCueEnter,this),e.on(Hi.ASSET_LIST_LOADED,this.onAssetListLoaded,this),e.on(Hi.BUFFER_APPENDED,this.onBufferAppended,this),e.on(Hi.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(Hi.BUFFERED_TO_END,this.onBufferedToEnd,this),e.on(Hi.MEDIA_ENDED,this.onMediaEnded,this),e.on(Hi.ERROR,this.onError,this),e.on(Hi.DESTROYING,this.onDestroying,this))}unregisterListeners(){const e=this.hls;e&&(e.off(Hi.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(Hi.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(Hi.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(Hi.MANIFEST_LOADING,this.onManifestLoading,this),e.off(Hi.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(Hi.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(Hi.AUDIO_TRACK_UPDATED,this.onAudioTrackUpdated,this),e.off(Hi.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.off(Hi.SUBTITLE_TRACK_UPDATED,this.onSubtitleTrackUpdated,this),e.off(Hi.EVENT_CUE_ENTER,this.onInterstitialCueEnter,this),e.off(Hi.ASSET_LIST_LOADED,this.onAssetListLoaded,this),e.off(Hi.BUFFER_CODECS,this.onBufferCodecs,this),e.off(Hi.BUFFER_APPENDED,this.onBufferAppended,this),e.off(Hi.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(Hi.BUFFERED_TO_END,this.onBufferedToEnd,this),e.off(Hi.MEDIA_ENDED,this.onMediaEnded,this),e.off(Hi.ERROR,this.onError,this),e.off(Hi.DESTROYING,this.onDestroying,this))}startLoad(){this.resumeBuffering()}stopLoad(){this.pauseBuffering()}resumeBuffering(){var e;null==(e=this.getBufferingPlayer())||e.resumeBuffering()}pauseBuffering(){var e;null==(e=this.getBufferingPlayer())||e.pauseBuffering()}destroy(){this.unregisterListeners(),this.stopLoad(),this.assetListLoader&&this.assetListLoader.destroy(),this.emptyPlayerQueue(),this.clearScheduleState(),this.schedule&&this.schedule.destroy(),this.media=this.detachedData=this.mediaSelection=this.requiredTracks=this.altSelection=this.schedule=this.manager=null,this.hls=this.HlsPlayerClass=this.log=null,this.assetListLoader=null,this.onPlay=this.onPause=this.onSeeking=this.onTimeupdate=null,this.onScheduleUpdate=null}onDestroying(){const e=this.primaryMedia||this.media;e&&this.removeMediaListeners(e)}removeMediaListeners(e){Jc(e,"play",this.onPlay),Jc(e,"pause",this.onPause),Jc(e,"seeking",this.onSeeking),Jc(e,"timeupdate",this.onTimeupdate)}onMediaAttaching(e,t){const s=this.media=t.media;$c(s,"seeking",this.onSeeking),$c(s,"timeupdate",this.onTimeupdate),$c(s,"play",this.onPlay),$c(s,"pause",this.onPause)}onMediaAttached(e,t){const s=this.effectivePlayingItem,n=this.detachedData;if(this.detachedData=null,null===s)this.checkStart();else if(!n){this.clearScheduleState();const e=this.findItemIndex(s);this.setSchedulePosition(e)}}clearScheduleState(){this.log("clear schedule state"),this.playingItem=this.bufferingItem=this.waitingItem=this.endedItem=this.playingAsset=this.endedAsset=this.bufferingAsset=null}onMediaDetaching(e,t){const s=!!t.transferMedia,n=this.media;if(this.media=null,!s&&(n&&this.removeMediaListeners(n),this.detachedData)){const e=this.getBufferingPlayer();e&&(this.log("Removing schedule state for detachedData and ".concat(e)),this.playingAsset=this.endedAsset=this.bufferingAsset=this.bufferingItem=this.waitingItem=this.detachedData=null,e.detachMedia()),this.shouldPlay=!1}}get interstitialsManager(){if(!this.hls)return null;if(this.manager)return this.manager;const e=this,t=()=>e.bufferingItem||e.waitingItem,s=t=>t?e.getAssetPlayer(t.identifier):t,n=(t,n,i,a,o)=>{if(t){let l=t[n].start;const c=t.event;if(c){if("playout"===n||c.timelineOccupancy!==cf.Point){const e=s(i);(null==e?void 0:e.interstitial)===c&&(l+=e.assetItem.startOffset+e[o])}}else{l+=("bufferedPos"===a?r():e[a])-t.start}return l}return 0},r=()=>{const t=e.bufferedPos;return t===Number.MAX_VALUE?i("primary"):Math.max(t,0)},i=t=>{var s,n;return null!=(s=e.primaryDetails)&&s.live?e.primaryDetails.edge:(null==(n=e.schedule)?void 0:n.durations[t])||0},a=(t,r)=>{var i,a;const o=e.effectivePlayingItem;if(null!=o&&null!=(i=o.event)&&i.restrictions.skip||!e.schedule)return;e.log("seek to ".concat(t,' "').concat(r,'"'));const l=e.effectivePlayingItem,c=e.schedule.findItemIndexAtTime(t,r),d=null==(a=e.schedule.items)?void 0:a[c],u=e.getBufferingPlayer(),h=null==u?void 0:u.interstitial,f=null==h?void 0:h.appendInPlace,m=l&&e.itemsMatch(l,d);if(l&&(f||m)){const i=s(e.playingAsset),a=(null==i?void 0:i.media)||e.primaryMedia;if(a){const s="primary"===r?a.currentTime:n(l,r,e.playingAsset,"timelinePos","currentTime"),o=t-s,c=(f?s:a.currentTime)+o;if(c>=0&&(!i||f||c<=i.duration))return void(a.currentTime=c)}}if(d){let s=t;if("primary"!==r){const e=t-d[r].start;s=d.start+e}const n=!e.isInterstitial(d);if(e.isInterstitial(l)&&!l.event.appendInPlace||!n&&!d.event.appendInPlace){if(l){const i=e.findItemIndex(l);if(c>i){const t=e.schedule.findJumpRestrictedIndex(i+1,c);if(t>i)return void e.setSchedulePosition(t)}let a=0;if(n)e.timelinePos=s,e.checkBuffer();else{const e=d.event.assetList,s=t-(d[r]||d).start;for(let t=e.length;t--;){const n=e[t];if(n.duration&&s>=n.startOffset&&s<n.startOffset+n.duration){a=t;break}}}e.setSchedulePosition(c,a)}}else{const t=e.media||(f?null==u?void 0:u.media:null);t&&(t.currentTime=s)}}},o=()=>{const s=e.effectivePlayingItem;if(e.isInterstitial(s))return s;const n=t();return e.isInterstitial(n)?n:null},l={get bufferedEnd(){const s=t(),r=e.bufferingItem;var i;return r&&r===s&&(n(r,"playout",e.bufferingAsset,"bufferedPos","bufferedEnd")-r.playout.start||(null==(i=e.bufferingAsset)?void 0:i.startOffset))||0},get currentTime(){const t=o(),s=e.effectivePlayingItem;return s&&s===t?n(s,"playout",e.effectivePlayingAsset,"timelinePos","currentTime")-s.playout.start:0},set currentTime(t){const s=o(),n=e.effectivePlayingItem;n&&n===s&&a(t+n.playout.start,"playout")},get duration(){const e=o();return e?e.playout.end-e.playout.start:0},get assetPlayers(){var t;const s=null==(t=o())?void 0:t.event.assetList;return s?s.map(t=>e.getAssetPlayer(t.identifier)):[]},get playingIndex(){var t;const s=null==(t=o())?void 0:t.event;return s&&e.effectivePlayingAsset?s.findAssetIndex(e.effectivePlayingAsset):-1},get scheduleItem(){return o()}};return this.manager={get events(){var t;return(null==(t=e.schedule)||null==(t=t.events)?void 0:t.slice(0))||[]},get schedule(){var t;return(null==(t=e.schedule)||null==(t=t.items)?void 0:t.slice(0))||[]},get interstitialPlayer(){return o()?l:null},get playerQueue(){return e.playerQueue.slice(0)},get bufferingAsset(){return e.bufferingAsset},get bufferingItem(){return t()},get bufferingIndex(){const s=t();return e.findItemIndex(s)},get playingAsset(){return e.effectivePlayingAsset},get playingItem(){return e.effectivePlayingItem},get playingIndex(){const t=e.effectivePlayingItem;return e.findItemIndex(t)},primary:{get bufferedEnd(){return r()},get currentTime(){const t=e.timelinePos;return t>0?t:0},set currentTime(e){a(e,"primary")},get duration(){return i("primary")},get seekableStart(){var t;return(null==(t=e.primaryDetails)?void 0:t.fragmentStart)||0}},integrated:{get bufferedEnd(){return n(t(),"integrated",e.bufferingAsset,"bufferedPos","bufferedEnd")},get currentTime(){return n(e.effectivePlayingItem,"integrated",e.effectivePlayingAsset,"timelinePos","currentTime")},set currentTime(e){a(e,"integrated")},get duration(){return i("integrated")},get seekableStart(){var t;return((t,s)=>{var n;if(0!==t&&"primary"!==s&&null!=(n=e.schedule)&&n.length){var r;const n=e.schedule.findItemIndexAtTime(t),i=null==(r=e.schedule.items)?void 0:r[n];if(i)return t+(i[s].start-i.start)}return t})((null==(t=e.primaryDetails)?void 0:t.fragmentStart)||0,"integrated")}},skip:()=>{const t=e.effectivePlayingItem,s=null==t?void 0:t.event;if(s&&!s.restrictions.skip){const n=e.findItemIndex(t);if(s.appendInPlace){const e=t.playout.start+t.event.duration;a(e+.001,"playout")}else e.advanceAfterAssetEnded(s,n,1/0)}}}}get effectivePlayingItem(){return this.waitingItem||this.playingItem||this.endedItem}get effectivePlayingAsset(){return this.playingAsset||this.endedAsset}get playingLastItem(){var e;const t=this.playingItem,s=null==(e=this.schedule)?void 0:e.items;return!!(this.playbackStarted&&t&&s)&&this.findItemIndex(t)===s.length-1}get playbackStarted(){return null!==this.effectivePlayingItem}get currentTime(){var e,t;if(null===this.mediaSelection)return;const s=this.waitingItem||this.playingItem;if(this.isInterstitial(s)&&!s.event.appendInPlace)return;let n=this.media;!n&&null!=(e=this.bufferingItem)&&null!=(e=e.event)&&e.appendInPlace&&(n=this.primaryMedia);const r=null==(t=n)?void 0:t.currentTime;return void 0!==r&&Ui(r)?r:void 0}get primaryMedia(){var e;return this.media||(null==(e=this.detachedData)?void 0:e.media)||null}isInterstitial(e){return!(null==e||!e.event)}retreiveMediaSource(e,t){const s=this.getAssetPlayer(e);s&&this.transferMediaFromPlayer(s,t)}transferMediaFromPlayer(e,t){const s=e.interstitial.appendInPlace,n=e.media;if(s&&n===this.primaryMedia){if(this.bufferingAsset=null,(!t||this.isInterstitial(t)&&!t.event.appendInPlace)&&t&&n)return void(this.detachedData={media:n});const s=e.transferMedia();this.log("transfer MediaSource from ".concat(e," ").concat(Do(s))),this.detachedData=s}else t&&n&&(this.shouldPlay||(this.shouldPlay=!n.paused))}transferMediaTo(e,t){var s,n;if(e.media===t)return;let r=null;const i=this.hls,a=e!==i,o=a&&e.interstitial.appendInPlace,l=null==(s=this.detachedData)?void 0:s.mediaSource;let c;if(i.media)o&&(r=i.transferMedia(),this.detachedData=r),c="Primary";else if(l){const e=this.getBufferingPlayer();e?(r=e.transferMedia(),c="".concat(e)):c="detached MediaSource"}else c="detached media";if(!r)if(l)r=this.detachedData,this.log("using detachedData: MediaSource ".concat(Do(r)));else if(!this.detachedData||i.media===t){const e=this.playerQueue;e.length>1&&e.forEach(e=>{if(a&&e.interstitial.appendInPlace!==o){const t=e.interstitial;this.clearInterstitial(e.interstitial,null),t.appendInPlace=!1,t.appendInPlace&&this.warn("Could not change append strategy for queued assets ".concat(t))}}),this.hls.detachMedia(),this.detachedData={media:t}}const d=r&&"mediaSource"in r&&"closed"!==(null==(n=r.mediaSource)?void 0:n.readyState),u=d&&r?r:t;this.log("".concat(d?"transfering MediaSource":"attaching media"," to ").concat(a?e:"Primary"," from ").concat(c," (media.currentTime: ").concat(t.currentTime,")"));const h=this.schedule;if(u===r&&h){const t=a&&e.assetId===h.assetIdAtEnd;u.overrides={duration:h.duration,endOfStream:!a||t,cueRemoval:!a}}e.attachMedia(u)}onInterstitialCueEnter(){this.onTimeupdate()}checkStart(){const e=this.schedule,t=null==e?void 0:e.events;if(!t||this.playbackDisabled||!this.media)return;-1===this.bufferedPos&&(this.bufferedPos=0);const s=this.timelinePos,n=this.effectivePlayingItem;if(-1===s){const s=this.hls.startPosition;if(this.log(Ef("checkStart",s)),this.timelinePos=s,t.length&&t[0].cue.pre){const s=e.findEventIndex(t[0].identifier);this.setSchedulePosition(s)}else if(s>=0||!this.primaryLive){const t=this.timelinePos=s>0?s:0,n=e.findItemIndexAtTime(t);this.setSchedulePosition(n)}}else if(n&&!this.playingItem){const t=e.findItemIndex(n);this.setSchedulePosition(t)}}advanceAssetBuffering(e,t){const s=e.event,n=s.findAssetIndex(t),r=mf(s,n);if(s.isAssetPastPlayoutLimit(r)){if(this.schedule){var i;const t=null==(i=this.schedule.items)?void 0:i[this.findItemIndex(e)+1];t&&this.bufferedToItem(t)}}else this.bufferedToEvent(e,r)}advanceAfterAssetEnded(e,t,s){const n=mf(e,s);if(e.isAssetPastPlayoutLimit(n)){if(this.schedule){const s=this.schedule.items;if(s){const n=t+1;if(n>=s.length)return void this.setSchedulePosition(-1);const r=e.resumeTime;this.timelinePos<r&&(this.log(Ef("advanceAfterAssetEnded",r)),this.timelinePos=r,e.appendInPlace&&this.advanceInPlace(r),this.checkBuffer(this.bufferedPos<r)),this.setSchedulePosition(n)}}}else{if(e.appendInPlace){const t=e.assetList[n];t&&this.advanceInPlace(t.timelineStart)}this.setSchedulePosition(t,n)}}setScheduleToAssetAtTime(e,t){const s=this.schedule;if(!s)return;const n=t.parentIdentifier,r=s.getEvent(n);if(r){const t=s.findEventIndex(n),i=s.findAssetIndex(r,e);this.advanceAfterAssetEnded(r,t,i-1)}}setSchedulePosition(e,t){var s;const n=null==(s=this.schedule)?void 0:s.items;if(!n||this.playbackDisabled)return;const r=e>=0?n[e]:null;this.log("setSchedulePosition ".concat(e,", ").concat(t," (").concat(r?yf(r):r,") pos: ").concat(this.timelinePos));const i=this.waitingItem||this.playingItem,a=this.playingLastItem;if(this.isInterstitial(i)){const s=i.event,c=this.playingAsset,d=null==c?void 0:c.identifier,u=d?this.getAssetPlayer(d):null;if(u&&d&&(!this.eventItemsMatch(i,r)||void 0!==t&&d!==s.assetList[t].identifier)){var o;const t=s.findAssetIndex(c);if(this.log("INTERSTITIAL_ASSET_ENDED ".concat(t+1,"/").concat(s.assetList.length," ").concat(pf(c))),this.endedAsset=c,this.playingAsset=null,this.hls.trigger(Hi.INTERSTITIAL_ASSET_ENDED,{asset:c,assetListIndex:t,event:s,schedule:n.slice(0),scheduleIndex:e,player:u}),i!==this.playingItem)return void(this.itemsMatch(i,this.playingItem)&&!this.playingAsset&&this.advanceAfterAssetEnded(s,this.findItemIndex(this.playingItem),t));this.retreiveMediaSource(d,r),!u.media||null!=(o=this.detachedData)&&o.mediaSource||u.detachMedia()}if(!this.eventItemsMatch(i,r)&&(this.endedItem=i,this.playingItem=null,this.log("INTERSTITIAL_ENDED ".concat(s," ").concat(yf(i))),s.hasPlayed=!0,this.hls.trigger(Hi.INTERSTITIAL_ENDED,{event:s,schedule:n.slice(0),scheduleIndex:e}),s.cue.once)){var l;this.updateSchedule();const e=null==(l=this.schedule)?void 0:l.items;if(r&&e){const s=this.findItemIndex(r);this.advanceSchedule(s,e,t,i,a)}return}}this.advanceSchedule(e,n,t,i,a)}advanceSchedule(e,t,s,n,r){const i=this.schedule;if(!i)return;const a=t[e]||null,o=this.primaryMedia,l=this.playerQueue;if(l.length&&l.forEach(t=>{const s=t.interstitial,n=i.findEventIndex(s.identifier);(n<e||n>e+1)&&this.clearInterstitial(s,a)}),this.isInterstitial(a)){this.timelinePos=Math.min(Math.max(this.timelinePos,a.start),a.end);const r=a.event;if(void 0===s){const t=mf(r,(s=i.findAssetIndex(r,this.timelinePos))-1);if(r.isAssetPastPlayoutLimit(t)||r.appendInPlace&&this.timelinePos===a.end)return void this.advanceAfterAssetEnded(r,e,s);s=t}const l=this.waitingItem;this.assetsBuffered(a,o)||this.setBufferingItem(a);let c=this.preloadAssets(r,s);if(this.eventItemsMatch(a,l||n)||(this.waitingItem=a,this.log("INTERSTITIAL_STARTED ".concat(yf(a)," ").concat(r.appendInPlace?"append in place":"")),this.hls.trigger(Hi.INTERSTITIAL_STARTED,{event:r,schedule:t.slice(0),scheduleIndex:e})),!r.assetListLoaded)return void this.log("Waiting for ASSET-LIST to complete loading ".concat(r));if(r.assetListLoader&&(r.assetListLoader.destroy(),r.assetListLoader=void 0),!o)return void this.log("Waiting for attachMedia to start Interstitial ".concat(r));this.waitingItem=this.endedItem=null,this.playingItem=a;const d=r.assetList[s];if(!d)return void this.advanceAfterAssetEnded(r,e,s||0);if(c||(c=this.getAssetPlayer(d.identifier)),null===c||c.destroyed){const e=r.assetList.length;this.warn("asset ".concat(s+1,"/").concat(e," player destroyed ").concat(r)),c=this.createAssetPlayer(r,d,s),c.loadSource()}if(!this.eventItemsMatch(a,this.bufferingItem)&&r.appendInPlace&&this.isAssetBuffered(d))return;this.startAssetPlayer(c,s,t,e,o),this.shouldPlay&&xf(c.media)}else a?(this.resumePrimary(a,e,n),this.shouldPlay&&xf(this.hls.media)):r&&this.isInterstitial(n)&&(this.endedItem=null,this.playingItem=n,n.event.appendInPlace||this.attachPrimary(i.durations.primary,null))}get playbackDisabled(){return!1===this.hls.config.enableInterstitialPlayback}get primaryDetails(){var e;return null==(e=this.mediaSelection)?void 0:e.main.details}get primaryLive(){var e;return!(null==(e=this.primaryDetails)||!e.live)}resumePrimary(e,t,s){var n,r;if(this.playingItem=e,this.playingAsset=this.endedAsset=null,this.waitingItem=this.endedItem=null,this.bufferedToItem(e),this.log("resuming ".concat(yf(e))),null==(n=this.detachedData)||!n.mediaSource){let s=this.timelinePos;(s<e.start||s>=e.end)&&(s=this.getPrimaryResumption(e,t),this.log(Ef("resumePrimary",s)),this.timelinePos=s),this.attachPrimary(s,e)}if(!s)return;const i=null==(r=this.schedule)?void 0:r.items;i&&(this.log("INTERSTITIALS_PRIMARY_RESUMED ".concat(yf(e))),this.hls.trigger(Hi.INTERSTITIALS_PRIMARY_RESUMED,{schedule:i.slice(0),scheduleIndex:t}),this.checkBuffer())}getPrimaryResumption(e,t){const s=e.start;if(this.primaryLive){const e=this.primaryDetails;if(0===t)return this.hls.startPosition;if(e&&(s<e.fragmentStart||s>e.edge))return this.hls.liveSyncPosition||-1}return s}isAssetBuffered(e){const t=this.getAssetPlayer(e.identifier);if(null!=t&&t.hls)return t.hls.bufferedToEnd;return Pl.bufferInfo(this.primaryMedia,this.timelinePos,0).end+1>=e.timelineStart+(e.duration||0)}attachPrimary(e,t,s){t?this.setBufferingItem(t):this.bufferingItem=this.playingItem,this.bufferingAsset=null;const n=this.primaryMedia;if(!n)return;const r=this.hls;r.media?this.checkBuffer():(this.transferMediaTo(r,n),s&&this.startLoadingPrimaryAt(e,s)),s||(this.log(Ef("attachPrimary",e)),this.timelinePos=e,this.startLoadingPrimaryAt(e,s))}startLoadingPrimaryAt(e,t){var s;const n=this.hls;!n.loadingEnabled||!n.media||Math.abs(((null==(s=n.mainForwardBufferInfo)?void 0:s.start)||n.media.currentTime)-e)>.5?n.startLoad(e,t):n.bufferingEnabled||n.resumeBuffering()}onManifestLoading(){var e;this.stopLoad(),null==(e=this.schedule)||e.reset(),this.emptyPlayerQueue(),this.clearScheduleState(),this.shouldPlay=!1,this.bufferedPos=this.timelinePos=-1,this.mediaSelection=this.altSelection=this.manager=this.requiredTracks=null,this.hls.off(Hi.BUFFER_CODECS,this.onBufferCodecs,this),this.hls.on(Hi.BUFFER_CODECS,this.onBufferCodecs,this)}onLevelUpdated(e,t){if(-1===t.level||!this.schedule)return;const s=this.hls.levels[t.level];if(!s.details)return;const n=na(na({},this.mediaSelection||this.altSelection),{},{main:s});this.mediaSelection=n,this.schedule.parseInterstitialDateRanges(n,this.hls.config.interstitialAppendInPlace),!this.effectivePlayingItem&&this.schedule.items&&this.checkStart()}onAudioTrackUpdated(e,t){const s=this.hls.audioTracks[t.id],n=this.mediaSelection;if(!n)return void(this.altSelection=na(na({},this.altSelection),{},{audio:s}));const r=na(na({},n),{},{audio:s});this.mediaSelection=r}onSubtitleTrackUpdated(e,t){const s=this.hls.subtitleTracks[t.id],n=this.mediaSelection;if(!n)return void(this.altSelection=na(na({},this.altSelection),{},{subtitles:s}));const r=na(na({},n),{},{subtitles:s});this.mediaSelection=r}onAudioTrackSwitching(e,t){const s=Fo(t);this.playerQueue.forEach(e=>{let{hls:n}=e;return n&&(n.setAudioOption(t)||n.setAudioOption(s))})}onSubtitleTrackSwitch(e,t){const s=Fo(t);this.playerQueue.forEach(e=>{let{hls:n}=e;return n&&(n.setSubtitleOption(t)||-1!==t.id&&n.setSubtitleOption(s))})}onBufferCodecs(e,t){const s=t.tracks;s&&(this.requiredTracks=s)}onBufferAppended(e,t){this.checkBuffer()}onBufferFlushed(e,t){const s=this.playingItem;if(s&&!this.itemsMatch(s,this.bufferingItem)&&!this.isInterstitial(s)){const e=this.timelinePos;this.bufferedPos=e,this.checkBuffer()}}onBufferedToEnd(e){if(!this.schedule)return;const t=this.schedule.events;if(this.bufferedPos<Number.MAX_VALUE&&t){for(let e=0;e<t.length;e++){const n=t[e];if(n.cue.post){var s;const e=this.schedule.findEventIndex(n.identifier),t=null==(s=this.schedule.items)?void 0:s[e];this.isInterstitial(t)&&this.eventItemsMatch(t,this.bufferingItem)&&this.bufferedToItem(t,0);break}}this.bufferedPos=Number.MAX_VALUE}}onMediaEnded(e){const t=this.playingItem;if(!this.playingLastItem&&t){const e=this.findItemIndex(t);this.setSchedulePosition(e+1)}else this.shouldPlay=!1}updateItem(e,t){var s;const n=null==(s=this.schedule)?void 0:s.items;if(e&&n){return n[this.findItemIndex(e,t)]||null}return null}trimInPlace(e,t){if(this.isInterstitial(e)&&e.event.appendInPlace&&t.end-e.end>.25){e.event.assetList.forEach((t,s)=>{e.event.isAssetPastPlayoutLimit(s)&&this.clearAssetPlayer(t.identifier,null)});const s=e.end+.25,n=Pl.bufferInfo(this.primaryMedia,s,0);if(n.end>s||(n.nextStart||0)>s){this.log("trim buffered interstitial ".concat(yf(e)," (was ").concat(yf(t),")"));const n=!0;this.attachPrimary(s,null,n),this.flushFrontBuffer(s)}}}itemsMatch(e,t){return!!t&&(e===t||e.event&&t.event&&this.eventItemsMatch(e,t)||!e.event&&!t.event&&this.findItemIndex(e)===this.findItemIndex(t))}eventItemsMatch(e,t){var s;return!!t&&(e===t||e.event.identifier===(null==(s=t.event)?void 0:s.identifier))}findItemIndex(e,t){return e&&this.schedule?this.schedule.findItemIndex(e,t):-1}updateSchedule(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];var t;const s=this.mediaSelection;s&&(null==(t=this.schedule)||t.updateSchedule(s,[],e))}checkBuffer(e){var t;const s=null==(t=this.schedule)?void 0:t.items;if(!s)return;const n=Pl.bufferInfo(this.primaryMedia,this.timelinePos,0);e&&(this.bufferedPos=this.timelinePos),e||(e=n.len<1),this.updateBufferedPos(n.end,s,e)}updateBufferedPos(e,t,s){const n=this.schedule,r=this.bufferingItem;if(this.bufferedPos>e||!n)return;if(1===t.length&&this.itemsMatch(t[0],r))return void(this.bufferedPos=e);const i=this.playingItem,a=this.findItemIndex(i);let o=n.findItemIndexAtTime(e);if(this.bufferedPos<e){var l;const s=this.findItemIndex(r),n=Math.min(s+1,t.length-1),i=t[n];if((-1===o&&r&&e>=r.end||null!=(l=i.event)&&l.appendInPlace&&e+.01>=i.start)&&(o=n),this.isInterstitial(r)){const e=r.event;if(n-a>1&&!1===e.appendInPlace)return;if(0===e.assetList.length&&e.assetListLoader)return}if(this.bufferedPos=e,o>s&&o>a)this.bufferedToItem(i);else{const t=this.primaryDetails;this.primaryLive&&t&&e>t.edge-t.targetduration&&i.start<t.edge+this.hls.config.interstitialLiveLookAhead&&this.isInterstitial(i)&&this.preloadAssets(i.event,0)}}else s&&i&&!this.itemsMatch(i,r)&&(o===a?this.bufferedToItem(i):o===a+1&&this.bufferedToItem(t[o]))}assetsBuffered(e,t){return 0!==e.event.assetList.length&&!e.event.assetList.some(e=>{const s=this.getAssetPlayer(e.identifier);return!(null!=s&&s.bufferedInPlaceToEnd(t))})}setBufferingItem(e){const t=this.bufferingItem,s=this.schedule;if(!this.itemsMatch(e,t)&&s){const{items:n,events:r}=s;if(!n||!r)return t;const i=this.isInterstitial(e),a=this.getBufferingPlayer();this.bufferingItem=e,this.bufferedPos=Math.max(e.start,Math.min(e.end,this.timelinePos));const o=a?a.remaining:t?t.end-this.timelinePos:0;if(this.log("INTERSTITIALS_BUFFERED_TO_BOUNDARY ".concat(yf(e))+(t?" (".concat(o.toFixed(2)," remaining)"):"")),!this.playbackDisabled)if(i){const t=s.findAssetIndex(e.event,this.bufferedPos);e.event.assetList.forEach((e,s)=>{const n=this.getAssetPlayer(e.identifier);n&&(s===t&&n.loadSource(),n.resumeBuffering())})}else this.hls.resumeBuffering(),this.playerQueue.forEach(e=>e.pauseBuffering());this.hls.trigger(Hi.INTERSTITIALS_BUFFERED_TO_BOUNDARY,{events:r.slice(0),schedule:n.slice(0),bufferingIndex:this.findItemIndex(e),playingIndex:this.findItemIndex(this.playingItem)})}else this.bufferingItem!==e&&(this.bufferingItem=e);return t}bufferedToItem(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const s=this.setBufferingItem(e);if(!this.playbackDisabled)if(this.isInterstitial(e))this.bufferedToEvent(e,t);else if(null!==s){this.bufferingAsset=null;const t=this.detachedData;if(t)if(t.mediaSource){const t=!0;this.attachPrimary(e.start,e,t)}else this.preloadPrimary(e);else this.preloadPrimary(e)}}preloadPrimary(e){const t=this.findItemIndex(e),s=this.getPrimaryResumption(e,t);this.startLoadingPrimaryAt(s)}bufferedToEvent(e,t){const s=e.event,n=0===s.assetList.length&&!s.assetListLoader,r=s.cue.once;if(n||!r){const e=this.preloadAssets(s,t);if(null!=e&&e.interstitial.appendInPlace){const t=this.primaryMedia;t&&this.bufferAssetPlayer(e,t)}}}preloadAssets(e,t){const s=e.assetUrl,n=e.assetList.length,r=0===n&&!e.assetListLoader,i=e.cue.once;if(r){const r=e.timelineStart;if(e.appendInPlace){var a;const t=this.playingItem;this.isInterstitial(t)||(null==t||null==(a=t.nextEvent)?void 0:a.identifier)!==e.identifier||this.flushFrontBuffer(r+.25)}let i,o=0;if(!this.playingItem&&this.primaryLive&&(o=this.hls.startPosition,-1===o&&(o=this.hls.liveSyncPosition||0)),o&&!e.cue.pre&&!e.cue.post){const e=o-r;e>0&&(i=Math.round(1e3*e)/1e3)}if(this.log("Load interstitial asset ".concat(t+1,"/").concat(s?1:n," ").concat(e).concat(i?" live-start: ".concat(o," start-offset: ").concat(i):"")),s)return this.createAsset(e,0,0,r,e.duration,s);const l=this.assetListLoader.loadAssetList(e,i);l&&(e.assetListLoader=l)}else if(!i&&n){for(let r=t;r<n;r++){const t=e.assetList[r],s=this.getAssetPlayerQueueIndex(t.identifier);-1!==s&&!this.playerQueue[s].destroyed||t.error||this.createAssetPlayer(e,t,r)}const s=e.assetList[t];if(s){const e=this.getAssetPlayer(s.identifier);return e&&e.loadSource(),e}}return null}flushFrontBuffer(e){const t=this.requiredTracks;if(!t)return;this.log("Removing front buffer starting at ".concat(e));Object.keys(t).forEach(t=>{this.hls.trigger(Hi.BUFFER_FLUSHING,{startOffset:e,endOffset:1/0,type:t})})}getAssetPlayerQueueIndex(e){const t=this.playerQueue;for(let s=0;s<t.length;s++)if(e===t[s].assetId)return s;return-1}getAssetPlayer(e){const t=this.getAssetPlayerQueueIndex(e);return this.playerQueue[t]||null}getBufferingPlayer(){const{playerQueue:e,primaryMedia:t}=this;if(t)for(let s=0;s<e.length;s++)if(e[s].media===t)return e[s];return null}createAsset(e,t,s,n,r,i){const a={parentIdentifier:e.identifier,identifier:df(e,i,t),duration:r,startOffset:s,timelineStart:n,uri:i};return this.createAssetPlayer(e,a,t)}createAssetPlayer(e,t,s){const n=this.hls,r=n.userConfig;let i=r.videoPreference;const a=n.loadLevelObj||n.levels[n.currentLevel];(i||a)&&(i=ta({},i),a.videoCodec&&(i.videoCodec=a.videoCodec),a.videoRange&&(i.allowedVideoRanges=[a.videoRange]));const o=n.audioTracks[n.audioTrack],l=n.subtitleTracks[n.subtitleTrack];let c=0;if(this.primaryLive||e.appendInPlace){const e=this.timelinePos-t.timelineStart;if(e>1){const s=t.duration;s&&e<s&&(c=e)}}const d=t.identifier,u=na(na({},r),{},{maxMaxBufferLength:Math.min(180,n.config.maxMaxBufferLength),autoStartLoad:!0,startFragPrefetch:!0,primarySessionId:n.sessionId,assetPlayerId:d,abrEwmaDefaultEstimate:n.bandwidthEstimate,interstitialsController:void 0,startPosition:c,liveDurationInfinity:!1,testBandwidth:!1,videoPreference:i,audioPreference:o||r.audioPreference,subtitlePreference:l||r.subtitlePreference});e.appendInPlace&&(e.appendInPlaceStarted=!0,t.timelineStart&&(u.timelineOffset=t.timelineStart));const h=u.cmcd;null!=h&&h.sessionId&&h.contentId&&(u.cmcd=ta({},h,{contentId:of(t.uri)})),this.getAssetPlayer(d)&&this.warn("Duplicate date range identifier ".concat(e," and asset ").concat(d));const f=new gf(this.HlsPlayerClass,u,e,t);this.playerQueue.push(f),e.assetList[s]=t;let m=!0;const p=n=>{if(n.live){var r;const t=new Error("Interstitials MUST be VOD assets ".concat(e)),n={fatal:!0,type:Vi.OTHER_ERROR,details:zi.INTERSTITIAL_ASSET_ITEM_ERROR,error:t},i=(null==(r=this.schedule)?void 0:r.findEventIndex(e.identifier))||-1;return void this.handleAssetItemError(n,e,i,s,t.message)}const i=n.edge-n.fragmentStart,a=t.duration;(m||null===a||i>a)&&(m=!1,this.log('Interstitial asset "'.concat(d,'" duration change ').concat(a," > ").concat(i)),t.duration=i,this.updateSchedule())};f.on(Hi.LEVEL_UPDATED,(e,t)=>{let{details:s}=t;return p(s)}),f.on(Hi.LEVEL_PTS_UPDATED,(e,t)=>{let{details:s}=t;return p(s)}),f.on(Hi.EVENT_CUE_ENTER,()=>this.onInterstitialCueEnter());const g=(e,t)=>{const s=this.getAssetPlayer(d);if(s&&t.tracks){s.off(Hi.BUFFER_CODECS,g),s.tracks=t.tracks;const e=this.primaryMedia;this.bufferingAsset===s.assetItem&&e&&!s.media&&this.bufferAssetPlayer(s,e)}};f.on(Hi.BUFFER_CODECS,g);f.on(Hi.BUFFERED_TO_END,()=>{var s;const n=this.getAssetPlayer(d);if(this.log("buffered to end of asset ".concat(n)),!n||!this.schedule)return;const r=this.schedule.findEventIndex(e.identifier),i=null==(s=this.schedule.items)?void 0:s[r];this.isInterstitial(i)&&this.advanceAssetBuffering(i,t)});const v=t=>()=>{if(!this.getAssetPlayer(d)||!this.schedule)return;this.shouldPlay=!0;const s=this.schedule.findEventIndex(e.identifier);this.advanceAfterAssetEnded(e,s,t)};return f.once(Hi.MEDIA_ENDED,v(s)),f.once(Hi.PLAYOUT_LIMIT_REACHED,v(1/0)),f.on(Hi.ERROR,(t,n)=>{if(!this.schedule)return;const r=this.getAssetPlayer(d);if(n.details===zi.BUFFER_STALLED_ERROR)return null!=r&&r.appendInPlace?void this.handleInPlaceStall(e):(this.onTimeupdate(),void this.checkBuffer(!0));this.handleAssetItemError(n,e,this.schedule.findEventIndex(e.identifier),s,"Asset player error ".concat(n.error," ").concat(e))}),f.on(Hi.DESTROYING,()=>{if(!this.getAssetPlayer(d)||!this.schedule)return;const t=new Error("Asset player destroyed unexpectedly ".concat(d)),n={fatal:!0,type:Vi.OTHER_ERROR,details:zi.INTERSTITIAL_ASSET_ITEM_ERROR,error:t};this.handleAssetItemError(n,e,this.schedule.findEventIndex(e.identifier),s,t.message)}),this.log("INTERSTITIAL_ASSET_PLAYER_CREATED ".concat(pf(t))),this.hls.trigger(Hi.INTERSTITIAL_ASSET_PLAYER_CREATED,{asset:t,assetListIndex:s,event:e,player:f}),f}clearInterstitial(e,t){this.clearAssetPlayers(e,t),e.reset()}clearAssetPlayers(e,t){e.assetList.forEach(e=>{this.clearAssetPlayer(e.identifier,t)})}resetAssetPlayer(e){const t=this.getAssetPlayerQueueIndex(e);if(-1!==t){this.log('reset asset player "'.concat(e,'" after error'));const s=this.playerQueue[t];this.transferMediaFromPlayer(s,null),s.resetDetails()}}clearAssetPlayer(e,t){const s=this.getAssetPlayerQueueIndex(e);if(-1!==s){const e=this.playerQueue[s];this.log("clear ".concat(e," toSegment: ").concat(t?yf(t):t)),this.transferMediaFromPlayer(e,t),this.playerQueue.splice(s,1),e.destroy()}}emptyPlayerQueue(){let e;for(;e=this.playerQueue.pop();)e.destroy();this.playerQueue=[]}startAssetPlayer(e,t,s,n,r){const{interstitial:i,assetItem:a,assetId:o}=e,l=i.assetList.length,c=this.playingAsset;this.endedAsset=null,this.playingAsset=a,c&&c.identifier===o||(c&&(this.clearAssetPlayer(c.identifier,s[n]),delete c.error),this.log("INTERSTITIAL_ASSET_STARTED ".concat(t+1,"/").concat(l," ").concat(pf(a))),this.hls.trigger(Hi.INTERSTITIAL_ASSET_STARTED,{asset:a,assetListIndex:t,event:i,schedule:s.slice(0),scheduleIndex:n,player:e})),this.bufferAssetPlayer(e,r)}bufferAssetPlayer(e,t){var s,n;if(!this.schedule)return;const{interstitial:r,assetItem:i}=e,a=this.schedule.findEventIndex(r.identifier),o=null==(s=this.schedule.items)?void 0:s[a];if(!o)return;e.loadSource(),this.setBufferingItem(o),this.bufferingAsset=i;const l=this.getBufferingPlayer();if(l===e)return;const c=r.appendInPlace;if(c&&!1===(null==l?void 0:l.interstitial.appendInPlace))return;const d=(null==l?void 0:l.tracks)||(null==(n=this.detachedData)?void 0:n.tracks)||this.requiredTracks;if(c&&i!==this.playingAsset){if(!e.tracks)return void this.log("Waiting for track info before buffering ".concat(e));if(d&&!ha(d,e.tracks)){const t=new Error("Asset ".concat(pf(i)," SourceBuffer tracks ('").concat(Object.keys(e.tracks),"') are not compatible with primary content tracks ('").concat(Object.keys(d),"')")),s={fatal:!0,type:Vi.OTHER_ERROR,details:zi.INTERSTITIAL_ASSET_ITEM_ERROR,error:t},n=r.findAssetIndex(i);return void this.handleAssetItemError(s,r,a,n,t.message)}}this.transferMediaTo(e,t)}handleInPlaceStall(e){const t=this.schedule,s=this.primaryMedia;if(!t||!s)return;const n=s.currentTime,r=t.findAssetIndex(e,n),i=e.assetList[r];if(i){const a=this.getAssetPlayer(i.identifier);if(a){const o=a.currentTime||n-i.timelineStart,l=a.duration-o;if(this.warn("Stalled at ".concat(o," of ").concat(o+l," in ").concat(a," ").concat(e," (media.currentTime: ").concat(n,")")),o&&(l/s.playbackRate<.5||a.bufferedInPlaceToEnd(s))&&a.hls){const s=t.findEventIndex(e.identifier);this.advanceAfterAssetEnded(e,s,r)}}}}advanceInPlace(e){const t=this.primaryMedia;t&&t.currentTime<e&&(t.currentTime=e)}handleAssetItemError(e,t,s,n,r){if(e.details===zi.BUFFER_STALLED_ERROR)return;const i=t.assetList[n]||null;if(this.warn("INTERSTITIAL_ASSET_ERROR ".concat(i?pf(i):i," ").concat(e.error)),!this.schedule)return;const a=(null==i?void 0:i.identifier)||"",o=this.getAssetPlayerQueueIndex(a),l=this.playerQueue[o]||null,c=this.schedule.items,d=ta({},e,{fatal:!1,errorAction:ul(!0),asset:i,assetListIndex:n,event:t,schedule:c,scheduleIndex:s,player:l});if(this.hls.trigger(Hi.INTERSTITIAL_ASSET_ERROR,d),!e.fatal)return;const u=this.playingAsset,h=this.bufferingAsset,f=new Error(r);if(i&&(this.clearAssetPlayer(a,null),i.error=f),t.assetList.some(e=>!e.error))for(let m=n;m<t.assetList.length;m++)this.resetAssetPlayer(t.assetList[m].identifier);else t.error=f;this.updateSchedule(!0),t.error?this.primaryFallback(t):u&&u.identifier===a?this.advanceAfterAssetEnded(t,s,n):h&&h.identifier===a&&this.isInterstitial(this.bufferingItem)&&this.advanceAssetBuffering(this.bufferingItem,h)}primaryFallback(e){const t=e.timelineStart,s=this.effectivePlayingItem;let n=this.timelinePos;if(s){this.log('Fallback to primary from event "'.concat(e.identifier,'" start: ').concat(t," pos: ").concat(n," playing: ").concat(yf(s)," error: ").concat(e.error)),-1===n&&(n=this.hls.startPosition);const r=this.updateItem(s,n);this.itemsMatch(s,r)&&this.clearInterstitial(e,null),e.appendInPlace&&(this.attachPrimary(t,null),this.flushFrontBuffer(t))}else if(-1===n)return void this.checkStart();if(!this.schedule)return;const r=this.schedule.findItemIndexAtTime(n);this.setSchedulePosition(r)}onAssetListLoaded(e,t){var s,n;const r=t.event,i=r.identifier,a=t.assetListResponse.ASSETS;if(null==(s=this.schedule)||!s.hasEvent(i))return;const o=r.timelineStart,l=r.duration;let c=0;a.forEach((e,t)=>{const s=parseFloat(e.DURATION);this.createAsset(r,t,c,o+c,s,e.URI),c+=s}),r.duration=c,this.log("Loaded asset-list with duration: ".concat(c," (was: ").concat(l,") ").concat(r));const d=this.waitingItem,u=(null==d?void 0:d.event.identifier)===i;this.updateSchedule();const h=null==(n=this.bufferingItem)?void 0:n.event;if(u){var f;const e=this.schedule.findEventIndex(i),t=null==(f=this.schedule.items)?void 0:f[e];if(t){if(!this.playingItem&&this.timelinePos>t.end){if(this.schedule.findItemIndexAtTime(this.timelinePos)!==e)return r.error=new Error("Interstitial ".concat(a.length?"no longer within playback range":"asset-list is empty"," ").concat(this.timelinePos," ").concat(r)),this.log(r.error.message),this.updateSchedule(!0),void this.primaryFallback(r)}this.setBufferingItem(t)}this.setSchedulePosition(e)}else if((null==h?void 0:h.identifier)===i){const e=r.assetList[0];if(e){const t=this.getAssetPlayer(e.identifier);if(h.appendInPlace){const e=this.primaryMedia;t&&e&&this.bufferAssetPlayer(t,e)}else t&&t.loadSource()}}}onError(e,t){if(this.schedule)switch(t.details){case zi.ASSET_LIST_PARSING_ERROR:case zi.ASSET_LIST_LOAD_ERROR:case zi.ASSET_LIST_LOAD_TIMEOUT:{const e=t.interstitial;e&&(this.updateSchedule(!0),this.primaryFallback(e));break}case zi.BUFFER_STALLED_ERROR:{const e=this.endedItem||this.waitingItem||this.playingItem;if(this.isInterstitial(e)&&e.event.appendInPlace)return void this.handleInPlaceStall(e.event);this.log("Primary player stall @".concat(this.timelinePos," bufferedPos: ").concat(this.bufferedPos)),this.onTimeupdate(),this.checkBuffer(!0);break}}}}});function Lm(e){return e&&"object"===typeof e?Array.isArray(e)?e.map(Lm):Object.keys(e).reduce((t,s)=>(t[s]=Lm(e[s]),t),{}):e}function Cm(e,t){const s=e.loader;if(s!==xm&&s!==km)t.log("[config]: Custom loader detected, cannot enable progressive streaming"),e.progressive=!1;else{(function(){if(self.fetch&&self.AbortController&&self.ReadableStream&&self.Request)try{return new self.ReadableStream({}),!0}catch(Np){}return!1})()&&(e.loader=xm,e.progressive=!0,e.enableSoftwareAES=!0,t.log("[config]: Progressive streaming enabled, using FetchLoader"))}}class Am extends Nl{constructor(e,t){super("gap-controller",e.logger),this.hls=void 0,this.fragmentTracker=void 0,this.media=null,this.mediaSource=void 0,this.nudgeRetry=0,this.stallReported=!1,this.stalled=null,this.moved=!1,this.seeking=!1,this.buffered={},this.lastCurrentTime=0,this.ended=0,this.waiting=0,this.onMediaPlaying=()=>{this.ended=0,this.waiting=0},this.onMediaWaiting=()=>{var e;null!=(e=this.media)&&e.seeking||(this.waiting=self.performance.now(),this.tick())},this.onMediaEnded=()=>{var e;this.hls&&(this.ended=(null==(e=this.media)?void 0:e.currentTime)||1,this.hls.trigger(Hi.MEDIA_ENDED,{stalled:!1}))},this.hls=e,this.fragmentTracker=t,this.registerListeners()}registerListeners(){const{hls:e}=this;e&&(e.on(Hi.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(Hi.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(Hi.BUFFER_APPENDED,this.onBufferAppended,this))}unregisterListeners(){const{hls:e}=this;e&&(e.off(Hi.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(Hi.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(Hi.BUFFER_APPENDED,this.onBufferAppended,this))}destroy(){super.destroy(),this.unregisterListeners(),this.media=this.hls=this.fragmentTracker=null,this.mediaSource=void 0}onMediaAttached(e,t){this.setInterval(100),this.mediaSource=t.mediaSource;const s=this.media=t.media;$c(s,"playing",this.onMediaPlaying),$c(s,"waiting",this.onMediaWaiting),$c(s,"ended",this.onMediaEnded)}onMediaDetaching(e,t){this.clearInterval();const{media:s}=this;s&&(Jc(s,"playing",this.onMediaPlaying),Jc(s,"waiting",this.onMediaWaiting),Jc(s,"ended",this.onMediaEnded),this.media=null),this.mediaSource=void 0}onBufferAppended(e,t){this.buffered=t.timeRanges}get hasBuffered(){return Object.keys(this.buffered).length>0}tick(){var e;if(null==(e=this.media)||!e.readyState||!this.hasBuffered)return;const t=this.media.currentTime;this.poll(t,this.lastCurrentTime),this.lastCurrentTime=t}poll(e,t){var s,n;const r=null==(s=this.hls)?void 0:s.config;if(!r)return;const i=this.media;if(!i)return;const{seeking:a}=i,o=this.seeking&&!a,l=!this.seeking&&a,c=i.paused&&!a||i.ended||0===i.playbackRate;if(this.seeking=a,e!==t)return t&&(this.ended=0),this.moved=!0,a||(this.nudgeRetry=0,r.nudgeOnVideoHole&&!c&&e>t&&this.nudgeOnVideoHole(e,t)),void(0===this.waiting&&this.stallResolved(e));if(l||o)return void(o&&this.stallResolved(e));if(c)return this.nudgeRetry=0,this.stallResolved(e),void(!this.ended&&i.ended&&this.hls&&(this.ended=e||1,this.hls.trigger(Hi.MEDIA_ENDED,{stalled:!1})));if(!Pl.getBuffered(i).length)return void(this.nudgeRetry=0);const d=Pl.bufferInfo(i,e,0),u=d.nextStart||0,h=this.fragmentTracker;if(a&&h&&this.hls){const t=Rm(this.hls.inFlightFragments,e),s=d.len>2,n=!u||t||u-e>2&&!h.getPartialFragment(e);if(s||n)return;this.moved=!1}const f=null==(n=this.hls)?void 0:n.latestLevelDetails;if(!this.moved&&null!==this.stalled&&h){if(!(d.len>0)&&!u)return;const t=Math.max(u,d.start||0)-e,s=!(null==f||!f.live)?2*f.targetduration:2,n=Nm(e,h);if(t>0&&(t<=s||n))return void(i.paused||this._trySkipBufferHole(n))}const m=r.detectStallWithCurrentTimeMs,p=self.performance.now(),g=this.waiting;let v=this.stalled;if(null===v){if(!(g>0&&p-g<m))return void(this.stalled=p);v=this.stalled=g}const y=p-v;if(!a&&(y>=m||g)&&this.hls){var b;if("ended"===(null==(b=this.mediaSource)?void 0:b.readyState)&&(null==f||!f.live)&&Math.abs(e-((null==f?void 0:f.edge)||0))<1){if(this.ended)return;return this.ended=e||1,void this.hls.trigger(Hi.MEDIA_ENDED,{stalled:!0})}if(this._reportStall(d),!this.media||!this.hls)return}const x=Pl.bufferInfo(i,e,r.maxBufferHole);this._tryFixBufferStall(x,y,e)}stallResolved(e){const t=this.stalled;if(t&&this.hls&&(this.stalled=null,this.stallReported)){const s=self.performance.now()-t;this.log("playback not stuck anymore @".concat(e,", after ").concat(Math.round(s),"ms")),this.stallReported=!1,this.waiting=0,this.hls.trigger(Hi.STALL_RESOLVED,{})}}nudgeOnVideoHole(e,t){var s;const n=this.buffered.video;if(this.hls&&this.media&&this.fragmentTracker&&null!=(s=this.buffered.audio)&&s.length&&n&&n.length>1&&e>n.end(0)){const s=Pl.bufferedInfo(Pl.timeRangesToArray(this.buffered.audio),e,0);if(s.len>1&&t>=s.start){const s=Pl.timeRangesToArray(n),r=Pl.bufferedInfo(s,t,0).bufferedIndex;if(r>-1&&r<s.length-1){const t=Pl.bufferedInfo(s,e,0).bufferedIndex,n=s[r].end,i=s[r+1].start;if((-1===t||t>r)&&i-n<1&&e-n<2){const s=new Error("nudging playhead to flush pipeline after video hole. currentTime: ".concat(e," hole: ").concat(n," -> ").concat(i," buffered index: ").concat(t));this.warn(s.message),this.media.currentTime+=1e-6;let r=Nm(e,this.fragmentTracker);r&&"fragment"in r?r=r.fragment:r||(r=void 0);const a=Pl.bufferInfo(this.media,e,0);this.hls.trigger(Hi.ERROR,{type:Vi.MEDIA_ERROR,details:zi.BUFFER_SEEK_OVER_HOLE,fatal:!1,error:s,reason:s.message,frag:r,buffer:a.len,bufferInfo:a})}}}}}_tryFixBufferStall(e,t,s){var n,r;const{fragmentTracker:i,media:a}=this,o=null==(n=this.hls)?void 0:n.config;if(!a||!i||!o)return;const l=null==(r=this.hls)?void 0:r.latestLevelDetails,c=Nm(s,i);if(c||null!=l&&l.live&&s<l.fragmentStart){if(this._trySkipBufferHole(c)||!this.media)return}const d=e.buffered,u=this.adjacentTraversal(e,s);(d&&d.length>1&&e.len>o.maxBufferHole||e.nextStart&&(e.nextStart-s<o.maxBufferHole||u))&&(t>1e3*o.highBufferWatchdogPeriod||this.waiting)&&(this.warn("Trying to nudge playhead over buffer-hole"),this._tryNudgeBuffer(e))}adjacentTraversal(e,t){const s=this.fragmentTracker,n=e.nextStart;if(s&&n){const e=s.getFragAtPos(t,Xi),r=s.getFragAtPos(n,Xi);if(e&&r)return r.sn-e.sn<2}return!1}_reportStall(e){const{hls:t,media:s,stallReported:n,stalled:r}=this;if(!n&&null!==r&&s&&t){this.stallReported=!0;const n=new Error("Playback stalling at @".concat(s.currentTime," due to low buffer (").concat(Do(e),")"));this.warn(n.message),t.trigger(Hi.ERROR,{type:Vi.MEDIA_ERROR,details:zi.BUFFER_STALLED_ERROR,fatal:!1,error:n,buffer:e.len,bufferInfo:e,stalled:{start:r}})}}_trySkipBufferHole(e){var t;const{fragmentTracker:s,media:n}=this,r=null==(t=this.hls)?void 0:t.config;if(!n||!s||!r)return 0;const i=n.currentTime,a=Pl.bufferInfo(n,i,0),o=i<a.start?a.start:a.nextStart;if(o&&this.hls){const t=a.len<=r.maxBufferHole,c=a.len>0&&a.len<1&&n.readyState<3,d=o-i;if(d>0&&(t||c)){if(d>r.maxBufferHole){let t=!1;if(0===i){const e=s.getAppendedFrag(0,Xi);e&&o<e.end&&(t=!0)}if(!t&&e){var l;if(null==(l=this.hls.loadLevelObj)||!l.details)return 0;if(Rm(this.hls.inFlightFragments,o))return 0;let t=!1,n=e.end;for(;n<o;){const e=Nm(n,s);if(!e){t=!0;break}n+=e.duration}if(t)return 0}}const t=Math.max(o+.05,i+.1);if(this.warn("skipping hole, adjusting currentTime from ".concat(i," to ").concat(t)),this.moved=!0,n.currentTime=t,null==e||!e.gap){const s=new Error("fragment loaded with buffer holes, seeking from ".concat(i," to ").concat(t)),n={type:Vi.MEDIA_ERROR,details:zi.BUFFER_SEEK_OVER_HOLE,fatal:!1,error:s,reason:s.message,buffer:a.len,bufferInfo:a};e&&("fragment"in e?n.part=e:n.frag=e),this.hls.trigger(Hi.ERROR,n)}return t}}return 0}_tryNudgeBuffer(e){const{hls:t,media:s,nudgeRetry:n}=this,r=null==t?void 0:t.config;if(!s||!r)return 0;const i=s.currentTime;if(this.nudgeRetry++,n<r.nudgeMaxRetry){const a=i+(n+1)*r.nudgeOffset,o=new Error("Nudging 'currentTime' from ".concat(i," to ").concat(a));this.warn(o.message),s.currentTime=a,t.trigger(Hi.ERROR,{type:Vi.MEDIA_ERROR,details:zi.BUFFER_NUDGE_ON_STALL,error:o,fatal:!1,buffer:e.len,bufferInfo:e})}else{const s=new Error("Playhead still not moving while enough data buffered @".concat(i," after ").concat(r.nudgeMaxRetry," nudges"));this.error(s.message),t.trigger(Hi.ERROR,{type:Vi.MEDIA_ERROR,details:zi.BUFFER_STALLED_ERROR,error:s,fatal:!0,buffer:e.len,bufferInfo:e})}}}function Rm(e,t){const s=_m(e.main);if(s&&s.start<=t)return s;const n=_m(e.audio);return n&&n.start<=t?n:null}function _m(e){if(!e)return null;switch(e.state){case td:case ed:case ld:case cd:return null}return e.frag}function Nm(e,t){return t.getAppendedFrag(e,Xi)||t.getPartialFragment(e)}function Im(){if("undefined"!==typeof self)return self.VTTCue||self.TextTrackCue}function jm(e,t,s,n,r){let i=new e(t,s,"");try{i.value=n,r&&(i.type=r)}catch(Np){i=new e(t,s,Do(r?na({type:r},n):n))}return i}const Pm=(()=>{const e=Im();try{e&&new e(0,Number.POSITIVE_INFINITY,"")}catch(Np){return Number.MAX_VALUE}return Number.POSITIVE_INFINITY})();class Dm{constructor(e){this.hls=void 0,this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.removeCues=!0,this.assetCue=void 0,this.onEventCueEnter=()=>{this.hls&&this.hls.trigger(Hi.EVENT_CUE_ENTER,{})},this.hls=e,this._registerListeners()}destroy(){this._unregisterListeners(),this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.hls=this.onEventCueEnter=null}_registerListeners(){const{hls:e}=this;e&&(e.on(Hi.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(Hi.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(Hi.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(Hi.MANIFEST_LOADING,this.onManifestLoading,this),e.on(Hi.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),e.on(Hi.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(Hi.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(Hi.LEVEL_PTS_UPDATED,this.onLevelPtsUpdated,this))}_unregisterListeners(){const{hls:e}=this;e&&(e.off(Hi.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(Hi.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(Hi.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(Hi.MANIFEST_LOADING,this.onManifestLoading,this),e.off(Hi.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),e.off(Hi.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(Hi.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(Hi.LEVEL_PTS_UPDATED,this.onLevelPtsUpdated,this))}onMediaAttaching(e,t){var s;this.media=t.media,!1===(null==(s=t.overrides)?void 0:s.cueRemoval)&&(this.removeCues=!1)}onMediaAttached(){var e;const t=null==(e=this.hls)?void 0:e.latestLevelDetails;t&&this.updateDateRangeCues(t)}onMediaDetaching(e,t){this.media=null;!!t.transferMedia||(this.id3Track&&(this.removeCues&&nf(this.id3Track,this.onEventCueEnter),this.id3Track=null),this.dateRangeCuesAppended={})}onManifestLoading(){this.dateRangeCuesAppended={}}createTrack(e){const t=this.getID3Track(e.textTracks);return t.mode="hidden",t}getID3Track(e){if(this.media){for(let t=0;t<e.length;t++){const s=e[t];if("metadata"===s.kind&&"id3"===s.label)return tf(s,this.media),s}return this.media.addTextTrack("metadata","id3")}}onFragParsingMetadata(e,t){if(!this.media||!this.hls)return;const{enableEmsgMetadataCues:s,enableID3MetadataCues:n}=this.hls.config;if(!s&&!n)return;const{samples:r}=t;this.id3Track||(this.id3Track=this.createTrack(this.media));const i=Im();if(i)for(let a=0;a<r.length;a++){const e=r[a].type;if(e===Vd.emsg&&!s||!n)continue;const t=Fd(r[a].data),o=r[a].pts;let l=o+r[a].duration;l>Pm&&(l=Pm);l-o<=0&&(l=o+.25);for(let s=0;s<t.length;s++){const n=t[s];if(!Ud(n)){this.updateId3CueEnds(o,e);const t=jm(i,o,l,n,e);t&&this.id3Track.addCue(t)}}}}updateId3CueEnds(e,t){var s;const n=null==(s=this.id3Track)?void 0:s.cues;if(n)for(let r=n.length;r--;){const s=n[r];s.type===t&&s.startTime<e&&s.endTime===Pm&&(s.endTime=e)}}onBufferFlushing(e,t){let{startOffset:s,endOffset:n,type:r}=t;const{id3Track:i,hls:a}=this;if(!a)return;const{config:{enableEmsgMetadataCues:o,enableID3MetadataCues:l}}=a;if(i&&(o||l)){let e;e="audio"===r?e=>e.type===Vd.audioId3&&l:"video"===r?e=>e.type===Vd.emsg&&o:e=>e.type===Vd.audioId3&&l||e.type===Vd.emsg&&o,rf(i,s,n,e)}}onLevelUpdated(e,t){let{details:s}=t;this.updateDateRangeCues(s,!0)}onLevelPtsUpdated(e,t){Math.abs(t.drift)>.01&&this.updateDateRangeCues(t.details)}updateDateRangeCues(e,t){if(!this.hls||!this.media)return;const{assetPlayerId:s,timelineOffset:n,enableDateRangeMetadataCues:r,interstitialsController:i}=this.hls.config;if(!r)return;const a=Im();if(s&&n&&!i){const{fragmentStart:t,fragmentEnd:n}=e;let r=this.assetCue;r?(r.startTime=t,r.endTime=n):a&&(r=this.assetCue=jm(a,t,n,{assetPlayerId:this.hls.config.assetPlayerId},"hlsjs.interstitial.asset"),r&&(r.id=s,this.id3Track||(this.id3Track=this.createTrack(this.media)),this.id3Track.addCue(r),r.addEventListener("enter",this.onEventCueEnter)))}if(!e.hasProgramDateTime)return;const{id3Track:o}=this,{dateRanges:l}=e,c=Object.keys(l);let d=this.dateRangeCuesAppended;var u;if(o&&t)if(null!=(u=o.cues)&&u.length){const e=Object.keys(d).filter(e=>!c.includes(e));for(let t=e.length;t--;){var h;const s=e[t],n=null==(h=d[s])?void 0:h.cues;delete d[s],n&&Object.keys(n).forEach(e=>{const t=n[e];if(t){t.removeEventListener("enter",this.onEventCueEnter);try{o.removeCue(t)}catch(Np){}}})}}else d=this.dateRangeCuesAppended={};const f=e.fragments[e.fragments.length-1];if(0!==c.length&&Ui(null==f?void 0:f.programDateTime)){this.id3Track||(this.id3Track=this.createTrack(this.media));for(let e=0;e<c.length;e++){const t=c[e],s=l[t],n=s.startTime,r=d[t],o=(null==r?void 0:r.cues)||{};let u=(null==r?void 0:r.durationKnown)||!1,h=Pm;const{duration:f,endDate:m}=s;if(m&&null!==f)h=n+f,u=!0;else if(s.endOnNext&&!u){const e=c.reduce((e,t)=>{if(t!==s.id){const n=l[t];if(n.class===s.class&&n.startDate>s.startDate&&(!e||s.startDate<e.startDate))return n}return e},null);e&&(h=e.startTime,u=!0)}const p=Object.keys(s.attr);for(let e=0;e<p.length;e++){const l=p[e];if(!zl(l))continue;const c=o[l];if(c)!u||null!=r&&r.durationKnown?Math.abs(c.startTime-n)>.01&&(c.startTime=n,c.endTime=h):c.endTime=h;else if(a){let e=s.attr[l];Hl(l)&&(e=pa(e));const r=jm(a,n,h,{key:l,data:e},Vd.dateRange);r&&(r.id=t,this.id3Track.addCue(r),o[l]=r,i&&("X-ASSET-LIST"!==l&&"X-ASSET-URL"!==l||r.addEventListener("enter",this.onEventCueEnter)))}}d[t]={cues:o,dateRange:s,durationKnown:u}}}}}class Mm{constructor(e){this.hls=void 0,this.config=void 0,this.media=null,this.currentTime=0,this.stallCount=0,this._latency=null,this._targetLatencyUpdated=!1,this.onTimeupdate=()=>{const{media:e}=this,t=this.levelDetails;if(!e||!t)return;this.currentTime=e.currentTime;const s=this.computeLatency();if(null===s)return;this._latency=s;const{lowLatencyMode:n,maxLiveSyncPlaybackRate:r}=this.config;if(!n||1===r||!t.live)return;const i=this.targetLatency;if(null===i)return;const a=s-i;if(a<Math.min(this.maxLatency,i+t.targetduration)&&a>.05&&this.forwardBufferLength>1){const t=Math.min(2,Math.max(1,r)),s=Math.round(2/(1+Math.exp(-.75*a-this.edgeStalled))*20)/20,n=Math.min(t,Math.max(1,s));this.changeMediaPlaybackRate(e,n)}else 1!==e.playbackRate&&0!==e.playbackRate&&this.changeMediaPlaybackRate(e,1)},this.hls=e,this.config=e.config,this.registerListeners()}get levelDetails(){var e;return(null==(e=this.hls)?void 0:e.latestLevelDetails)||null}get latency(){return this._latency||0}get maxLatency(){const{config:e}=this;if(void 0!==e.liveMaxLatencyDuration)return e.liveMaxLatencyDuration;const t=this.levelDetails;return t?e.liveMaxLatencyDurationCount*t.targetduration:0}get targetLatency(){const e=this.levelDetails;if(null===e||null===this.hls)return null;const{holdBack:t,partHoldBack:s,targetduration:n}=e,{liveSyncDuration:r,liveSyncDurationCount:i,lowLatencyMode:a}=this.config,o=this.hls.userConfig;let l=a&&s||t;(this._targetLatencyUpdated||o.liveSyncDuration||o.liveSyncDurationCount||0===l)&&(l=void 0!==r?r:i*n);const c=n;return l+Math.min(this.stallCount*this.config.liveSyncOnStallIncrease,c)}set targetLatency(e){this.stallCount=0,this.config.liveSyncDuration=e,this._targetLatencyUpdated=!0}get liveSyncPosition(){const e=this.estimateLiveEdge(),t=this.targetLatency;if(null===e||null===t)return null;const s=this.levelDetails;if(null===s)return null;const n=s.edge,r=e-t-this.edgeStalled,i=n-s.totalduration,a=n-(this.config.lowLatencyMode&&s.partTarget||s.targetduration);return Math.min(Math.max(i,r),a)}get drift(){const e=this.levelDetails;return null===e?1:e.drift}get edgeStalled(){const e=this.levelDetails;if(null===e)return 0;const t=3*(this.config.lowLatencyMode&&e.partTarget||e.targetduration);return Math.max(e.age-t,0)}get forwardBufferLength(){const{media:e}=this,t=this.levelDetails;if(!e||!t)return 0;const s=e.buffered.length;return(s?e.buffered.end(s-1):t.edge)-this.currentTime}destroy(){this.unregisterListeners(),this.onMediaDetaching(),this.hls=null}registerListeners(){const{hls:e}=this;e&&(e.on(Hi.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(Hi.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(Hi.MANIFEST_LOADING,this.onManifestLoading,this),e.on(Hi.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(Hi.ERROR,this.onError,this))}unregisterListeners(){const{hls:e}=this;e&&(e.off(Hi.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(Hi.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(Hi.MANIFEST_LOADING,this.onManifestLoading,this),e.off(Hi.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(Hi.ERROR,this.onError,this))}onMediaAttached(e,t){this.media=t.media,this.media.addEventListener("timeupdate",this.onTimeupdate)}onMediaDetaching(){this.media&&(this.media.removeEventListener("timeupdate",this.onTimeupdate),this.media=null)}onManifestLoading(){this._latency=null,this.stallCount=0}onLevelUpdated(e,t){let{details:s}=t;s.advanced&&this.onTimeupdate(),!s.live&&this.media&&this.media.removeEventListener("timeupdate",this.onTimeupdate)}onError(e,t){var s;t.details===zi.BUFFER_STALLED_ERROR&&(this.stallCount++,this.hls&&null!=(s=this.levelDetails)&&s.live&&this.hls.logger.warn("[latency-controller]: Stall detected, adjusting target latency"))}changeMediaPlaybackRate(e,t){var s,n;e.playbackRate!==t&&(null==(s=this.hls)||s.logger.debug("[latency-controller]: latency=".concat(this.latency.toFixed(3),", targetLatency=").concat(null==(n=this.targetLatency)?void 0:n.toFixed(3),", forwardBufferLength=").concat(this.forwardBufferLength.toFixed(3),": adjusting playback rate from ").concat(e.playbackRate," to ").concat(t)),e.playbackRate=t)}estimateLiveEdge(){const e=this.levelDetails;return null===e?null:e.edge+e.age}computeLatency(){const e=this.estimateLiveEdge();return null===e?null:e-this.currentTime}}class Om extends Hu{constructor(e,t){super(e,"level-controller"),this._levels=[],this._firstLevel=-1,this._maxAutoLevel=-1,this._startLevel=void 0,this.currentLevel=null,this.currentLevelIndex=-1,this.manualLevelIndex=-1,this.steering=void 0,this.onParsedComplete=void 0,this.steering=t,this._registerListeners()}_registerListeners(){const{hls:e}=this;e.on(Hi.MANIFEST_LOADING,this.onManifestLoading,this),e.on(Hi.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(Hi.LEVEL_LOADED,this.onLevelLoaded,this),e.on(Hi.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(Hi.FRAG_BUFFERED,this.onFragBuffered,this),e.on(Hi.ERROR,this.onError,this)}_unregisterListeners(){const{hls:e}=this;e.off(Hi.MANIFEST_LOADING,this.onManifestLoading,this),e.off(Hi.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(Hi.LEVEL_LOADED,this.onLevelLoaded,this),e.off(Hi.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(Hi.FRAG_BUFFERED,this.onFragBuffered,this),e.off(Hi.ERROR,this.onError,this)}destroy(){this._unregisterListeners(),this.steering=null,this.resetLevels(),super.destroy()}stopLoad(){this._levels.forEach(e=>{e.loadError=0,e.fragmentError=0}),super.stopLoad()}resetLevels(){this._startLevel=void 0,this.manualLevelIndex=-1,this.currentLevelIndex=-1,this.currentLevel=null,this._levels=[],this._maxAutoLevel=-1}onManifestLoading(e,t){this.resetLevels()}onManifestLoaded(e,t){const s=this.hls.config.preferManagedMediaSource,n=[],r={},i={};let a=!1,o=!1,l=!1;t.levels.forEach(e=>{const t=e.attrs;let{audioCodec:c,videoCodec:d}=e;c&&(e.audioCodec=c=ho(c,s)||void 0),d&&(d=e.videoCodec=function(e){const t=e.split(",");for(let s=0;s<t.length;s++){const e=t[s].split(".");e.length>2&&"avc1"===e[0]&&(t[s]="avc1.".concat(parseInt(e[1]).toString(16)).concat(("000"+parseInt(e[2]).toString(16)).slice(-4)))}return t.join(",")}(d));const{width:u,height:h,unknownCodecs:f}=e,m=(null==f?void 0:f.length)||0;if(a||(a=!(!u||!h)),o||(o=!!d),l||(l=!!c),m||c&&!this.isAudioSupported(c)||d&&!this.isVideoSupported(d))return void this.log('Some or all CODECS not supported "'.concat(t.CODECS,'"'));const{CODECS:p,"FRAME-RATE":g,"HDCP-LEVEL":v,"PATHWAY-ID":y,RESOLUTION:b,"VIDEO-RANGE":x}=t,E="".concat(y||".","-"),S="".concat(E).concat(e.bitrate,"-").concat(b,"-").concat(g,"-").concat(p,"-").concat(x,"-").concat(v);if(r[S])if(r[S].uri===e.url||e.attrs["PATHWAY-ID"])r[S].addGroupId("audio",t.AUDIO),r[S].addGroupId("text",t.SUBTITLES);else{const t=i[S]+=1;e.attrs["PATHWAY-ID"]=new Array(t+1).join(".");const s=this.createLevel(e);r[S]=s,n.push(s)}else{const t=this.createLevel(e);r[S]=t,i[S]=1,n.push(t)}}),this.filterAndSortMediaOptions(n,t,a,o,l)}createLevel(e){const t=new Io(e),s=e.supplemental;if(null!=s&&s.videoCodec&&!this.isVideoSupported(s.videoCodec)){const e=new Error('SUPPLEMENTAL-CODECS not supported "'.concat(s.videoCodec,'"'));this.log(e.message),t.supportedResult=xo(e,[])}return t}isAudioSupported(e){return ro(e,"audio",this.hls.config.preferManagedMediaSource)}isVideoSupported(e){return ro(e,"video",this.hls.config.preferManagedMediaSource)}filterAndSortMediaOptions(e,t,s,n,r){var i;let a=[],o=[],l=e;const c=(null==(i=t.stats)?void 0:i.parsing)||{};if((s||n)&&r&&(l=l.filter(e=>{let{videoCodec:t,videoRange:s,width:n,height:r}=e;return(!!t||!(!n||!r))&&(!!(i=s)&&Lo.indexOf(i)>-1);var i})),0===l.length)return Promise.resolve().then(()=>{if(this.hls){let e="no level with compatible codecs found in manifest",s=e;t.levels.length&&(s="one or more CODECS in variant not supported: ".concat(Do(t.levels.map(e=>e.attrs.CODECS).filter((e,t,s)=>s.indexOf(e)===t))),this.warn(s),e+=" (".concat(s,")"));const n=new Error(e);this.hls.trigger(Hi.ERROR,{type:Vi.MEDIA_ERROR,details:zi.MANIFEST_INCOMPATIBLE_CODECS_ERROR,fatal:!0,url:t.url,error:n,reason:s})}}),void(c.end=performance.now());t.audioTracks&&(a=t.audioTracks.filter(e=>!e.audioCodec||this.isAudioSupported(e.audioCodec)),Fm(a)),t.subtitles&&(o=t.subtitles,Fm(o));const d=l.slice(0);l.sort((e,t)=>{if(e.attrs["HDCP-LEVEL"]!==t.attrs["HDCP-LEVEL"])return(e.attrs["HDCP-LEVEL"]||"")>(t.attrs["HDCP-LEVEL"]||"")?1:-1;if(s&&e.height!==t.height)return e.height-t.height;if(e.frameRate!==t.frameRate)return e.frameRate-t.frameRate;if(e.videoRange!==t.videoRange)return Lo.indexOf(e.videoRange)-Lo.indexOf(t.videoRange);if(e.videoCodec!==t.videoCodec){const s=oo(e.videoCodec),n=oo(t.videoCodec);if(s!==n)return n-s}if(e.uri===t.uri&&e.codecSet!==t.codecSet){const s=lo(e.codecSet),n=lo(t.codecSet);if(s!==n)return n-s}return e.averageBitrate!==t.averageBitrate?e.averageBitrate-t.averageBitrate:0});let u=d[0];if(this.steering&&(l=this.steering.filterParsedLevels(l),l.length!==d.length))for(let v=0;v<d.length;v++)if(d[v].pathwayId===l[0].pathwayId){u=d[v];break}this._levels=l;for(let v=0;v<l.length;v++)if(l[v]===u){var h;this._firstLevel=v;const e=u.bitrate,t=this.hls.bandwidthEstimate;if(this.log("manifest loaded, ".concat(l.length," level(s) found, first bitrate: ").concat(e)),void 0===(null==(h=this.hls.userConfig)?void 0:h.abrEwmaDefaultEstimate)){const s=Math.min(e,this.hls.config.abrEwmaDefaultEstimateMax);s>t&&t===this.hls.abrEwmaDefaultEstimate&&(this.hls.bandwidthEstimate=s)}break}const f=r&&!n,m=this.hls.config,p=!(!m.audioStreamController||!m.audioTrackController),g={levels:l,audioTracks:a,subtitleTracks:o,sessionData:t.sessionData,sessionKeys:t.sessionKeys,firstLevel:this._firstLevel,stats:t.stats,audio:r,video:n,altAudio:p&&!f&&a.some(e=>!!e.url)};c.end=performance.now(),this.hls.trigger(Hi.MANIFEST_PARSED,g)}get levels(){return 0===this._levels.length?null:this._levels}get loadLevelObj(){return this.currentLevel}get level(){return this.currentLevelIndex}set level(e){const t=this._levels;if(0===t.length)return;if(e<0||e>=t.length){const s=new Error("invalid level idx"),n=e<0;if(this.hls.trigger(Hi.ERROR,{type:Vi.OTHER_ERROR,details:zi.LEVEL_SWITCH_ERROR,level:e,fatal:n,error:s,reason:s.message}),n)return;e=Math.min(e,t.length-1)}const s=this.currentLevelIndex,n=this.currentLevel,r=n?n.attrs["PATHWAY-ID"]:void 0,i=t[e],a=i.attrs["PATHWAY-ID"];if(this.currentLevelIndex=e,this.currentLevel=i,s===e&&n&&r===a)return;this.log("Switching to level ".concat(e," (").concat(i.height?i.height+"p ":"").concat(i.videoRange?i.videoRange+" ":"").concat(i.codecSet?i.codecSet+" ":"","@").concat(i.bitrate,")").concat(a?" with Pathway "+a:""," from level ").concat(s).concat(r?" with Pathway "+r:""));const o={level:e,attrs:i.attrs,details:i.details,bitrate:i.bitrate,averageBitrate:i.averageBitrate,maxBitrate:i.maxBitrate,realBitrate:i.realBitrate,width:i.width,height:i.height,codecSet:i.codecSet,audioCodec:i.audioCodec,videoCodec:i.videoCodec,audioGroups:i.audioGroups,subtitleGroups:i.subtitleGroups,loaded:i.loaded,loadError:i.loadError,fragmentError:i.fragmentError,name:i.name,id:i.id,uri:i.uri,url:i.url,urlId:0,audioGroupIds:i.audioGroupIds,textGroupIds:i.textGroupIds};this.hls.trigger(Hi.LEVEL_SWITCHING,o);const l=i.details;if(!l||l.live){const e=this.switchParams(i.uri,null==n?void 0:n.details,l);this.loadPlaylist(e)}}get manualLevel(){return this.manualLevelIndex}set manualLevel(e){this.manualLevelIndex=e,void 0===this._startLevel&&(this._startLevel=e),-1!==e&&(this.level=e)}get firstLevel(){return this._firstLevel}set firstLevel(e){this._firstLevel=e}get startLevel(){if(void 0===this._startLevel){const e=this.hls.config.startLevel;return void 0!==e?e:this.hls.firstAutoLevel}return this._startLevel}set startLevel(e){this._startLevel=e}get pathways(){return this.steering?this.steering.pathways():[]}get pathwayPriority(){return this.steering?this.steering.pathwayPriority:null}set pathwayPriority(e){if(this.steering){const t=this.steering.pathways(),s=e.filter(e=>-1!==t.indexOf(e));if(e.length<1)return void this.warn("pathwayPriority ".concat(e," should contain at least one pathway from list: ").concat(t));this.steering.pathwayPriority=s}}onError(e,t){!t.fatal&&t.context&&t.context.type===Wi&&t.context.level===this.level&&this.checkRetry(t)}onFragBuffered(e,t){let{frag:s}=t;if(void 0!==s&&s.type===Xi){const e=s.elementaryStreams;if(!Object.keys(e).some(t=>!!e[t]))return;const t=this._levels[s.level];null!=t&&t.loadError&&(this.log("Resetting level error count of ".concat(t.loadError," on frag buffered")),t.loadError=0)}}onLevelLoaded(e,t){var s;const{level:n,details:r}=t,i=t.levelInfo;var a;if(!i)return this.warn("Invalid level index ".concat(n)),void(null!=(a=t.deliveryDirectives)&&a.skip&&(r.deltaUpdateFailed=!0));if(i===this.currentLevel||t.withoutMultiVariant){0===i.fragmentError&&(i.loadError=0);let e=i.details;e===t.details&&e.advanced&&(e=void 0),this.playlistLoaded(n,t,e)}else null!=(s=t.deliveryDirectives)&&s.skip&&(r.deltaUpdateFailed=!0)}loadPlaylist(e){super.loadPlaylist(),this.shouldLoadPlaylist(this.currentLevel)&&this.scheduleLoading(this.currentLevel,e)}loadingPlaylist(e,t){super.loadingPlaylist(e,t);const s=this.getUrlWithDirectives(e.uri,t),n=this.currentLevelIndex,r=e.attrs["PATHWAY-ID"],i=e.details,a=null==i?void 0:i.age;this.log("Loading level index ".concat(n).concat(void 0!==(null==t?void 0:t.msn)?" at sn "+t.msn+" part "+t.part:"").concat(r?" Pathway "+r:"").concat(a&&i.live?" age "+a.toFixed(1)+(i.type?" "+i.type||0:""):""," ").concat(s)),this.hls.trigger(Hi.LEVEL_LOADING,{url:s,level:n,levelInfo:e,pathwayId:e.attrs["PATHWAY-ID"],id:0,deliveryDirectives:t||null})}get nextLoadLevel(){return-1!==this.manualLevelIndex?this.manualLevelIndex:this.hls.nextAutoLevel}set nextLoadLevel(e){this.level=e,-1===this.manualLevelIndex&&(this.hls.nextAutoLevel=e)}removeLevel(e){var t;if(1===this._levels.length)return;const s=this._levels.filter((t,s)=>s!==e||(this.steering&&this.steering.removeLevel(t),t===this.currentLevel&&(this.currentLevel=null,this.currentLevelIndex=-1,t.details&&t.details.fragments.forEach(e=>e.level=-1)),!1));zc(s),this._levels=s,this.currentLevelIndex>-1&&null!=(t=this.currentLevel)&&t.details&&(this.currentLevelIndex=this.currentLevel.details.fragments[0].level),this.manualLevelIndex>-1&&(this.manualLevelIndex=this.currentLevelIndex);const n=s.length-1;this._firstLevel=Math.min(this._firstLevel,n),this._startLevel&&(this._startLevel=Math.min(this._startLevel,n)),this.hls.trigger(Hi.LEVELS_UPDATED,{levels:s})}onLevelsUpdated(e,t){let{levels:s}=t;this._levels=s}checkMaxAutoUpdated(){const{autoLevelCapping:e,maxAutoLevel:t,maxHdcpLevel:s}=this.hls;this._maxAutoLevel!==t&&(this._maxAutoLevel=t,this.hls.trigger(Hi.MAX_AUTO_LEVEL_UPDATED,{autoLevelCapping:e,levels:this.levels,maxAutoLevel:t,minAutoLevel:this.hls.minAutoLevel,maxHdcpLevel:s}))}}function Fm(e){const t={};e.forEach(e=>{const s=e.groupId||"";e.id=t[s]=t[s]||0,t[s]++})}function Um(){return self.SourceBuffer||self.WebKitSourceBuffer}function Bm(){if(!ua())return!1;const e=Um();return!e||e.prototype&&"function"===typeof e.prototype.appendBuffer&&"function"===typeof e.prototype.remove}class Gm extends hd{constructor(e,t,s){super(e,t,s,"stream-controller",Xi),this.audioCodecSwap=!1,this.level=-1,this._forceStartLoad=!1,this._hasEnoughToStart=!1,this.altAudio=0,this.audioOnly=!1,this.fragPlaying=null,this.fragLastKbps=0,this.couldBacktrack=!1,this.backtrackFragment=null,this.audioCodecSwitch=!1,this.videoBuffer=null,this.onMediaPlaying=()=>{this.tick()},this.onMediaSeeked=()=>{const e=this.media,t=e?e.currentTime:null;if(null===t||!Ui(t))return;if(this.log("Media seeked to ".concat(t.toFixed(3))),!this.getBufferedFrag(t))return;const s=this.getFwdBufferInfoAtPos(e,t,Xi,0);null!==s&&0!==s.len?this.tick():this.warn("Main forward buffer length at ".concat(t,' on "seeked" event ').concat(s?s.len:"empty",")"))},this.registerListeners()}registerListeners(){super.registerListeners();const{hls:e}=this;e.on(Hi.MANIFEST_PARSED,this.onManifestParsed,this),e.on(Hi.LEVEL_LOADING,this.onLevelLoading,this),e.on(Hi.LEVEL_LOADED,this.onLevelLoaded,this),e.on(Hi.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),e.on(Hi.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(Hi.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),e.on(Hi.BUFFER_CREATED,this.onBufferCreated,this),e.on(Hi.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(Hi.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(Hi.FRAG_BUFFERED,this.onFragBuffered,this)}unregisterListeners(){super.unregisterListeners();const{hls:e}=this;e.off(Hi.MANIFEST_PARSED,this.onManifestParsed,this),e.off(Hi.LEVEL_LOADED,this.onLevelLoaded,this),e.off(Hi.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),e.off(Hi.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(Hi.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),e.off(Hi.BUFFER_CREATED,this.onBufferCreated,this),e.off(Hi.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(Hi.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(Hi.FRAG_BUFFERED,this.onFragBuffered,this)}onHandlerDestroying(){this.onMediaPlaying=this.onMediaSeeked=null,this.unregisterListeners(),super.onHandlerDestroying()}startLoad(e,t){if(this.levels){const{lastCurrentTime:s,hls:n}=this;if(this.stopLoad(),this.setInterval(100),this.level=-1,!this.startFragRequested){let e=n.startLevel;-1===e&&(n.config.testBandwidth&&this.levels.length>1?(e=0,this.bitrateTest=!0):e=n.firstAutoLevel),n.nextLoadLevel=e,this.level=n.loadLevel,this._hasEnoughToStart=!!t}s>0&&-1===e&&!t&&(this.log("Override startPosition with lastCurrentTime @".concat(s.toFixed(3))),e=s),this.state=td,this.nextLoadPosition=this.lastCurrentTime=e+this.timelineOffset,this.startPosition=t?-1:e,this.tick()}else this._forceStartLoad=!0,this.state=ed}stopLoad(){this._forceStartLoad=!1,super.stopLoad()}doTick(){switch(this.state){case ud:{const{levels:e,level:t}=this,s=null==e?void 0:e[t],n=null==s?void 0:s.details;if(n&&(!n.live||this.levelLastLoaded===s&&!this.waitForLive(s))){if(this.waitForCdnTuneIn(n))break;this.state=td;break}if(this.hls.nextLoadLevel!==this.level){this.state=td;break}break}case rd:this.checkRetryDate()}this.state===td&&this.doTickIdle(),this.onTickEnd()}onTickEnd(){var e;super.onTickEnd(),null!=(e=this.media)&&e.readyState&&!1===this.media.seeking&&(this.lastCurrentTime=this.media.currentTime),this.checkFragmentChanged()}doTickIdle(){const{hls:e,levelLastLoaded:t,levels:s,media:n}=this;if(null===t||!n&&!this.primaryPrefetch&&(this.startFragRequested||!e.config.startFragPrefetch))return;if(this.altAudio&&this.audioOnly)return;const r=this.buffering?e.nextLoadLevel:e.loadLevel;if(null==s||!s[r])return;const i=s[r],a=this.getMainFwdBufferInfo();if(null===a)return;const o=this.getLevelDetails();if(o&&this._streamEnded(a,o)){const e={};return 2===this.altAudio&&(e.type="video"),this.hls.trigger(Hi.BUFFER_EOS,e),void(this.state=ld)}if(!this.buffering)return;e.loadLevel!==r&&-1===e.manualLevel&&this.log("Adapting to level ".concat(r," from level ").concat(this.level)),this.level=e.nextLoadLevel=r;const l=i.details;if(!l||this.state===ud||this.waitForLive(i))return this.level=r,this.state=ud,void(this.startFragRequested=!1);const c=a.len,d=this.getMaxBufferLength(i.maxBitrate);if(c>=d)return;this.backtrackFragment&&this.backtrackFragment.start>a.end&&(this.backtrackFragment=null);const u=this.backtrackFragment?this.backtrackFragment.start:a.end;let h=this.getNextFragment(u,l);if(this.couldBacktrack&&!this.fragPrevious&&h&&wa(h)&&this.fragmentTracker.getState(h)!==pl){var f;const e=(null!=(f=this.backtrackFragment)?f:h).sn-l.startSN,t=l.fragments[e-1];t&&h.cc===t.cc&&(h=t,this.fragmentTracker.removeFragment(t))}else this.backtrackFragment&&a.len&&(this.backtrackFragment=null);if(h&&this.isLoopLoading(h,u)){if(!h.gap){const e=this.audioOnly&&!this.altAudio?Ea:Sa,t=(e===Sa?this.videoBuffer:this.mediaBuffer)||this.media;t&&this.afterBufferFlushed(t,e,Xi)}h=this.getNextFragmentLoopLoading(h,l,a,Xi,d)}h&&(!h.initSegment||h.initSegment.data||this.bitrateTest||(h=h.initSegment),this.loadFragment(h,i,u))}loadFragment(e,t,s){const n=this.fragmentTracker.getState(e);n===hl||n===ml?wa(e)?this.bitrateTest?(this.log("Fragment ".concat(e.sn," of level ").concat(e.level," is being downloaded to test bitrate and will not be buffered")),this._loadBitrateTestFrag(e,t)):super.loadFragment(e,t,s):this._loadInitSegment(e,t):this.clearTrackerIfNeeded(e)}getBufferedFrag(e){return this.fragmentTracker.getBufferedFrag(e,Xi)}followingBufferedFrag(e){return e?this.getBufferedFrag(e.end+.5):null}immediateLevelSwitch(){this.abortCurrentFrag(),this.flushMainBuffer(0,Number.POSITIVE_INFINITY)}nextLevelSwitch(){const{levels:e,media:t}=this;if(null!=t&&t.readyState){let s;const n=this.getAppendedFrag(t.currentTime);n&&n.start>1&&this.flushMainBuffer(0,n.start-1);const r=this.getLevelDetails();if(null!=r&&r.live){const e=this.getMainFwdBufferInfo();if(!e||e.len<2*r.targetduration)return}if(!t.paused&&e){const t=e[this.hls.nextLoadLevel],n=this.fragLastKbps;s=n&&this.fragCurrent?this.fragCurrent.duration*t.maxBitrate/(1e3*n)+1:0}else s=0;const i=this.getBufferedFrag(t.currentTime+s);if(i){const e=this.followingBufferedFrag(i);if(e){this.abortCurrentFrag();const t=e.maxStartPTS?e.maxStartPTS:e.start,s=e.duration,n=Math.max(i.end,t+Math.min(Math.max(s-this.config.maxFragLookUpTolerance,s*(this.couldBacktrack?.5:.125)),s*(this.couldBacktrack?.75:.25)));this.flushMainBuffer(n,Number.POSITIVE_INFINITY)}}}}abortCurrentFrag(){const e=this.fragCurrent;switch(this.fragCurrent=null,this.backtrackFragment=null,e&&(e.abortRequests(),this.fragmentTracker.removeFragment(e)),this.state){case sd:case nd:case rd:case ad:case od:this.state=td}this.nextLoadPosition=this.getLoadPosition()}flushMainBuffer(e,t){super.flushMainBuffer(e,t,2===this.altAudio?"video":null)}onMediaAttached(e,t){super.onMediaAttached(e,t);const s=t.media;$c(s,"playing",this.onMediaPlaying),$c(s,"seeked",this.onMediaSeeked)}onMediaDetaching(e,t){const{media:s}=this;s&&(Jc(s,"playing",this.onMediaPlaying),Jc(s,"seeked",this.onMediaSeeked)),this.videoBuffer=null,this.fragPlaying=null,super.onMediaDetaching(e,t);!!t.transferMedia||(this._hasEnoughToStart=!1)}onManifestLoading(){super.onManifestLoading(),this.log("Trigger BUFFER_RESET"),this.hls.trigger(Hi.BUFFER_RESET,void 0),this.couldBacktrack=!1,this.fragLastKbps=0,this.fragPlaying=this.backtrackFragment=null,this.altAudio=0,this.audioOnly=!1}onManifestParsed(e,t){let s=!1,n=!1;for(let r=0;r<t.levels.length;r++){const e=t.levels[r].audioCodec;e&&(s=s||-1!==e.indexOf("mp4a.40.2"),n=n||-1!==e.indexOf("mp4a.40.5"))}this.audioCodecSwitch=s&&n&&!function(){var e;const t=Um();return"function"===typeof(null==t||null==(e=t.prototype)?void 0:e.changeType)}(),this.audioCodecSwitch&&this.log("Both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC"),this.levels=t.levels,this.startFragRequested=!1}onLevelLoading(e,t){const{levels:s}=this;if(!s||this.state!==td)return;const n=t.levelInfo;(!n.details||n.details.live&&(this.levelLastLoaded!==n||n.details.expired)||this.waitForCdnTuneIn(n.details))&&(this.state=ud)}onLevelLoaded(e,t){var s;const{levels:n,startFragRequested:r}=this,i=t.level,a=t.details,o=a.totalduration;if(!n)return void this.warn("Levels were reset while loading level ".concat(i));this.log("Level ".concat(i," loaded [").concat(a.startSN,",").concat(a.endSN,"]").concat(a.lastPartSn?"[part-".concat(a.lastPartSn,"-").concat(a.lastPartIndex,"]"):"",", cc [").concat(a.startCC,", ").concat(a.endCC,"] duration:").concat(o));const l=t.levelInfo,c=this.fragCurrent;!c||this.state!==nd&&this.state!==rd||c.level!==t.level&&c.loader&&this.abortCurrentFrag();let d=0;if(a.live||null!=(s=l.details)&&s.live){var u;if(this.checkLiveUpdate(a),a.deltaUpdateFailed)return;d=this.alignPlaylists(a,l.details,null==(u=this.levelLastLoaded)?void 0:u.details)}if(l.details=a,this.levelLastLoaded=l,r||this.setStartPosition(a,d),this.hls.trigger(Hi.LEVEL_UPDATED,{details:a,level:i}),this.state===ud){if(this.waitForCdnTuneIn(a))return;this.state=td}r&&a.live&&this.synchronizeToLiveEdge(a),this.tick()}synchronizeToLiveEdge(e){const{config:t,media:s}=this;if(!s)return;const n=this.hls.liveSyncPosition,r=this.getLoadPosition(),i=e.fragmentStart,a=e.edge,o=r>=i-t.maxFragLookUpTolerance&&r<=a;if(null!==n&&s.duration>n&&(r<n||!o)){const i=void 0!==t.liveMaxLatencyDuration?t.liveMaxLatencyDuration:t.liveMaxLatencyDurationCount*e.targetduration;if((!o&&s.readyState<4||r<a-i)&&(this._hasEnoughToStart||(this.nextLoadPosition=n),s.readyState))if(this.warn("Playback: ".concat(r.toFixed(3)," is located too far from the end of live sliding playlist: ").concat(a,", reset currentTime to : ").concat(n.toFixed(3))),"buffered"===this.config.liveSyncMode){var l;const e=Pl.bufferInfo(s,n,0);if(null==(l=e.buffered)||!l.length)return void(s.currentTime=n);if(e.start<=r)return void(s.currentTime=n);const{nextStart:t}=Pl.bufferedInfo(e.buffered,r,0);t&&(s.currentTime=t)}else s.currentTime=n}}_handleFragmentLoadProgress(e){var t;const s=e.frag,{part:n,payload:r}=e,{levels:i}=this;if(!i)return void this.warn("Levels were reset while fragment load was in progress. Fragment ".concat(s.sn," of level ").concat(s.level," will not be buffered"));const a=i[s.level];if(!a)return void this.warn("Level ".concat(s.level," not found on progress"));const o=a.details;if(!o)return this.warn("Dropping fragment ".concat(s.sn," of level ").concat(s.level," after level details were reset")),void this.fragmentTracker.removeFragment(s);const l=a.videoCodec,c=o.PTSKnown||!o.live,d=null==(t=s.initSegment)?void 0:t.data,u=this._getAudioCodec(a),h=this.transmuxer=this.transmuxer||new zu(this.hls,Xi,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)),f=n?n.index:-1,m=-1!==f,p=new Il(s.level,s.sn,s.stats.chunkCount,r.byteLength,f,m),g=this.initPTS[s.cc];h.push(r,d,u,l,s,n,o.totalduration,c,p,g)}onAudioTrackSwitching(e,t){const s=this.hls,n=0!==this.altAudio;if(zo(t.url,s))this.altAudio=1;else{if(this.mediaBuffer!==this.media){this.log("Switching on main audio, use media.buffered to schedule main fragment loading"),this.mediaBuffer=this.media;const e=this.fragCurrent;e&&(this.log("Switching to main audio track, cancel main fragment load"),e.abortRequests(),this.fragmentTracker.removeFragment(e)),this.resetTransmuxer(),this.resetLoadingState()}else this.audioOnly&&this.resetTransmuxer();if(n)return this.altAudio=0,this.fragmentTracker.removeAllFragments(),s.once(Hi.BUFFER_FLUSHED,()=>{this.hls&&this.hls.trigger(Hi.AUDIO_TRACK_SWITCHED,t)}),void s.trigger(Hi.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:null});s.trigger(Hi.AUDIO_TRACK_SWITCHED,t)}}onAudioTrackSwitched(e,t){const s=zo(t.url,this.hls);if(s){const e=this.videoBuffer;e&&this.mediaBuffer!==e&&(this.log("Switching on alternate audio, use video.buffered to schedule main fragment loading"),this.mediaBuffer=e)}this.altAudio=s?2:0,this.tick()}onBufferCreated(e,t){const s=t.tracks;let n,r,i=!1;for(const a in s){const e=s[a];if("main"===e.id){if(r=a,n=e,"video"===a){const e=s[a];e&&(this.videoBuffer=e.buffer)}}else i=!0}i&&n?(this.log("Alternate track found, use ".concat(r,".buffered to schedule main fragment loading")),this.mediaBuffer=n.buffer):this.mediaBuffer=this.media}onFragBuffered(e,t){const{frag:s,part:n}=t,r=s.type===Xi;if(r){if(this.fragContextChanged(s))return this.warn("Fragment ".concat(s.sn).concat(n?" p: "+n.index:""," of level ").concat(s.level," finished buffering, but was aborted. state: ").concat(this.state)),void(this.state===od&&(this.state=td));const e=n?n.stats:s.stats;this.fragLastKbps=Math.round(8*e.total/(e.buffering.end-e.loading.first)),wa(s)&&(this.fragPrevious=s),this.fragBufferedComplete(s,n)}const i=this.media;i&&(!this._hasEnoughToStart&&Pl.getBuffered(i).length&&(this._hasEnoughToStart=!0,this.seekToStartPos()),r&&this.tick())}get hasEnoughToStart(){return this._hasEnoughToStart}onError(e,t){var s;if(t.fatal)this.state=cd;else switch(t.details){case zi.FRAG_GAP:case zi.FRAG_PARSING_ERROR:case zi.FRAG_DECRYPT_ERROR:case zi.FRAG_LOAD_ERROR:case zi.FRAG_LOAD_TIMEOUT:case zi.KEY_LOAD_ERROR:case zi.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(Xi,t);break;case zi.LEVEL_LOAD_ERROR:case zi.LEVEL_LOAD_TIMEOUT:case zi.LEVEL_PARSING_ERROR:t.levelRetry||this.state!==ud||(null==(s=t.context)?void 0:s.type)!==Wi||(this.state=td);break;case zi.BUFFER_ADD_CODEC_ERROR:case zi.BUFFER_APPEND_ERROR:if("main"!==t.parent)return;this.reduceLengthAndFlushBuffer(t)&&this.resetLoadingState();break;case zi.BUFFER_FULL_ERROR:if("main"!==t.parent)return;if(this.reduceLengthAndFlushBuffer(t)){!this.config.interstitialsController&&this.config.assetPlayerId?this._hasEnoughToStart=!0:this.flushMainBuffer(0,Number.POSITIVE_INFINITY)}break;case zi.INTERNAL_EXCEPTION:this.recoverWorkerError(t)}}onFragLoadEmergencyAborted(){this.state=td,this._hasEnoughToStart||(this.startFragRequested=!1,this.nextLoadPosition=this.lastCurrentTime),this.tickImmediate()}onBufferFlushed(e,t){let{type:s}=t;if(s!==Ea||!this.altAudio){const e=(s===Sa?this.videoBuffer:this.mediaBuffer)||this.media;e&&(this.afterBufferFlushed(e,s,Xi),this.tick())}}onLevelsUpdated(e,t){this.level>-1&&this.fragCurrent&&(this.level=this.fragCurrent.level,-1===this.level&&this.resetWhenMissingContext(this.fragCurrent)),this.levels=t.levels}swapAudioCodec(){this.audioCodecSwap=!this.audioCodecSwap}seekToStartPos(){const{media:e}=this;if(!e)return;const t=e.currentTime;let s=this.startPosition;if(s>=0&&t<s){if(e.seeking)return void this.log("could not seek to ".concat(s,", already seeking at ").concat(t));const n=this.timelineOffset;n&&s&&(s+=n);const r=this.getLevelDetails(),i=Pl.getBuffered(e),a=i.length?i.start(0):0,o=a-s,l=Math.max(this.config.maxBufferHole,this.config.maxFragLookUpTolerance);(this.config.startOnSegmentBoundary||o>0&&(o<l||this.loadingParts&&o<2*((null==r?void 0:r.partTarget)||0)))&&(this.log("adjusting start position by ".concat(o," to match buffer start")),s+=o,this.startPosition=s),t<s&&(this.log("seek to target start position ".concat(s," from current time ").concat(t," buffer start ").concat(a)),e.currentTime=s)}}_getAudioCodec(e){let t=this.config.defaultAudioCodec||e.audioCodec;return this.audioCodecSwap&&t&&(this.log("Swapping audio codec"),t=-1!==t.indexOf("mp4a.40.5")?"mp4a.40.2":"mp4a.40.5"),t}_loadBitrateTestFrag(e,t){e.bitrateTest=!0,this._doFragLoad(e,t).then(e=>{const{hls:s}=this,n=null==e?void 0:e.frag;if(!n||this.fragContextChanged(n))return;t.fragmentError=0,this.state=td,this.startFragRequested=!1,this.bitrateTest=!1;const r=n.stats;r.parsing.start=r.parsing.end=r.buffering.start=r.buffering.end=self.performance.now(),s.trigger(Hi.FRAG_LOADED,e),n.bitrateTest=!1}).catch(t=>{this.state!==ed&&this.state!==cd&&(this.warn(t),this.resetFragmentLoading(e))})}_handleTransmuxComplete(e){const t=this.playlistType,{hls:s}=this,{remuxResult:n,chunkMeta:r}=e,i=this.getCurrentContext(r);if(!i)return void this.resetWhenMissingContext(r);const{frag:a,part:o,level:l}=i,{video:c,text:d,id3:u,initSegment:h}=n,{details:f}=l,m=this.altAudio?void 0:n.audio;if(this.fragContextChanged(a))this.fragmentTracker.removeFragment(a);else{if(this.state=ad,h){const e=h.tracks;if(e){const n=a.initSegment||a;if(this.unhandledEncryptionError(h,a))return;this._bufferInitSegment(l,e,n,r),s.trigger(Hi.FRAG_PARSING_INIT_SEGMENT,{frag:n,id:t,tracks:e})}const n=h.initPTS,i=h.timescale,o=this.initPTS[a.cc];if(Ui(n)&&(!o||o.baseTime!==n||o.timescale!==i)){const e=h.trackId;this.initPTS[a.cc]={baseTime:n,timescale:i,trackId:e},s.trigger(Hi.INIT_PTS_FOUND,{frag:a,id:t,initPTS:n,timescale:i,trackId:e})}}if(c&&f){m&&"audiovideo"===c.type&&this.logMuxedErr(a);const e=f.fragments[a.sn-1-f.startSN],t=a.sn===f.startSN,s=!e||a.cc>e.cc;if(!1!==n.independent){const{startPTS:e,endPTS:n,startDTS:i,endDTS:l}=c;if(o)o.elementaryStreams[c.type]={startPTS:e,endPTS:n,startDTS:i,endDTS:l};else if(c.firstKeyFrame&&c.independent&&1===r.id&&!s&&(this.couldBacktrack=!0),c.dropped&&c.independent){const r=this.getMainFwdBufferInfo(),i=(r?r.end:this.getLoadPosition())+this.config.maxBufferHole,o=c.firstKeyFramePTS?c.firstKeyFramePTS:e;if(!t&&i<o-this.config.maxBufferHole&&!s)return void this.backtrack(a);s&&(a.gap=!0),a.setElementaryStreamInfo(c.type,a.start,n,a.start,l,!0)}else t&&e-(f.appliedTimelineOffset||0)>2&&(a.gap=!0);a.setElementaryStreamInfo(c.type,e,n,i,l),this.backtrackFragment&&(this.backtrackFragment=a),this.bufferFragmentData(c,a,o,r,t||s)}else{if(!t&&!s)return void this.backtrack(a);a.gap=!0}}if(m){const{startPTS:e,endPTS:t,startDTS:s,endDTS:n}=m;o&&(o.elementaryStreams[Ea]={startPTS:e,endPTS:t,startDTS:s,endDTS:n}),a.setElementaryStreamInfo(Ea,e,t,s,n),this.bufferFragmentData(m,a,o,r)}if(f&&null!=u&&u.samples.length){const e={id:t,frag:a,details:f,samples:u.samples};s.trigger(Hi.FRAG_PARSING_METADATA,e)}if(f&&d){const e={id:t,frag:a,details:f,samples:d.samples};s.trigger(Hi.FRAG_PARSING_USERDATA,e)}}}logMuxedErr(e){this.warn("".concat(wa(e)?"Media":"Init"," segment with muxed audiovideo where only video expected: ").concat(e.url))}_bufferInitSegment(e,t,s,n){if(this.state!==ad)return;this.audioOnly=!!t.audio&&!t.video,this.altAudio&&!this.audioOnly&&(delete t.audio,t.audiovideo&&this.logMuxedErr(s));const{audio:r,video:i,audiovideo:a}=t;if(r){const s=e.audioCodec;let n=fo(r.codec,s);"mp4a"===n&&(n="mp4a.40.5");const i=navigator.userAgent.toLowerCase();if(this.audioCodecSwitch){n&&(n=-1!==n.indexOf("mp4a.40.5")?"mp4a.40.2":"mp4a.40.5");const e=r.metadata;e&&"channelCount"in e&&1!==(e.channelCount||1)&&-1===i.indexOf("firefox")&&(n="mp4a.40.5")}n&&-1!==n.indexOf("mp4a.40.5")&&-1!==i.indexOf("android")&&"audio/mpeg"!==r.container&&(n="mp4a.40.2",this.log("Android: force audio codec to ".concat(n))),s&&s!==n&&this.log('Swapping manifest audio codec "'.concat(s,'" for "').concat(n,'"')),r.levelCodec=n,r.id=Xi,this.log("Init audio buffer, container:".concat(r.container,", codecs[selected/level/parsed]=[").concat(n||"","/").concat(s||"","/").concat(r.codec,"]")),delete t.audiovideo}if(i){i.levelCodec=e.videoCodec,i.id=Xi;const s=i.codec;if(4===(null==s?void 0:s.length))switch(s){case"hvc1":case"hev1":i.codec="hvc1.1.6.L120.90";break;case"av01":i.codec="av01.0.04M.08";break;case"avc1":i.codec="avc1.42e01e"}this.log("Init video buffer, container:".concat(i.container,", codecs[level/parsed]=[").concat(e.videoCodec||"","/").concat(s,"]").concat(i.codec!==s?" parsed-corrected="+i.codec:"").concat(i.supplemental?" supplemental="+i.supplemental:"")),delete t.audiovideo}a&&(this.log("Init audiovideo buffer, container:".concat(a.container,", codecs[level/parsed]=[").concat(e.codecs,"/").concat(a.codec,"]")),delete t.video,delete t.audio);const o=Object.keys(t);if(o.length){if(this.hls.trigger(Hi.BUFFER_CODECS,t),!this.hls)return;o.forEach(e=>{const r=t[e].initSegment;null!=r&&r.byteLength&&this.hls.trigger(Hi.BUFFER_APPENDING,{type:e,data:r,frag:s,part:null,chunkMeta:n,parent:s.type})})}this.tickImmediate()}getMainFwdBufferInfo(){const e=this.mediaBuffer&&2===this.altAudio?this.mediaBuffer:this.media;return this.getFwdBufferInfo(e,Xi)}get maxBufferLength(){const{levels:e,level:t}=this,s=null==e?void 0:e[t];return s?this.getMaxBufferLength(s.maxBitrate):this.config.maxBufferLength}backtrack(e){this.couldBacktrack=!0,this.backtrackFragment=e,this.resetTransmuxer(),this.flushBufferGap(e),this.fragmentTracker.removeFragment(e),this.fragPrevious=null,this.nextLoadPosition=e.start,this.state=td}checkFragmentChanged(){const e=this.media;let t=null;if(e&&e.readyState>1&&!1===e.seeking){const s=e.currentTime;if(Pl.isBuffered(e,s)?t=this.getAppendedFrag(s):Pl.isBuffered(e,s+.1)&&(t=this.getAppendedFrag(s+.1)),t){this.backtrackFragment=null;const e=this.fragPlaying,s=t.level;e&&t.sn===e.sn&&e.level===s||(this.fragPlaying=t,this.hls.trigger(Hi.FRAG_CHANGED,{frag:t}),e&&e.level===s||this.hls.trigger(Hi.LEVEL_SWITCHED,{level:s}))}}}get nextLevel(){const e=this.nextBufferedFrag;return e?e.level:-1}get currentFrag(){var e;if(this.fragPlaying)return this.fragPlaying;const t=(null==(e=this.media)?void 0:e.currentTime)||this.lastCurrentTime;return Ui(t)?this.getAppendedFrag(t):null}get currentProgramDateTime(){var e;const t=(null==(e=this.media)?void 0:e.currentTime)||this.lastCurrentTime;if(Ui(t)){const e=this.getLevelDetails(),s=this.currentFrag||(e?Ko(null,e.fragments,t):null);if(s){const e=s.programDateTime;if(null!==e){const n=e+1e3*(t-s.start);return new Date(n)}}}return null}get currentLevel(){const e=this.currentFrag;return e?e.level:-1}get nextBufferedFrag(){const e=this.currentFrag;return e?this.followingBufferedFrag(e):null}get forceStartLoad(){return this._forceStartLoad}}class Vm extends ra{constructor(e,t){super("key-loader",t),this.config=void 0,this.keyIdToKeyInfo={},this.emeController=null,this.config=e}abort(e){for(const s in this.keyIdToKeyInfo){const n=this.keyIdToKeyInfo[s].loader;if(n){var t;if(e&&e!==(null==(t=n.context)?void 0:t.frag.type))return;n.abort()}}}detach(){for(const e in this.keyIdToKeyInfo){const t=this.keyIdToKeyInfo[e];(t.mediaKeySessionContext||t.decryptdata.isCommonEncryption)&&delete this.keyIdToKeyInfo[e]}}destroy(){this.detach();for(const e in this.keyIdToKeyInfo){const t=this.keyIdToKeyInfo[e].loader;t&&t.destroy()}this.keyIdToKeyInfo={}}createKeyLoadError(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:zi.KEY_LOAD_ERROR,s=arguments.length>2?arguments[2]:void 0,n=arguments.length>3?arguments[3]:void 0,r=arguments.length>4?arguments[4]:void 0;return new _l({type:Vi.NETWORK_ERROR,details:t,fatal:!1,frag:e,response:r,error:s,networkDetails:n})}loadClear(e,t,s){if(this.emeController&&this.config.emeEnabled&&!this.emeController.getSelectedKeySystemFormats().length){if(t.length)for(let n=0,r=t.length;n<r;n++){const i=t[n];if(e.cc<=i.cc&&(!wa(e)||!wa(i)||e.sn<i.sn)||!s&&n==r-1)return this.emeController.selectKeySystemFormat(i).then(e=>{if(!this.emeController)return;i.setKeyFormat(e);const t=oc(e);return t?this.emeController.getKeySystemAccess([t]):void 0})}if(this.config.requireKeySystemAccessOnStart){const e=cc(this.config);if(e.length)return this.emeController.getKeySystemAccess(e)}}return null}load(e){return!e.decryptdata&&e.encrypted&&this.emeController&&this.config.emeEnabled?this.emeController.selectKeySystemFormat(e).then(t=>this.loadInternal(e,t)):this.loadInternal(e)}loadInternal(e,t){var s,n;t&&e.setKeyFormat(t);const r=e.decryptdata;if(!r){const s=new Error(t?"Expected frag.decryptdata to be defined after setting format ".concat(t):"Missing decryption data on fragment in onKeyLoading (emeEnabled with controller: ".concat(this.emeController&&this.config.emeEnabled,")"));return Promise.reject(this.createKeyLoadError(e,zi.KEY_LOAD_ERROR,s))}const i=r.uri;if(!i)return Promise.reject(this.createKeyLoadError(e,zi.KEY_LOAD_ERROR,new Error('Invalid key URI: "'.concat(i,'"'))));const a=zm(r);let o=this.keyIdToKeyInfo[a];if(null!=(s=o)&&s.decryptdata.key)return r.key=o.decryptdata.key,Promise.resolve({frag:e,keyInfo:o});if(this.emeController&&null!=(n=o)&&n.keyLoadPromise){switch(this.emeController.getKeyStatus(o.decryptdata)){case"usable":case"usable-in-future":return o.keyLoadPromise.then(t=>{const{keyInfo:s}=t;return r.key=s.decryptdata.key,{frag:e,keyInfo:s}})}}switch(this.log("".concat(this.keyIdToKeyInfo[a]?"Rel":"L","oading").concat(r.keyId?" keyId: "+ma(r.keyId):""," URI: ").concat(r.uri," from ").concat(e.type," ").concat(e.level)),o=this.keyIdToKeyInfo[a]={decryptdata:r,keyLoadPromise:null,loader:null,mediaKeySessionContext:null},r.method){case"SAMPLE-AES":case"SAMPLE-AES-CENC":case"SAMPLE-AES-CTR":return"identity"===r.keyFormat?this.loadKeyHTTP(o,e):this.loadKeyEME(o,e);case"AES-128":case"AES-256":case"AES-256-CTR":return this.loadKeyHTTP(o,e);default:return Promise.reject(this.createKeyLoadError(e,zi.KEY_LOAD_ERROR,new Error('Key supplied with unsupported METHOD: "'.concat(r.method,'"'))))}}loadKeyEME(e,t){const s={frag:t,keyInfo:e};if(this.emeController&&this.config.emeEnabled){var n;if(!e.decryptdata.keyId&&null!=(n=t.initSegment)&&n.data){const s=function(e){const t=[];return Ka(e,e=>t.push(e.subarray(8,24))),t}(t.initSegment.data);if(s.length){let t=s[0];t.some(e=>0!==e)?(this.log("Using keyId found in init segment ".concat(ma(t))),mc.setKeyIdForUri(e.decryptdata.uri,t)):(t=mc.addKeyIdForUri(e.decryptdata.uri),this.log("Generating keyId to patch media ".concat(ma(t)))),e.decryptdata.keyId=t}}if(!e.decryptdata.keyId&&!wa(t))return Promise.resolve(s);const r=this.emeController.loadKey(s);return(e.keyLoadPromise=r.then(t=>(e.mediaKeySessionContext=t,s))).catch(s=>{throw e.keyLoadPromise=null,"data"in s&&(s.data.frag=t),s})}return Promise.resolve(s)}loadKeyHTTP(e,t){const s=this.config,n=new(0,s.loader)(s);return t.keyLoader=e.loader=n,e.keyLoadPromise=new Promise((r,i)=>{const a={keyInfo:e,frag:t,responseType:"arraybuffer",url:e.decryptdata.uri},o=s.keyLoadPolicy.default,l={loadPolicy:o,timeout:o.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},c={onSuccess:(e,t,s,n)=>{const{frag:a,keyInfo:o}=s,l=zm(o.decryptdata);if(!a.decryptdata||o!==this.keyIdToKeyInfo[l])return i(this.createKeyLoadError(a,zi.KEY_LOAD_ERROR,new Error("after key load, decryptdata unset or changed"),n));o.decryptdata.key=a.decryptdata.key=new Uint8Array(e.data),a.keyLoader=null,o.loader=null,r({frag:a,keyInfo:o})},onError:(e,s,n,r)=>{this.resetLoader(s),i(this.createKeyLoadError(t,zi.KEY_LOAD_ERROR,new Error("HTTP Error ".concat(e.code," loading key ").concat(e.text)),n,na({url:a.url,data:void 0},e)))},onTimeout:(e,s,n)=>{this.resetLoader(s),i(this.createKeyLoadError(t,zi.KEY_LOAD_TIMEOUT,new Error("key loading timed out"),n))},onAbort:(e,s,n)=>{this.resetLoader(s),i(this.createKeyLoadError(t,zi.INTERNAL_ABORTED,new Error("key loading aborted"),n))}};n.load(a,l,c)})}resetLoader(e){const{frag:t,keyInfo:s,url:n}=e,r=s.loader;t.keyLoader===r&&(t.keyLoader=null,s.loader=null);const i=zm(s.decryptdata)||n;delete this.keyIdToKeyInfo[i],r&&r.destroy()}}function zm(e){if(e.keyFormat!==rc){const t=e.keyId;if(t)return ma(t)}return e.uri}function Hm(e){const{type:t}=e;switch(t){case qi:return Qi;case Yi:return $i;default:return Xi}}function Km(e,t){let s=e.url;return void 0!==s&&0!==s.indexOf("data:")||(s=t.url),s}class Wm{constructor(e){this.hls=void 0,this.loaders=Object.create(null),this.variableList=null,this.onManifestLoaded=this.checkAutostartLoad,this.hls=e,this.registerListeners()}startLoad(e){}stopLoad(){this.destroyInternalLoaders()}registerListeners(){const{hls:e}=this;e.on(Hi.MANIFEST_LOADING,this.onManifestLoading,this),e.on(Hi.LEVEL_LOADING,this.onLevelLoading,this),e.on(Hi.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),e.on(Hi.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this),e.on(Hi.LEVELS_UPDATED,this.onLevelsUpdated,this)}unregisterListeners(){const{hls:e}=this;e.off(Hi.MANIFEST_LOADING,this.onManifestLoading,this),e.off(Hi.LEVEL_LOADING,this.onLevelLoading,this),e.off(Hi.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),e.off(Hi.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this),e.off(Hi.LEVELS_UPDATED,this.onLevelsUpdated,this)}createInternalLoader(e){const t=this.hls.config,s=t.pLoader,n=t.loader,r=new(s||n)(t);return this.loaders[e.type]=r,r}getInternalLoader(e){return this.loaders[e.type]}resetInternalLoader(e){this.loaders[e]&&delete this.loaders[e]}destroyInternalLoaders(){for(const e in this.loaders){const t=this.loaders[e];t&&t.destroy(),this.resetInternalLoader(e)}}destroy(){this.variableList=null,this.unregisterListeners(),this.destroyInternalLoaders()}onManifestLoading(e,t){const{url:s}=t;this.variableList=null,this.load({id:null,level:0,responseType:"text",type:Ki,url:s,deliveryDirectives:null,levelOrTrack:null})}onLevelLoading(e,t){const{id:s,level:n,pathwayId:r,url:i,deliveryDirectives:a,levelInfo:o}=t;this.load({id:s,level:n,pathwayId:r,responseType:"text",type:Wi,url:i,deliveryDirectives:a,levelOrTrack:o})}onAudioTrackLoading(e,t){const{id:s,groupId:n,url:r,deliveryDirectives:i,track:a}=t;this.load({id:s,groupId:n,level:null,responseType:"text",type:qi,url:r,deliveryDirectives:i,levelOrTrack:a})}onSubtitleTrackLoading(e,t){const{id:s,groupId:n,url:r,deliveryDirectives:i,track:a}=t;this.load({id:s,groupId:n,level:null,responseType:"text",type:Yi,url:r,deliveryDirectives:i,levelOrTrack:a})}onLevelsUpdated(e,t){const s=this.loaders[Wi];if(s){const e=s.context;e&&!t.levels.some(t=>t===e.levelOrTrack)&&(s.abort(),delete this.loaders[Wi])}}load(e){var t;const s=this.hls.config;let n,r=this.getInternalLoader(e);if(r){const t=this.hls.logger,s=r.context;if(s&&s.levelOrTrack===e.levelOrTrack&&(s.url===e.url||s.deliveryDirectives&&!e.deliveryDirectives))return void(s.url===e.url?t.log("[playlist-loader]: ignore ".concat(e.url," ongoing request")):t.log("[playlist-loader]: ignore ".concat(e.url," in favor of ").concat(s.url)));t.log("[playlist-loader]: aborting previous loader for type: ".concat(e.type)),r.abort()}if(n=e.type===Ki?s.manifestLoadPolicy.default:ta({},s.playlistLoadPolicy.default,{timeoutRetry:null,errorRetry:null}),r=this.createInternalLoader(e),Ui(null==(t=e.deliveryDirectives)?void 0:t.part)){let t;if(e.type===Wi&&null!==e.level?t=this.hls.levels[e.level].details:e.type===qi&&null!==e.id?t=this.hls.audioTracks[e.id].details:e.type===Yi&&null!==e.id&&(t=this.hls.subtitleTracks[e.id].details),t){const e=t.partTarget,s=t.targetduration;if(e&&s){const t=1e3*Math.max(3*e,.8*s);n=ta({},n,{maxTimeToFirstByteMs:Math.min(t,n.maxTimeToFirstByteMs),maxLoadTimeMs:Math.min(t,n.maxTimeToFirstByteMs)})}}}const i=n.errorRetry||n.timeoutRetry||{},a={loadPolicy:n,timeout:n.maxLoadTimeMs,maxRetry:i.maxNumRetry||0,retryDelay:i.retryDelayMs||0,maxRetryDelay:i.maxRetryDelayMs||0},o={onSuccess:(e,t,s,n)=>{const r=this.getInternalLoader(s);this.resetInternalLoader(s.type);const i=e.data;t.parsing.start=performance.now(),Ec.isMediaPlaylist(i)||s.type!==Ki?this.handleTrackOrLevelPlaylist(e,t,s,n||null,r):this.handleMasterPlaylist(e,t,s,n)},onError:(e,t,s,n)=>{this.handleNetworkError(t,s,!1,e,n)},onTimeout:(e,t,s)=>{this.handleNetworkError(t,s,!0,void 0,e)}};r.load(e,a,o)}checkAutostartLoad(){if(!this.hls)return;const{config:{autoStartLoad:e,startPosition:t},forceStartLoad:s}=this.hls;(e||s)&&(this.hls.logger.log("".concat(e?"auto":"force"," startLoad with configured startPosition ").concat(t)),this.hls.startLoad(t))}handleMasterPlaylist(e,t,s,n){const r=this.hls,i=e.data,a=Km(e,s),o=Ec.parseMasterPlaylist(i,a);if(o.playlistParsingError)return t.parsing.end=performance.now(),void this.handleManifestParsingError(e,s,o.playlistParsingError,n,t);const{contentSteering:l,levels:c,sessionData:d,sessionKeys:u,startTimeOffset:h,variableList:f}=o;this.variableList=f,c.forEach(e=>{const{unknownCodecs:t}=e;if(t){const{preferManagedMediaSource:s}=this.hls.config;let{audioCodec:n,videoCodec:r}=e;for(let i=t.length;i--;){const a=t[i];ro(a,"audio",s)?(e.audioCodec=n=n?"".concat(n,",").concat(a):a,so.audio[n.substring(0,4)]=2,t.splice(i,1)):ro(a,"video",s)&&(e.videoCodec=r=r?"".concat(r,",").concat(a):a,so.video[r.substring(0,4)]=2,t.splice(i,1))}}});const{AUDIO:m=[],SUBTITLES:p,"CLOSED-CAPTIONS":g}=Ec.parseMasterPlaylistMedia(i,a,o);if(m.length){m.some(e=>!e.url)||!c[0].audioCodec||c[0].attrs.AUDIO||(this.hls.logger.log("[playlist-loader]: audio codec signaled in quality level, but no embedded audio track signaled, create one"),m.unshift({type:"main",name:"main",groupId:"main",default:!1,autoselect:!1,forced:!1,id:-1,attrs:new Vl({}),bitrate:0,url:""}))}r.trigger(Hi.MANIFEST_LOADED,{levels:c,audioTracks:m,subtitles:p,captions:g,contentSteering:l,url:a,stats:t,networkDetails:n,sessionData:d,sessionKeys:u,startTimeOffset:h,variableList:f})}handleTrackOrLevelPlaylist(e,t,s,n,r){const i=this.hls,{id:a,level:o,type:l}=s,c=Km(e,s),d=Ui(o)?o:Ui(a)?a:0,u=Hm(s),h=Ec.parseLevelPlaylist(e.data,c,d,u,0,this.variableList);if(l===Ki){const e={attrs:new Vl({}),bitrate:0,details:h,name:"",url:c};h.requestScheduled=t.loading.start+Uc(h,0),i.trigger(Hi.MANIFEST_LOADED,{levels:[e],audioTracks:[],url:c,stats:t,networkDetails:n,sessionData:null,sessionKeys:null,contentSteering:null,startTimeOffset:null,variableList:null})}t.parsing.end=performance.now(),s.levelDetails=h,this.handlePlaylistLoaded(h,e,t,s,n,r)}handleManifestParsingError(e,t,s,n,r){this.hls.trigger(Hi.ERROR,{type:Vi.NETWORK_ERROR,details:zi.MANIFEST_PARSING_ERROR,fatal:t.type===Ki,url:e.url,err:s,error:s,reason:s.message,response:e,context:t,networkDetails:n,stats:r})}handleNetworkError(e,t){let s=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=arguments.length>3?arguments[3]:void 0,r=arguments.length>4?arguments[4]:void 0,i="A network ".concat(s?"timeout":"error"+(n?" (status "+n.code+")":"")," occurred while loading ").concat(e.type);e.type===Wi?i+=": ".concat(e.level," id: ").concat(e.id):e.type!==qi&&e.type!==Yi||(i+=" id: ".concat(e.id,' group-id: "').concat(e.groupId,'"'));const a=new Error(i);this.hls.logger.warn("[playlist-loader]: ".concat(i));let o=zi.UNKNOWN,l=!1;const c=this.getInternalLoader(e);switch(e.type){case Ki:o=s?zi.MANIFEST_LOAD_TIMEOUT:zi.MANIFEST_LOAD_ERROR,l=!0;break;case Wi:o=s?zi.LEVEL_LOAD_TIMEOUT:zi.LEVEL_LOAD_ERROR,l=!1;break;case qi:o=s?zi.AUDIO_TRACK_LOAD_TIMEOUT:zi.AUDIO_TRACK_LOAD_ERROR,l=!1;break;case Yi:o=s?zi.SUBTITLE_TRACK_LOAD_TIMEOUT:zi.SUBTITLE_LOAD_ERROR,l=!1}c&&this.resetInternalLoader(e.type);const d={type:Vi.NETWORK_ERROR,details:o,fatal:l,url:e.url,loader:c,context:e,error:a,networkDetails:t,stats:r};if(n){const s=(null==t?void 0:t.url)||e.url;d.response=na({url:s,data:void 0},n)}this.hls.trigger(Hi.ERROR,d)}handlePlaylistLoaded(e,t,s,n,r,i){const a=this.hls,{type:o,level:l,levelOrTrack:c,id:d,groupId:u,deliveryDirectives:h}=n,f=Km(t,n),m=Hm(n);let p="number"===typeof n.level&&m===Xi?l:void 0;const g=e.playlistParsingError;if(g){if(this.hls.logger.warn("".concat(g," ").concat(e.url)),!a.config.ignorePlaylistParsingErrors)return void a.trigger(Hi.ERROR,{type:Vi.NETWORK_ERROR,details:zi.LEVEL_PARSING_ERROR,fatal:!1,url:f,error:g,reason:g.message,response:t,context:n,level:p,parent:m,networkDetails:r,stats:s});e.playlistParsingError=null}if(!e.fragments.length){const i=e.playlistParsingError=new Error("No Segments found in Playlist");return void a.trigger(Hi.ERROR,{type:Vi.NETWORK_ERROR,details:zi.LEVEL_EMPTY_ERROR,fatal:!1,url:f,error:i,reason:i.message,response:t,context:n,level:p,parent:m,networkDetails:r,stats:s})}switch(e.live&&i&&(i.getCacheAge&&(e.ageHeader=i.getCacheAge()||0),i.getCacheAge&&!isNaN(e.ageHeader)||(e.ageHeader=0)),o){case Ki:case Wi:if(p)if(c){if(c!==a.levels[p]){const e=a.levels.indexOf(c);e>-1&&(p=e)}}else p=0;a.trigger(Hi.LEVEL_LOADED,{details:e,levelInfo:c||a.levels[0],level:p||0,id:d||0,stats:s,networkDetails:r,deliveryDirectives:h,withoutMultiVariant:o===Ki});break;case qi:a.trigger(Hi.AUDIO_TRACK_LOADED,{details:e,track:c,id:d||0,groupId:u||"",stats:s,networkDetails:r,deliveryDirectives:h});break;case Yi:a.trigger(Hi.SUBTITLE_TRACK_LOADED,{details:e,track:c,id:d||0,groupId:u||"",stats:s,networkDetails:r,deliveryDirectives:h})}}}class qm{static get version(){return bd}static isMSESupported(){return Bm()}static isSupported(){return function(){if(!Bm())return!1;const e=ua();return"function"===typeof(null==e?void 0:e.isTypeSupported)&&(["avc1.42E01E,mp4a.40.2","av01.0.01M.08","vp09.00.50.08"].some(t=>e.isTypeSupported(ao(t,"video")))||["mp4a.40.2","fLaC"].some(t=>e.isTypeSupported(ao(t,"audio"))))}()}static getMediaSource(){return ua()}static get Events(){return Hi}static get MetadataSchema(){return Vd}static get ErrorTypes(){return Vi}static get ErrorDetails(){return zi}static get DefaultConfig(){return qm.defaultConfig?qm.defaultConfig:wm}static set DefaultConfig(e){qm.defaultConfig=e}constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.config=void 0,this.userConfig=void 0,this.logger=void 0,this.coreComponents=void 0,this.networkControllers=void 0,this._emitter=new yd,this._autoLevelCapping=-1,this._maxHdcpLevel=null,this.abrController=void 0,this.bufferController=void 0,this.capLevelController=void 0,this.latencyController=void 0,this.levelController=void 0,this.streamController=void 0,this.audioStreamController=void 0,this.subtititleStreamController=void 0,this.audioTrackController=void 0,this.subtitleTrackController=void 0,this.interstitialsController=void 0,this.gapController=void 0,this.emeController=void 0,this.cmcdController=void 0,this._media=null,this._url=null,this._sessionId=void 0,this.triggeringException=void 0,this.started=!1;const t=this.logger=function(e,t,s){const n=oa();if("object"===typeof console&&!0===e||"object"===typeof e){const r=["debug","log","info","warn","error"];r.forEach(t=>{n[t]=la(t,e,s)});try{n.log('Debug logs enabled for "'.concat(t,'" in hls.js version ',"1.6.15"))}catch(Np){return oa()}r.forEach(t=>{ca[t]=la(t,e)})}else ta(ca,n);return n}(e.debug||!1,"Hls instance",e.assetPlayerId),s=this.config=function(e,t,s){if((t.liveSyncDurationCount||t.liveMaxLatencyDurationCount)&&(t.liveSyncDuration||t.liveMaxLatencyDuration))throw new Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration");if(void 0!==t.liveMaxLatencyDurationCount&&(void 0===t.liveSyncDurationCount||t.liveMaxLatencyDurationCount<=t.liveSyncDurationCount))throw new Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be greater than "liveSyncDurationCount"');if(void 0!==t.liveMaxLatencyDuration&&(void 0===t.liveSyncDuration||t.liveMaxLatencyDuration<=t.liveSyncDuration))throw new Error('Illegal hls.js config: "liveMaxLatencyDuration" must be greater than "liveSyncDuration"');const n=Lm(e),r=["TimeOut","MaxRetry","RetryDelay","MaxRetryTimeout"];return["manifest","level","frag"].forEach(e=>{const i="".concat("level"===e?"playlist":e,"LoadPolicy"),a=void 0===t[i],o=[];r.forEach(s=>{const r="".concat(e,"Loading").concat(s),l=t[r];if(void 0!==l&&a){o.push(r);const e=n[i].default;switch(t[i]={default:e},s){case"TimeOut":e.maxLoadTimeMs=l,e.maxTimeToFirstByteMs=l;break;case"MaxRetry":e.errorRetry.maxNumRetry=l,e.timeoutRetry.maxNumRetry=l;break;case"RetryDelay":e.errorRetry.retryDelayMs=l,e.timeoutRetry.retryDelayMs=l;break;case"MaxRetryTimeout":e.errorRetry.maxRetryDelayMs=l,e.timeoutRetry.maxRetryDelayMs=l}}}),o.length&&s.warn('hls.js config: "'.concat(o.join('", "'),'" setting(s) are deprecated, use "').concat(i,'": ').concat(Do(t[i])))}),na(na({},n),t)}(qm.DefaultConfig,e,t);this.userConfig=e,s.progressive&&Cm(s,t);const{abrController:n,bufferController:r,capLevelController:i,errorController:a,fpsController:o}=s,l=new a(this),c=this.abrController=new n(this),d=new gl(this),u=s.interstitialsController,h=u?this.interstitialsController=new u(this,qm):null,f=this.bufferController=new r(this,d),m=this.capLevelController=new i(this),p=new o(this),g=new Wm(this),v=s.contentSteeringController,y=v?new v(this):null,b=this.levelController=new Om(this,y),x=new Dm(this),E=new Vm(this.config,this.logger),S=this.streamController=new Gm(this,d,E),T=this.gapController=new Am(this,d);m.setStreamController(S),p.setStreamController(S);const k=[g,b,S];h&&k.splice(1,0,h),y&&k.splice(1,0,y),this.networkControllers=k;const w=[c,f,T,m,p,x,d];this.audioTrackController=this.createController(s.audioTrackController,k);const L=s.audioStreamController;L&&k.push(this.audioStreamController=new L(this,d,E)),this.subtitleTrackController=this.createController(s.subtitleTrackController,k);const C=s.subtitleStreamController;C&&k.push(this.subtititleStreamController=new C(this,d,E)),this.createController(s.timelineController,w),E.emeController=this.emeController=this.createController(s.emeController,w),this.cmcdController=this.createController(s.cmcdController,w),this.latencyController=this.createController(Mm,w),this.coreComponents=w,k.push(l);const A=l.onErrorOut;"function"===typeof A&&this.on(Hi.ERROR,A,l),this.on(Hi.MANIFEST_LOADED,g.onManifestLoaded,g)}createController(e,t){if(e){const s=new e(this);return t&&t.push(s),s}return null}on(e,t){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this;this._emitter.on(e,t,s)}once(e,t){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this;this._emitter.once(e,t,s)}removeAllListeners(e){this._emitter.removeAllListeners(e)}off(e,t){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this,n=arguments.length>3?arguments[3]:void 0;this._emitter.off(e,t,s,n)}listeners(e){return this._emitter.listeners(e)}emit(e,t,s){return this._emitter.emit(e,t,s)}trigger(e,t){if(this.config.debug)return this.emit(e,e,t);try{return this.emit(e,e,t)}catch(s){if(this.logger.error("An internal error happened while handling event "+e+'. Error message: "'+s.message+'". Here is a stacktrace:',s),!this.triggeringException){this.triggeringException=!0;const t=e===Hi.ERROR;this.trigger(Hi.ERROR,{type:Vi.OTHER_ERROR,details:zi.INTERNAL_EXCEPTION,fatal:t,event:e,error:s}),this.triggeringException=!1}}return!1}listenerCount(e){return this._emitter.listenerCount(e)}destroy(){this.logger.log("destroy"),this.trigger(Hi.DESTROYING,void 0),this.detachMedia(),this.removeAllListeners(),this._autoLevelCapping=-1,this._url=null,this.networkControllers.forEach(e=>e.destroy()),this.networkControllers.length=0,this.coreComponents.forEach(e=>e.destroy()),this.coreComponents.length=0;const e=this.config;e.xhrSetup=e.fetchSetup=void 0,this.userConfig=null}attachMedia(e){if(!e||"media"in e&&!e.media){const t=new Error("attachMedia failed: invalid argument (".concat(e,")"));return void this.trigger(Hi.ERROR,{type:Vi.OTHER_ERROR,details:zi.ATTACH_MEDIA_ERROR,fatal:!0,error:t})}this.logger.log("attachMedia"),this._media&&(this.logger.warn("media must be detached before attaching"),this.detachMedia());const t="media"in e,s=t?e.media:e,n=t?e:{media:s};this._media=s,this.trigger(Hi.MEDIA_ATTACHING,n)}detachMedia(){this.logger.log("detachMedia"),this.trigger(Hi.MEDIA_DETACHING,{}),this._media=null}transferMedia(){this._media=null;const e=this.bufferController.transferMedia();return this.trigger(Hi.MEDIA_DETACHING,{transferMedia:e}),e}loadSource(e){this.stopLoad();const t=this.media,s=this._url,n=this._url=ba.buildAbsoluteURL(self.location.href,e,{alwaysNormalize:!0});this._autoLevelCapping=-1,this._maxHdcpLevel=null,this.logger.log("loadSource:".concat(n)),t&&s&&(s!==n||this.bufferController.hasSourceTypes())&&(this.detachMedia(),this.attachMedia(t)),this.trigger(Hi.MANIFEST_LOADING,{url:e})}get url(){return this._url}get hasEnoughToStart(){return this.streamController.hasEnoughToStart}get startPosition(){return this.streamController.startPositionValue}startLoad(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1,t=arguments.length>1?arguments[1]:void 0;this.logger.log("startLoad(".concat(e+(t?", <skip seek to start>":""),")")),this.started=!0,this.resumeBuffering();for(let s=0;s<this.networkControllers.length&&(this.networkControllers[s].startLoad(e,t),this.started&&this.networkControllers);s++);}stopLoad(){this.logger.log("stopLoad"),this.started=!1;for(let e=0;e<this.networkControllers.length&&(this.networkControllers[e].stopLoad(),!this.started&&this.networkControllers);e++);}get loadingEnabled(){return this.started}get bufferingEnabled(){return this.streamController.bufferingEnabled}resumeBuffering(){this.bufferingEnabled||(this.logger.log("resume buffering"),this.networkControllers.forEach(e=>{e.resumeBuffering&&e.resumeBuffering()}))}pauseBuffering(){this.bufferingEnabled&&(this.logger.log("pause buffering"),this.networkControllers.forEach(e=>{e.pauseBuffering&&e.pauseBuffering()}))}get inFlightFragments(){const e={[Xi]:this.streamController.inFlightFrag};return this.audioStreamController&&(e[Qi]=this.audioStreamController.inFlightFrag),this.subtititleStreamController&&(e[$i]=this.subtititleStreamController.inFlightFrag),e}swapAudioCodec(){this.logger.log("swapAudioCodec"),this.streamController.swapAudioCodec()}recoverMediaError(){this.logger.log("recoverMediaError");const e=this._media,t=null==e?void 0:e.currentTime;this.detachMedia(),e&&(this.attachMedia(e),t&&this.startLoad(t))}removeLevel(e){this.levelController.removeLevel(e)}get sessionId(){let e=this._sessionId;return e||(e=this._sessionId=function(){try{return crypto.randomUUID()}catch(e){try{const e=URL.createObjectURL(new Blob),t=e.toString();return URL.revokeObjectURL(e),t.slice(t.lastIndexOf("/")+1)}catch(e){let t=(new Date).getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,e=>{const s=(t+16*Math.random())%16|0;return t=Math.floor(t/16),("x"==e?s:3&s|8).toString(16)})}}}()),e}get levels(){const e=this.levelController.levels;return e||[]}get latestLevelDetails(){return this.streamController.getLevelDetails()||null}get loadLevelObj(){return this.levelController.loadLevelObj}get currentLevel(){return this.streamController.currentLevel}set currentLevel(e){this.logger.log("set currentLevel:".concat(e)),this.levelController.manualLevel=e,this.streamController.immediateLevelSwitch()}get nextLevel(){return this.streamController.nextLevel}set nextLevel(e){this.logger.log("set nextLevel:".concat(e)),this.levelController.manualLevel=e,this.streamController.nextLevelSwitch()}get loadLevel(){return this.levelController.level}set loadLevel(e){this.logger.log("set loadLevel:".concat(e)),this.levelController.manualLevel=e}get nextLoadLevel(){return this.levelController.nextLoadLevel}set nextLoadLevel(e){this.levelController.nextLoadLevel=e}get firstLevel(){return Math.max(this.levelController.firstLevel,this.minAutoLevel)}set firstLevel(e){this.logger.log("set firstLevel:".concat(e)),this.levelController.firstLevel=e}get startLevel(){const e=this.levelController.startLevel;return-1===e&&this.abrController.forcedAutoLevel>-1?this.abrController.forcedAutoLevel:e}set startLevel(e){this.logger.log("set startLevel:".concat(e)),-1!==e&&(e=Math.max(e,this.minAutoLevel)),this.levelController.startLevel=e}get capLevelToPlayerSize(){return this.config.capLevelToPlayerSize}set capLevelToPlayerSize(e){const t=!!e;t!==this.config.capLevelToPlayerSize&&(t?this.capLevelController.startCapping():(this.capLevelController.stopCapping(),this.autoLevelCapping=-1,this.streamController.nextLevelSwitch()),this.config.capLevelToPlayerSize=t)}get autoLevelCapping(){return this._autoLevelCapping}get bandwidthEstimate(){const{bwEstimator:e}=this.abrController;return e?e.getEstimate():NaN}set bandwidthEstimate(e){this.abrController.resetEstimator(e)}get abrEwmaDefaultEstimate(){const{bwEstimator:e}=this.abrController;return e?e.defaultEstimate:NaN}get ttfbEstimate(){const{bwEstimator:e}=this.abrController;return e?e.getEstimateTTFB():NaN}set autoLevelCapping(e){this._autoLevelCapping!==e&&(this.logger.log("set autoLevelCapping:".concat(e)),this._autoLevelCapping=e,this.levelController.checkMaxAutoUpdated())}get maxHdcpLevel(){return this._maxHdcpLevel}set maxHdcpLevel(e){(function(e){return wo.indexOf(e)>-1})(e)&&this._maxHdcpLevel!==e&&(this._maxHdcpLevel=e,this.levelController.checkMaxAutoUpdated())}get autoLevelEnabled(){return-1===this.levelController.manualLevel}get manualLevel(){return this.levelController.manualLevel}get minAutoLevel(){const{levels:e,config:{minAutoBitrate:t}}=this;if(!e)return 0;const s=e.length;for(let n=0;n<s;n++)if(e[n].maxBitrate>=t)return n;return 0}get maxAutoLevel(){const{levels:e,autoLevelCapping:t,maxHdcpLevel:s}=this;let n;if(n=-1===t&&null!=e&&e.length?e.length-1:t,s)for(let r=n;r--;){const t=e[r].attrs["HDCP-LEVEL"];if(t&&t<=s)return r}return n}get firstAutoLevel(){return this.abrController.firstAutoLevel}get nextAutoLevel(){return this.abrController.nextAutoLevel}set nextAutoLevel(e){this.abrController.nextAutoLevel=e}get playingDate(){return this.streamController.currentProgramDateTime}get mainForwardBufferInfo(){return this.streamController.getMainFwdBufferInfo()}get maxBufferLength(){return this.streamController.maxBufferLength}setAudioOption(e){var t;return(null==(t=this.audioTrackController)?void 0:t.setAudioOption(e))||null}setSubtitleOption(e){var t;return(null==(t=this.subtitleTrackController)?void 0:t.setSubtitleOption(e))||null}get allAudioTracks(){const e=this.audioTrackController;return e?e.allAudioTracks:[]}get audioTracks(){const e=this.audioTrackController;return e?e.audioTracks:[]}get audioTrack(){const e=this.audioTrackController;return e?e.audioTrack:-1}set audioTrack(e){const t=this.audioTrackController;t&&(t.audioTrack=e)}get allSubtitleTracks(){const e=this.subtitleTrackController;return e?e.allSubtitleTracks:[]}get subtitleTracks(){const e=this.subtitleTrackController;return e?e.subtitleTracks:[]}get subtitleTrack(){const e=this.subtitleTrackController;return e?e.subtitleTrack:-1}get media(){return this._media}set subtitleTrack(e){const t=this.subtitleTrackController;t&&(t.subtitleTrack=e)}get subtitleDisplay(){const e=this.subtitleTrackController;return!!e&&e.subtitleDisplay}set subtitleDisplay(e){const t=this.subtitleTrackController;t&&(t.subtitleDisplay=e)}get lowLatencyMode(){return this.config.lowLatencyMode}set lowLatencyMode(e){this.config.lowLatencyMode=e}get liveSyncPosition(){return this.latencyController.liveSyncPosition}get latency(){return this.latencyController.latency}get maxLatency(){return this.latencyController.maxLatency}get targetLatency(){return this.latencyController.targetLatency}set targetLatency(e){this.latencyController.targetLatency=e}get drift(){return this.latencyController.drift}get forceStartLoad(){return this.streamController.forceStartLoad}get pathways(){return this.levelController.pathways}get pathwayPriority(){return this.levelController.pathwayPriority}set pathwayPriority(e){this.levelController.pathwayPriority=e}get bufferedToEnd(){var e;return!(null==(e=this.bufferController)||!e.bufferedToEnd)}get interstitialsManager(){var e;return(null==(e=this.interstitialsController)?void 0:e.interstitialsManager)||null}getMediaDecodingInfo(e){return So(e,Oo(arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.allAudioTracks),navigator.mediaCapabilities)}}qm.defaultConfig=void 0;const Ym=e=>{let{size:t=24}=e;return(0,bn.jsx)("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"currentColor",children:(0,bn.jsx)("polygon",{points:"5 3 19 12 5 21 5 3"})})},Xm=e=>{let{size:t=24}=e;return(0,bn.jsxs)("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"currentColor",children:[(0,bn.jsx)("rect",{x:"6",y:"4",width:"4",height:"16"}),(0,bn.jsx)("rect",{x:"14",y:"4",width:"4",height:"16"})]})},Qm=e=>{let{muted:t}=e;return(0,bn.jsxs)("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[(0,bn.jsx)("polygon",{points:"11 5 6 9 2 9 2 15 6 15 11 19 11 5"}),!t&&(0,bn.jsx)("path",{d:"M19.07 4.93a10 10 0 0 1 0 14.14M15.54 8.46a5 5 0 0 1 0 7.07"}),t&&(0,bn.jsx)("line",{x1:"23",y1:"9",x2:"17",y2:"15"}),t&&(0,bn.jsx)("line",{x1:"17",y1:"9",x2:"23",y2:"15"})]})},$m=()=>(0,bn.jsxs)("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[(0,bn.jsx)("polyline",{points:"15 3 21 3 21 9"}),(0,bn.jsx)("polyline",{points:"9 21 3 21 3 15"}),(0,bn.jsx)("line",{x1:"21",y1:"3",x2:"14",y2:"10"}),(0,bn.jsx)("line",{x1:"3",y1:"21",x2:"10",y2:"14"})]}),Jm=()=>(0,bn.jsxs)("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[(0,bn.jsx)("polyline",{points:"4 14 10 14 10 20"}),(0,bn.jsx)("polyline",{points:"20 10 14 10 14 4"}),(0,bn.jsx)("line",{x1:"14",y1:"10",x2:"21",y2:"3"}),(0,bn.jsx)("line",{x1:"3",y1:"21",x2:"10",y2:"14"})]}),Zm=()=>(0,bn.jsx)("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:(0,bn.jsx)("polyline",{points:"18 15 12 9 6 15"})}),ep=()=>(0,bn.jsx)("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:(0,bn.jsx)("polyline",{points:"6 9 12 15 18 9"})}),tp=()=>(0,bn.jsxs)("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[(0,bn.jsx)("rect",{x:"3",y:"3",width:"7",height:"7"}),(0,bn.jsx)("rect",{x:"14",y:"3",width:"7",height:"7"}),(0,bn.jsx)("rect",{x:"14",y:"14",width:"7",height:"7"}),(0,bn.jsx)("rect",{x:"3",y:"14",width:"7",height:"7"})]}),sp=()=>(0,bn.jsxs)("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[(0,bn.jsx)("line",{x1:"8",y1:"6",x2:"21",y2:"6"}),(0,bn.jsx)("line",{x1:"8",y1:"12",x2:"21",y2:"12"}),(0,bn.jsx)("line",{x1:"8",y1:"18",x2:"21",y2:"18"}),(0,bn.jsx)("line",{x1:"3",y1:"6",x2:"3.01",y2:"6"}),(0,bn.jsx)("line",{x1:"3",y1:"12",x2:"3.01",y2:"12"}),(0,bn.jsx)("line",{x1:"3",y1:"18",x2:"3.01",y2:"18"})]}),np=()=>(0,bn.jsxs)("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[(0,bn.jsx)("circle",{cx:"12",cy:"12",r:"2"}),(0,bn.jsx)("path",{d:"M16.24 7.76a6 6 0 0 1 0 8.49m-8.48-.01a6 6 0 0 1 0-8.49m11.31-2.82a10 10 0 0 1 0 14.14m-14.14 0a10 10 0 0 1 0-14.14"})]}),rp=()=>(0,bn.jsxs)("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[(0,bn.jsx)("rect",{x:"2",y:"7",width:"20",height:"15",rx:"2",ry:"2"}),(0,bn.jsx)("polyline",{points:"17 2 12 7 7 2"})]}),ip=e=>{let{seconds:t=10}=e;return(0,bn.jsxs)("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"currentColor",children:[(0,bn.jsx)("path",{d:"M12.5 4V1l-5 4 5 4V6c3.31 0 6 2.69 6 6s-2.69 6-6 6-6-2.69-6-6H4.5c0 4.42 3.58 8 8 8s8-3.58 8-8-3.58-8-8-8z"}),(0,bn.jsx)("text",{x:"12.5",y:"14",textAnchor:"middle",fontSize:"7",fontWeight:"bold",fill:"currentColor",children:t})]})},ap=e=>{let{seconds:t=10}=e;return(0,bn.jsxs)("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"currentColor",children:[(0,bn.jsx)("path",{d:"M11.5 4V1l5 4-5 4V6c-3.31 0-6 2.69-6 6s2.69 6 6 6 6-2.69 6-6h2c0 4.42-3.58 8-8 8s-8-3.58-8-8 3.58-8 8-8z"}),(0,bn.jsx)("text",{x:"11.5",y:"14",textAnchor:"middle",fontSize:"7",fontWeight:"bold",fill:"currentColor",children:t})]})},op=()=>(0,bn.jsxs)("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"currentColor",children:[(0,bn.jsx)("circle",{cx:"12",cy:"12",r:"8",fill:"none",stroke:"currentColor",strokeWidth:"2"}),(0,bn.jsx)("circle",{cx:"12",cy:"12",r:"4",fill:"currentColor"})]}),lp=[{id:1,name:"TV3",description:"La televisi\xf3 de Catalunya",logo:"https://statics.3cat.cat/recursos/frontal/ico/icon_tv3_180.png",streamUrl:"https://directes3-tv-cat.3catdirectes.cat/live-content/tv3-hls/master.m3u8",category:"auton\xf2mica",region:"Catalunya",hd:!0},{id:2,name:"3/24",description:"Canal de not\xedcies 24h",logo:"https://statics.3cat.cat/recursos/frontal/ico/icon_324_180.png",streamUrl:"https://directes-tv-int.3catdirectes.cat/live-content/canal324-hls/master.m3u8",category:"not\xedcies",region:"Catalunya",hd:!0},{id:3,name:"33",description:"Canal cultural",logo:"https://statics.3cat.cat/recursos/frontal/ico/icon_c33_180.png",streamUrl:"https://directes-tv-cat.3catdirectes.cat/live-origin/c33-super3-hls/master.m3u8",category:"auton\xf2mica",region:"Catalunya",hd:!0},{id:4,name:"SX3",description:"Canal infantil i juvenil",logo:"https://statics.3cat.cat/recursos/frontal/ico/icon_sx3_180.png",streamUrl:"https://directes-tv-cat.3catdirectes.cat/live-content/super3-hls/master.m3u8",category:"infantil",region:"Catalunya",hd:!0},{id:5,name:"Esport3",description:"Canal esportiu",logo:"https://statics.3cat.cat/recursos/frontal/ico/icon_esport3_180.png",streamUrl:"https://directes-tv-cat.3catdirectes.cat/live-origin/esport3-hls/master.m3u8",category:"esports",region:"Catalunya",hd:!0},{id:10,name:"La 1",description:"Primera cadena de TVE",logo:"https://img2.rtve.es/css/rtve.commons/rtve.header.footer/i/logoRTVEes.png",streamUrl:"https://ztnr.rtve.es/ztnr/1688877.m3u8",category:"generalista",region:"Espanya",hd:!0},{id:11,name:"La 2",description:"Cultura i documentals",logo:"https://img2.rtve.es/css/rtve.commons/rtve.header.footer/i/logoRTVEes.png",streamUrl:"https://ztnr.rtve.es/ztnr/1688885.m3u8",category:"generalista",region:"Espanya",hd:!0},{id:12,name:"24 Horas",description:"Canal de not\xedcies RTVE",logo:"https://img2.rtve.es/css/rtve.commons/rtve.header.footer/i/logoRTVEes.png",streamUrl:"https://ztnr.rtve.es/ztnr/1694255.m3u8",category:"not\xedcies",region:"Espanya",hd:!0},{id:13,name:"Clan",description:"Canal infantil RTVE",logo:"https://img2.rtve.es/css/rtve.commons/rtve.header.footer/i/logoRTVEes.png",streamUrl:"https://ztnr.rtve.es/ztnr/5466990.m3u8",category:"infantil",region:"Espanya",hd:!0},{id:14,name:"Teledeporte",description:"Esports RTVE",logo:"https://img2.rtve.es/css/rtve.commons/rtve.header.footer/i/logoRTVEes.png",streamUrl:"https://ztnr.rtve.es/ztnr/1712295.m3u8",category:"esports",region:"Espanya",hd:!0},{id:20,name:"\xc0 Punt",description:"TV Valenciana",logo:"https://upload.wikimedia.org/wikipedia/commons/b/be/Logo_%C3%A0_punt.png",streamUrl:"https://bcovlive-a.akamaihd.net/8499d938ef904e39b58a4adec2ddeada/eu-west-1/6057955885001/playlist_dvr.m3u8",category:"auton\xf2mica",region:"Pa\xeds Valenci\xe0",hd:!0},{id:21,name:"IB3",description:"TV Illes Balears",logo:"https://upload.wikimedia.org/wikipedia/commons/7/7e/IB3_logo_2022.svg",streamUrl:"https://ibsatiphone.ib3tv.com/hls/directeTV1_iphone.m3u8",category:"auton\xf2mica",region:"Illes Balears",hd:!0},{id:22,name:"ETB 1",description:"TV Euskadi en euskera",logo:"https://upload.wikimedia.org/wikipedia/commons/4/4f/ETB1.svg",streamUrl:"https://multimedia.eitb.eus/live-content/etb1hd-hls/master.m3u8",category:"auton\xf2mica",region:"Euskadi",hd:!0},{id:23,name:"ETB 2",description:"TV Euskadi en castell\xe0",logo:"https://upload.wikimedia.org/wikipedia/commons/4/4c/ETB2.svg",streamUrl:"https://multimedia.eitb.eus/live-content/etb2hd-hls/master.m3u8",category:"auton\xf2mica",region:"Euskadi",hd:!0},{id:24,name:"TVG",description:"TV Galicia",logo:"https://upload.wikimedia.org/wikipedia/commons/a/a2/Tvg.svg",streamUrl:"https://crtvg-live.hls.adaptive.level3.net/crtvg/smil:crtvg.smil/index.m3u8",category:"auton\xf2mica",region:"Gal\xedcia",hd:!0},{id:25,name:"TVG 2",description:"Cultura galega",logo:"https://upload.wikimedia.org/wikipedia/commons/a/a2/Tvg.svg",streamUrl:"https://crtvg2-live.hls.adaptive.level3.net/crtvg2/smil:crtvg2.smil/index.m3u8",category:"auton\xf2mica",region:"Gal\xedcia",hd:!0},{id:26,name:"Canal Sur",description:"TV Andalusia",logo:"https://upload.wikimedia.org/wikipedia/commons/d/d2/Canal_Sur_logo.svg",streamUrl:"https://cdnlive.shooowit.net/rtvalive/smil:channel1.smil/playlist.m3u8",category:"auton\xf2mica",region:"Andalusia",hd:!0},{id:27,name:"Telemadrid",description:"TV Madrid",logo:"https://upload.wikimedia.org/wikipedia/commons/5/54/Logo_TeleMadrid.svg",streamUrl:"https://telemadridhls-live.hls.adaptive.level3.net/telemadrid/smil:telemadrid.smil/playlist.m3u8",category:"auton\xf2mica",region:"Madrid",hd:!0},{id:28,name:"Arag\xf3n TV",description:"TV Arag\xf3",logo:"https://upload.wikimedia.org/wikipedia/commons/4/49/Arag%C3%B3n_TV_logo.svg",streamUrl:"https://cartv.streaming.aranova.es/hls/live/aragontv_canal1.m3u8",category:"auton\xf2mica",region:"Arag\xf3",hd:!0},{id:29,name:"CMM",description:"TV Castilla-La Mancha",logo:"https://upload.wikimedia.org/wikipedia/commons/c/c5/CMM.svg",streamUrl:"https://cdnlive.shooowit.net/cmmlive/smil:cmmtv.smil/playlist.m3u8",category:"auton\xf2mica",region:"Castilla-La Mancha",hd:!0},{id:30,name:"TPA",description:"TV Principado Asturias",logo:"https://upload.wikimedia.org/wikipedia/commons/7/75/TPA_logo.svg",streamUrl:"https://rtpa-live.hls.adaptive.level3.net/rtpa/smil:rtpa.smil/index.m3u8",category:"auton\xf2mica",region:"Ast\xfaries",hd:!0},{id:31,name:"7 RM",description:"TV Regi\xf3n de Murcia",logo:"https://upload.wikimedia.org/wikipedia/commons/7/72/7_Region_de_Murcia_logo.svg",streamUrl:"https://cdn.7tvmurcia.es/hls/live.m3u8",category:"auton\xf2mica",region:"M\xfarcia",hd:!0},{id:32,name:"Canal Extremadura",description:"TV Extremadura",logo:"https://upload.wikimedia.org/wikipedia/commons/6/60/Canal_Extremadura_TV_logo.svg",streamUrl:"https://cdnlive.shooowit.net/caborientallive/smil:extremadura.smil/playlist.m3u8",category:"auton\xf2mica",region:"Extremadura",hd:!0},{id:33,name:"CyL TV",description:"TV Castella i Lle\xf3",logo:"https://upload.wikimedia.org/wikipedia/commons/2/23/CyLTV.svg",streamUrl:"https://streaming-o.rtvcyl.es/cylc7/smil:cylc7.smil/playlist.m3u8",category:"auton\xf2mica",region:"Castella i Lle\xf3",hd:!0},{id:34,name:"TV Canarias",description:"TV Can\xe0ries",logo:"https://upload.wikimedia.org/wikipedia/commons/4/4b/Televisi%C3%B3n_Canaria_Logo.svg",streamUrl:"https://rtvc-live.flumotion.com/playlist.m3u8",category:"auton\xf2mica",region:"Can\xe0ries",hd:!0},{id:40,name:"TRECE",description:"Canal cat\xf2lic",logo:"https://upload.wikimedia.org/wikipedia/commons/3/34/TRECE_logo.svg",streamUrl:"https://live-edge-bom-1.cdn.enetres.net/A62F6E09D69245B7B19DC0B0D5D04A72021/live-1500/index.m3u8",category:"tem\xe0tica",region:"Espanya",hd:!0},{id:41,name:"El Toro TV",description:"Canal taur\xed",logo:"https://eltorotv.com/favicon.ico",streamUrl:"https://streaming-1.eltorotv.com/lb0/eltorotv-streaming-web/index.m3u8",category:"tem\xe0tica",region:"Espanya",hd:!0},{id:42,name:"Real Madrid TV",description:"Canal del Real Madrid",logo:"https://upload.wikimedia.org/wikipedia/commons/4/47/Real_Madrid_TV.svg",streamUrl:"https://rmtv-live.akamaized.net/hls/live/2033988/rmtv/master.m3u8",category:"esports",region:"Espanya",hd:!0},{id:43,name:"Bar\xe7a TV+",description:"Canal del FC Barcelona",logo:"https://upload.wikimedia.org/wikipedia/en/4/47/FC_Barcelona_%28crest%29.svg",streamUrl:"https://directes-tv-cat.3catdirectes.cat/live-content/barcatv-hls/master.m3u8",category:"esports",region:"Catalunya",hd:!0},{id:50,name:"DW Espa\xf1ol",description:"Deutsche Welle en espanyol",logo:"https://upload.wikimedia.org/wikipedia/commons/8/81/Deutsche_Welle_Logo.svg",streamUrl:"https://dwamdstream102.akamaized.net/hls/live/2015525/dwstream102/index.m3u8",category:"not\xedcies",region:"Internacional",hd:!0},{id:51,name:"France 24 Espa\xf1ol",description:"France 24 en espanyol",logo:"https://upload.wikimedia.org/wikipedia/commons/6/66/France_24_logo_%282018%29.svg",streamUrl:"https://stream.france24.com/F24_ES_LO_HLS/live_web.m3u8",category:"not\xedcies",region:"Internacional",hd:!0},{id:52,name:"Euronews",description:"Euronews en espanyol",logo:"https://upload.wikimedia.org/wikipedia/commons/3/37/Euronews_logo_%282022%29.svg",streamUrl:"https://euronews-euronews-spanish-2-eu.rakuten.wurl.tv/playlist.m3u8",category:"not\xedcies",region:"Internacional",hd:!0},{id:53,name:"RT en Espa\xf1ol",description:"Russia Today en espanyol",logo:"https://upload.wikimedia.org/wikipedia/commons/a/a0/RT_logo.svg",streamUrl:"https://rt-esp.rttv.com/live/rtesp/playlist.m3u8",category:"not\xedcies",region:"Internacional",hd:!0},{id:54,name:"NHK World",description:"NHK Jap\xf3 en angl\xe8s",logo:"https://upload.wikimedia.org/wikipedia/commons/8/80/NHK_World_Japan_logo.svg",streamUrl:"https://nhkworld.webcdn.stream.ne.jp/www11/nhkworld-tv/domestic/263942/live.m3u8",category:"not\xedcies",region:"Internacional",hd:!0},{id:55,name:"Al Jazeera",description:"Al Jazeera en angl\xe8s",logo:"https://upload.wikimedia.org/wikipedia/en/f/f2/Al_Jazeera_English.svg",streamUrl:"https://live-hls-web-aje.getaj.net/AJE/01.m3u8",category:"not\xedcies",region:"Internacional",hd:!0},{id:56,name:"CGTN Espa\xf1ol",description:"TV Xina en espanyol",logo:"https://upload.wikimedia.org/wikipedia/commons/6/68/CGTN.svg",streamUrl:"https://livees.cgtn.com/1000e/prog_index.m3u8",category:"not\xedcies",region:"Internacional",hd:!0},{id:60,name:"betev\xe9",description:"TV Barcelona",logo:"https://upload.wikimedia.org/wikipedia/commons/d/d7/Betev%C3%A9_logo.svg",streamUrl:"https://cdnapisec.kaltura.com/p/2346171/sp/234617100/playManifest/entryId/1_2vffmgpo/format/applehttp/protocol/https/a.m3u8",category:"local",region:"Barcelona",hd:!0},{id:61,name:"8tv",description:"TV privada catalana",logo:"https://upload.wikimedia.org/wikipedia/commons/7/7c/8tv_logo.svg",streamUrl:"https://streaming-8tv.streaming-br.com/8tv/smil:live.smil/playlist.m3u8",category:"local",region:"Catalunya",hd:!0},{id:62,name:"TAC 12",description:"TV Terrassa i Rub\xed",logo:"https://tac12.tv/favicon.ico",streamUrl:"https://cdnlive.shooowit.net/tac12live/smil:tac12.smil/playlist.m3u8",category:"local",region:"Barcelona",hd:!0},{id:63,name:"El Punt Avui TV",description:"Actualitat catalana",logo:"https://www.elpuntavui.cat/favicon.ico",streamUrl:"https://cdnlive.shooowit.net/elpuntavuilive/smil:elpuntavuitv.smil/playlist.m3u8",category:"local",region:"Catalunya",hd:!0},{id:70,name:"Hit TV",description:"Videoclips i m\xfasica",logo:"https://hittv.es/favicon.ico",streamUrl:"https://hittv-live.akamaized.net/hls/live/2033979/hittv/master.m3u8",category:"m\xfasica",region:"Espanya",hd:!0},{id:71,name:"Sol M\xfasica",description:"M\xfasica espanyola i llatina",logo:"https://solmusica.com/favicon.ico",streamUrl:"https://cdnlive.shooowit.net/solmusicalive/smil:solmusica.smil/playlist.m3u8",category:"m\xfasica",region:"Espanya",hd:!0}],cp=[{id:100,name:"Catalunya R\xe0dio",description:"Emissora nacional catalana",logo:"https://statics.3cat.cat/recursos/frontal/ico/icon_catradio_180.png",streamUrl:"https://directes-radio-int.3catdirectes.cat/live-content/catalunya-radio-hls/master.m3u8",category:"generalista",region:"Catalunya"},{id:101,name:"Catalunya Informaci\xf3",description:"Not\xedcies 24h",logo:"https://statics.3cat.cat/recursos/frontal/ico/icon_catinformacio_180.png",streamUrl:"https://directes-radio-int.3catdirectes.cat/live-content/catinfo-hls/master.m3u8",category:"not\xedcies",region:"Catalunya"},{id:102,name:"Catalunya M\xfasica",description:"M\xfasica cl\xe0ssica",logo:"https://statics.3cat.cat/recursos/frontal/ico/icon_catmusica_180.png",streamUrl:"https://directes-radio-int.3catdirectes.cat/live-content/catmusica-hls/master.m3u8",category:"m\xfasica",region:"Catalunya"},{id:103,name:"iCat",description:"M\xfasica alternativa i indie",logo:"https://statics.3cat.cat/recursos/frontal/ico/icon_icat_180.png",streamUrl:"https://directes-radio-int.3catdirectes.cat/live-content/icat-hls/master.m3u8",category:"m\xfasica",region:"Catalunya"},{id:110,name:"RNE 1",description:"Radio Nacional de Espa\xf1a",logo:"https://img.rtve.es/css/rtve.commons/rtve.header.footer/i/logoRTVE.png",streamUrl:"https://rtvelivestream.rtve.es/rtvesec/rne/rne_r1_main.m3u8",category:"generalista",region:"Espanya"},{id:111,name:"Radio Cl\xe1sica",description:"RNE M\xfasica cl\xe0ssica",logo:"https://img.rtve.es/css/rtve.commons/rtve.header.footer/i/logoRTVE.png",streamUrl:"https://rtvelivestream.rtve.es/rtvesec/rne/rne_r2_main.m3u8",category:"m\xfasica",region:"Espanya"},{id:112,name:"Radio 3",description:"M\xfasica i cultura",logo:"https://img.rtve.es/css/rtve.commons/rtve.header.footer/i/logoRTVE.png",streamUrl:"https://rtvelivestream.rtve.es/rtvesec/rne/rne_r3_main.m3u8",category:"m\xfasica",region:"Espanya"},{id:113,name:"R\xe0dio 4",description:"RNE Catalunya",logo:"https://img.rtve.es/css/rtve.commons/rtve.header.footer/i/logoRTVE.png",streamUrl:"https://rtvelivestream.rtve.es/rtvesec/rne/rne_r4_main.m3u8",category:"generalista",region:"Catalunya"},{id:114,name:"Radio 5",description:"Not\xedcies 24h",logo:"https://img.rtve.es/css/rtve.commons/rtve.header.footer/i/logoRTVE.png",streamUrl:"https://rtvelivestream.rtve.es/rtvesec/rne/rne_r5_main.m3u8",category:"not\xedcies",region:"Espanya"},{id:115,name:"Radio Exterior",description:"RNE Internacional",logo:"https://img.rtve.es/css/rtve.commons/rtve.header.footer/i/logoRTVE.png",streamUrl:"https://rtvelivestream.rtve.es/rtvesec/rne/rne_rne_main.m3u8",category:"generalista",region:"Internacional"},{id:120,name:"Cadena SER",description:"R\xe0dio generalista",logo:"https://upload.wikimedia.org/wikipedia/commons/d/d9/Cadena_SER_logo.svg",streamUrl:"https://playerservices.streamtheworld.com/api/livestream-redirect/CADENASERAAC.aac",category:"generalista",region:"Espanya"},{id:121,name:"COPE",description:"R\xe0dio generalista",logo:"https://upload.wikimedia.org/wikipedia/commons/5/5d/COPE_Logo.svg",streamUrl:"https://flucast09-h-cloud.flumotion.com/cope/net1.aac",category:"generalista",region:"Espanya"},{id:122,name:"Onda Cero",description:"R\xe0dio generalista",logo:"https://upload.wikimedia.org/wikipedia/commons/c/c0/Onda_Cero.svg",streamUrl:"https://atres-live.ondacero.es/live/ondaceroeventos1/master.m3u8",category:"generalista",region:"Espanya"},{id:130,name:"Los 40",description:"\xc8xits actuals",logo:"https://upload.wikimedia.org/wikipedia/commons/3/35/Los_40_Principales_logo.svg",streamUrl:"https://playerservices.streamtheworld.com/api/livestream-redirect/LOS40AAC.aac",category:"m\xfasica",region:"Espanya"},{id:131,name:"Los 40 Classic",description:"Cl\xe0ssics",logo:"https://upload.wikimedia.org/wikipedia/commons/3/35/Los_40_Principales_logo.svg",streamUrl:"https://playerservices.streamtheworld.com/api/livestream-redirect/LOS40_CLASSICAAC.aac",category:"m\xfasica",region:"Espanya"},{id:132,name:"Cadena Dial",description:"M\xfasica en espanyol",logo:"https://upload.wikimedia.org/wikipedia/commons/c/c1/Cadena_Dial_logo.svg",streamUrl:"https://playerservices.streamtheworld.com/api/livestream-redirect/CADENADIAL.aac",category:"m\xfasica",region:"Espanya"},{id:133,name:"Europa FM",description:"Pop i rock actual",logo:"https://upload.wikimedia.org/wikipedia/commons/0/07/Europa_FM_logo.svg",streamUrl:"https://atres-live.europafm.com/live/europafm/master.m3u8",category:"m\xfasica",region:"Espanya"},{id:134,name:"Kiss FM",description:"Dance i electr\xf2nica",logo:"https://kissfm.es/favicon.ico",streamUrl:"https://kissfm.kissfmradio.cires21.com/kissfm.mp3",category:"m\xfasica",region:"Espanya"},{id:135,name:"Rock FM",description:"Rock cl\xe0ssic i actual",logo:"https://upload.wikimedia.org/wikipedia/commons/d/d4/Rock_FM_logo.svg",streamUrl:"https://rockfm.cope.stream.flumotion.com/cope/rockfm.aac",category:"m\xfasica",region:"Espanya"},{id:140,name:"RAC1",description:"R\xe0dio catalana privada",logo:"https://upload.wikimedia.org/wikipedia/commons/6/62/RAC1_logo.svg",streamUrl:"https://streaming.rac1.cat/rac1-master.m3u8",category:"generalista",region:"Catalunya"},{id:141,name:"RAC105",description:"Pop i rock en catal\xe0",logo:"https://upload.wikimedia.org/wikipedia/commons/6/62/RAC1_logo.svg",streamUrl:"https://streaming.rac105.cat/rac105-master.m3u8",category:"m\xfasica",region:"Catalunya"},{id:142,name:"Flaix FM",description:"Dance i remember",logo:"https://ffrm.es/favicon.ico",streamUrl:"https://shoutcast.ccma.cat/flaix",category:"m\xfasica",region:"Catalunya"},{id:143,name:"R\xe0dio Flaixbac",description:"Remember 80s 90s",logo:"https://ffrm.es/favicon.ico",streamUrl:"https://shoutcast.ccma.cat/flaixbac",category:"m\xfasica",region:"Catalunya"},{id:150,name:"BBC World Service",description:"BBC en angl\xe8s",logo:"https://upload.wikimedia.org/wikipedia/commons/e/eb/BBC_World_Service_red.svg",streamUrl:"https://stream.live.vc.bbcmedia.co.uk/bbc_world_service",category:"not\xedcies",region:"Internacional"},{id:151,name:"France Inter",description:"R\xe0dio francesa",logo:"https://upload.wikimedia.org/wikipedia/commons/c/cf/France_Inter_logo.svg",streamUrl:"https://icecast.radiofrance.fr/franceinter-hifi.aac",category:"generalista",region:"Internacional"}],dp=[{id:"all",name:"Tots",icon:null},{id:"auton\xf2mica",name:"Auton\xf2miques",icon:null},{id:"not\xedcies",name:"Not\xedcies",icon:null},{id:"esports",name:"Esports",icon:null},{id:"infantil",name:"Infantil",icon:null},{id:"entreteniment",name:"Entreteniment",icon:null},{id:"m\xfasica",name:"M\xfasica",icon:null},{id:"tem\xe0tica",name:"Tem\xe0tiques",icon:null},{id:"local",name:"Locals",icon:null}],up=[{id:"all",name:"Totes",icon:null},{id:"generalista",name:"Generalistes",icon:null},{id:"m\xfasica",name:"M\xfasica",icon:null},{id:"not\xedcies",name:"Not\xedcies",icon:null}];const hp=function(){const[e,t]=(0,i.useState)("tv"),[s,n]=(0,i.useState)("fullscreen"),[r,a]=(0,i.useState)(lp[0]),[o,l]=(0,i.useState)("all"),[c,d]=(0,i.useState)("number"),[u,h]=(0,i.useState)(!1),[f,m]=(0,i.useState)(!0),[p,g]=(0,i.useState)(!0),[v,y]=(0,i.useState)(!1),[b,x]=(0,i.useState)(1),[E,S]=(0,i.useState)(!1),[T,k]=(0,i.useState)(""),[w,L]=(0,i.useState)(!1),[C,A]=(0,i.useState)(!1),[R,_]=(0,i.useState)(null),[N,I]=(0,i.useState)(!0),[j,P]=(0,i.useState)(!0),[D,M]=(0,i.useState)(null),O=(0,i.useRef)(null),F=(0,i.useRef)(null),U=(0,i.useRef)(null),B=(0,i.useRef)(null),G=(0,i.useRef)(null),V=(0,i.useRef)(null),z=(0,i.useRef)(0),H=(0,i.useRef)(null),K=(0,i.useRef)(null),W=(0,i.useRef)(null),q=10;(0,i.useEffect)(()=>{const t="tv"===e?O.current:F.current,s=r.streamUrl;if(!t||!s)return;P(!0),M(null),t.pause(),W.current&&clearTimeout(W.current),W.current=setTimeout(()=>{j&&(P(!1),M("El canal no respon. Pot estar temporalment no disponible."))},15e3),K.current&&(K.current.destroy(),K.current=null);const n=s.includes(".m3u8"),i=()=>{const e=t.play();void 0!==e&&e.then(()=>{g(!0),I(!0),P(!1),M(null),W.current&&clearTimeout(W.current)}).catch(e=>{"AbortError"!==e.name&&(console.warn("Playback error:",e.message),M("Error reproduint el canal"),P(!1))})},a=()=>{P(!1),M(null),W.current&&clearTimeout(W.current)},o=()=>{P(!0)},l=e=>{P(!1),M("Error carregant el canal. Prova amb un altre.")};if(t.addEventListener("canplay",a),t.addEventListener("waiting",o),t.addEventListener("error",l),n&&qm.isSupported()){const e=new qm({enableWorker:!0,lowLatencyMode:!1,backBufferLength:90,maxBufferLength:30,maxMaxBufferLength:600,maxBufferSize:6e7,maxBufferHole:.5,startLevel:-1,abrEwmaDefaultEstimate:5e6,abrBandWidthFactor:.95,abrBandWidthUpFactor:.7,abrMaxWithRealBitrate:!0,capLevelToPlayerSize:!0,fragLoadingMaxRetry:6,manifestLoadingMaxRetry:4,levelLoadingMaxRetry:4});K.current=e,e.loadSource(s),e.attachMedia(t),e.on(qm.Events.MANIFEST_PARSED,(t,s)=>{if(s.levels&&s.levels.length>0){const t=s.levels.findIndex(e=>e.height>=720);-1!==t&&(e.currentLevel=t)}i()}),e.on(qm.Events.ERROR,(t,s)=>{if(s.fatal)switch(s.type){case qm.ErrorTypes.NETWORK_ERROR:console.warn("HLS network error, trying to recover..."),e.startLoad();break;case qm.ErrorTypes.MEDIA_ERROR:console.warn("HLS media error, trying to recover..."),e.recoverMediaError();break;default:console.warn("HLS fatal error:",s.details),M("Error amb el stream. Prova amb un altre canal."),P(!1),e.destroy()}})}else!t.canPlayType("application/vnd.apple.mpegurl")&&n||(t.src=s,t.load(),i());return()=>{t.removeEventListener("canplay",a),t.removeEventListener("waiting",o),t.removeEventListener("error",l),W.current&&clearTimeout(W.current),K.current&&(K.current.destroy(),K.current=null)}},[r,e]);const Y="tv"===e?lp:cp,X="tv"===e?dp:up,Q=(()=>{let e="all"===o?[...Y]:Y.filter(e=>e.category===o);switch(c){case"name":e.sort((e,t)=>e.name.localeCompare(t.name));break;case"category":e.sort((e,t)=>(e.category||"").localeCompare(t.category||""));break;default:e.sort((e,t)=>e.id-t.id)}return e})(),$=(0,i.useCallback)(()=>{B.current&&clearTimeout(B.current),m(!0),"fullscreen"===s&&(B.current=setTimeout(()=>{u||m(!1)},4e3))},[s,u]);(0,i.useEffect)(()=>{const e=e=>{if(e.key>="0"&&e.key<="9")k(t=>{const s=t+e.key;return G.current&&clearTimeout(G.current),G.current=setTimeout(()=>{const e=parseInt(s),t=Y.find(t=>t.id===e);t&&(a(t),J()),k("")},1500),s});else{switch(e.key){case"ArrowUp":e.preventDefault(),Z(-1);break;case"ArrowDown":e.preventDefault(),Z(1);break;case" ":e.preventDefault(),ee();break;case"m":case"M":ae();break;case"f":case"F":le();break;case"g":case"G":h(e=>!e);break;case"Escape":u?h(!1):E&&ce();break;case"i":case"I":J()}$()}};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[Y,r,E,u,$]);const J=()=>{L(!0),V.current&&clearTimeout(V.current),V.current=setTimeout(()=>{L(!1)},5e3)},Z=e=>{let t=Y.findIndex(e=>e.id===r.id)+e;t<0&&(t=Y.length-1),t>=Y.length&&(t=0),a(Y[t]),J()},ee=()=>{const t="tv"===e?O.current:F.current;t&&(p?t.pause():t.play(),g(!p))},te=()=>{if(g(!0),!C&&!document.fullscreenElement&&"fullscreen"===s){A(!0);const e=U.current||document.documentElement;e.requestFullscreen?e.requestFullscreen().catch(()=>{}):e.webkitRequestFullscreen?e.webkitRequestFullscreen():e.msRequestFullscreen&&e.msRequestFullscreen(),window.screen.orientation&&window.screen.orientation.lock&&window.screen.orientation.lock("landscape").catch(()=>{}),S(!0)}},se=e=>{_(e),setTimeout(()=>_(null),500)},ne=t=>{const s="tv"===e?O.current:F.current;if(s&&s.duration&&isFinite(s.duration)){const e=Math.max(0,Math.min(s.duration,s.currentTime+t));s.currentTime=e,I(!1)}},re=()=>{const t="tv"===e?O.current:F.current;t&&(t.duration&&isFinite(t.duration)?t.currentTime=t.duration:t.seekable&&t.seekable.length>0&&(t.currentTime=t.seekable.end(t.seekable.length-1)),t.play(),I(!0),g(!0))},ie=e=>{var t;const s=e.target;if(s.closest(".tv-bottom-controls")||s.closest(".tv-top-controls")||s.closest(".control-btn")||s.closest(".tv-channel-sidebar")||s.closest(".nav-btn"))return void(B.current&&clearTimeout(B.current));const n=Date.now(),r=n-z.current,i=e.touches[0],a=(null===(t=U.current)||void 0===t?void 0:t.offsetWidth)||window.innerWidth,o=i.clientX,l=o<.33*a?"left":o>.66*a?"right":"center";r<300&&r>0?(clearTimeout(H.current),z.current=0,"left"===l?(ne(-10),se("left")):"right"===l?(ne(q),se("right")):(ee(),se("center"))):(z.current=n,H.current=setTimeout(()=>{f?m(!1):$(),z.current=0},300))};(0,i.useEffect)(()=>()=>{document.fullscreenElement&&document.exitFullscreen().catch(()=>{}),window.screen.orientation&&window.screen.orientation.unlock&&window.screen.orientation.unlock(),H.current&&clearTimeout(H.current)},[]);const ae=()=>{const t="tv"===e?O.current:F.current;t&&(t.muted=!v,y(!v))},oe=t=>{const s=parseFloat(t.target.value);x(s);const n="tv"===e?O.current:F.current;n&&(n.volume=s,y(0===s))},le=()=>{var e;document.fullscreenElement?(document.exitFullscreen(),S(!1)):(null===(e=U.current)||void 0===e||e.requestFullscreen(),S(!0))},ce=()=>{document.fullscreenElement&&(document.exitFullscreen(),S(!1))};(0,i.useEffect)(()=>{const e=()=>{S(!!document.fullscreenElement)};return document.addEventListener("fullscreenchange",e),()=>document.removeEventListener("fullscreenchange",e)},[]);const de=e=>{a(e),h(!1),J(),g(!0)},ue=e=>{t(e),l("all");a(("tv"===e?lp:cp)[0]),g(!0)};return(0,bn.jsx)("div",{className:"tv-page",children:"grid"===s?(0,bn.jsxs)("div",{className:"tv-grid-view",children:[(0,bn.jsxs)("div",{className:"tv-grid-header",children:[(0,bn.jsxs)("div",{className:"tv-mode-switcher",children:[(0,bn.jsxs)("button",{className:"mode-btn ".concat("tv"===e?"active":""),onClick:()=>ue("tv"),children:[(0,bn.jsx)(rp,{})," Televisi\xf3"]}),(0,bn.jsxs)("button",{className:"mode-btn ".concat("radio"===e?"active":""),onClick:()=>ue("radio"),children:[(0,bn.jsx)(np,{})," R\xe0dio"]})]}),(0,bn.jsxs)("div",{className:"tv-header-right",children:[(0,bn.jsxs)("select",{className:"tv-sort-select",value:c,onChange:e=>d(e.target.value),children:[(0,bn.jsx)("option",{value:"number",children:"Ordenar per n\xfamero"}),(0,bn.jsx)("option",{value:"name",children:"Ordenar per nom"}),(0,bn.jsx)("option",{value:"category",children:"Ordenar per categoria"})]}),(0,bn.jsxs)("div",{className:"tv-view-switcher",children:[(0,bn.jsx)("button",{className:"view-btn ".concat("fullscreen"===s?"active":""),onClick:()=>n("fullscreen"),title:"Vista reproductor",children:(0,bn.jsx)($m,{})}),(0,bn.jsx)("button",{className:"view-btn ".concat("grid"===s?"active":""),onClick:()=>n("grid"),title:"Vista graella",children:(0,bn.jsx)(tp,{})})]})]})]}),(0,bn.jsxs)("div",{className:"tv-channels-count",children:[Q.length," ","tv"===e?"canals":"emissores"," disponibles"]}),(0,bn.jsx)("div",{className:"tv-categories-bar",children:X.map(e=>(0,bn.jsxs)("button",{className:"category-chip ".concat(o===e.id?"active":""),onClick:()=>l(e.id),children:[(0,bn.jsx)("span",{className:"category-icon",children:e.icon}),e.name]},e.id))}),(0,bn.jsx)("div",{className:"tv-channels-grid",children:Q.map(e=>(0,bn.jsxs)("div",{className:"channel-card ".concat(r.id===e.id?"active":""),onClick:()=>{de(e),n("fullscreen")},children:[(0,bn.jsxs)("div",{className:"channel-card-logo",children:[(0,bn.jsx)("img",{src:e.logo,alt:e.name,onError:e=>{e.target.style.display="none",e.target.nextSibling.style.display="flex"}}),(0,bn.jsx)("div",{className:"channel-card-fallback",style:{display:"none"},children:e.name.charAt(0)}),(0,bn.jsx)("div",{className:"channel-card-number",children:e.id}),e.hd&&(0,bn.jsx)("span",{className:"channel-hd-badge",children:"HD"})]}),(0,bn.jsxs)("div",{className:"channel-card-info",children:[(0,bn.jsx)("h3",{children:e.name}),(0,bn.jsx)("p",{children:e.description}),e.region&&(0,bn.jsx)("span",{className:"channel-region",children:e.region})]}),(0,bn.jsxs)("div",{className:"channel-card-live",children:[(0,bn.jsx)("span",{className:"live-dot"}),"EN DIRECTE"]})]},e.id))})]}):(0,bn.jsxs)("div",{className:"tv-fullscreen-view ".concat(f?"controls-visible":""),ref:U,onMouseMove:$,onTouchStart:ie,onClick:e=>{(e.target===e.currentTarget||e.target.classList.contains("tv-video-container"))&&$()},children:[(0,bn.jsxs)("div",{className:"tv-video-container",children:[j&&(0,bn.jsxs)("div",{className:"tv-loading-overlay",children:[(0,bn.jsx)("div",{className:"tv-loading-spinner"}),(0,bn.jsxs)("div",{className:"tv-loading-text",children:["Carregant ",r.name,"..."]})]}),D&&(0,bn.jsxs)("div",{className:"tv-error-overlay",children:[(0,bn.jsx)("div",{className:"tv-error-icon",children:"!"}),(0,bn.jsx)("div",{className:"tv-error-text",children:D}),(0,bn.jsx)("button",{className:"tv-retry-btn",onClick:()=>{M(null),P(!0);const t="tv"===e?O.current:F.current;t&&(t.load(),t.play().catch(()=>{}))},children:"Reintentar"})]}),"tv"===e?(0,bn.jsx)("video",{ref:O,playsInline:!0,muted:v,className:"tv-video-player",onPlay:te,onPause:()=>g(!1)},r.id):(0,bn.jsxs)("div",{className:"tv-radio-visual",children:[(0,bn.jsxs)("div",{className:"radio-visualization",children:[(0,bn.jsx)("div",{className:"radio-cover",children:(0,bn.jsx)("img",{src:r.logo,alt:r.name,onError:e=>e.target.style.display="none"})}),(0,bn.jsxs)("div",{className:"radio-waves",children:[(0,bn.jsx)("span",{}),(0,bn.jsx)("span",{}),(0,bn.jsx)("span",{}),(0,bn.jsx)("span",{}),(0,bn.jsx)("span",{})]})]}),(0,bn.jsx)("audio",{ref:F,muted:v,onPlay:()=>g(!0),onPause:()=>g(!1)},r.id)]})]}),R&&(0,bn.jsxs)("div",{className:"skip-indicator ".concat(R),children:["left"===R&&(0,bn.jsx)(ip,{seconds:q}),"right"===R&&(0,bn.jsx)(ap,{seconds:q}),"center"===R&&(p?(0,bn.jsx)(Xm,{size:48}):(0,bn.jsx)(Ym,{size:48}))]}),T&&(0,bn.jsx)("div",{className:"tv-channel-number-display",children:T}),w&&!f&&(0,bn.jsxs)("div",{className:"tv-channel-info-overlay",children:[(0,bn.jsxs)("div",{className:"channel-info-content",children:[(0,bn.jsx)("div",{className:"channel-info-number",children:r.id}),(0,bn.jsx)("img",{src:r.logo,alt:r.name,className:"channel-info-logo",onError:e=>e.target.style.display="none"}),(0,bn.jsxs)("div",{className:"channel-info-details",children:[(0,bn.jsx)("h2",{children:r.name}),(0,bn.jsx)("p",{children:r.description}),(0,bn.jsxs)("div",{className:"channel-info-meta",children:[(0,bn.jsxs)("span",{className:"live-indicator",children:[(0,bn.jsx)("span",{className:"live-dot"})," EN DIRECTE"]}),r.hd&&(0,bn.jsx)("span",{className:"hd-badge",children:"HD"}),r.region&&(0,bn.jsx)("span",{className:"region-badge",children:r.region})]})]})]}),(0,bn.jsxs)("div",{className:"channel-nav-hint",children:[(0,bn.jsx)("span",{children:"\u25b2 Canal anterior"}),(0,bn.jsx)("span",{children:"\u25bc Canal seg\xfcent"})]})]}),(0,bn.jsxs)("div",{className:"tv-top-controls ".concat(f?"visible":""),children:[(0,bn.jsx)("button",{className:"tv-back-btn",onClick:()=>n("grid"),children:"\u2190 Tornar"}),(0,bn.jsxs)("div",{className:"tv-mode-pills",children:[(0,bn.jsx)("button",{className:"mode-pill ".concat("tv"===e?"active":""),onClick:()=>ue("tv"),children:"Televisi\xf3"}),(0,bn.jsx)("button",{className:"mode-pill ".concat("radio"===e?"active":""),onClick:()=>ue("radio"),children:"R\xe0dio"})]}),(0,bn.jsxs)("button",{className:"tv-guide-btn",onClick:()=>h(!u),children:[(0,bn.jsx)(sp,{})," Guia"]})]}),(0,bn.jsxs)("div",{className:"tv-bottom-controls ".concat(f?"visible":""),children:[(0,bn.jsxs)("div",{className:"tv-current-channel",children:[(0,bn.jsx)("div",{className:"current-channel-number",children:r.id}),(0,bn.jsx)("img",{src:r.logo,alt:r.name,className:"current-channel-logo",onError:e=>e.target.style.display="none"}),(0,bn.jsxs)("div",{className:"current-channel-info",children:[(0,bn.jsx)("h3",{children:r.name}),(0,bn.jsx)("p",{children:r.description})]}),(0,bn.jsxs)("div",{className:"current-channel-live",children:[(0,bn.jsx)("span",{className:"live-dot"})," EN DIRECTE"]})]}),(0,bn.jsxs)("div",{className:"tv-player-controls",children:[(0,bn.jsxs)("div",{className:"tv-nav-controls",children:[(0,bn.jsx)("button",{className:"nav-btn",onClick:()=>Z(-1),title:"Canal anterior",children:(0,bn.jsx)(Zm,{})}),(0,bn.jsx)("button",{className:"nav-btn",onClick:()=>Z(1),title:"Canal seg\xfcent",children:(0,bn.jsx)(ep,{})})]}),(0,bn.jsx)("button",{className:"control-btn skip-btn",onClick:()=>{ne(-10),se("left")},title:"Retrocedir 10s",children:(0,bn.jsx)(ip,{seconds:q})}),(0,bn.jsx)("button",{className:"control-btn play-btn",onClick:ee,children:p?(0,bn.jsx)(Xm,{size:28}):(0,bn.jsx)(Ym,{size:28})}),(0,bn.jsx)("button",{className:"control-btn skip-btn",onClick:()=>{ne(q),se("right")},title:"Avan\xe7ar 10s",children:(0,bn.jsx)(ap,{seconds:q})}),(0,bn.jsxs)("button",{className:"control-btn live-btn ".concat(N?"active":""),onClick:re,title:"Tornar al directe",children:[(0,bn.jsx)(op,{}),(0,bn.jsx)("span",{className:"live-text",children:"DIRECTE"})]}),(0,bn.jsxs)("div",{className:"volume-control",children:[(0,bn.jsx)("button",{className:"control-btn",onClick:ae,children:(0,bn.jsx)(Qm,{muted:v})}),(0,bn.jsx)("input",{type:"range",min:"0",max:"1",step:"0.1",value:v?0:b,onChange:oe,className:"volume-slider"})]}),(0,bn.jsx)("button",{className:"control-btn",onClick:le,children:E?(0,bn.jsx)(Jm,{}):(0,bn.jsx)($m,{})})]})]}),u&&(0,bn.jsxs)("div",{className:"tv-channel-sidebar",children:[(0,bn.jsxs)("div",{className:"sidebar-header",children:[(0,bn.jsx)("h2",{children:"Canals"}),(0,bn.jsx)("button",{onClick:()=>h(!1),children:"\u2715"})]}),(0,bn.jsx)("div",{className:"sidebar-categories",children:X.map(e=>(0,bn.jsxs)("button",{className:"sidebar-category ".concat(o===e.id?"active":""),onClick:()=>l(e.id),children:[e.icon," ",e.name]},e.id))}),(0,bn.jsx)("div",{className:"sidebar-channels",children:Q.map(e=>(0,bn.jsxs)("div",{className:"sidebar-channel ".concat(r.id===e.id?"active":""),onClick:()=>de(e),children:[(0,bn.jsx)("span",{className:"sidebar-channel-num",children:e.id}),(0,bn.jsx)("img",{src:e.logo,alt:e.name,onError:e=>e.target.style.display="none"}),(0,bn.jsxs)("div",{className:"sidebar-channel-info",children:[(0,bn.jsx)("span",{className:"sidebar-channel-name",children:e.name}),(0,bn.jsx)("span",{className:"sidebar-channel-desc",children:e.description})]}),e.hd&&(0,bn.jsx)("span",{className:"hd-mini",children:"HD"})]},e.id))})]})]})})},fp=[{id:"all",name:"Tot",icon:null},{id:"informatius",name:"Informatius",icon:null},{id:"entreteniment",name:"Entreteniment",icon:null},{id:"esports",name:"Esports",icon:null},{id:"infantil",name:"Infantil",icon:null},{id:"documentals",name:"Documentals",icon:null},{id:"cultura",name:"Cultura",icon:null}];function mp(e){if(!e)return"";return new Date(e).toLocaleDateString("ca-ES",{day:"numeric",month:"short",year:"numeric"})}function pp(e){let{program:t,onClick:s}=e;return(0,bn.jsxs)("div",{className:"video-card",onClick:s,children:[(0,bn.jsxs)("div",{className:"video-card-image",children:[t.image?(0,bn.jsx)("img",{src:t.image,alt:t.title,onError:e=>{e.target.style.display="none",e.target.nextSibling.style.display="flex"}}):null,(0,bn.jsx)("div",{className:"video-card-placeholder",style:{display:t.image?"none":"flex"},children:(0,bn.jsx)(An,{})}),(0,bn.jsx)("div",{className:"video-card-overlay",children:(0,bn.jsx)(In,{size:32})}),t.video_count>0&&(0,bn.jsxs)("span",{className:"video-duration",children:[t.video_count," v\xeddeos"]})]}),(0,bn.jsxs)("div",{className:"video-card-info",children:[(0,bn.jsx)("h3",{children:t.title}),(0,bn.jsx)("span",{className:"video-program-tag",children:t.channel||"3Cat"})]})]})}function gp(e){let{video:t,onClick:s}=e;return(0,bn.jsxs)("div",{className:"video-card",onClick:s,children:[(0,bn.jsxs)("div",{className:"video-card-image",children:[t.image?(0,bn.jsx)("img",{src:t.image,alt:t.title,onError:e=>{e.target.style.display="none",e.target.nextSibling.style.display="flex"}}):null,(0,bn.jsx)("div",{className:"video-card-placeholder",style:{display:t.image?"none":"flex"},children:(0,bn.jsx)(An,{})}),(0,bn.jsx)("div",{className:"video-card-overlay",children:(0,bn.jsx)(In,{size:32})}),t.duration&&(0,bn.jsxs)("span",{className:"video-duration",children:[(0,bn.jsx)(Qn,{})," ",yn(t.duration)]})]}),(0,bn.jsxs)("div",{className:"video-card-info",children:[(0,bn.jsx)("h3",{children:t.title}),(0,bn.jsxs)("div",{className:"video-meta",children:[t.program&&(0,bn.jsx)("span",{className:"video-program-tag",children:t.program}),t.date&&(0,bn.jsx)("span",{className:"video-date",children:mp(t.date)})]})]})]})}function vp(e){let{video:t,onClose:s}=e;const[n,r]=(0,i.useState)(null),[a,o]=(0,i.useState)(!0),[l,c]=(0,i.useState)(null);return(0,i.useEffect)(()=>{!async function(){try{const e=await fetch("".concat(mn,"/api/3cat/videos/").concat(t.id));if(e.ok){const t=await e.json();r(t.stream_url)}else c("No s'ha pogut obtenir el v\xeddeo")}catch(Ip){c("Error carregant el v\xeddeo")}o(!1)}()},[t.id]),(0,i.useEffect)(()=>{const e=e=>{"Escape"===e.key&&s()};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[s]),(0,bn.jsx)("div",{className:"video-player-modal",onClick:s,children:(0,bn.jsxs)("div",{className:"video-player-content",onClick:e=>e.stopPropagation(),children:[(0,bn.jsx)("button",{className:"video-player-close",onClick:s,children:"\u2715"}),(0,bn.jsxs)("div",{className:"video-player-header",children:[(0,bn.jsx)("h2",{children:t.title}),t.program&&(0,bn.jsx)("span",{className:"video-player-program",children:t.program})]}),a?(0,bn.jsxs)("div",{className:"video-player-loading",children:[(0,bn.jsx)("div",{className:"spinner"}),(0,bn.jsx)("p",{children:"Carregant v\xeddeo..."})]}):l?(0,bn.jsxs)("div",{className:"video-player-error",children:[(0,bn.jsx)("p",{children:l}),(0,bn.jsxs)("a",{href:"https://www.3cat.cat/3cat/video/".concat(t.id),target:"_blank",rel:"noopener noreferrer",className:"btn btn-primary",children:["Veure a 3Cat ",(0,bn.jsx)(xr,{})]})]}):(0,bn.jsx)("video",{className:"video-player-video",src:n,controls:!0,autoPlay:!0,playsInline:!0}),t.description&&(0,bn.jsx)("p",{className:"video-player-description",children:t.description})]})})}const yp=function(){const e=re(),{isAdmin:t,isAuthenticated:s}=Sn(),[n,r]=(0,i.useState)("grid"),[a,o]=(0,i.useState)("all"),[l,c]=(0,i.useState)(""),[d,u]=(0,i.useState)([]),[h,f]=(0,i.useState)([]),[m,p]=(0,i.useState)(null),[g,v]=(0,i.useState)(null),[y,b]=(0,i.useState)(!0),[x,E]=(0,i.useState)(null),[S,T]=(0,i.useState)("programs");(0,i.useEffect)(()=>{s&&t||e("/")},[s,t,e]);const k=(0,i.useCallback)(async()=>{b(!0),E(null);try{const e=await fetch("".concat(mn,"/api/3cat/programs?limit=100"));if(e.ok){const t=await e.json();u(t.programs||[])}else E("Error carregant programes")}catch(Ip){console.error("Error loading programs:",Ip),E("Error de connexi\xf3")}b(!1)},[]),w=(0,i.useCallback)(async()=>{b(!0),E(null);try{const e=await fetch("".concat(mn,"/api/3cat/latest?limit=50"));if(e.ok){const t=await e.json();f(t.videos||[])}else E("Error carregant v\xeddeos")}catch(Ip){console.error("Error loading videos:",Ip),E("Error de connexi\xf3")}b(!1)},[]),L=(0,i.useCallback)(async e=>{b(!0),E(null);try{const t=await fetch("".concat(mn,"/api/3cat/videos?program_id=").concat(e,"&limit=50"));if(t.ok){const e=await t.json();f(e.videos||[])}else E("Error carregant v\xeddeos")}catch(Ip){console.error("Error loading program videos:",Ip),E("Error de connexi\xf3")}b(!1)},[]),C=(0,i.useCallback)(async e=>{if(e.trim()){b(!0),E(null);try{const t=await fetch("".concat(mn,"/api/3cat/search?q=").concat(encodeURIComponent(e),"&limit=50"));if(t.ok){const e=await t.json();f(e.videos||[]),T("latest")}else E("Error cercant")}catch(Ip){console.error("Error searching:",Ip),E("Error de connexi\xf3")}b(!1)}else"programs"===S?k():w()},[S,k,w]);(0,i.useEffect)(()=>{m?L(m.id):"programs"===S?k():w()},[S,m,k,w,L]),(0,i.useEffect)(()=>{const e=setTimeout(()=>{l&&C(l)},500);return()=>clearTimeout(e)},[l,C]);const A="all"===a?d:d.filter(e=>{var t;return null===(t=e.category)||void 0===t?void 0:t.toLowerCase().includes(a)}),R=m?h.length:"programs"===S?A.length:h.length;return(0,bn.jsxs)("div",{className:"programs-page",children:[(0,bn.jsxs)("header",{className:"programs-header",children:[(0,bn.jsx)("div",{className:"programs-header-content",children:m?(0,bn.jsxs)(bn.Fragment,{children:[(0,bn.jsxs)("button",{className:"back-btn",onClick:()=>{p(null),c("")},children:[(0,bn.jsx)(Fn,{})," Tornar"]}),(0,bn.jsx)("h1",{children:m.title}),(0,bn.jsx)("p",{className:"programs-subtitle",children:m.description||"V\xeddeos del programa ".concat(m.title)})]}):(0,bn.jsxs)(bn.Fragment,{children:[(0,bn.jsx)("h1",{children:"A la carta - 3Cat"}),(0,bn.jsx)("p",{className:"programs-subtitle",children:"Programes i continguts de TV3, 3/24, 33 i m\xe9s"})]})}),!m&&(0,bn.jsxs)("div",{className:"programs-search",children:[(0,bn.jsx)(On,{}),(0,bn.jsx)("input",{type:"text",placeholder:"Cercar programes, v\xeddeos...",value:l,onChange:e=>c(e.target.value)})]})]}),!m&&!l&&(0,bn.jsxs)("div",{className:"programs-tabs",children:[(0,bn.jsx)("button",{className:"tab-btn ".concat("programs"===S?"active":""),onClick:()=>T("programs"),children:"Programes"}),(0,bn.jsx)("button",{className:"tab-btn ".concat("latest"===S?"active":""),onClick:()=>T("latest"),children:"\xdaltims v\xeddeos"})]}),(0,bn.jsxs)("div",{className:"programs-controls",children:[(0,bn.jsx)("div",{className:"programs-stats",children:(0,bn.jsxs)("span",{className:"stats-count",children:[R," ",m||"latest"===S?"v\xeddeos":"programes"]})}),(0,bn.jsxs)("div",{className:"programs-view-toggle",children:[(0,bn.jsx)("button",{className:"view-btn ".concat("grid"===n?"active":""),onClick:()=>r("grid"),title:"Vista graella",children:(0,bn.jsx)(fr,{})}),(0,bn.jsx)("button",{className:"view-btn ".concat("list"===n?"active":""),onClick:()=>r("list"),title:"Vista llista",children:(0,bn.jsx)(mr,{})})]})]}),!m&&"programs"===S&&!l&&(0,bn.jsx)("div",{className:"programs-categories",children:fp.map(e=>(0,bn.jsxs)("button",{className:"category-chip ".concat(a===e.id?"active":""),onClick:()=>o(e.id),children:[(0,bn.jsx)("span",{className:"category-icon",children:e.icon}),e.name]},e.id))}),(0,bn.jsx)("main",{className:"programs-content",children:y?(0,bn.jsxs)("div",{className:"programs-loading",children:[(0,bn.jsx)("div",{className:"spinner"}),(0,bn.jsx)("p",{children:"Carregant contingut de 3Cat..."})]}):x?(0,bn.jsxs)("div",{className:"programs-error",children:[(0,bn.jsx)(An,{}),(0,bn.jsx)("h3",{children:"Error"}),(0,bn.jsx)("p",{children:x}),(0,bn.jsx)("button",{onClick:()=>window.location.reload(),className:"btn btn-primary btn-md",children:"Tornar a intentar"})]}):0===R?(0,bn.jsxs)("div",{className:"no-content",children:[(0,bn.jsx)(An,{}),(0,bn.jsx)("p",{children:"No s'ha trobat contingut"}),l&&(0,bn.jsx)("button",{className:"btn btn-secondary btn-sm",onClick:()=>c(""),children:"Esborrar cerca"})]}):(0,bn.jsx)("div",{className:"videos-grid ".concat("list"===n?"list-view":""),children:m||"latest"===S||l?h.map(e=>(0,bn.jsx)(gp,{video:e,onClick:()=>(e=>{v(e)})(e)},e.id)):A.map(e=>(0,bn.jsx)(pp,{program:e,onClick:()=>(e=>{p(e)})(e)},e.id))})}),g&&(0,bn.jsx)(vp,{video:g,onClose:()=>v(null)})]})};const bp=function(){var e,t;const[s,n]=(0,i.useState)(!0),[r,a]=(0,i.useState)(""),[o,l]=(0,i.useState)(""),[c,d]=(0,i.useState)(""),[u,h]=(0,i.useState)(""),[f,m]=(0,i.useState)(""),[p,g]=(0,i.useState)(!1),{login:v,register:y}=Sn(),b=re(),x=(null===(e=se().state)||void 0===e||null===(t=e.from)||void 0===t?void 0:t.pathname)||"/";return(0,bn.jsx)("div",{className:"login-page",children:(0,bn.jsxs)("div",{className:"login-container",children:[(0,bn.jsxs)("div",{className:"login-header",children:[(0,bn.jsx)("img",{src:"/img/caduceus.png",alt:"Hermes",className:"login-logo"}),(0,bn.jsx)("h1",{children:"Hermes"}),(0,bn.jsx)("p",{children:s?"Inicia sessi\xf3 per continuar":"Crea un compte nou"})]}),(0,bn.jsxs)("form",{onSubmit:async e=>{let t;e.preventDefault(),m(""),g(!0),t=s?await v(r,o):await y(r,o,c,u),g(!1),t.success?b(x,{replace:!0}):m(t.error)},className:"login-form",children:[f&&(0,bn.jsx)("div",{className:"login-error",children:f}),(0,bn.jsxs)("div",{className:"form-group",children:[(0,bn.jsx)("label",{htmlFor:"username",children:"Usuari"}),(0,bn.jsx)("input",{type:"text",id:"username",value:r,onChange:e=>a(e.target.value),placeholder:"El teu nom d'usuari",required:!0,autoComplete:"username"})]}),!s&&(0,bn.jsxs)(bn.Fragment,{children:[(0,bn.jsxs)("div",{className:"form-group",children:[(0,bn.jsx)("label",{htmlFor:"displayName",children:"Nom a mostrar"}),(0,bn.jsx)("input",{type:"text",id:"displayName",value:u,onChange:e=>h(e.target.value),placeholder:"Com vols que et diguem?"})]}),(0,bn.jsxs)("div",{className:"form-group",children:[(0,bn.jsx)("label",{htmlFor:"email",children:"Email (opcional)"}),(0,bn.jsx)("input",{type:"email",id:"email",value:c,onChange:e=>d(e.target.value),placeholder:"email@exemple.com",autoComplete:"email"})]})]}),(0,bn.jsxs)("div",{className:"form-group",children:[(0,bn.jsx)("label",{htmlFor:"password",children:"Contrasenya"}),(0,bn.jsx)("input",{type:"password",id:"password",value:o,onChange:e=>l(e.target.value),placeholder:"La teva contrasenya",required:!0,autoComplete:s?"current-password":"new-password"})]}),(0,bn.jsx)("button",{type:"submit",className:"login-button",disabled:p,children:p?"Carregant...":s?"Iniciar sessi\xf3":"Crear compte"})]}),(0,bn.jsx)("div",{className:"login-footer",children:(0,bn.jsxs)("p",{children:[s?"No tens compte?":"Ja tens compte?",(0,bn.jsx)("button",{type:"button",className:"toggle-mode",onClick:()=>{n(!s),m("")},children:s?"Registra't":"Inicia sessi\xf3"})]})}),(0,bn.jsx)("button",{type:"button",className:"skip-login",onClick:()=>b("/"),children:"Continuar sense compte \u2192"})]})})};fn.defaults.baseURL=mn;const xp=[{code:"ca",name:"Catala"},{code:"es",name:"Castellano"},{code:"en",name:"English"},{code:"fr",name:"Francais"},{code:"de",name:"Deutsch"},{code:"it",name:"Italiano"},{code:"pt",name:"Portugues"},{code:"ja",name:"Japanese"},{code:"ko",name:"Korean"},{code:"zh",name:"Chinese"}],Ep=[{value:"auto",label:"Automatic"},{value:"2160p",label:"4K (2160p)"},{value:"1080p",label:"Full HD (1080p)"},{value:"720p",label:"HD (720p)"},{value:"480p",label:"SD (480p)"}];const Sp=function(){var e,t;const{user:s,isAdmin:n,logout:r,updateProfile:a}=Sn(),o=re(),[l,c]=(0,i.useState)("profile"),[d,u]=(0,i.useState)(!1),[h,f]=(0,i.useState)(null),[m,p]=(0,i.useState)((null===s||void 0===s?void 0:s.display_name)||""),[g,v]=(0,i.useState)((null===s||void 0===s?void 0:s.email)||""),[y,b]=(0,i.useState)(!1),[x,E]=(0,i.useState)((null===s||void 0===s?void 0:s.avatar)||""),[S,T]=(0,i.useState)(""),[k,w]=(0,i.useState)(!1),[L,C]=(0,i.useState)(1),[A,R]=(0,i.useState)({x:0,y:0}),[_,N]=(0,i.useState)(!1),[I,j]=(0,i.useState)({x:0,y:0}),[P,D]=(0,i.useState)(""),[M,O]=(0,i.useState)(""),[F,U]=(0,i.useState)(""),[B,G]=(0,i.useState)(localStorage.getItem("hermes_subtitle_lang")||"ca"),[V,z]=(0,i.useState)(localStorage.getItem("hermes_audio_lang")||"ca"),[H,K]=(0,i.useState)(localStorage.getItem("hermes_quality")||"auto"),[W,q]=(0,i.useState)("false"!==localStorage.getItem("hermes_autoplay")),[Y,X]=(0,i.useState)("false"!==localStorage.getItem("hermes_skip_intros")),[Q,$]=(0,i.useState)([]),[J,Z]=(0,i.useState)([]),[ee,te]=(0,i.useState)(1),[se,ne]=(0,i.useState)(7),[ie,ae]=(0,i.useState)(null);(0,i.useEffect)(()=>{s?(p(s.display_name||""),v(s.email||""),E(s.avatar||""),n&&oe()):o("/login")},[s,n,o]);const oe=async()=>{try{const[e,t]=await Promise.all([fn.get("".concat(mn,"/api/admin/users")),fn.get("".concat(mn,"/api/invitations"))]);$(e.data.users||[]),Z(t.data.invitations||[])}catch(Np){console.error("Error loading admin data:",Np)}},le=function(e){f({text:e,type:arguments.length>1&&void 0!==arguments[1]?arguments[1]:"success"}),setTimeout(()=>f(null),3e3)},ce=async()=>{u(!0);try{const e=await a({avatar:""});e.success?(E(""),T(""),le("Foto de perfil eliminada"),b(!1)):le(e.error,"error")}catch(Np){le("Error eliminant la foto","error")}u(!1)},de=e=>{if(!_)return;e.preventDefault();const t=e.clientX-I.x,s=e.clientY-I.y,n=150;R({x:Math.max(-150,Math.min(n,t)),y:Math.max(-150,Math.min(n,s))})},ue=()=>{N(!1)};return s?(0,bn.jsxs)("div",{className:"profile-page",children:[h&&(0,bn.jsx)("div",{className:"profile-message ".concat(h.type),children:h.text}),(0,bn.jsxs)("div",{className:"profile-container",children:[(0,bn.jsxs)("div",{className:"profile-sidebar",children:[(0,bn.jsxs)("div",{className:"profile-avatar",children:[(0,bn.jsxs)("div",{className:"avatar-wrapper",children:[(0,bn.jsx)("div",{className:"avatar-circle ".concat(x?"has-image":""),children:x?(0,bn.jsx)("img",{src:x,alt:"Avatar"}):(null===(e=s.display_name)||void 0===e?void 0:e.charAt(0).toUpperCase())||(null===(t=s.username)||void 0===t?void 0:t.charAt(0).toUpperCase())}),(0,bn.jsx)("button",{className:"avatar-edit-btn",onClick:()=>{T(x),b(!0)},title:"Canviar foto",children:(0,bn.jsx)(cr,{})})]}),(0,bn.jsx)("h2",{children:s.display_name||s.username}),(0,bn.jsxs)("p",{children:["@",s.username]})]}),(0,bn.jsxs)("nav",{className:"profile-nav",children:[(0,bn.jsxs)("button",{className:"profile"===l?"active":"",onClick:()=>c("profile"),children:[(0,bn.jsx)(zn,{})," Perfil"]}),(0,bn.jsxs)("button",{className:"preferences"===l?"active":"",onClick:()=>c("preferences"),children:[(0,bn.jsx)(Bn,{})," Preferencies"]}),(0,bn.jsxs)("button",{className:"security"===l?"active":"",onClick:()=>c("security"),children:[(0,bn.jsx)($n,{})," Seguretat"]}),n&&(0,bn.jsxs)("button",{className:"admin"===l?"active":"",onClick:()=>c("admin"),children:[(0,bn.jsx)(Zn,{})," Administracio"]}),(0,bn.jsxs)("button",{className:"logout-btn",onClick:()=>{r(),o("/")},children:[(0,bn.jsx)(Gn,{})," Tancar sessio"]})]})]}),(0,bn.jsxs)("div",{className:"profile-content",children:["profile"===l&&(0,bn.jsxs)("div",{className:"profile-section",children:[(0,bn.jsx)("h1",{children:"Perfil"}),(0,bn.jsxs)("form",{onSubmit:async e=>{e.preventDefault(),u(!0);try{const e=await a({display_name:m,email:g});e.success?le("Perfil actualitzat correctament"):le(e.error,"error")}catch(e){le("Error actualitzant el perfil","error")}u(!1)},children:[(0,bn.jsxs)("div",{className:"form-group",children:[(0,bn.jsx)("label",{children:"Nom d'usuari"}),(0,bn.jsx)("input",{type:"text",value:s.username,disabled:!0,className:"disabled"})]}),(0,bn.jsxs)("div",{className:"form-group",children:[(0,bn.jsx)("label",{children:"Nom a mostrar"}),(0,bn.jsx)("input",{type:"text",value:m,onChange:e=>p(e.target.value),placeholder:"El teu nom"})]}),(0,bn.jsxs)("div",{className:"form-group",children:[(0,bn.jsx)("label",{children:"Email"}),(0,bn.jsx)("input",{type:"email",value:g,onChange:e=>v(e.target.value),placeholder:"email@example.com"})]}),(0,bn.jsx)("button",{type:"submit",className:"primary-btn",disabled:d,children:d?"Guardant...":"Guardar canvis"})]})]}),"preferences"===l&&(0,bn.jsxs)("div",{className:"profile-section",children:[(0,bn.jsx)("h1",{children:"Preferencies de reproduccio"}),(0,bn.jsxs)("div",{className:"pref-group",children:[(0,bn.jsx)("h3",{children:"Idioma"}),(0,bn.jsxs)("div",{className:"pref-row",children:[(0,bn.jsx)("label",{children:"Idioma d'audio preferit"}),(0,bn.jsx)("select",{value:V,onChange:e=>z(e.target.value),children:xp.map(e=>(0,bn.jsx)("option",{value:e.code,children:e.name},e.code))})]}),(0,bn.jsxs)("div",{className:"pref-row",children:[(0,bn.jsx)("label",{children:"Idioma de subtitols preferit"}),(0,bn.jsxs)("select",{value:B,onChange:e=>G(e.target.value),children:[(0,bn.jsx)("option",{value:"off",children:"Desactivats"}),xp.map(e=>(0,bn.jsx)("option",{value:e.code,children:e.name},e.code))]})]})]}),(0,bn.jsxs)("div",{className:"pref-group",children:[(0,bn.jsx)("h3",{children:"Qualitat"}),(0,bn.jsxs)("div",{className:"pref-row",children:[(0,bn.jsx)("label",{children:"Qualitat per defecte"}),(0,bn.jsx)("select",{value:H,onChange:e=>K(e.target.value),children:Ep.map(e=>(0,bn.jsx)("option",{value:e.value,children:e.label},e.value))})]})]}),(0,bn.jsxs)("div",{className:"pref-group",children:[(0,bn.jsx)("h3",{children:"Reproduccio"}),(0,bn.jsxs)("div",{className:"pref-row toggle",children:[(0,bn.jsx)("label",{children:"Reproduir seguent episodi automaticament"}),(0,bn.jsx)("button",{className:"toggle-btn ".concat(W?"active":""),onClick:()=>q(!W),children:(0,bn.jsx)("span",{className:"toggle-slider"})})]}),(0,bn.jsxs)("div",{className:"pref-row toggle",children:[(0,bn.jsx)("label",{children:"Saltar intros automaticament"}),(0,bn.jsx)("button",{className:"toggle-btn ".concat(Y?"active":""),onClick:()=>X(!Y),children:(0,bn.jsx)("span",{className:"toggle-slider"})})]})]}),(0,bn.jsx)("button",{className:"primary-btn",onClick:()=>{localStorage.setItem("hermes_subtitle_lang",B),localStorage.setItem("hermes_audio_lang",V),localStorage.setItem("hermes_quality",H),localStorage.setItem("hermes_autoplay",W.toString()),localStorage.setItem("hermes_skip_intros",Y.toString()),le("Preferencies guardades")},children:"Guardar preferencies"})]}),"security"===l&&(0,bn.jsxs)("div",{className:"profile-section",children:[(0,bn.jsx)("h1",{children:"Seguretat"}),(0,bn.jsxs)("form",{onSubmit:async e=>{if(e.preventDefault(),M===F){u(!0);try{await fn.put("".concat(mn,"/api/auth/password"),{old_password:P,new_password:M}),le("Contrasenya canviada correctament"),D(""),O(""),U("")}catch(e){var t,s;le((null===(t=e.response)||void 0===t||null===(s=t.data)||void 0===s?void 0:s.detail)||"Error canviant la contrasenya","error")}u(!1)}else le("Les contrasenyes no coincideixen","error")},children:[(0,bn.jsxs)("div",{className:"form-group",children:[(0,bn.jsx)("label",{children:"Contrasenya actual"}),(0,bn.jsx)("input",{type:"password",value:P,onChange:e=>D(e.target.value),required:!0})]}),(0,bn.jsxs)("div",{className:"form-group",children:[(0,bn.jsx)("label",{children:"Nova contrasenya"}),(0,bn.jsx)("input",{type:"password",value:M,onChange:e=>O(e.target.value),required:!0})]}),(0,bn.jsxs)("div",{className:"form-group",children:[(0,bn.jsx)("label",{children:"Confirmar nova contrasenya"}),(0,bn.jsx)("input",{type:"password",value:F,onChange:e=>U(e.target.value),required:!0})]}),(0,bn.jsx)("button",{type:"submit",className:"primary-btn",disabled:d,children:d?"Canviant...":"Canviar contrasenya"})]})]}),"admin"===l&&n&&(0,bn.jsxs)("div",{className:"profile-section admin-section",children:[(0,bn.jsx)("h1",{children:"Administracio"}),(0,bn.jsxs)("div",{className:"admin-block",children:[(0,bn.jsx)("h2",{children:"Invitacions"}),(0,bn.jsxs)("div",{className:"invite-create",children:[(0,bn.jsxs)("div",{className:"invite-inputs",children:[(0,bn.jsxs)("div",{className:"form-group inline",children:[(0,bn.jsx)("label",{children:"Usos maxims"}),(0,bn.jsx)("input",{type:"number",min:"1",max:"100",value:ee,onChange:e=>te(parseInt(e.target.value))})]}),(0,bn.jsxs)("div",{className:"form-group inline",children:[(0,bn.jsx)("label",{children:"Dies de validesa"}),(0,bn.jsx)("input",{type:"number",min:"1",max:"365",value:se,onChange:e=>ne(parseInt(e.target.value))})]})]}),(0,bn.jsx)("button",{className:"primary-btn",onClick:async()=>{try{await fn.post("".concat(mn,"/api/invitations"),{max_uses:ee,expires_days:se}),le("Invitacio creada"),oe()}catch(Np){var e,t;le((null===(e=Np.response)||void 0===e||null===(t=e.data)||void 0===t?void 0:t.detail)||"Error creant invitacio","error")}},children:"Crear invitacio"})]}),J.length>0&&(0,bn.jsx)("div",{className:"invite-list",children:J.map(e=>(0,bn.jsxs)("div",{className:"invite-item",children:[(0,bn.jsxs)("div",{className:"invite-code",children:[(0,bn.jsx)("code",{children:e.code}),(0,bn.jsx)("button",{className:"copy-btn",onClick:()=>(e=>{const t="".concat(window.location.origin,"/login?invite=").concat(e);navigator.clipboard.writeText(t),ae(e),setTimeout(()=>ae(null),2e3)})(e.code),title:"Copiar enllac d'invitacio",children:ie===e.code?(0,bn.jsx)(Jn,{}):(0,bn.jsx)(er,{})})]}),(0,bn.jsxs)("div",{className:"invite-meta",children:[(0,bn.jsxs)("span",{children:[e.uses,"/",e.max_uses," usos"]}),(0,bn.jsxs)("span",{children:["Caduca: ",new Date(e.expires_at).toLocaleDateString("ca")]})]}),(0,bn.jsx)("button",{className:"delete-btn",onClick:()=>(async e=>{try{await fn.delete("".concat(mn,"/api/invitations/").concat(e)),le("Invitacio eliminada"),oe()}catch(Np){le("Error eliminant invitacio","error")}})(e.id),children:(0,bn.jsx)(tr,{})})]},e.id))})]}),(0,bn.jsxs)("div",{className:"admin-block",children:[(0,bn.jsxs)("h2",{children:["Usuaris (",Q.length,")"]}),(0,bn.jsx)("div",{className:"users-list",children:Q.map(e=>{var t,n;return(0,bn.jsxs)("div",{className:"user-item ".concat(e.is_active?"":"inactive"),children:[(0,bn.jsxs)("div",{className:"user-info",children:[(0,bn.jsx)("div",{className:"user-avatar",children:(null===(t=e.display_name)||void 0===t?void 0:t.charAt(0).toUpperCase())||(null===(n=e.username)||void 0===n?void 0:n.charAt(0).toUpperCase())}),(0,bn.jsxs)("div",{children:[(0,bn.jsx)("h4",{children:e.display_name||e.username}),(0,bn.jsxs)("p",{children:["@",e.username," ",e.is_admin&&(0,bn.jsx)("span",{className:"admin-badge",children:"Admin"}),e.is_premium&&(0,bn.jsx)("span",{className:"premium-badge",children:"Premium"})]})]})]}),e.id!==s.id&&(0,bn.jsxs)("div",{className:"user-actions",children:[(0,bn.jsx)("button",{className:"action-btn ".concat(e.is_active?"warning":"success"),onClick:()=>(async(e,t)=>{try{await fn.put("".concat(mn,"/api/admin/users/").concat(e,"/toggle-active?active=").concat(t)),le("Usuari ".concat(t?"activat":"desactivat")),oe()}catch(Np){var s,n;le((null===(s=Np.response)||void 0===s||null===(n=s.data)||void 0===n?void 0:n.detail)||"Error","error")}})(e.id,!e.is_active),children:e.is_active?"Desactivar":"Activar"}),(0,bn.jsx)("button",{className:"action-btn ".concat(e.is_premium?"warning":"premium"),onClick:()=>(async(e,t)=>{try{await fn.put("".concat(mn,"/api/admin/users/").concat(e,"/toggle-premium?is_premium=").concat(t)),le("Usuari ".concat(t?"ara \xe9s":"ja no \xe9s"," premium")),oe()}catch(Np){var s,n;le((null===(s=Np.response)||void 0===s||null===(n=s.data)||void 0===n?void 0:n.detail)||"Error","error")}})(e.id,!e.is_premium),children:e.is_premium?"Treure premium":"Fer premium"}),(0,bn.jsx)("button",{className:"action-btn danger",onClick:()=>(async e=>{if(window.confirm("Segur que vols eliminar aquest usuari?"))try{await fn.delete("".concat(mn,"/api/admin/users/").concat(e)),le("Usuari eliminat"),oe()}catch(Np){var t,s;le((null===(t=Np.response)||void 0===t||null===(s=t.data)||void 0===s?void 0:s.detail)||"Error","error")}})(e.id),children:"Eliminar"})]})]},e.id)})})]})]})]})]}),y&&(0,bn.jsx)("div",{className:"avatar-modal-overlay",onClick:()=>{_||(b(!1),w(!1),T(""))},onMouseMove:_?de:void 0,onMouseUp:_?ue:void 0,children:(0,bn.jsx)("div",{className:"avatar-modal",onClick:e=>e.stopPropagation(),children:k?(0,bn.jsxs)(bn.Fragment,{children:[(0,bn.jsx)("h3",{children:"Ajusta la imatge"}),(0,bn.jsx)("div",{className:"crop-editor",onMouseDown:e=>{N(!0),j({x:e.clientX-A.x,y:e.clientY-A.y})},onMouseMove:de,onMouseUp:ue,children:(0,bn.jsxs)("div",{className:"crop-container",children:[(0,bn.jsx)("img",{src:S,alt:"Crop",style:{transform:"translate(calc(-50% + ".concat(A.x,"px), calc(-50% + ").concat(A.y,"px)) scale(").concat(L,")"),cursor:_?"grabbing":"grab"},draggable:!1}),(0,bn.jsx)("div",{className:"crop-overlay",children:(0,bn.jsx)("div",{className:"crop-circle"})})]})}),(0,bn.jsxs)("div",{className:"crop-controls",children:[(0,bn.jsx)("label",{children:"Zoom"}),(0,bn.jsx)("input",{type:"range",min:"0.3",max:"3",step:"0.05",value:L,onChange:e=>C(parseFloat(e.target.value))}),(0,bn.jsxs)("span",{children:[Math.round(100*L),"%"]})]}),(0,bn.jsxs)("div",{className:"avatar-modal-actions",children:[(0,bn.jsx)("button",{className:"cancel-btn",onClick:()=>{w(!1),T("")},children:"Cancel\xb7lar"}),(0,bn.jsx)("button",{className:"save-btn",onClick:()=>{const e=document.createElement("canvas"),t=e.getContext("2d"),s=new Image;s.crossOrigin="anonymous",s.onload=()=>{const n=200;e.width=n,e.height=n;const r=L,i=Math.min(s.width,s.height)/r,a=s.width/2,o=s.height/2,l=a-i/2-A.x/100*(i/2),c=o-i/2-A.y/100*(i/2);t.drawImage(s,l,c,i,i,0,0,n,n);const d=e.toDataURL("image/jpeg",.9);T(d),w(!1)},s.onerror=()=>{le("Error processant la imatge","error"),w(!1)},s.src=S},children:"Aplicar"})]})]}):S&&S.startsWith("data:")?(0,bn.jsxs)(bn.Fragment,{children:[(0,bn.jsx)("h3",{children:"Previsualitzaci\xf3"}),(0,bn.jsx)("div",{className:"avatar-preview large",children:(0,bn.jsx)("img",{src:S,alt:"Preview"})}),(0,bn.jsxs)("div",{className:"avatar-modal-actions",children:[(0,bn.jsx)("button",{className:"cancel-btn",onClick:()=>T(""),children:"Canviar imatge"}),x&&(0,bn.jsx)("button",{className:"remove-btn",onClick:ce,disabled:d,children:"Eliminar"}),(0,bn.jsx)("button",{className:"save-btn",onClick:async()=>{u(!0);try{const e=await a({avatar:S});e.success?(E(S),le("Foto de perfil actualitzada"),b(!1)):le(e.error,"error")}catch(Np){le("Error actualitzant la foto","error")}u(!1)},disabled:d,children:d?"Guardant...":"Guardar"})]})]}):(0,bn.jsxs)(bn.Fragment,{children:[(0,bn.jsx)("h3",{children:"Canviar foto de perfil"}),(0,bn.jsxs)("div",{className:"avatar-upload-section",children:[(0,bn.jsxs)("label",{className:"file-upload-btn",children:[(0,bn.jsx)("input",{type:"file",accept:"image/*",onChange:e=>{const t=e.target.files[0];if(!t)return;if(!t.type.startsWith("image/"))return void le("Si us plau, selecciona una imatge","error");if(t.size>5242880)return void le("La imatge no pot superar 5MB","error");const s=new FileReader;s.onload=e=>{T(e.target.result),C(1),R({x:0,y:0}),w(!0)},s.readAsDataURL(t)},style:{display:"none"}}),"Pujar imatge local"]}),(0,bn.jsx)("span",{className:"upload-divider",children:"o"})]}),(0,bn.jsxs)("div",{className:"form-group url-input-group",children:[(0,bn.jsx)("label",{children:"URL de la imatge"}),(0,bn.jsxs)("div",{className:"url-input-row",children:[(0,bn.jsx)("input",{type:"url",value:S,onChange:e=>T(e.target.value),placeholder:"https://exemple.com/foto.jpg"}),S&&(0,bn.jsx)("button",{className:"edit-url-btn",onClick:()=>{S&&!S.startsWith("data:")&&(C(1),R({x:0,y:0}),w(!0))},title:"Editar imatge",children:"Editar"})]})]}),(0,bn.jsxs)("div",{className:"avatar-modal-actions",children:[(0,bn.jsx)("button",{className:"cancel-btn",onClick:()=>b(!1),children:"Cancel\xb7lar"}),x&&(0,bn.jsx)("button",{className:"remove-btn",onClick:ce,disabled:d,children:"Eliminar actual"})]})]})})})]}):null},Tp=()=>(0,bn.jsxs)("svg",{viewBox:"0 0 500 500",fill:"currentColor",children:[(0,bn.jsx)("path",{d:"M250 500C111.93 500 0 388.07 0 250S111.93 0 250 0s250 111.93 250 250-111.93 250-250 250zm0-450C139.54 50 50 139.54 50 250s89.54 200 200 200 200-89.54 200-200S360.46 50 250 50z"}),(0,bn.jsx)("circle",{cx:"150",cy:"250",r:"60"}),(0,bn.jsx)("circle",{cx:"250",cy:"250",r:"60"}),(0,bn.jsx)("circle",{cx:"350",cy:"250",r:"60"})]}),kp=()=>(0,bn.jsx)("svg",{viewBox:"0 0 24 24",fill:"currentColor",children:(0,bn.jsx)("path",{d:"M8.273 7.247v8.423l-2.103-.003v-5.216l-2.03 2.404-1.989-2.458-.02 5.285H0V7.247h2.09l1.9 2.442 1.903-2.442h2.38zm5.908 0H9.152v8.423h5.03v-2.07h-2.845v-1.349h2.641v-2.074h-2.641V9.32h2.844V7.247zm5.125 0h-2.186v8.423h2.186v-2.812l1.509 2.812h2.617l-1.822-3.206 1.67-3.012h-2.454l-1.52 2.834V7.247z"})}),wp=()=>(0,bn.jsx)("svg",{viewBox:"0 0 24 24",fill:"currentColor",children:(0,bn.jsx)("path",{d:"M12.027 11.573c-.545.178-1.09.267-1.635.267-1.363 0-2.534-.534-3.512-1.602-.979-1.068-1.468-2.424-1.468-4.068 0-1.644.489-3 1.468-4.068.978-1.068 2.149-1.602 3.512-1.602.544 0 1.09.089 1.635.267V0h1.635v11.573h-1.635zm0-8.673c-.545-.178-1.09-.267-1.635-.267-.817 0-1.507.356-2.07 1.068-.563.712-.844 1.602-.844 2.67s.281 1.958.844 2.67c.563.712 1.253 1.068 2.07 1.068.544 0 1.09-.089 1.635-.267V2.9zM19.591 24h-1.635v-5.8c-.545.178-1.09.267-1.635.267-1.363 0-2.534-.534-3.512-1.602-.979-1.068-1.468-2.424-1.468-4.068 0-1.644.489-3 1.468-4.068.978-1.068 2.149-1.602 3.512-1.602.544 0 1.09.089 1.635.267V7.127h1.635V24zm-1.635-15.1c-.545-.178-1.09-.267-1.635-.267-.817 0-1.507.356-2.07 1.068-.563.712-.844 1.602-.844 2.67s.281 1.958.844 2.67c.563.712 1.253 1.068 2.07 1.068.544 0 1.09-.089 1.635-.267V8.9z"})});const Lp=function(){var e,t,s,n,r,a,o,l,c,d,u;const{isAuthenticated:h}=Sn(),[f,m]=(0,i.useState)([]),[p,g]=(0,i.useState)(!0),[v,y]=(0,i.useState)("all"),b=re(),[x,E]=(0,i.useState)(!1),[S,T]=(0,i.useState)(null),[k,w]=(0,i.useState)(""),[L,C]=(0,i.useState)(!1),[A,R]=(0,i.useState)(null),[_,N]=(0,i.useState)(null),[I,j]=(0,i.useState)(null),[P,D]=(0,i.useState)(!1),[M,O]=(0,i.useState)({current:0,total:0}),F=(0,i.useCallback)(async()=>{if(h)try{const e=await fn.get("".concat(mn,"/api/user/watchlist"));m(e.data||[])}catch(e){console.error("Error carregant watchlist:",e)}finally{g(!1)}else g(!1)},[h]);(0,i.useEffect)(()=>{F()},[F]);const U=e=>{const t="movie"===e.media_type?"movies":"series";b("/".concat(t,"/tmdb-").concat(e.tmdb_id))},B={letterboxd:{name:"Letterboxd",icon:Tp,color:"#00e054",description:"Importa la teva watchlist de pel\xb7l\xedcules",placeholder:"Nom d'usuari de Letterboxd",urlExample:"letterboxd.com/usuari/watchlist"},myanimelist:{name:"MyAnimeList",icon:kp,color:"#2e51a2",description:"Importa els animes que est\xe0s veient",placeholder:"Nom d'usuari de MAL",urlExample:"myanimelist.net/animelist/usuari"},goodreads:{name:"Goodreads",icon:wp,color:"#553b08",description:"Importa els llibres per llegir",placeholder:"ID d'usuari de Goodreads",urlExample:"goodreads.com/user/show/123456789"}},G=()=>{E(!1),T(null),w(""),R(null),N(null),j(null),O({current:0,total:0})},V=async()=>{if(k.trim()){D(!0),N(null),j(null);try{const e=await fn.post("".concat(mn,"/api/import/external/preview"),{username:k.trim(),platform:S});0===e.data.total_items?N("No s'han trobat elements per importar. Comprova el nom d'usuari."):j(e.data)}catch(s){var e,t;console.error("Error preview:",s),N((null===(e=s.response)||void 0===e||null===(t=e.data)||void 0===t?void 0:t.detail)||"Error al cercar. Comprova el nom d'usuari.")}finally{D(!1)}}else N("Cal introduir un nom d'usuari")},z="all"===v?f:f.filter(e=>e.media_type===v);return h?p?(0,bn.jsx)("div",{className:"watchlist-container",children:(0,bn.jsx)("div",{className:"loading-screen",children:(0,bn.jsx)("div",{className:"loading-spinner"})})}):(0,bn.jsxs)("div",{className:"watchlist-container",children:[(0,bn.jsxs)("div",{className:"watchlist-header",children:[(0,bn.jsxs)("h1",{children:[(0,bn.jsx)(Mn,{}),"La meva llista"]}),(0,bn.jsxs)("p",{className:"watchlist-subtitle",children:[f.length," ",1===f.length?"t\xedtol":"t\xedtols"," guardats"]})]}),(0,bn.jsxs)("div",{className:"import-section",children:[(0,bn.jsxs)("div",{className:"import-header",children:[(0,bn.jsx)(Yn,{}),(0,bn.jsx)("span",{children:"Importar des de..."})]}),(0,bn.jsx)("div",{className:"import-buttons",children:Object.entries(B).map(e=>{let[t,s]=e;const n=s.icon;return(0,bn.jsxs)("button",{className:"import-btn",style:{"--platform-color":s.color},onClick:()=>(e=>{T(e),w(""),R(null),N(null),j(null),O({current:0,total:0}),E(!0)})(t),children:[(0,bn.jsx)(n,{}),(0,bn.jsx)("span",{children:s.name})]},t)})})]}),f.length>0&&(0,bn.jsxs)("div",{className:"watchlist-filters",children:[(0,bn.jsxs)("button",{className:"filter-btn ".concat("all"===v?"active":""),onClick:()=>y("all"),children:["Tot (",f.length,")"]}),(0,bn.jsxs)("button",{className:"filter-btn ".concat("movie"===v?"active":""),onClick:()=>y("movie"),children:[(0,bn.jsx)(Ln,{}),"Pel\xb7l\xedcules (",f.filter(e=>"movie"===e.media_type).length,")"]}),(0,bn.jsxs)("button",{className:"filter-btn ".concat("series"===v?"active":""),onClick:()=>y("series"),children:[(0,bn.jsx)(Cn,{}),"S\xe8ries (",f.filter(e=>"series"===e.media_type).length,")"]})]}),0===z.length?(0,bn.jsxs)("div",{className:"watchlist-empty",children:[(0,bn.jsx)(Mn,{}),(0,bn.jsx)("h2",{children:"La teva llista est\xe0 buida"}),(0,bn.jsx)("p",{children:"Afegeix pel\xb7l\xedcules i s\xe8ries des de les p\xe0gines de detalls"}),(0,bn.jsx)("button",{onClick:()=>b("/"),className:"browse-btn",children:"Explorar contingut"})]}):(0,bn.jsx)("div",{className:"watchlist-grid",children:z.map(e=>(0,bn.jsxs)("div",{className:"watchlist-card",children:[(0,bn.jsxs)("div",{className:"watchlist-poster",onClick:()=>U(e),children:[e.poster_path?(0,bn.jsx)("img",{src:"https://image.tmdb.org/t/p/w500".concat(e.poster_path),alt:e.title}):(0,bn.jsx)("div",{className:"poster-placeholder",children:"movie"===e.media_type?(0,bn.jsx)(Ln,{}):(0,bn.jsx)(Cn,{})}),(0,bn.jsx)("div",{className:"card-overlay",children:(0,bn.jsx)("button",{className:"play-btn",onClick:t=>{t.stopPropagation(),(e=>{"movie"===e.media_type?b("/debrid/movie/".concat(e.tmdb_id)):b("/debrid/tv/".concat(e.tmdb_id,"?s=1&e=1"))})(e)},children:(0,bn.jsx)(In,{})})}),(0,bn.jsx)("div",{className:"media-type-badge",children:"movie"===e.media_type?"Pel\xb7l\xedcula":"S\xe8rie"})]}),(0,bn.jsxs)("div",{className:"watchlist-info",children:[(0,bn.jsx)("h3",{onClick:()=>U(e),children:e.title}),(0,bn.jsxs)("div",{className:"watchlist-meta",children:[e.year&&(0,bn.jsx)("span",{className:"year",children:e.year}),e.rating&&(0,bn.jsxs)("span",{className:"rating",children:[(0,bn.jsx)(Pn,{})," ",e.rating.toFixed(1)]})]}),(0,bn.jsxs)("button",{className:"remove-btn",onClick:()=>(async e=>{try{await fn.delete("".concat(mn,"/api/user/watchlist/").concat(e.tmdb_id,"?media_type=").concat(e.media_type)),m(t=>t.filter(t=>t.id!==e.id))}catch(t){console.error("Error eliminant de watchlist:",t)}})(e),title:"Eliminar de la llista",children:[(0,bn.jsx)(tr,{}),"Eliminar"]})]})]},e.id))}),x&&S&&(0,bn.jsx)("div",{className:"import-modal-overlay",onClick:G,children:(0,bn.jsxs)("div",{className:"import-modal",onClick:e=>e.stopPropagation(),children:[(0,bn.jsx)("button",{className:"modal-close",onClick:G,children:(0,bn.jsx)(qn,{})}),(0,bn.jsxs)("div",{className:"modal-header",style:{"--platform-color":B[S].color},children:[i.createElement(B[S].icon),(0,bn.jsxs)("h2",{children:["Importar de ",B[S].name]}),(0,bn.jsx)("p",{children:B[S].description})]}),(0,bn.jsx)("div",{className:"modal-content",children:A?(0,bn.jsxs)("div",{className:"import-results",children:[(0,bn.jsxs)("div",{className:"results-summary",children:[(0,bn.jsxs)("div",{className:"result-stat success",children:[(0,bn.jsx)(Jn,{}),(0,bn.jsx)("span",{children:(null===(t=A.results)||void 0===t||null===(s=t.found)||void 0===s?void 0:s.length)||0}),(0,bn.jsx)("label",{children:"Afegits"})]}),(0,bn.jsxs)("div",{className:"result-stat existing",children:[(0,bn.jsx)(Mn,{}),(0,bn.jsx)("span",{children:(null===(n=A.results)||void 0===n||null===(r=n.already_in_watchlist)||void 0===r?void 0:r.length)||0}),(0,bn.jsx)("label",{children:"Ja existien"})]}),(0,bn.jsxs)("div",{className:"result-stat warning",children:[(0,bn.jsx)(dr,{}),(0,bn.jsx)("span",{children:(null===(a=A.results)||void 0===a||null===(o=a.not_found)||void 0===o?void 0:o.length)||0}),(0,bn.jsx)("label",{children:"No trobats"})]})]}),(null===(l=A.results)||void 0===l||null===(c=l.found)||void 0===c?void 0:c.length)>0&&(0,bn.jsxs)("div",{className:"results-list",children:[(0,bn.jsx)("h4",{children:"Afegits a la llista:"}),(0,bn.jsxs)("ul",{children:[A.results.found.slice(0,10).map((e,t)=>(0,bn.jsxs)("li",{children:["movie"===e.type&&(0,bn.jsx)(Ln,{}),"series"===e.type&&(0,bn.jsx)(Cn,{}),"book"===e.type&&(0,bn.jsx)(Rn,{}),(0,bn.jsx)("span",{children:e.title}),e.year&&(0,bn.jsxs)("span",{className:"item-year",children:["(",e.year,")"]})]},t)),A.results.found.length>10&&(0,bn.jsxs)("li",{className:"more-items",children:["...i ",A.results.found.length-10," m\xe9s"]})]})]}),(null===(d=A.results)||void 0===d||null===(u=d.not_found)||void 0===u?void 0:u.length)>0&&(0,bn.jsxs)("div",{className:"results-list not-found",children:[(0,bn.jsx)("h4",{children:"No s'han trobat:"}),(0,bn.jsxs)("ul",{children:[A.results.not_found.slice(0,5).map((e,t)=>(0,bn.jsx)("li",{children:(0,bn.jsx)("span",{children:e.title})},t)),A.results.not_found.length>5&&(0,bn.jsxs)("li",{className:"more-items",children:["...i ",A.results.not_found.length-5," m\xe9s"]})]})]}),(0,bn.jsx)("button",{className:"import-done-btn",onClick:G,style:{"--platform-color":B[S].color},children:"Fet!"})]}):(0,bn.jsxs)(bn.Fragment,{children:[!I&&!L&&(0,bn.jsxs)(bn.Fragment,{children:[(0,bn.jsxs)("div",{className:"input-group",children:[(0,bn.jsx)("label",{children:B[S].placeholder}),(0,bn.jsx)("input",{type:"text",value:k,onChange:e=>w(e.target.value),placeholder:B[S].placeholder,onKeyDown:e=>"Enter"===e.key&&!P&&V(),disabled:P}),(0,bn.jsx)("span",{className:"input-hint",children:B[S].urlExample})]}),_&&(0,bn.jsxs)("div",{className:"import-error",children:[(0,bn.jsx)(dr,{}),(0,bn.jsx)("span",{children:_})]}),(0,bn.jsx)("button",{className:"import-submit-btn",onClick:V,disabled:P||!k.trim(),style:{"--platform-color":B[S].color},children:P?(0,bn.jsxs)(bn.Fragment,{children:[(0,bn.jsx)("div",{className:"btn-spinner"}),"Cercant..."]}):(0,bn.jsxs)(bn.Fragment,{children:[(0,bn.jsx)(On,{}),"Cercar contingut"]})})]}),I&&!L&&(0,bn.jsxs)("div",{className:"preview-results",children:[(0,bn.jsxs)("div",{className:"preview-summary",children:[(0,bn.jsx)("div",{className:"preview-icon",style:{"--platform-color":B[S].color},children:i.createElement(B[S].icon)}),(0,bn.jsxs)("div",{className:"preview-count",children:[(0,bn.jsx)("span",{className:"count-number",children:I.total_items}),(0,bn.jsx)("span",{className:"count-label",children:"t\xedtols trobats"})]})]}),(0,bn.jsxs)("div",{className:"preview-items",children:[null===(e=I.items)||void 0===e?void 0:e.slice(0,5).map((e,t)=>(0,bn.jsxs)("div",{className:"preview-item",children:[(0,bn.jsx)("span",{children:e.title}),e.year&&(0,bn.jsxs)("span",{className:"item-year",children:["(",e.year,")"]})]},t)),I.total_items>5&&(0,bn.jsxs)("div",{className:"preview-item more",children:["...i ",I.total_items-5," m\xe9s"]})]}),(0,bn.jsxs)("div",{className:"preview-actions",children:[(0,bn.jsx)("button",{className:"import-back-btn",onClick:()=>j(null),children:"Enrere"}),(0,bn.jsxs)("button",{className:"import-submit-btn",onClick:async()=>{if(!I)return;C(!0),N(null),R(null);const e=I.total_items;O({current:0,total:e});const t=setInterval(()=>{O(t=>{const s=Math.max(1,Math.floor(e/20)),n=Math.min(t.current+s,Math.floor(.95*e));return qt(qt({},t),{},{current:n})})},500);try{var s,n;const r=await fn.post("".concat(mn,"/api/import/external"),{username:k.trim(),platform:S});clearInterval(t),O({current:e,total:e}),R(r.data),(null===(s=r.data.results)||void 0===s||null===(n=s.found)||void 0===n?void 0:n.length)>0&&F()}catch(a){var r,i;clearInterval(t),console.error("Error importaci\xf3:",a),N((null===(r=a.response)||void 0===r||null===(i=r.data)||void 0===i?void 0:i.detail)||"Error durant la importaci\xf3. Comprova el nom d'usuari.")}finally{C(!1)}},style:{"--platform-color":B[S].color},children:[(0,bn.jsx)(Yn,{}),"Importar tot"]})]})]}),L&&(0,bn.jsxs)("div",{className:"import-progress",children:[(0,bn.jsx)("div",{className:"progress-icon",children:(0,bn.jsx)("div",{className:"import-spinner"})}),(0,bn.jsx)("h3",{children:"Importaci\xf3 en progr\xe9s..."}),(0,bn.jsxs)("p",{className:"progress-text",children:["Processant ",M.current," de ",M.total," t\xedtols"]}),(0,bn.jsx)("div",{className:"progress-bar-container",children:(0,bn.jsx)("div",{className:"progress-bar",style:{width:"".concat(M.total>0?M.current/M.total*100:0,"%"),"--platform-color":B[S].color}})}),(0,bn.jsx)("p",{className:"progress-hint",children:"Cercant cada t\xedtol a TMDB i afegint a la teva llista..."})]})]})})]})})]}):(0,bn.jsx)("div",{className:"watchlist-container",children:(0,bn.jsxs)("div",{className:"watchlist-empty",children:[(0,bn.jsx)(Mn,{}),(0,bn.jsx)("h2",{children:"Inicia sessi\xf3 per veure la teva llista"}),(0,bn.jsx)("p",{children:"Guarda pel\xb7l\xedcules i s\xe8ries per veure-les m\xe9s tard"}),(0,bn.jsx)("button",{onClick:()=>b("/login"),className:"login-btn",children:"Iniciar sessi\xf3"})]})})};function Cp(e){let{children:t}=e;const{user:s}=Sn();return null!==s&&void 0!==s&&s.is_admin?t:(0,bn.jsx)(xe,{to:"/",replace:!0})}function Ap(){const e=window.location.pathname.replace("/stream/","/debrid/")+window.location.search;return(0,bn.jsx)(xe,{to:e,replace:!0})}function Rp(){const{initialLoading:e,loadingProgress:t,preloadData:s}=wn();return(0,i.useEffect)(()=>{s()},[s]),e?(0,bn.jsx)(Sr,{progress:t}):(0,bn.jsx)(Ie,{children:(0,bn.jsxs)("div",{className:"app",children:[(0,bn.jsxs)("div",{className:"animated-bg",children:[(0,bn.jsx)("div",{className:"bubble bubble-1"}),(0,bn.jsx)("div",{className:"bubble bubble-2"}),(0,bn.jsx)("div",{className:"bubble bubble-3"})]}),(0,bn.jsxs)(Te,{children:[(0,bn.jsx)(Ee,{path:"/play/:type/:id",element:(0,bn.jsx)(xe,{to:"/",replace:!0})}),(0,bn.jsx)(Ee,{path:"/stream/:type/:tmdbId",element:(0,bn.jsx)(Ap,{})}),(0,bn.jsx)(Ee,{path:"/debrid/:type/:tmdbId",element:(0,bn.jsx)(ii,{})}),(0,bn.jsx)(Ee,{path:"/read/:id",element:(0,bn.jsx)(Cp,{children:(0,bn.jsx)(bi,{})})}),(0,bn.jsx)(Ee,{path:"/listen/:id",element:(0,bn.jsx)(Cp,{children:(0,bn.jsx)(Fi,{})})}),(0,bn.jsx)(Ee,{path:"/login",element:(0,bn.jsx)(bp,{})}),(0,bn.jsx)(Ee,{path:"*",element:(0,bn.jsxs)(bn.Fragment,{children:[(0,bn.jsx)(Er,{}),(0,bn.jsx)("main",{className:"main-content",children:(0,bn.jsxs)(Te,{children:[(0,bn.jsx)(Ee,{path:"/",element:(0,bn.jsx)(wr,{})}),(0,bn.jsx)(Ee,{path:"/movies",element:(0,bn.jsx)(Dr,{})}),(0,bn.jsx)(Ee,{path:"/series",element:(0,bn.jsx)(Mr,{})}),(0,bn.jsx)(Ee,{path:"/books",element:(0,bn.jsx)(Cp,{children:(0,bn.jsx)(ci,{})})}),(0,bn.jsx)(Ee,{path:"/audiobooks",element:(0,bn.jsx)(Cp,{children:(0,bn.jsx)(xi,{})})}),(0,bn.jsx)(Ee,{path:"/tv",element:(0,bn.jsx)(Cp,{children:(0,bn.jsx)(hp,{})})}),(0,bn.jsx)(Ee,{path:"/programs",element:(0,bn.jsx)(Cp,{children:(0,bn.jsx)(yp,{})})}),(0,bn.jsx)(Ee,{path:"/movies/:id",element:(0,bn.jsx)(Or,{})}),(0,bn.jsx)(Ee,{path:"/series/:id",element:(0,bn.jsx)(Or,{})}),(0,bn.jsx)(Ee,{path:"/search",element:(0,bn.jsx)(ai,{})}),(0,bn.jsx)(Ee,{path:"/admin",element:(0,bn.jsx)(oi,{})}),(0,bn.jsx)(Ee,{path:"/profile",element:(0,bn.jsx)(Sp,{})}),(0,bn.jsx)(Ee,{path:"/watchlist",element:(0,bn.jsx)(Lp,{})})]})})]})})]})]})})}const _p=function(){return(0,bn.jsx)(En,{children:(0,bn.jsx)(kn,{children:(0,bn.jsx)(Rp,{})})})};o.createRoot(document.getElementById("root")).render((0,bn.jsx)(i.StrictMode,{children:(0,bn.jsx)(_p,{})}))})();
//# sourceMappingURL=main.728efff8.js.map